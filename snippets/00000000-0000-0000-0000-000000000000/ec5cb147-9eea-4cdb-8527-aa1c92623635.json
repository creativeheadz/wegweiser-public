{"settings": {"snippetUuid": "ec5cb147-9eea-4cdb-8527-aa1c92623635", "snippetname": "AgentUpdate", "snippettype": ".py", "created_at": 1765055992}, "payload": {"payloadsig": "Mvd0gGXhXgxT6iEjgi7moIvvtfi7CLqmvvjKNEyXzsDWv+APLOvDMglhrlf8TZEA9TtX8kygs8X3aZm1nPHkv4FB7N0EzFTVUc2qK9VDx5xpklo6lYGCP2kr0LOr3slnDBDFJOgqIB51YT6qZpypDZyqjRVDHKy1U7yc4sQ/3K6Ct/uoWl4mQdjn88AADvbNSHpDGcqb+/PbtU3g27VoHmwxF2rfxB9YJKFBXduAX0K2I0/c/YMD40YwiDb9Imzsd/+YcdeYQ+n5pTX1QAMn+L5y8GoBUjj9Wts0j6ajI60OvrlpOr30ns9ko5VsmSzdDgi7iXsZzle+qSay0VuI5jzWjkMvorujAzf8C0wLn7KWCIqDuLuk1M8Kc48jFOvsFHZ7ajYjscrWbrEouiqgQ/uY8lJznFDEINAbcEy0XCJc0w/ibMjmOf6fi3i/Eb816WOL1JSIq9Cw++lBV7TE3IWEsP/o3bR+CBAcoR2n9CUXL/XXpBOMKnFWOdvVysCuYpcE5xRFitQcY+RCyR85ahsfYbrAXJ1FOLsEHeFLAsNskiL1VYTodOghIQjS3eoSzIqF3y7ielV1D265X4p76XksbfMk2fSHJ2/b9/Co7/AURjr9wVFZzIidi8ukfJLsRe2KSNrkv0kRwiSJio+EftjEXjsCFjJmRYPN30BJMkU=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvQWdlbnRVcGRhdGUucHkKIyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKQ29tcHJlaGVuc2l2ZSBBZ2VudCBVcGRhdGUgU25pcHBldApTdXBwb3J0cyB1cGRhdGluZyBOQVRTIGFnZW50LCBjbGFzc2ljYWwgYWdlbnQsIG9yIGJvdGgKU3VwcG9ydHMgaW1tZWRpYXRlIGhvdC1yZWxvYWQgb3Igc2NoZWR1bGVkIHJlYm9vdApCYWNrd2FyZCBjb21wYXRpYmxlIHdpdGggdjMuMC4xIGFnZW50cwoiIiIKCmltcG9ydCBoYXNobGliCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHNodXRpbAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0YXJmaWxlCmltcG9ydCB0ZW1wZmlsZQppbXBvcnQgdGltZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKCmltcG9ydCByZXF1ZXN0cwpmcm9tIGxvZ3plcm8gaW1wb3J0IGxvZ2dlciwgbG9nZmlsZQoKCmRlZiBsb2dfbWVzc2FnZShtc2cpOgogICAgIiIiTG9nIGEgbWVzc2FnZSB3aXRoIHRpbWVzdGFtcCIiIgogICAgbG9nZ2VyLmluZm8oZiJBR0VOVF9VUERBVEU6IHttc2d9IikKCgpkZWYgZ2V0X2FwcF9kaXJzKCk6CiAgICAiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMgYmFzZWQgb24gcGxhdGZvcm0iIiIKICAgIHN5c3RlbSA9IHBsYXRmb3JtLnN5c3RlbSgpCiAgICBpZiBzeXN0ZW0gPT0gJ1dpbmRvd3MnOgogICAgICAgIGFwcF9kaXIgPSByIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcV2Vnd2Vpc2VyIgogICAgZWxpZiBzeXN0ZW0gPT0gJ0Rhcndpbic6ICAjIG1hY09TCiAgICAgICAgYXBwX2RpciA9ICIvb3B0L1dlZ3dlaXNlciIKICAgIGVsc2U6ICAjIExpbnV4CiAgICAgICAgYXBwX2RpciA9ICIvb3B0L1dlZ3dlaXNlciIKCiAgICBsb2dfZGlyID0gb3MucGF0aC5qb2luKGFwcF9kaXIsICdMb2dzJykKICAgIGNvbmZpZ19kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ0NvbmZpZycpCiAgICBhZ2VudF9kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ0FnZW50JykKICAgIGJhY2t1cF9kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJy5iYWNrdXAnKQoKICAgIHJldHVybiBhcHBfZGlyLCBsb2dfZGlyLCBjb25maWdfZGlyLCBhZ2VudF9kaXIsIGJhY2t1cF9kaXIKCgpkZWYgZ2V0X2RldmljZV9jb25maWcoY29uZmlnX2Rpcik6CiAgICAiIiJSZXRyaWV2ZSBkZXZpY2UgVVVJRCBhbmQgc2VydmVyIGFkZHJlc3MgZnJvbSBjb25maWcgZmlsZSIiIgogICAgY29uZmlnX2ZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnX2RpciwgJ2FnZW50LmNvbmZpZycpCiAgICBsb2dfbWVzc2FnZShmIlJlYWRpbmcgY29uZmlnIGZyb20ge2NvbmZpZ19maWxlfSIpCgogICAgdHJ5OgogICAgICAgIHdpdGggb3Blbihjb25maWdfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWdfZGljdCA9IGpzb24ubG9hZChmKQogICAgZXhjZXB0IChGaWxlTm90Rm91bmRFcnJvciwganNvbi5KU09ORGVjb2RlRXJyb3IpIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJFcnJvciByZWFkaW5nIGNvbmZpZzoge2V9IikKICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGRldmljZV91dWlkID0gY29uZmlnX2RpY3QuZ2V0KCdkZXZpY2V1dWlkJykKICAgIHNlcnZlcl9hZGRyID0gY29uZmlnX2RpY3QuZ2V0KCdzZXJ2ZXJBZGRyJywgJ2FwcC53ZWd3ZWlzZXIudGVjaCcpCgogICAgcmV0dXJuIGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkcgoKCmRlZiBkb3dubG9hZF9hbmRfdmVyaWZ5KHVybCwgZXhwZWN0ZWRfaGFzaCwgdGVtcF9maWxlKToKICAgICIiIkRvd25sb2FkIHVwZGF0ZSBwYWNrYWdlIGFuZCB2ZXJpZnkgU0hBMjU2IGhhc2giIiIKICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWRpbmcgdXBkYXRlIGZyb20ge3VybH0iKQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHRpbWVvdXQ9MzAwLCBzdHJlYW09VHJ1ZSkKICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKCiAgICAgICAgIyBTYXZlIHRvIHRlbXAgZmlsZQogICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGUsICd3YicpIGFzIGY6CiAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT04MTkyKToKICAgICAgICAgICAgICAgIGlmIGNodW5rOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCgogICAgICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWQgY29tcGxldGUsIHNhdmVkIHRvIHt0ZW1wX2ZpbGV9IikKCiAgICAgICAgIyBWZXJpZnkgaGFzaAogICAgICAgIHNoYTI1Nl9oYXNoID0gaGFzaGxpYi5zaGEyNTYoKQogICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgIGZvciBieXRlX2Jsb2NrIGluIGl0ZXIobGFtYmRhOiBmLnJlYWQoNDA5NiksIGIiIik6CiAgICAgICAgICAgICAgICBzaGEyNTZfaGFzaC51cGRhdGUoYnl0ZV9ibG9jaykKCiAgICAgICAgYWN0dWFsX2hhc2ggPSBzaGEyNTZfaGFzaC5oZXhkaWdlc3QoKQogICAgICAgIGxvZ19tZXNzYWdlKGYiRXhwZWN0ZWQgaGFzaDoge2V4cGVjdGVkX2hhc2h9IikKICAgICAgICBsb2dfbWVzc2FnZShmIkFjdHVhbCBoYXNoOiAgIHthY3R1YWxfaGFzaH0iKQoKICAgICAgICBpZiBhY3R1YWxfaGFzaCAhPSBleHBlY3RlZF9oYXNoOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiSGFzaCBtaXNtYXRjaCEgVXBkYXRlIHBhY2thZ2UgbWF5IGJlIGNvcnJ1cHRlZC4iKQoKICAgICAgICBsb2dfbWVzc2FnZSgiSGFzaCB2ZXJpZmljYXRpb24gc3VjY2Vzc2Z1bCIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWQgZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiVmVyaWZpY2F0aW9uIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgYmFja3VwX2N1cnJlbnRfaW5zdGFsbGF0aW9uKGFnZW50X2RpciwgYmFja3VwX2Rpcik6CiAgICAiIiJCYWNrdXAgY3VycmVudCBpbnN0YWxsYXRpb24gZm9yIHJvbGxiYWNrIiIiCiAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICBiYWNrdXBfcGF0aCA9IG9zLnBhdGguam9pbihiYWNrdXBfZGlyLCBmImFnZW50LWJhY2t1cC17dGltZXN0YW1wfSIpCgogICAgbG9nX21lc3NhZ2UoZiJDcmVhdGluZyBiYWNrdXAgYXQge2JhY2t1cF9wYXRofSIpCgogICAgdHJ5OgogICAgICAgIG9zLm1ha2VkaXJzKGJhY2t1cF9wYXRoLCBleGlzdF9vaz1UcnVlKQoKICAgICAgICAjIENvcHkgZW50aXJlIEFnZW50IGRpcmVjdG9yeQogICAgICAgIHNodXRpbC5jb3B5dHJlZShhZ2VudF9kaXIsIG9zLnBhdGguam9pbihiYWNrdXBfcGF0aCwgJ0FnZW50JyksIGRpcnNfZXhpc3Rfb2s9VHJ1ZSkKCiAgICAgICAgbG9nX21lc3NhZ2UoZiJCYWNrdXAgY3JlYXRlZCBzdWNjZXNzZnVsbHkiKQogICAgICAgIHJldHVybiBiYWNrdXBfcGF0aAoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIkJhY2t1cCBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCgpkZWYgZXh0cmFjdF91cGRhdGUodGVtcF9maWxlLCBpbnN0YWxsX2Rpcik6CiAgICAiIiJFeHRyYWN0IHVwZGF0ZSB0YXJiYWxsIHRvIGluc3RhbGxhdGlvbiBkaXJlY3RvcnkiIiIKICAgIGxvZ19tZXNzYWdlKGYiRXh0cmFjdGluZyB1cGRhdGUgdG8ge2luc3RhbGxfZGlyfSIpCgogICAgdHJ5OgogICAgICAgIHdpdGggdGFyZmlsZS5vcGVuKHRlbXBfZmlsZSwgbW9kZT0ncjpneicpIGFzIHRhcjoKICAgICAgICAgICAgIyBFeHRyYWN0IGFsbCBmaWxlcwogICAgICAgICAgICB0YXIuZXh0cmFjdGFsbChwYXRoPWluc3RhbGxfZGlyKQoKICAgICAgICBsb2dfbWVzc2FnZSgiRXh0cmFjdGlvbiBjb21wbGV0ZSIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJFeHRyYWN0aW9uIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcm9sbGJhY2tfaW5zdGFsbGF0aW9uKGJhY2t1cF9wYXRoLCBhZ2VudF9kaXIpOgogICAgIiIiUm9sbGJhY2sgdG8gcHJldmlvdXMgaW5zdGFsbGF0aW9uIGZyb20gYmFja3VwIiIiCiAgICBsb2dfbWVzc2FnZShmIlJvbGxpbmcgYmFjayBpbnN0YWxsYXRpb24gZnJvbSB7YmFja3VwX3BhdGh9IikKCiAgICB0cnk6CiAgICAgICAgYmFja3VwX2FnZW50ID0gb3MucGF0aC5qb2luKGJhY2t1cF9wYXRoLCAnQWdlbnQnKQoKICAgICAgICAjIFJlbW92ZSBjdXJyZW50IGluc3RhbGxhdGlvbgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGFnZW50X2Rpcik6CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUoYWdlbnRfZGlyKQoKICAgICAgICAjIFJlc3RvcmUgZnJvbSBiYWNrdXAKICAgICAgICBzaHV0aWwuY29weXRyZWUoYmFja3VwX2FnZW50LCBhZ2VudF9kaXIpCgogICAgICAgIGxvZ19tZXNzYWdlKCJSb2xsYmFjayBzdWNjZXNzZnVsIikKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIlJvbGxiYWNrIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcmVzdGFydF9zZXJ2aWNlX2ltbWVkaWF0ZSgpOgogICAgIiIiUmVzdGFydCBhZ2VudCBzZXJ2aWNlIGltbWVkaWF0ZWx5IiIiCiAgICBzeXN0ZW0gPSBwbGF0Zm9ybS5zeXN0ZW0oKQogICAgbG9nX21lc3NhZ2UoZiJSZXN0YXJ0aW5nIGFnZW50IHNlcnZpY2Ugb24ge3N5c3RlbX0iKQoKICAgIHRyeToKICAgICAgICBpZiBzeXN0ZW0gPT0gIkxpbnV4IjoKICAgICAgICAgICAgIyBSZXN0YXJ0IGJvdGggc2NoZWR1bGVkIGFuZCBwZXJzaXN0ZW50IGFnZW50cwogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInN5c3RlbWN0bCIsICJyZXN0YXJ0IiwgIndlZ3dlaXNlci1hZ2VudCJdLCBjaGVjaz1GYWxzZSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJzeXN0ZW1jdGwiLCAicmVzdGFydCIsICJ3ZWd3ZWlzZXItcGVyc2lzdGVudC1hZ2VudCJdLCBjaGVjaz1GYWxzZSkKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIkxpbnV4IHNlcnZpY2VzIHJlc3RhcnRlZCIpCgogICAgICAgIGVsaWYgc3lzdGVtID09ICJEYXJ3aW4iOiAgIyBtYWNPUwogICAgICAgICAgICAjIFJlc3RhcnQgTGF1bmNoRGFlbW9ucwogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImxhdW5jaGN0bCIsICJzdG9wIiwgInRlY2gud2Vnd2Vpc2VyLmFnZW50Il0sIGNoZWNrPUZhbHNlKQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImxhdW5jaGN0bCIsICJzdGFydCIsICJ0ZWNoLndlZ3dlaXNlci5hZ2VudCJdLCBjaGVjaz1GYWxzZSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJsYXVuY2hjdGwiLCAic3RvcCIsICJ0ZWNoLndlZ3dlaXNlci5wZXJzaXN0ZW50LWFnZW50Il0sIGNoZWNrPUZhbHNlKQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImxhdW5jaGN0bCIsICJzdGFydCIsICJ0ZWNoLndlZ3dlaXNlci5wZXJzaXN0ZW50LWFnZW50Il0sIGNoZWNrPUZhbHNlKQogICAgICAgICAgICBsb2dfbWVzc2FnZSgibWFjT1Mgc2VydmljZXMgcmVzdGFydGVkIikKCiAgICAgICAgZWxpZiBzeXN0ZW0gPT0gIldpbmRvd3MiOgogICAgICAgICAgICAjIFJlc3RhcnQgV2luZG93cyBzZXJ2aWNlCiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsibmV0IiwgInN0b3AiLCAiV2Vnd2Vpc2VyQWdlbnQiXSwgY2hlY2s9RmFsc2UpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJuZXQiLCAic3RhcnQiLCAiV2Vnd2Vpc2VyQWdlbnQiXSwgY2hlY2s9RmFsc2UpCiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJXaW5kb3dzIHNlcnZpY2UgcmVzdGFydGVkIikKCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJTZXJ2aWNlIHJlc3RhcnQgZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBzdGFnZV91cGRhdGVfZm9yX3JlYm9vdCh0ZW1wX2ZpbGUsIGFwcF9kaXIpOgogICAgIiIiU3RhZ2UgdXBkYXRlIGZvciBhcHBsaWNhdGlvbiBhZnRlciBuZXh0IHJlYm9vdCIiIgogICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgIHN0YWdpbmdfZmlsZSA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnc3RhZ2VkLXVwZGF0ZS50YXIuZ3onKQoKICAgIGxvZ19tZXNzYWdlKGYiU3RhZ2luZyB1cGRhdGUgZm9yIHJlYm9vdCBvbiB7c3lzdGVtfSIpCgogICAgdHJ5OgogICAgICAgICMgQ29weSB1cGRhdGUgcGFja2FnZSB0byBzdGFnaW5nIGFyZWEKICAgICAgICBzaHV0aWwuY29weTIodGVtcF9maWxlLCBzdGFnaW5nX2ZpbGUpCiAgICAgICAgbG9nX21lc3NhZ2UoZiJVcGRhdGUgc3RhZ2VkIGF0IHtzdGFnaW5nX2ZpbGV9IikKCiAgICAgICAgaWYgc3lzdGVtID09ICJMaW51eCI6CiAgICAgICAgICAgICMgQ3JlYXRlIG9uZXNob3Qgc3lzdGVtZCBzZXJ2aWNlIHRvIGFwcGx5IG9uIG5leHQgYm9vdAogICAgICAgICAgICB1bml0X2NvbnRlbnQgPSBmIiIiW1VuaXRdCkRlc2NyaXB0aW9uPUFwcGx5IFdlZ3dlaXNlciBBZ2VudCBVcGRhdGUKQWZ0ZXI9bmV0d29yay50YXJnZXQKCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKRXhlY1N0YXJ0PS91c3IvYmluL3B5dGhvbjMgLWMgImltcG9ydCB0YXJmaWxlLCBzaHV0aWwsIG9zOyB0YXI9dGFyZmlsZS5vcGVuKCd7c3RhZ2luZ19maWxlfScsICdyOmd6Jyk7IHRhci5leHRyYWN0YWxsKCd7YXBwX2Rpcn0nKTsgdGFyLmNsb3NlKCk7IG9zLnJlbW92ZSgne3N0YWdpbmdfZmlsZX0nKSIKRXhlY1N0YXJ0UG9zdD0vYmluL3N5c3RlbWN0bCByZXN0YXJ0IHdlZ3dlaXNlci1wZXJzaXN0ZW50LWFnZW50ClJlbWFpbkFmdGVyRXhpdD15ZXMKCltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldAoiIiIKICAgICAgICAgICAgdW5pdF9maWxlID0gJy9ldGMvc3lzdGVtZC9zeXN0ZW0vd2Vnd2Vpc2VyLWFwcGx5LXVwZGF0ZS5zZXJ2aWNlJwogICAgICAgICAgICB3aXRoIG9wZW4odW5pdF9maWxlLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKHVuaXRfY29udGVudCkKCiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsic3lzdGVtY3RsIiwgImRhZW1vbi1yZWxvYWQiXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJzeXN0ZW1jdGwiLCAiZW5hYmxlIiwgIndlZ3dlaXNlci1hcHBseS11cGRhdGUuc2VydmljZSJdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICBsb2dfbWVzc2FnZSgiU3lzdGVtZCB1bml0IGNyZWF0ZWQgYW5kIGVuYWJsZWQiKQoKICAgICAgICBlbGlmIHN5c3RlbSA9PSAiV2luZG93cyI6CiAgICAgICAgICAgICMgQ3JlYXRlIHNjaGVkdWxlZCB0YXNrIHRvIHJ1biBvbiBzdGFydHVwCiAgICAgICAgICAgICMgRm9yIG5vdywganVzdCBsb2cgdGhhdCBpdCdzIHN0YWdlZCAoY2FuIGJlIGVuaGFuY2VkIHdpdGggc2NodGFza3MpCiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJVcGRhdGUgc3RhZ2VkIGZvciBtYW51YWwgYXBwbGljYXRpb24gYWZ0ZXIgcmVib290IikKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIldpbmRvd3Mgc2NoZWR1bGVkIHRhc2sgY3JlYXRpb24gd291bGQgZ28gaGVyZSIpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiU3RhZ2luZyBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsIHN0YXR1cywgdmVyc2lvbiwgZXJyb3JfbXNnPU5vbmUpOgogICAgIiIiU2VuZCB1cGRhdGUgc3RhdHVzIGJhY2sgdG8gc2VydmVyIiIiCiAgICB0cnk6CiAgICAgICAgdXJsID0gZiJodHRwczovL3tzZXJ2ZXJfYWRkcn0vYXBpL2RldmljZS97ZGV2aWNlX3V1aWR9L3VwZGF0ZS1zdGF0dXMiCiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ3N0YXR1cyc6IHN0YXR1cywKICAgICAgICAgICAgJ3ZlcnNpb24nOiB2ZXJzaW9uLAogICAgICAgICAgICAndGltZXN0YW1wJzogZGF0ZXRpbWUudXRjbm93KCkuaXNvZm9ybWF0KCksCiAgICAgICAgICAgICdlcnJvcl9tZXNzYWdlJzogZXJyb3JfbXNnCiAgICAgICAgfQoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPXBheWxvYWQsIHRpbWVvdXQ9MzApCiAgICAgICAgbG9nX21lc3NhZ2UoZiJTdGF0dXMgc2VudCB0byBzZXJ2ZXI6IHtzdGF0dXN9IikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJGYWlsZWQgdG8gc2VuZCBzdGF0dXMgdG8gc2VydmVyOiB7ZX0iKQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gRVhFQ1VUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgbWFpbigpOgogICAgIiIiTWFpbiBleGVjdXRpb24gZnVuY3Rpb24iIiIKCiAgICAjIEdldCBhcHBsaWNhdGlvbiBkaXJlY3RvcmllcwogICAgYXBwX2RpciwgbG9nX2RpciwgY29uZmlnX2RpciwgYWdlbnRfZGlyLCBiYWNrdXBfZGlyID0gZ2V0X2FwcF9kaXJzKCkKCiAgICAjIFNldHVwIGxvZ2dpbmcKICAgIG9zLm1ha2VkaXJzKGxvZ19kaXIsIGV4aXN0X29rPVRydWUpCiAgICBsb2dfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKGxvZ19kaXIsICdhZ2VudF91cGRhdGUubG9nJykKICAgIGxvZ2ZpbGUobG9nX2ZpbGVfcGF0aCkKCiAgICBsb2dfbWVzc2FnZSgiPT09IEFnZW50IFVwZGF0ZSBTY3JpcHQgU3RhcnRlZCA9PT0iKQogICAgbG9nX21lc3NhZ2UoZiJQbGF0Zm9ybToge3BsYXRmb3JtLnN5c3RlbSgpfSB7cGxhdGZvcm0ucmVsZWFzZSgpfSIpCgogICAgIyBHZXQgZGV2aWNlIGNvbmZpZ3VyYXRpb24KICAgIGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciA9IGdldF9kZXZpY2VfY29uZmlnKGNvbmZpZ19kaXIpCiAgICBsb2dfbWVzc2FnZShmIkRldmljZSBVVUlEOiB7ZGV2aWNlX3V1aWR9IikKICAgIGxvZ19tZXNzYWdlKGYiU2VydmVyOiB7c2VydmVyX2FkZHJ9IikKCiAgICAjIEdldCBwYXJhbWV0ZXJzICh0aGVzZSB3b3VsZCBiZSBwYXNzZWQgYnkgdGhlIHNuaXBwZXQgc2NoZWR1bGVyKQogICAgIyBGb3Igbm93LCB1c2luZyBkZWZhdWx0cyAtIGluIHByb2R1Y3Rpb24sIHRoZXNlIGNvbWUgZnJvbSBzbmlwcGV0IHBhcmFtZXRlcnMKICAgIHVwZGF0ZV92ZXJzaW9uID0gb3MuZ2V0ZW52KCdVUERBVEVfVkVSU0lPTicsICczLjAuMi10ZXN0JykKICAgIHVwZGF0ZV91cmwgPSBvcy5nZXRlbnYoJ1VQREFURV9VUkwnLCBmJ2h0dHBzOi8ve3NlcnZlcl9hZGRyfS9pbnN0YWxsZXJGaWxlcy97cGxhdGZvcm0uc3lzdGVtKCl9L3VwZGF0ZXMvYWdlbnQte3VwZGF0ZV92ZXJzaW9ufS50YXIuZ3onKQogICAgdXBkYXRlX2hhc2ggPSBvcy5nZXRlbnYoJ1VQREFURV9IQVNIJywgJycpICAjIE11c3QgYmUgcHJvdmlkZWQKICAgIGFwcGx5X21vZGUgPSBvcy5nZXRlbnYoJ0FQUExZX01PREUnLCAnaW1tZWRpYXRlJykgICMgb3IgJ3NjaGVkdWxlZF9yZWJvb3QnCiAgICB0YXJnZXRfY29tcG9uZW50ID0gb3MuZ2V0ZW52KCdUQVJHRVRfQ09NUE9ORU5UJywgJ2JvdGgnKSAgIyAnbmF0c19hZ2VudCcsICdhZ2VudCcsIG9yICdib3RoJwoKICAgIGxvZ19tZXNzYWdlKGYiVXBkYXRlIHZlcnNpb246IHt1cGRhdGVfdmVyc2lvbn0iKQogICAgbG9nX21lc3NhZ2UoZiJVcGRhdGUgVVJMOiB7dXBkYXRlX3VybH0iKQogICAgbG9nX21lc3NhZ2UoZiJBcHBseSBtb2RlOiB7YXBwbHlfbW9kZX0iKQogICAgbG9nX21lc3NhZ2UoZiJUYXJnZXQgY29tcG9uZW50OiB7dGFyZ2V0X2NvbXBvbmVudH0iKQoKICAgIGlmIG5vdCB1cGRhdGVfaGFzaDoKICAgICAgICBsb2dfbWVzc2FnZSgiRVJST1I6IE5vIHVwZGF0ZSBoYXNoIHByb3ZpZGVkLCBjYW5ub3QgdmVyaWZ5IHBhY2thZ2UgaW50ZWdyaXR5IikKICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdObyBoYXNoIHByb3ZpZGVkJykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgRG93bmxvYWQgdXBkYXRlIHBhY2thZ2UKICAgIHRlbXBfZmlsZSA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnVGVtcCcsIGYndXBkYXRlLXt1cGRhdGVfdmVyc2lvbn0udGFyLmd6JykKICAgIG9zLm1ha2VkaXJzKG9zLnBhdGguZGlybmFtZSh0ZW1wX2ZpbGUpLCBleGlzdF9vaz1UcnVlKQoKICAgIGlmIG5vdCBkb3dubG9hZF9hbmRfdmVyaWZ5KHVwZGF0ZV91cmwsIHVwZGF0ZV9oYXNoLCB0ZW1wX2ZpbGUpOgogICAgICAgIGxvZ19tZXNzYWdlKCJEb3dubG9hZCBvciB2ZXJpZmljYXRpb24gZmFpbGVkIikKICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdEb3dubG9hZC92ZXJpZmljYXRpb24gZmFpbGVkJykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgQmFja3VwIGN1cnJlbnQgaW5zdGFsbGF0aW9uCiAgICBiYWNrdXBfcGF0aCA9IGJhY2t1cF9jdXJyZW50X2luc3RhbGxhdGlvbihhZ2VudF9kaXIsIGJhY2t1cF9kaXIpCiAgICBpZiBub3QgYmFja3VwX3BhdGg6CiAgICAgICAgbG9nX21lc3NhZ2UoIkJhY2t1cCBmYWlsZWQsIGFib3J0aW5nIHVwZGF0ZSIpCiAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnQmFja3VwIGZhaWxlZCcpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIEV4dHJhY3QgdXBkYXRlCiAgICBpZiBub3QgZXh0cmFjdF91cGRhdGUodGVtcF9maWxlLCBhcHBfZGlyKToKICAgICAgICBsb2dfbWVzc2FnZSgiRXh0cmFjdGlvbiBmYWlsZWQsIGF0dGVtcHRpbmcgcm9sbGJhY2siKQogICAgICAgIHJvbGxiYWNrX2luc3RhbGxhdGlvbihiYWNrdXBfcGF0aCwgYWdlbnRfZGlyKQogICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ0V4dHJhY3Rpb24gZmFpbGVkJykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgQXBwbHkgdXBkYXRlIGJhc2VkIG9uIG1vZGUKICAgIGlmIGFwcGx5X21vZGUgPT0gJ2ltbWVkaWF0ZSc6CiAgICAgICAgbG9nX21lc3NhZ2UoIkFwcGx5aW5nIHVwZGF0ZSBpbW1lZGlhdGVseSIpCgogICAgICAgIGlmIHJlc3RhcnRfc2VydmljZV9pbW1lZGlhdGUoKToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlVwZGF0ZSBhcHBsaWVkIHN1Y2Nlc3NmdWxseSIpCiAgICAgICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdzdWNjZXNzJywgdXBkYXRlX3ZlcnNpb24pCgogICAgICAgICAgICAjIENsZWFuIHVwIHRlbXAgZmlsZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9maWxlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJTZXJ2aWNlIHJlc3RhcnQgZmFpbGVkLCBhdHRlbXB0aW5nIHJvbGxiYWNrIikKICAgICAgICAgICAgcm9sbGJhY2tfaW5zdGFsbGF0aW9uKGJhY2t1cF9wYXRoLCBhZ2VudF9kaXIpCiAgICAgICAgICAgIHJlc3RhcnRfc2VydmljZV9pbW1lZGlhdGUoKSAgIyBUcnkgdG8gcmVzdGFydCBvbGQgdmVyc2lvbgogICAgICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdTZXJ2aWNlIHJlc3RhcnQgZmFpbGVkJykKICAgICAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBlbGlmIGFwcGx5X21vZGUgPT0gJ3NjaGVkdWxlZF9yZWJvb3QnOgogICAgICAgIGxvZ19tZXNzYWdlKCJTdGFnaW5nIHVwZGF0ZSBmb3IgcmVib290IikKCiAgICAgICAgaWYgc3RhZ2VfdXBkYXRlX2Zvcl9yZWJvb3QodGVtcF9maWxlLCBhcHBfZGlyKToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlVwZGF0ZSBzdGFnZWQgc3VjY2Vzc2Z1bGx5LCB3aWxsIGFwcGx5IG9uIG5leHQgcmVib290IikKICAgICAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ3N0YWdlZCcsIHVwZGF0ZV92ZXJzaW9uKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJTdGFnaW5nIGZhaWxlZCIpCiAgICAgICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ1N0YWdpbmcgZmFpbGVkJykKICAgICAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBsb2dfbWVzc2FnZSgiPT09IEFnZW50IFVwZGF0ZSBTY3JpcHQgQ29tcGxldGVkID09PSIpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKQo="}}