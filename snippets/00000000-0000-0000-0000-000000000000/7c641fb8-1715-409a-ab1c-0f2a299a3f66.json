{"settings": {"snippetUuid": "7c641fb8-1715-409a-ab1c-0f2a299a3f66", "snippetname": "LinuxAudit", "snippettype": ".py", "created_at": 1763062562}, "payload": {"payloadsig": "G0OGGvu+L+KvzyL3Z92oE9mQoqSk3LfmyoJXVl5ecLSA4iGhOBJpkzKmqx4kfRda96u8q2ED052ufb4TJJY/quPNHcavzpXBRJ8GdXy4yJeW3/U6XIIkvxAP1IbrYjQPCMGuZ7LajYYcxU+yb20yHIEQTqo4FvEgUqimE3u1oV9EFvpDHLogY3jFeJRdfK53EbgA4ibY4cdE1w+1evGcsy5XzYmRRGgZrbuP6kFSDeufSR99zcoc0CyA40JCekCYn4MFwVJbnsfYWGpXgnu6kZXbryBqZ5KP7ajemx0kRnum677DAUOT7TuR+1AeSKL2XpgU+M5jNcPJQM9Hr+SWdKX2JVnzSjs7/0Iih0k++IEYc0jKRIBMeQzumgxFzIVtRqmw/2k2FAQrcYZY19nnqqoX0hFNFdQ87zWvsNzP9qm3NdJSbniMWoyhN7qjDoAnSdx7e7tx23B66KJ4OWVviI+gB7ZBl5QhJ7kht3HY8y5I8BZ3sIb1injPAP8xucq8lIb6BLFvSzAZvbhi+jYQD0azVpplc2k9rBwmWhU48DHCPf8h1xV16dUMhRztaaQp+PNLtvfNjLwspCE+DhZU+LNaoCppmE/dml+G/N312wjSMqw6cGttHIQ5oDxAUzqd/pgvsA2Emqqh4O5AYR8d2ypxzJz+ulfRlagOsyYOK5k=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvTGludXhBdWRpdC5weQoiIiIKTGludXgtc3BlY2lmaWMgYXVkaXQgY29sbGVjdG9yIGZvciBXZWd3ZWlzZXIKQ29sbGVjdHMgY29tcHJlaGVuc2l2ZSBzeXN0ZW0gaW5mb3JtYXRpb24gdXNpbmcgcHN1dGlsIGFuZCBMaW51eC1zcGVjaWZpYyB0b29scwpTZWxmLWNvbnRhaW5lZCBzbmlwcGV0IHdpdGggYWxsIHV0aWxpdGllcyBpbmxpbmVkLgoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBtYXRoCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIElOTElORUQgVVRJTElUSUVTIChmcm9tIEF1ZGl0Q29tbW9uKSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgY29udmVydFNpemUoc2l6ZUJ5dGVzKToKICAgICIiIkNvbnZlcnQgYnl0ZXMgdG8gaHVtYW4tcmVhZGFibGUgZm9ybWF0IiIiCiAgICBpZiBzaXplQnl0ZXMgPT0gMDoKICAgICAgICByZXR1cm4gIjAgQiIKICAgIHNpemVOYW1lID0gKCJCIiwgIktCIiwgIk1CIiwgIkdCIiwgIlRCIiwgIlBCIiwgIkVCIiwgIlpCIiwgIllCIikKICAgIGkgPSBpbnQobWF0aC5mbG9vcihtYXRoLmxvZyhzaXplQnl0ZXMsIDEwMjQpKSkKICAgIHAgPSBtYXRoLnBvdygxMDI0LCBpKQogICAgcyA9IHJvdW5kKHNpemVCeXRlcyAvIHAsIDIpCiAgICByZXR1cm4gZid7c30ge3NpemVOYW1lW2ldfScKCmRlZiBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCBlbmRwb2ludCwgaG9zdCwgZGVidWdNb2RlPUZhbHNlKToKICAgICIiIlNlbmQgSlNPTiBwYXlsb2FkIHRvIEZsYXNrIGVuZHBvaW50IiIiCiAgICB1cmwgPSBmJ2h0dHBzOi8ve2hvc3R9e2VuZHBvaW50fScKICAgIGlmIGRlYnVnTW9kZToKICAgICAgICBsb2dnZXIuZGVidWcoZidwYXlsb2FkIHRvIHNlbmQ6IHtwYXlsb2FkfScpCiAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQXR0ZW1wdGluZyB0byBjb25uZWN0IHRvIHt1cmx9JykKICAgIGhlYWRlcnMgPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30KICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKHBheWxvYWQpKQogICAgcmV0dXJuIHJlc3BvbnNlCgpkZWYgZ2V0UHVibGljSXBBZGRyKCk6CiAgICAiIiJHZXQgcHVibGljIElQIGFkZHJlc3MiIiIKICAgIG9kRG5zU2VydmVyID0gJzIwOC42Ny4yMjIuMjIyJwogICAgaHR0cERuc1NlcnZlciA9ICdodHRwczovL2ljYW5oYXppcC5jb20nCiAgICBkbnNSZXNvbHZlciA9IGRucy5yZXNvbHZlci5SZXNvbHZlcigpCiAgICBkbnNSZXNvbHZlci5uYW1lc2VydmVycyA9IFtvZERuc1NlcnZlcl0KICAgIHB1YmxpY0lwID0gTm9uZQoKICAgIHRyeToKICAgICAgICBhbnN3ZXJzID0gZG5zUmVzb2x2ZXIucmVzb2x2ZSgnbXlpcC5vcGVuZG5zLmNvbScsICdBJykKICAgICAgICBmb3IgaXAgaW4gYW5zd2VyczoKICAgICAgICAgICAgcHVibGljSXAgPSBpcC50b190ZXh0KCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHB1YmxpY0lQIGZyb20ge29kRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoKICAgIGlmIG5vdCBwdWJsaWNJcDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoaHR0cERuc1NlcnZlcikKICAgICAgICAgICAgcHVibGljSXAgPSByLnRleHQuc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtodHRwRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoKICAgIGlmIG5vdCBwdWJsaWNJcDoKICAgICAgICBwdWJsaWNJcCA9ICcwLjAuMC4wJwoKICAgIHJldHVybiBwdWJsaWNJcAoKZGVmIGdldFVzZXJIb21lUGF0aCgpOgogICAgIiIiR2V0IHVzZXIgaG9tZSBkaXJlY3RvcnkgcGF0aCIiIgogICAgdXNlckhvbWVQYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKCJ+IikKICAgIGxvZ2dlci5pbmZvKGYndXNlckhvbWVQYXRoOiB7dXNlckhvbWVQYXRofScpCiAgICByZXR1cm4gdXNlckhvbWVQYXRoCgpkZWYgZ2V0RGV2aWNlVXVpZChjb25maWdGaWxlKToKICAgICIiIkdldCBkZXZpY2UgVVVJRCBmcm9tIGNvbmZpZyBmaWxlIiIiCiAgICBsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gcmVhZCB7Y29uZmlnRmlsZX0nKQogICAgdHJ5OgogICAgICAgIHdpdGggb3Blbihjb25maWdGaWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICBkZXZpY2VVdWlkID0gY29uZmlnLmdldCgnZGV2aWNldXVpZCcpICAjIGxvd2VyY2FzZSB0byBtYXRjaCBjb25maWcgZmlsZQogICAgICAgICAgICBob3N0ID0gY29uZmlnLmdldCgnc2VydmVyQWRkcicsICdhcHAud2Vnd2Vpc2VyLnRlY2gnKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmJ2RldmljZVV1aWQ6IHtkZXZpY2VVdWlkfScpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VVdWlkLCBob3N0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHJlYWQgY29uZmlnIGZpbGU6IHtlfScpCiAgICAgICAgcmV0dXJuIE5vbmUsICdhcHAud2Vnd2Vpc2VyLnRlY2gnCgpkZWYgZ2V0QXBwRGlycygpOgogICAgIiIiR2V0IGFwcGxpY2F0aW9uIGRpcmVjdG9yaWVzIiIiCiAgICB1c2VySG9tZVBhdGggPSBnZXRVc2VySG9tZVBhdGgoKQogICAgYXBwRGlyID0gb3MucGF0aC5qb2luKHVzZXJIb21lUGF0aCwgJy53ZWd3ZWlzZXInKQogICAgbG9nRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2xvZ3MnKQogICAgY29uZmlnRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2NvbmZpZycpCiAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ3RlbXAnKQogICAgZmlsZXNEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnZmlsZXMnKQoKICAgIGZvciBkaXJlY3RvcnkgaW4gW2FwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyXToKICAgICAgICBvcy5tYWtlZGlycyhkaXJlY3RvcnksIGV4aXN0X29rPVRydWUpCgogICAgbG9nZ2VyLmluZm8oZidhcHBEaXI6IHthcHBEaXJ9JykKICAgIHJldHVybiBhcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0RpcgoKZGVmIGRlbEZpbGUoZmlsZVRvRGVsZXRlKToKICAgICIiIkRlbGV0ZSBhIGZpbGUiIiIKICAgIGxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uLi4nKQogICAgdHJ5OgogICAgICAgIG9zLnJlbW92ZShmaWxlVG9EZWxldGUpCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZGVsZXRlZCB7ZmlsZVRvRGVsZXRlfS4nKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uIFJlYXNvbjoge2V9JykKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgSU5MSU5FRCBQU1VUSUwgTUVUUklDUyAoZnJvbSBQc3V0aWxNZXRyaWNzKSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgZ2V0Q3B1TWV0cmljcygpOgogICAgIiIiR2F0aGVyIGNvbXByZWhlbnNpdmUgQ1BVIG1ldHJpY3MgdXNpbmcgcHN1dGlsIiIiCiAgICB0cnk6CiAgICAgICAgY3B1X21ldHJpY3MgPSB7fQoKICAgICAgICAjIENvcmUgaW5mb3JtYXRpb24KICAgICAgICBjcHVfbWV0cmljc1snY29yZXNfbG9naWNhbCddID0gcHN1dGlsLmNwdV9jb3VudChsb2dpY2FsPVRydWUpCiAgICAgICAgY3B1X21ldHJpY3NbJ2NvcmVzX3BoeXNpY2FsJ10gPSBwc3V0aWwuY3B1X2NvdW50KGxvZ2ljYWw9RmFsc2UpCgogICAgICAgICMgRnJlcXVlbmN5IGluZm9ybWF0aW9uCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcmVxID0gcHN1dGlsLmNwdV9mcmVxKCkKICAgICAgICAgICAgaWYgZnJlcToKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfY3VycmVudCddID0gcm91bmQoZnJlcS5jdXJyZW50LCAyKQogICAgICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2ZyZXF1ZW5jeV9taW4nXSA9IHJvdW5kKGZyZXEubWluLCAyKQogICAgICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2ZyZXF1ZW5jeV9tYXgnXSA9IHJvdW5kKGZyZXEubWF4LCAyKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgZnJlcXVlbmN5OiB7ZX0nKQoKICAgICAgICAjIFBlci1DUFUgdXNhZ2UgcGVyY2VudGFnZQogICAgICAgIHRyeToKICAgICAgICAgICAgY3B1X3BlcmNlbnQgPSBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSwgcGVyY3B1PVRydWUpCiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfcGVyY2VudCddID0gW3JvdW5kKHAsIDIpIGZvciBwIGluIGNwdV9wZXJjZW50XQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBwZXItQ1BVIHBlcmNlbnQ6IHtlfScpCgogICAgICAgICMgT3ZlcmFsbCBDUFUgdXNhZ2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfcGVyY2VudF9vdmVyYWxsJ10gPSByb3VuZChwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MC4xKSwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgb3ZlcmFsbCBDUFUgcGVyY2VudDoge2V9JykKCiAgICAgICAgIyBDUFUgdGltZXMgKHVzZXIsIHN5c3RlbSwgaWRsZSwgaW93YWl0LCBpcnEsIHNvZnRpcnEpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0aW1lcyA9IHBzdXRpbC5jcHVfdGltZXMoKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3RpbWVzJ10gPSB7CiAgICAgICAgICAgICAgICAndXNlcic6IHJvdW5kKHRpbWVzLnVzZXIsIDIpLAogICAgICAgICAgICAgICAgJ3N5c3RlbSc6IHJvdW5kKHRpbWVzLnN5c3RlbSwgMiksCiAgICAgICAgICAgICAgICAnaWRsZSc6IHJvdW5kKHRpbWVzLmlkbGUsIDIpLAogICAgICAgICAgICAgICAgJ2lvd2FpdCc6IHJvdW5kKHRpbWVzLmlvd2FpdCwgMikgaWYgaGFzYXR0cih0aW1lcywgJ2lvd2FpdCcpIGVsc2UgTm9uZSwKICAgICAgICAgICAgICAgICdpcnEnOiByb3VuZCh0aW1lcy5pcnEsIDIpIGlmIGhhc2F0dHIodGltZXMsICdpcnEnKSBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAnc29mdGlycSc6IHJvdW5kKHRpbWVzLnNvZnRpcnEsIDIpIGlmIGhhc2F0dHIodGltZXMsICdzb2Z0aXJxJykgZWxzZSBOb25lLAogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IENQVSB0aW1lczoge2V9JykKCiAgICAgICAgIyBDUFUgc3RhdGlzdGljcyAoY29udGV4dCBzd2l0Y2hlcywgaW50ZXJydXB0cykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0YXRzID0gcHN1dGlsLmNwdV9zdGF0cygpCiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfc3RhdHMnXSA9IHsKICAgICAgICAgICAgICAgICdjdHhfc3dpdGNoZXMnOiBzdGF0cy5jdHhfc3dpdGNoZXMsCiAgICAgICAgICAgICAgICAnaW50ZXJydXB0cyc6IHN0YXRzLmludGVycnVwdHMsCiAgICAgICAgICAgICAgICAnc29mdF9pbnRlcnJ1cHRzJzogc3RhdHMuc29mdF9pbnRlcnJ1cHRzLAogICAgICAgICAgICAgICAgJ3N5c2NhbGxzJzogc3RhdHMuc3lzY2FsbHMgaWYgaGFzYXR0cihzdGF0cywgJ3N5c2NhbGxzJykgZWxzZSBOb25lLAogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IENQVSBzdGF0czoge2V9JykKCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZ2F0aGVyZWQgQ1BVIG1ldHJpY3MnKQogICAgICAgIHJldHVybiBjcHVfbWV0cmljcwoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnYXRoZXJpbmcgQ1BVIG1ldHJpY3M6IHtlfScpCiAgICAgICAgcmV0dXJuIHt9CgpkZWYgZ2V0TWVtb3J5TWV0cmljcygpOgogICAgIiIiR2F0aGVyIGNvbXByZWhlbnNpdmUgbWVtb3J5IG1ldHJpY3MgdXNpbmcgcHN1dGlsIiIiCiAgICB0cnk6CiAgICAgICAgbWVtb3J5X21ldHJpY3MgPSB7fQoKICAgICAgICAjIFZpcnR1YWwgbWVtb3J5IGRldGFpbHMKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZtZW0gPSBwc3V0aWwudmlydHVhbF9tZW1vcnkoKQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snYnVmZmVycyddID0gdm1lbS5idWZmZXJzIGlmIGhhc2F0dHIodm1lbSwgJ2J1ZmZlcnMnKSBlbHNlIE5vbmUKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ2NhY2hlZCddID0gdm1lbS5jYWNoZWQgaWYgaGFzYXR0cih2bWVtLCAnY2FjaGVkJykgZWxzZSBOb25lCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzaGFyZWQnXSA9IHZtZW0uc2hhcmVkIGlmIGhhc2F0dHIodm1lbSwgJ3NoYXJlZCcpIGVsc2UgTm9uZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1sncGVyY2VudCddID0gcm91bmQodm1lbS5wZXJjZW50LCAyKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCB2aXJ0dWFsIG1lbW9yeSBkZXRhaWxzOiB7ZX0nKQoKICAgICAgICAjIFN3YXAgbWVtb3J5IGRldGFpbHMKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN3YXAgPSBwc3V0aWwuc3dhcF9tZW1vcnkoKQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF90b3RhbCddID0gc3dhcC50b3RhbAogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF91c2VkJ10gPSBzd2FwLnVzZWQKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfZnJlZSddID0gc3dhcC5mcmVlCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzd2FwX3BlcmNlbnQnXSA9IHJvdW5kKHN3YXAucGVyY2VudCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgc3dhcCBtZW1vcnkgZGV0YWlsczoge2V9JykKCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZ2F0aGVyZWQgbWVtb3J5IG1ldHJpY3MnKQogICAgICAgIHJldHVybiBtZW1vcnlfbWV0cmljcwoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnYXRoZXJpbmcgbWVtb3J5IG1ldHJpY3M6IHtlfScpCiAgICAgICAgcmV0dXJuIHt9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIENPTkZJR1VSQVRJT04gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVidWdNb2RlID0gVHJ1ZQpob3N0ID0gJ2FwcC53ZWd3ZWlzZXIudGVjaCcKcG9ydCA9IDQ0MwoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdUluZm8oZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IENQVSBpbmZvcm1hdGlvbiBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgogICAgdHJ5OgogICAgICAgICMgR2V0IENQVSBuYW1lIGZyb20gbHNjcHUKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWydsc2NwdSddLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBjcHVOYW1lID0gJ1Vua25vd24nCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdNb2RlbCBuYW1lJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgY3B1TmFtZSA9IGxpbmUuc3BsaXQoJ01vZGVsIG5hbWU6JylbMV0uc3RyaXAoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmJ2NwdU5hbWU6IHtjcHVOYW1lfScpCiAgICAgICAgCiAgICAgICAgIyBHZXQgY29tcHJlaGVuc2l2ZSBDUFUgbWV0cmljcwogICAgICAgIGNwdV9tZXRyaWNzID0gZ2V0Q3B1TWV0cmljcygpCiAgICAgICAgCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2NwdSddID0gewogICAgICAgICAgICAnY3B1bmFtZSc6IGNwdU5hbWUsCiAgICAgICAgICAgICdjcHVfbWV0cmljcyc6IGNwdV9tZXRyaWNzCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgQ1BVIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2NwdSddID0gewogICAgICAgICAgICAnY3B1bmFtZSc6ICdVbmtub3duJywKICAgICAgICAgICAgJ2NwdV9tZXRyaWNzJzoge30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0TWVtb3J5RGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbWVtb3J5IGluZm9ybWF0aW9uIGluY2x1ZGluZyBjb21wcmVoZW5zaXZlIHBzdXRpbCBtZXRyaWNzIiIiCiAgICB0cnk6CiAgICAgICAgdm1lbSA9IHBzdXRpbC52aXJ0dWFsX21lbW9yeSgpCiAgICAgICAgCiAgICAgICAgIyBCYXNpYyBtZW1vcnkgaW5mbwogICAgICAgIHRvdGFsTWVtb3J5ID0gdm1lbS50b3RhbAogICAgICAgIGF2YWlsYWJsZU1lbW9yeSA9IHZtZW0uYXZhaWxhYmxlCiAgICAgICAgdXNlZE1lbW9yeSA9IHZtZW0udXNlZAogICAgICAgIGZyZWVNZW1vcnkgPSB2bWVtLmZyZWUKICAgICAgICAKICAgICAgICAjIEdldCBjb21wcmVoZW5zaXZlIG1lbW9yeSBtZXRyaWNzCiAgICAgICAgbWVtb3J5X21ldHJpY3MgPSBnZXRNZW1vcnlNZXRyaWNzKCkKICAgICAgICAKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWVtb3J5J10gPSB7CiAgICAgICAgICAgICd0b3RhbCc6IHRvdGFsTWVtb3J5LAogICAgICAgICAgICAnYXZhaWxhYmxlJzogYXZhaWxhYmxlTWVtb3J5LAogICAgICAgICAgICAndXNlZCc6IHVzZWRNZW1vcnksCiAgICAgICAgICAgICdmcmVlJzogZnJlZU1lbW9yeSwKICAgICAgICAgICAgJ21lbW9yeV9tZXRyaWNzJzogbWVtb3J5X21ldHJpY3MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZidNZW1vcnk6IHtjb252ZXJ0U2l6ZSh0b3RhbE1lbW9yeSl9IHRvdGFsJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG1lbW9yeSBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydtZW1vcnknXSA9IHsKICAgICAgICAgICAgJ3RvdGFsJzogMCwKICAgICAgICAgICAgJ2F2YWlsYWJsZSc6IDAsCiAgICAgICAgICAgICd1c2VkJzogMCwKICAgICAgICAgICAgJ2ZyZWUnOiAwLAogICAgICAgICAgICAnbWVtb3J5X21ldHJpY3MnOiB7fQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTeXN0ZW1EYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBzeXN0ZW0gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ10gPSB7CiAgICAgICAgICAgICdkZXZpY2VQbGF0Zm9ybSc6IGYieyhwbGF0Zm9ybS5zeXN0ZW0oKSBvciAnVW5rbm93bicpfS17KHBsYXRmb3JtLnJlbGVhc2UoKSBvciAnVW5rbm93bicpfS17KHBsYXRmb3JtLnZlcnNpb24oKSBvciAnVW5rbm93bicpfSIsCiAgICAgICAgICAgICdzeXN0ZW1OYW1lJzogc29ja2V0LmdldGhvc3RuYW1lKCksCiAgICAgICAgICAgICdjdXJyZW50VXNlcic6IGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICAgICAnY3B1VXNhZ2UnOiBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSksCiAgICAgICAgICAgICdjcHVDb3VudCc6IHBzdXRpbC5jcHVfY291bnQoKSwKICAgICAgICAgICAgJ2Jvb3RUaW1lJzogcHN1dGlsLmJvb3RfdGltZSgpLAogICAgICAgICAgICAncHVibGljSXAnOiBnZXRQdWJsaWNJcEFkZHIoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ1N5c3RlbSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBzeXN0ZW0gZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRpc2sgc3RhdGlzdGljcyIiIgogICAgdHJ5OgogICAgICAgIGRyaXZlcyA9IFtdCiAgICAgICAgZm9yIHBhcnRpdGlvbiBpbiBwc3V0aWwuZGlza19wYXJ0aXRpb25zKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVzYWdlID0gcHN1dGlsLmRpc2tfdXNhZ2UocGFydGl0aW9uLm1vdW50cG9pbnQpCiAgICAgICAgICAgICAgICBkcml2ZXMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IHBhcnRpdGlvbi5kZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsJzogdXNhZ2UudG90YWwsCiAgICAgICAgICAgICAgICAgICAgJ3VzZWQnOiB1c2FnZS51c2VkLAogICAgICAgICAgICAgICAgICAgICdmcmVlJzogdXNhZ2UuZnJlZSwKICAgICAgICAgICAgICAgICAgICAndXNlZFBlcic6IHVzYWdlLnBlcmNlbnQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWVQZXInOiAxMDAgLSB1c2FnZS5wZXJjZW50CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnUGVybWlzc2lvbiBkZW5pZWQgZm9yIHtwYXJ0aXRpb24ubW91bnRwb2ludH0nKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVzJ10gPSBkcml2ZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ0Rpc2sgc3RhdHMgY29sbGVjdGVkOiB7bGVuKGRyaXZlcyl9IGRyaXZlcycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkaXNrIHN0YXRzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IG5ldHdvcmsgaW50ZXJmYWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgbmV0d29ya0xpc3QgPSBbXQogICAgICAgIGZvciBpbnRlcmZhY2VfbmFtZSwgaW50ZXJmYWNlX2FkZHJzIGluIHBzdXRpbC5uZXRfaWZfYWRkcnMoKS5pdGVtcygpOgogICAgICAgICAgICBuZXRfaWZfc3RhdHMgPSBwc3V0aWwubmV0X2lmX3N0YXRzKCkKICAgICAgICAgICAgaWYgaW50ZXJmYWNlX25hbWUgaW4gbmV0X2lmX3N0YXRzOgogICAgICAgICAgICAgICAgc3RhdHMgPSBuZXRfaWZfc3RhdHNbaW50ZXJmYWNlX25hbWVdCiAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfbmFtZTogewogICAgICAgICAgICAgICAgICAgICAgICAnaWZJc1VwJzogc3RhdHMuaXN1cCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lmU3BlZWQnOiBzdGF0cy5zcGVlZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lmTXR1Jzogc3RhdHMubXR1LAogICAgICAgICAgICAgICAgICAgICAgICAnYnl0ZXNTZW50Jzogc3RhdHMuYnl0ZXNfc2VudCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2J5dGVzUmVjdic6IHN0YXRzLmJ5dGVzX3JlY3YsCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJJbic6IHN0YXRzLmVycmluLAogICAgICAgICAgICAgICAgICAgICAgICAnZXJyT3V0Jzogc3RhdHMuZXJyb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzczQnOiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAnbmV0bWFzazQnOiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAnYnJvYWRjYXN0NCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzNic6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICduZXRtYXNrNic6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdicm9hZGNhc3Q2JzogTm9uZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgYWRkciBpbiBpbnRlcmZhY2VfYWRkcnM6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkci5mYW1pbHkubmFtZSA9PSAnQUZfSU5FVCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYWRkcmVzczQnXSA9IGFkZHIuYWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ25ldG1hc2s0J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydicm9hZGNhc3Q0J10gPSBhZGRyLmJyb2FkY2FzdAogICAgICAgICAgICAgICAgICAgIGVsaWYgYWRkci5mYW1pbHkubmFtZSA9PSAnQUZfSU5FVDYnOgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ2FkZHJlc3M2J10gPSBhZGRyLmFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWyduZXRtYXNrNiddID0gYWRkci5uZXRtYXNrCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYnJvYWRjYXN0NiddID0gYWRkci5icm9hZGNhc3QKCiAgICAgICAgICAgICAgICBuZXR3b3JrTGlzdC5hcHBlbmQoaW50ZXJmYWNlX2RhdGEpCgogICAgICAgIGRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddID0gbmV0d29ya0xpc3QKICAgICAgICBsb2dnZXIuaW5mbyhmJ05ldHdvcmsgZGF0YSBjb2xsZWN0ZWQ6IHtsZW4obmV0d29ya0xpc3QpfSBpbnRlcmZhY2VzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG5ldHdvcmsgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbmV0d29ya0xpc3QnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGxvZ2dlZC1pbiB1c2VycyIiIgogICAgdHJ5OgogICAgICAgIHVzZXJzID0gW10KICAgICAgICB1c2VyX2RpY3QgPSB7fQogICAgICAgIGZvciBpZHgsIHVzZXIgaW4gZW51bWVyYXRlKHBzdXRpbC51c2VycygpKToKICAgICAgICAgICAgdXNlcl9kaWN0W3N0cihpZHgpXSA9IHsKICAgICAgICAgICAgICAgICd1c2VybmFtZSc6IHVzZXIubmFtZSwKICAgICAgICAgICAgICAgICd0ZXJtaW5hbCc6IHVzZXIudGVybWluYWwgb3IgJ04vQScsCiAgICAgICAgICAgICAgICAnaG9zdCc6IHVzZXIuaG9zdCBvciAnTi9BJywKICAgICAgICAgICAgICAgICdsb2dnZWRJbic6IHVzZXIuc3RhcnRlZCwKICAgICAgICAgICAgICAgICdwaWQnOiB1c2VyLnBpZCBvciAwCiAgICAgICAgICAgIH0KICAgICAgICB1c2Vycy5hcHBlbmQodXNlcl9kaWN0KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnVXNlcnMnXSA9IHVzZXJzCiAgICAgICAgbG9nZ2VyLmluZm8oZidVc2VyIGRhdGEgY29sbGVjdGVkOiB7bGVuKHVzZXJfZGljdCl9IHVzZXJzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHVzZXIgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnVXNlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0QmF0dGVyeURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGJhdHRlcnkgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBiYXR0ZXJ5ID0gcHN1dGlsLnNlbnNvcnNfYmF0dGVyeSgpCiAgICAgICAgaWYgYmF0dGVyeToKICAgICAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnOiBUcnVlLAogICAgICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IGJhdHRlcnkucGVyY2VudCwKICAgICAgICAgICAgICAgICdzZWNzTGVmdCc6IGludChiYXR0ZXJ5LnNlY3NsZWZ0KSBpZiAoaXNpbnN0YW5jZShiYXR0ZXJ5LnNlY3NsZWZ0LCAoaW50LCBmbG9hdCkpIGFuZCBiYXR0ZXJ5LnNlY3NsZWZ0ID49IDApIGVsc2UgLTEsCiAgICAgICAgICAgICAgICAncG93ZXJQbHVnJzogYmF0dGVyeS5wb3dlcl9wbHVnZ2VkCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAgICAgJ2luc3RhbGxlZCc6IEZhbHNlLAogICAgICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IDAsCiAgICAgICAgICAgICAgICAnc2Vjc0xlZnQnOiAtMSwKICAgICAgICAgICAgICAgICdwb3dlclBsdWcnOiBUcnVlCiAgICAgICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0JhdHRlcnkgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgYmF0dGVyeSBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J10gPSB7CiAgICAgICAgICAgICdpbnN0YWxsZWQnOiBGYWxzZSwKICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IDAsCiAgICAgICAgICAgICdzZWNzTGVmdCc6IC0xLAogICAgICAgICAgICAncG93ZXJQbHVnJzogVHJ1ZQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVcHRpbWVEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCB1cHRpbWUgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBib290X3RpbWUgPSBwc3V0aWwuYm9vdF90aW1lKCkKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXB0aW1lJ10gPSB7CiAgICAgICAgICAgICdib290VGltZSc6IGJvb3RfdGltZSwKICAgICAgICAgICAgJ3VwdGltZVNlY29uZHMnOiB0aW1lLnRpbWUoKSAtIGJvb3RfdGltZQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ1VwdGltZSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyB1cHRpbWUgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBjb2xsZWN0b3IgdmVyc2lvbiBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGFnZW50VmVyc2lvbkZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnRWZXJzaW9uLnR4dCcpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oYWdlbnRWZXJzaW9uRmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgbG9jYWxBZ2VudFZlcnNpb24gPSBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgbG9jYWxBZ2VudFZlcnNpb24gPSAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10gPSB7CiAgICAgICAgICAgICdjb2xsdmVyc2lvbic6IGxvY2FsQWdlbnRWZXJzaW9uLAogICAgICAgICAgICAnY29sbGluc3RhbGxkaXInOiBhcHBEaXIKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidDb2xsZWN0b3IgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgY29sbGVjdG9yIGRhdGE6IHtlfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCwgZGV2aWNlVXVpZCk6CiAgICAiIiJHZXQgYmFzaWMgZGV2aWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RldmljZSddID0gewogICAgICAgICAgICAnZGV2aWNlVXVpZCc6IGRldmljZVV1aWQsCiAgICAgICAgICAgICdzeXN0ZW10aW1lJzogdGltZS50aW1lKCkKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidEZXZpY2UgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgZGV2aWNlIGRhdGE6IHtlfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0UGFydGl0aW9uRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgcGFydGl0aW9uIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgcGFydGl0aW9ucyA9IFtdCiAgICAgICAgcGFydGl0aW9uX2RpY3QgPSB7fQogICAgICAgIGZvciBpZHgsIHBhcnRpdGlvbiBpbiBlbnVtZXJhdGUocHN1dGlsLmRpc2tfcGFydGl0aW9ucygpKToKICAgICAgICAgICAgcGFydGl0aW9uX2RpY3RbcGFydGl0aW9uLm1vdW50cG9pbnRdID0gewogICAgICAgICAgICAgICAgJ2RldmljZSc6IHBhcnRpdGlvbi5kZXZpY2UsCiAgICAgICAgICAgICAgICAnZnN0eXBlJzogcGFydGl0aW9uLmZzdHlwZQogICAgICAgICAgICB9CiAgICAgICAgcGFydGl0aW9ucy5hcHBlbmQocGFydGl0aW9uX2RpY3QpCgogICAgICAgIGRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10gPSBwYXJ0aXRpb25zCiAgICAgICAgbG9nZ2VyLmluZm8oZidQYXJ0aXRpb24gZGF0YSBjb2xsZWN0ZWQ6IHtsZW4ocGFydGl0aW9uX2RpY3QpfSBwYXJ0aXRpb25zJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHBhcnRpdGlvbiBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldEdwdUluZm8oZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IEdQVSBpbmZvcm1hdGlvbiAoTGludXgtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgdmVuZG9yID0gJ05vIGRhdGEgZm91bmQnCiAgICAgICAgcHJvZHVjdCA9ICdObyBkYXRhIGZvdW5kJwogICAgICAgIGNvbG91ckRlcHRoID0gLTEKICAgICAgICBoUmVzID0gLTEKICAgICAgICB2UmVzID0gLTEKCiAgICAgICAgIyBUcnkgbHNwY2kgZm9yIEdQVSBpbmZvCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIFsnbHNwY2knXSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgICAgIGlmICdWR0EnIGluIGxpbmUgb3IgJ0Rpc3BsYXknIGluIGxpbmU6CiAgICAgICAgICAgICAgICAgICAgcGFydHMgPSBsaW5lLnNwbGl0KCc6ICcpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QgPSBwYXJ0c1sxXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0WydncHVpbmZvJ10gPSB7CiAgICAgICAgICAgICdncHV2ZW5kb3InOiB2ZW5kb3IsCiAgICAgICAgICAgICdncHVwcm9kdWN0JzogcHJvZHVjdCwKICAgICAgICAgICAgJ2dwdWNvbG91cic6IGNvbG91ckRlcHRoLAogICAgICAgICAgICAnZ3B1aHJlcyc6IGhSZXMsCiAgICAgICAgICAgICdncHV2cmVzJzogdlJlcwogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0dQVSBpbmZvIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBHUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogJ05vIGRhdGEgZm91bmQnLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdWNvbG91cic6IC0xLAogICAgICAgICAgICAnZ3B1aHJlcyc6IC0xLAogICAgICAgICAgICAnZ3B1dnJlcyc6IC0xCiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1hbnVmYWN0dXJlciIiIgogICAgdHJ5OgogICAgICAgIG1hbnVmYWN0dXJlciA9ICdVbmtub3duJwogICAgICAgICMgVHJ5IGRtaWRlY29kZQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbJ3N1ZG8nLCAnZG1pZGVjb2RlJywgJy1zJywgJ3N5c3RlbS1tYW51ZmFjdHVyZXInXSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICBtYW51ZmFjdHVyZXIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0WydtYW51ZmFjdHVyZXInXSA9IG1hbnVmYWN0dXJlcgogICAgICAgIGxvZ2dlci5pbmZvKGYnTWFudWZhY3R1cmVyOiB7bWFudWZhY3R1cmVyfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBtYW51ZmFjdHVyZXI6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBPUyBsYW5ndWFnZSIiIgogICAgdHJ5OgogICAgICAgIG9zTGFuZyA9ICdVbmtub3duJwogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbJ2xvY2FsZSddLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICAgICApCiAgICAgICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICAgICAgaWYgJ0xBTkc9JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgIG9zTGFuZyA9IGxpbmUuc3BsaXQoJz0nKVsxXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0Wydvc0xhbmcnXSA9IG9zTGFuZwogICAgICAgIGxvZ2dlci5pbmZvKGYnT1MgTGFuZ3VhZ2U6IHtvc0xhbmd9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIE9TIGxhbmd1YWdlOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydvc0xhbmcnXSA9ICdVbmtub3duJwogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFNtQmlvc0luZm8oZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IFNNQklPUyBpbmZvcm1hdGlvbiAoTGludXgtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgc21iaW9zX2RpY3QgPSB7fQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbJ3N1ZG8nLCAnZG1pZGVjb2RlJ10sCiAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgICAgICBpZiAnU2VyaWFsIE51bWJlcicgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnc2VyaWFsTnVtYmVyJ10gPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQogICAgICAgICAgICAgICAgaWYgJ0NoYXNzaXMgVHlwZScgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnY2hhc3Npc1R5cGUnXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHNtYmlvc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidTTUJJT1MgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgU01CSU9TIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3NtYmlvcyddID0ge30KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1vZGVsIiIiCiAgICB0cnk6CiAgICAgICAgbW9kZWwgPSAnVW5rbm93bicKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgWydzdWRvJywgJ2RtaWRlY29kZScsICctcycsICdzeXN0ZW0tcHJvZHVjdC1uYW1lJ10sCiAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgbW9kZWwgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW1Nb2RlbCddID0gbW9kZWwKICAgICAgICBsb2dnZXIuaW5mbyhmJ1N5c3RlbSBNb2RlbDoge21vZGVsfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBzeXN0ZW0gbW9kZWw6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3N5c3RlbU1vZGVsJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRQcmludGVycyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgcHJpbnRlciBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIHByaW50ZXJzID0gW10KICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICAgICAgWydscHN0YXQnLCAnLXAnLCAnLWQnXSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgICAgIGlmICdwcmludGVyJyBpbiBsaW5lLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRlcnMuYXBwZW5kKGxpbmUuc3RyaXAoKSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gPSBwcmludGVycwogICAgICAgIGxvZ2dlci5pbmZvKGYnUHJpbnRlcnMgY29sbGVjdGVkOiB7bGVuKHByaW50ZXJzKX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgcHJpbnRlcnM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFVzYkRldmljZXMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IFVTQiBkZXZpY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICB1c2JfZGV2aWNlcyA9IFtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgIFsnbHN1c2InXSwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICB1c2JfZGV2aWNlcyA9IHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGRldmljZURhdGFEaWN0Wyd1c2JEZXZpY2VzJ10gPSB1c2JfZGV2aWNlcwogICAgICAgIGxvZ2dlci5pbmZvKGYnVVNCIGRldmljZXMgY29sbGVjdGVkOiB7bGVuKHVzYl9kZXZpY2VzKX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgVVNCIGRldmljZXM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3VzYkRldmljZXMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0UGNpRGV2aWNlcyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgUENJIGRldmljZSBpbmZvcm1hdGlvbiAoTGludXgtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgcGNpX2RldmljZXMgPSBbXQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBbJ2xzcGNpJ10sCiAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgICAgICkKICAgICAgICAgICAgcGNpX2RldmljZXMgPSByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGNpRGV2aWNlcyddID0gcGNpX2RldmljZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1BDSSBkZXZpY2VzIGNvbGxlY3RlZDoge2xlbihwY2lfZGV2aWNlcyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFBDSSBkZXZpY2VzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwY2lEZXZpY2VzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBNQUlOIEVYRUNVVElPTiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKCdMaW51eEF1ZGl0IFN0YXJ0aW5nLi4uJykKCiAgICAjIFNldHVwIGRpcmVjdG9yaWVzCiAgICBhcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0RpciA9IGdldEFwcERpcnMoKQoKICAgICMgR2V0IGRldmljZSBVVUlEIGFuZCBob3N0CiAgICBhZ2VudENvbmZpZ0ZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnQuY29uZmlnJykKICAgIGRldmljZVV1aWQsIGhvc3QgPSBnZXREZXZpY2VVdWlkKGFnZW50Q29uZmlnRmlsZSkKCiAgICAjIENvbGxlY3QgYWxsIGRhdGEKICAgIGRldmljZURhdGFEaWN0ID0ge30KICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCwgZGV2aWNlVXVpZCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGlza1N0YXRzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNYW51ZmFjdHVyZXIoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE9zTGFuZyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0R3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRQY2lEZXZpY2VzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KQoKICAgICMgVXBkYXRlIGRldmljZSBVVUlEIGluIHBheWxvYWQKICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnZGV2aWNlVXVpZCddID0gZGV2aWNlVXVpZAoKICAgICMgU2VuZCBwYXlsb2FkCiAgICByb3V0ZSA9ICcvcGF5bG9hZC9zZW5kYXVkaXQnCiAgICBwYXlsb2FkID0geydkYXRhJzogZGV2aWNlRGF0YURpY3R9CgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKGYnUGF5bG9hZDoge2pzb24uZHVtcHMocGF5bG9hZCwgaW5kZW50PTIsIGRlZmF1bHQ9c3RyKX0nKQoKICAgIHJlc3BvbnNlID0gc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgcm91dGUsIGhvc3QsIGRlYnVnTW9kZSkKICAgIGxvZ2dlci5pbmZvKGYnU2VydmVyIHJlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IHwge3Jlc3BvbnNlLnRleHR9JykKCg=="}}