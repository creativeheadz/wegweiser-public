{"settings": {"snippetUuid": "415e9c21-0be8-45d7-888d-d845716c0f24", "snippetname": "fullAudit", "snippettype": ".py", "created_at": 1761419466}, "payload": {"payloadsig": "haHhG1L9uHD6tWOKiPQRtrcYOTdajoa+4z7+p2QR2B8yiOGb44SI4x2b54RnKixBpf/6VfAdP1CL8B8N/nCN1ZdfNZare+MpOTAdJdfPDi5W9lJ+hoILBsD9WoGBN6m6pUoxvqAAcSBxnvakTHxOKKR7Fedzlik43wN2KwXFFC0k2lyDWfHvtGaB5Nt0OjUF7EMGSVRoU8rhblFQmjHOjfivsczc0b5XInqVBpO2IOK/AIFDCFgxj3aColgWZmJaO5Rj9yUdqclH96rXx5h+/7miYMqoz3+QZHlEp1widZLi2Alp3AVulXoBaFQyZcwEa/eP15pZviTsY4zcOnjuRMO5UoilUIWNTDjqAkHQ2BnNzr7CPMgP6Ax/iZXOqu3GzKMNP/kt5ENCaKT3f5vIcaAXHkg/K7v1amtoP0ft8LMLA+Vm/KQVocuvfoNYBIbrtS4o+ofKK2BanRuy8UTBkSyGBf9qqJiZ7TxCAfF93pSa0evfKnA+4qSMwnMSV5Lx1d6Ng8Te258lWHUxONFJta5lEla0a21C9SaWa3GMGKL5uB0eSPNfNatWiPWnHMWR6J/VQJetOyJKqq2BIsKXmgB8QZox4Y7RnojqsL4b1Udgj20e8YCY0c23HJFy9Fvar48y3Z2Tywq4HONmHqUZ6SQBio99EMIDEuurKJcAYs8=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvZnVsbEF1ZGl0LnB5CiMgRmlsZXBhdGg6IGNvbGxlY3Rvci9jb2xsZWN0b3IucHkKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzaHV0aWwKaW1wb3J0IG1hdGgKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBzeXMKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBoYXNobGliCnRyeToKCWZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCmV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCXN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdsb2d6ZXJvJ10pCglmcm9tIGxvZ3plcm8gaW1wb3J0IGxvZ2dlciwgbG9nZmlsZQp0cnk6CglpbXBvcnQgcHN1dGlsCmV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCXN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKCWltcG9ydCBwc3V0aWwKdHJ5OgoJaW1wb3J0IHJlcXVlc3RzCmV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCXN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdyZXF1ZXN0cyddKQoJaW1wb3J0IHJlcXVlc3RzCnRyeToKCWltcG9ydCBkbnMucmVzb2x2ZXIKZXhjZXB0OgoJc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2Ruc3B5dGhvbiddKQoJaW1wb3J0IGRucy5yZXNvbHZlcgppZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6Cgl0cnk6CgkJaW1wb3J0IHdpbjMyYXBpCgkJbG9nZ2VyLmRlYnVnKCd3aW4zMmFwaSBhbHJlYWR5IGltcG9ydGVkJykKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuaW5mbygnTmVlZCB0byBpbXBvcnQgd2luMzJhcGknKQoJCWxvZ2dlci5kZWJ1ZyhmJ1J1bm5pbmcge3N5cy5leGVjdXRhYmxlfSAtbSBwaXAgaW5zdGFsbCBweXBpd2luMzInKQoJCWltcG9ydFJlc3VsdCA9IHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKCQlsb2dnZXIuZGVidWcoZidpbXBvcnRSZXN1bHQ6IHtpbXBvcnRSZXN1bHR9JykKCQlpbXBvcnQgd2luMzJhcGkJCgoKCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKIyBkZWYgcGFyc2VBcmdzKCk6CiMgCXBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKCkKIyAJcGFyc2VyLmFkZF9hcmd1bWVudCgiLXQiLCAiLS10ZW1wRGlyIiwgCQloZWxwID0gIkVudGVyIHRlbXAgZGlyZWN0b3J5IiwgCXJlcXVpcmVkPVRydWUpCiMgCXBhcnNlci5hZGRfYXJndW1lbnQoIi1tIiwgIi0tbW9kZSIsIAkJaGVscCA9ICJFbnRlciBtb2RlIC0gYXVkaXQiLCAJcmVxdWlyZWQ9RmFsc2UpCQojIAlwYXJzZXIuYWRkX2FyZ3VtZW50KCItZyIsICItLWdyb3VwVXVpZCIsCWhlbHAgPSAiRW50ZXIgZ3JvdXBVdWlkIiwJCXJlcXVpcmVkPUZhbHNlKQkJIAojIAlwYXJzZXIuYWRkX2FyZ3VtZW50KCItdiIsICItLXZlcnNpb24iLAkJaGVscCA9ICJEaXNwbGF5IHRoZSB2ZXJzaW9uIiwgCWFjdGlvbj0nc3RvcmVfdHJ1ZScpCiMgCWFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCQojIAlyZXR1cm4oYXJncykKCmRlZiBjb252ZXJ0U2l6ZShzaXplQnl0ZXMpOgoJaWYgc2l6ZUJ5dGVzID09IDA6CgkJcmV0dXJuICIwIEIiCglzaXplTmFtZSA9ICgiQiIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIsICJaQiIsICJZQiIpCglpID0gaW50KG1hdGguZmxvb3IobWF0aC5sb2coc2l6ZUJ5dGVzLCAxMDI0KSkpCglwID0gbWF0aC5wb3coMTAyNCwgaSkKCXMgPSByb3VuZChzaXplQnl0ZXMgLyBwLCAyKQoJcmV0dXJuIChmJ3tzfSB7c2l6ZU5hbWVbaV19JykKCmRlZiBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCBlbmRwb2ludCk6Cgl1cmwgCQk9IGYnaHR0cHM6Ly97aG9zdH17ZW5kcG9pbnR9JwoJaWYgZGVidWdNb2RlID09IFRydWU6CgkJbG9nZ2VyLmRlYnVnKGYncGF5bG9hZCB0byBzZW5kOiB7cGF5bG9hZH0nKQoJCWxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCgloZWFkZXJzIAk9IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfQoJcmVzcG9uc2UgCT0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKHBheWxvYWQpKQoJcmV0dXJuKHJlc3BvbnNlKQoKZGVmIGdldFB1YmxpY0lwQWRkcigpOgoJb2REbnNTZXJ2ZXIgCQkJPSAnMjA4LjY3LjIyMi4yMjInCglodHRwRG5zU2VydmVyCQkJPSAnaHR0cHM6Ly9pY2FuaGF6aXAuY29tJwoJZG5zUmVzb2x2ZXIgCQkJPSBkbnMucmVzb2x2ZXIuUmVzb2x2ZXIoKQoJZG5zUmVzb2x2ZXIubmFtZXNlcnZlcnMgPSBbb2REbnNTZXJ2ZXJdCgl0cnk6CgkJYW5zd2VycyAJCQk9IGRuc1Jlc29sdmVyLnJlc29sdmUoJ215aXAub3BlbmRucy5jb20nLCAnQScpCgkJZm9yIHB1YmxpY0lwIGluIGFuc3dlcnM6CgkJCXB1YmxpY0lwID0gcHVibGljSXAudG9fdGV4dCgpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtvZERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCQlwdWJsaWNJcCA9IE5vbmUKCWlmIG5vdCBwdWJsaWNJcDoKCQl0cnk6CgkJCXIgCQkJPSByZXF1ZXN0cy5nZXQoaHR0cERuc1NlcnZlcikKCQkJbG9nZ2VyLmluZm8oZidydGV4dDoge3IudGV4dH0nKQoJCQlwdWJsaWNJcCAJPSByLnRleHQuc3RyaXAoKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtodHRwRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoJCQlwdWJsaWNJcCA9IE5vbmUKCWlmIG5vdCBwdWJsaWNJcDoKCQlwdWJsaWNJcCA9ICcwLjAuMC4wJwoJcmV0dXJuKHB1YmxpY0lwKQoKZGVmIGdldFVzZXJIb21lUGF0aCgpOgoJdXNlckhvbWVQYXRoIAk9IG9zLnBhdGguZXhwYW5kdXNlcigifiIpCglsb2dnZXIuaW5mbyhmJ3VzZXJIb21lUGF0aDoge3VzZXJIb21lUGF0aH0nKQoJcmV0dXJuKHVzZXJIb21lUGF0aCkKCmRlZiBnZXREZXZpY2VVdWlkKGNvbmZpZ0ZpbGUpOgoJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQgY29uZmlnIGZpbGU6IHtjb25maWdGaWxlfS4uLicpCglpZiBvcy5wYXRoLmlzZmlsZShjb25maWdGaWxlKToKCQl0cnk6CgkJCXdpdGggb3Blbihjb25maWdGaWxlLCAncicpIGFzIGY6CgkJCQljb25maWdEaWN0ID0ganNvbi5sb2FkKGYpCgkJCWxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IHJlYWQge2NvbmZpZ0ZpbGV9JykKCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byByZWFkIHtjb25maWdGaWxlfScpCgkJCXF1aXQoJ1F1aXR0aW5nLicpCgkJZGV2aWNlVXVpZCAJPSBjb25maWdEaWN0WydkZXZpY2V1dWlkJ10KCQlpZiAnc2VydmVyQWRkcicgaW4gY29uZmlnRGljdDoKCQkJaG9zdCA9IGNvbmZpZ0RpY3RbJ3NlcnZlckFkZHInXQoJCWVsc2U6CgkJCWhvc3QgPSAnYXBwLndlZ3dlaXNlci50ZWNoJwoJZWxzZToKCQlsb2dnZXIuZXJyb3IoZid7Y29uZmlnRmlsZX0gZG9lcyBub3QgZXhpc3QuIFF1aXR0aW5nLicpCglyZXR1cm4oZGV2aWNlVXVpZCwgaG9zdCkKCiMgZGVmIHdyaXRlV2VnQ29uZmlnRmlsZShkZXZpY2V1dWlkLCBncm91cHV1aWQpOgojIAljb25maWdEaWN0ID0geydkZXZpY2V1dWlkJzpkZXZpY2V1dWlkLCAnZ3JvdXB1dWlkJzpncm91cHV1aWR9CiMgCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byB3cml0ZSB0byB7d2VnQ29uZmlnRmlsZX0nKQojIAl3aXRoIG9wZW4od2VnQ29uZmlnRmlsZSwgJ3cnKSBhcyBmOgojIAkJZi53cml0ZShqc29uLmR1bXBzKGNvbmZpZ0RpY3QsIGluZGVudD00KSkKIyAJbG9nZ2VyLmluZm8oZid7d2VnQ29uZmlnRmlsZX0gd3JpdHRlbiBzdWNjZXNzZnVsbHkuJykKCiMgZGVmIHJlZ2lzdGVyRGV2aWNlKGdyb3VwdXVpZCk6CiMgCWVuZHBvaW50IAkJPSAnL2RldmljZXMvcmVnaXN0ZXInCiMgCWRldmljZU5hbWUgCQk9IHNvY2tldC5nZXRob3N0bmFtZSgpCiMgCWhhcmR3YXJlSW5mbyAJPSBwbGF0Zm9ybS5zeXN0ZW0oKQojIAlwYXlsb2FkIAkJPSB7J2dyb3VwdXVpZCc6IGdyb3VwdXVpZCwgJ2RldmljZW5hbWUnOiBkZXZpY2VOYW1lLCAnaGFyZHdhcmVpbmZvJzogaGFyZHdhcmVJbmZvfQojIAlyZXNwb25zZSAJCT0gc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgZW5kcG9pbnQpCiMgCWxvZ2dlci5kZWJ1ZyhmJ3Jlc3BvbnNlOiB7cmVzcG9uc2UudGV4dH0nKQojIAlkZXZpY2VVdWlkIAkJPSBqc29uLmxvYWRzKHJlc3BvbnNlLnRleHQpWydkZXZpY2V1dWlkJ10KIyAJbG9nZ2VyLmRlYnVnKGYnRGV2aWNlIGlzc3VlZCBuZXcgZGV2aWNlVXVpZDoge2RldmljZVV1aWR9JykKIyAJcmV0dXJuKGRldmljZVV1aWQpCgpkZWYgZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCk6CglkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ10gCQkJCQk9IHt9CglkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ11bJ2RldmljZVV1aWQnXQkJPSBmJ3tkZXZpY2VVdWlkfScKIwlkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ11bJ2dyb3VwVXVpZCddCQk9IGYne2dyb3VwVXVpZH0nCglkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ11bJ3N5c3RlbXRpbWUnXQkJPSBpbnQodGltZS50aW1lKCkpCglpZiBkZWJ1Z01vZGUgPT0gVHJ1ZToKCQlsb2dnZXIuZGVidWcoanNvbi5kdW1wcyhkZXZpY2VEYXRhRGljdCwgaW5kZW50PTQpKQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFN5c3RlbURhdGEoZGV2aWNlRGF0YURpY3QpOgoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddIAkJCQkJPSB7fQkKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnZGV2aWNlUGxhdGZvcm0nXSAJPSBwbGF0Zm9ybS5wbGF0Zm9ybSgpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ3N5c3RlbU5hbWUnXQkJPSBzb2NrZXQuZ2V0aG9zdG5hbWUoKQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydjdXJyZW50VXNlciddCQk9IGdldHBhc3MuZ2V0dXNlcigpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ2NwdVVzYWdlJ10JCT0gcHN1dGlsLmNwdV9wZXJjZW50KDQpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ2NwdUNvdW50J10gCQk9IHBzdXRpbC5jcHVfY291bnQoKQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydwdWJsaWNJcCddIAkJPSBnZXRQdWJsaWNJcEFkZHIoKQoJaWYgZGVidWdNb2RlID09IFRydWU6CgkJbG9nZ2VyLmRlYnVnKGpzb24uZHVtcHMoZGV2aWNlRGF0YURpY3QsIGluZGVudD00KSkKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KToKCWFnZW50VmVyc2lvbkZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnRWZXJzaW9uLnR4dCcpCgl3aXRoIG9wZW4oYWdlbnRWZXJzaW9uRmlsZSwgJ3InKSBhcyBmOgoJCWxvY2FsQWdlbnRWZXJzaW9uID0gZi5yZWFkKCkuc3RyaXAoKQoJbG9nZ2VyLmluZm8oZidsb2NhbEFnZW50VmVyc2lvbjoge2xvY2FsQWdlbnRWZXJzaW9ufScpCglkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10gCQkJCQk9IHt9CglkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ11bJ2NvbGx2ZXJzaW9uJ10JCT0gbG9jYWxBZ2VudFZlcnNpb24KCWRldmljZURhdGFEaWN0Wydjb2xsZWN0b3InXVsnY29sbGluc3RhbGxkaXInXQk9IGFwcERpcgoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpOgoJaWYgJ3N5c3RlbScgbm90IGluIGRldmljZURhdGFEaWN0OgoJCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXSA9IHt9CglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ2Jvb3RUaW1lJ10JCT0gaW50KHBzdXRpbC5ib290X3RpbWUoKSkKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCk6CglkZXZpY2VEYXRhRGljdFsnbmV0d29ya0xpc3QnXQkJCQk9IFtdCglwc05ldERpY3QgCQkJCQkJCQkJPSBwc3V0aWwubmV0X2lmX3N0YXRzKCkKCWlmRGljdCAJCQkJCQkJCQkJPSB7fQoKCWZvciBpZk5hbWUsIGRhdGEgaW4gcHNOZXREaWN0Lml0ZW1zKCk6CgkJaWZEaWN0W2lmTmFtZV0gCQkJCT0ge30KCQlpZkRpY3RbaWZOYW1lXVsnaWZJc1VwJ10JPSBkYXRhLmlzdXAKCQlpZkRpY3RbaWZOYW1lXVsnaWZTcGVlZCddCT0gZGF0YS5zcGVlZAoJCWlmRGljdFtpZk5hbWVdWydpZk10dSddCQk9IGRhdGEubXR1CgoJcHNOZXREaWN0IAkJCQkJCQkJCT0gcHN1dGlsLm5ldF9pb19jb3VudGVycyhwZXJuaWM9VHJ1ZSkKCWZvciBpZk5hbWUsIGRhdGEgaW4gcHNOZXREaWN0Lml0ZW1zKCk6CgkJaWZEaWN0W2lmTmFtZV1bJ2J5dGVzU2VudCddIAk9IGRhdGEuYnl0ZXNfcmVjdgoJCWlmRGljdFtpZk5hbWVdWydieXRlc1JlY3YnXSAJPSBkYXRhLmJ5dGVzX3NlbnQKCQlpZkRpY3RbaWZOYW1lXVsnZXJySW4nXSAJCT0gZGF0YS5lcnJpbgoJCWlmRGljdFtpZk5hbWVdWydlcnJPdXQnXSAJCT0gZGF0YS5lcnJvdXQKCglwc05ldERpY3QgCQkJCQkJCQkJPSBwc3V0aWwubmV0X2lmX2FkZHJzKCkKCWZvciBpZk5hbWUsIGFkZHJlc3NlcyBpbiBwc05ldERpY3QuaXRlbXMoKToKCQlmb3IgYWRkcmVzcyBpbiBhZGRyZXNzZXM6CgkJCWlmIGFkZHJlc3MuZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUOgoJCQkJaWZEaWN0W2lmTmFtZV1bJ2FkZHJlc3M0J10gCQk9IGFkZHJlc3MuYWRkcmVzcwoJCQkJaWZEaWN0W2lmTmFtZV1bJ25ldG1hc2s0J10gCQk9IGFkZHJlc3MubmV0bWFzawoJCQkJaWZEaWN0W2lmTmFtZV1bJ2Jyb2FkY2FzdDQnXSAJPSBhZGRyZXNzLmJyb2FkY2FzdAoJCQllbGlmIGFkZHJlc3MuZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUNjoKCQkJCWlmRGljdFtpZk5hbWVdWydhZGRyZXNzNiddIAkJPSBhZGRyZXNzLmFkZHJlc3MKCQkJCWlmRGljdFtpZk5hbWVdWyduZXRtYXNrNiddIAkJPSBhZGRyZXNzLm5ldG1hc2sKCQkJCWlmRGljdFtpZk5hbWVdWydicm9hZGNhc3Q2J10gCT0gYWRkcmVzcy5icm9hZGNhc3QKCWRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddLmFwcGVuZChpZkRpY3QpCQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQkKCQpkZWYgZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpOgoJdXNlcnMgCQk9IHBzdXRpbC51c2VycygpCglkZXZpY2VEYXRhRGljdFsnVXNlcnMnXSAJCQkJPSBbXQoJdXNlckRpY3QgCT0ge30KCXVzZXJJZCAJCT0gMAoJZm9yIHVzZXIgaW4gdXNlcnM6CgkJdXNlckRpY3RbdXNlcklkXSAJCQkJPSB7fQoJCXVzZXJEaWN0W3VzZXJJZF1bJ3VzZXJuYW1lJ10gCT0gdXNlci5uYW1lCgkJaWYgbm90IHVzZXIudGVybWluYWw6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ3Rlcm1pbmFsJ10gCT0gJy0xJwoJCWVsc2U6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ3Rlcm1pbmFsJ10gCT0gdXNlci50ZXJtaW5hbAoJCWlmIG5vdCB1c2VyLmhvc3Q6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ2hvc3QnXSAJPSAnbG9jYWxob3N0JwoJCWVsc2U6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ2hvc3QnXSAJCT0gdXNlci5ob3N0CgkJdXNlckRpY3RbdXNlcklkXVsnbG9nZ2VkSW4nXSAJPSB1c2VyLnN0YXJ0ZWQKCQlpZiBub3QgdXNlci5waWQ6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ3BpZCddCQkJPSAtMQoJCWVsc2U6CgkJCXVzZXJEaWN0W3VzZXJJZF1bJ3BpZCddIAkJPSB1c2VyLnBpZAoJCXVzZXJJZCArPSAxCglkZXZpY2VEYXRhRGljdFsnVXNlcnMnXS5hcHBlbmQodXNlckRpY3QpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0V2luZG93c0RyaXZlcygpOgoJZHJpdmVzIAkJCT0gd2luMzJhcGkuR2V0TG9naWNhbERyaXZlU3RyaW5ncygpCglkcml2ZXNMaXN0IAkJPSBkcml2ZXMuc3BsaXQoJ1wwMDAnKVs6LTFdCglpZiBkZWJ1Z01vZGUgPT0gVHJ1ZToKCQlsb2dnZXIuZGVidWcoZidkcml2ZXNMaXN0OiB7ZHJpdmVzTGlzdH0nKQoJcmV0dXJuKGRyaXZlc0xpc3QpCgpkZWYgZ2V0RGlza1N0YXRzKGRldmljZURhdGFEaWN0KToKCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQlkZXZpY2VEYXRhRGljdFsnZHJpdmVzJ10gPSBbXQoJCWRyaXZlc0xpc3QgPSBnZXRXaW5kb3dzRHJpdmVzKCkKCQlmb3IgZHJpdmUgaW4gZHJpdmVzTGlzdDoKCQkJaWYgZGVidWdNb2RlID09IFRydWU6CgkJCQlsb2dnZXIuZGVidWcoZidjaGVja2luZyBkcml2ZToge2RyaXZlfScpCgkJCWRyaXZlRGF0YSA9IHt9CgkJCXRyeToKCQkJCXN0YXQgCT0gc2h1dGlsLmRpc2tfdXNhZ2UoZHJpdmUpCgkJCQl0b3RhbCAJPSBzdGF0LnRvdGFsCgkJCQl1c2VkIAk9IHN0YXQudXNlZAoJCQkJZnJlZSAJPSBzdGF0LmZyZWUKCQkJCXVzZWRQZXIJPSAodXNlZCAvIHRvdGFsKSAqIDEwMAoJCQkJZnJlZVBlciA9IChmcmVlIC8gdG90YWwpICogMTAwCgkJCQlkcml2ZURhdGFbJ25hbWUnXSAJCT0gZHJpdmUKCQkJCWRyaXZlRGF0YVsndG90YWwnXSAJCT0gdG90YWwKCQkJCWRyaXZlRGF0YVsndXNlZCddIAkJPSB1c2VkCgkJCQlkcml2ZURhdGFbJ2ZyZWUnXSAJCT0gZnJlZQoJCQkJZHJpdmVEYXRhWyd1c2VkUGVyJ10gCT0gdXNlZFBlcgoJCQkJZHJpdmVEYXRhWydmcmVlUGVyJ10gCT0gZnJlZVBlcgoJCQkJZGV2aWNlRGF0YURpY3RbJ2RyaXZlcyddLmFwcGVuZChkcml2ZURhdGEpCgkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCWxvZ2dlci5lcnJvcihmJ1VuYWJsZSB0byBxdWVyeSB7ZHJpdmV9LiBSZWFzb246IHtlfScpCgoJZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgoJCWRyaXZlRGF0YSAJPSB7fQoJCXN0YXQgCQk9IHNodXRpbC5kaXNrX3VzYWdlKCcvJykKCQl0b3RhbCAJCT0gc3RhdC50b3RhbAoJCXVzZWQgCQk9IHN0YXQudXNlZAoJCWZyZWUgCQk9IHN0YXQuZnJlZQoJCXVzZWRQZXIJCT0gKHVzZWQgLyB0b3RhbCkgKiAxMDAKCQlmcmVlUGVyIAk9IChmcmVlIC8gdG90YWwpICogMTAwCgkJZGV2aWNlRGF0YURpY3RbJ2RyaXZlcyddID0gW10KCQlkcml2ZURhdGFbJ25hbWUnXSAJCT0gJy8nCgkJZHJpdmVEYXRhWyd0b3RhbCddIAkJPSB0b3RhbAoJCWRyaXZlRGF0YVsndXNlZCddIAkJPSB1c2VkCgkJZHJpdmVEYXRhWydmcmVlJ10gCQk9IGZyZWUKCQlkcml2ZURhdGFbJ3VzZWRQZXInXSAJPSB1c2VkUGVyCgkJZHJpdmVEYXRhWydmcmVlUGVyJ10gCT0gZnJlZVBlcgoJCWRldmljZURhdGFEaWN0Wydkcml2ZXMnXS5hcHBlbmQoZHJpdmVEYXRhKQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KToKCWJhdHRlcnkgCQkJCQkJCQk9IHBzdXRpbC5zZW5zb3JzX2JhdHRlcnkoKQoJZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXQkgCQkJPSB7fQoJaWYgYmF0dGVyeToKCQlkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddWydpbnN0YWxsZWQnXQk9IFRydWUKCQlkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddWydwY0NoYXJnZWQnXQk9IGJhdHRlcnkucGVyY2VudAoJCWRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3NlY3NMZWZ0J10JPSBiYXR0ZXJ5LnNlY3NsZWZ0LnZhbHVlCgkJZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsncG93ZXJQbHVnJ10JPSBiYXR0ZXJ5LnBvd2VyX3BsdWdnZWQKCWVsc2U6CgkJZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsnaW5zdGFsbGVkJ10JPSBGYWxzZQoJCWRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3BjQ2hhcmdlZCddCT0gMAoJCWRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3NlY3NMZWZ0J10JPSAwCgkJZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsncG93ZXJQbHVnJ10JPSBGYWxzZQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpOgoJcGFydGl0aW9uRGljdCAJCQkJCT0ge30KCWRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10gCT0gW10KCXBhcnRpdGlvbnNMaXN0CQkJCQk9IHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKQoJZm9yIHBhcnRpdGlvbiBpbiBwYXJ0aXRpb25zTGlzdDoKCQlwYXJ0aXRpb25EaWN0W3BhcnRpdGlvbi5tb3VudHBvaW50XSAJCQk9IHt9CgkJcGFydGl0aW9uRGljdFtwYXJ0aXRpb24ubW91bnRwb2ludF1bJ2RldmljZSddCT0gcGFydGl0aW9uLmRldmljZQoJCXBhcnRpdGlvbkRpY3RbcGFydGl0aW9uLm1vdW50cG9pbnRdWydmc3R5cGUnXQk9IHBhcnRpdGlvbi5mc3R5cGUKCWRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10uYXBwZW5kKHBhcnRpdGlvbkRpY3QpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0bWVtb3J5RGF0YShkZXZpY2VEYXRhRGljdCk6CgltZW1vcnkgCQkJCQkJCQkJPSBwc3V0aWwudmlydHVhbF9tZW1vcnkoKQoJZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddCSAJCQk9IHt9CglkZXZpY2VEYXRhRGljdFsnbWVtb3J5J11bJ3RvdGFsJ10JCT0gbWVtb3J5LnRvdGFsCglkZXZpY2VEYXRhRGljdFsnbWVtb3J5J11bJ2F2YWlsYWJsZSddCT0gbWVtb3J5LmF2YWlsYWJsZQoJZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddWyd1c2VkJ10JCT0gbWVtb3J5LnVzZWQKCWRldmljZURhdGFEaWN0WydtZW1vcnknXVsnZnJlZSddCQk9IG1lbW9yeS5mcmVlCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgoKCmRlZiBjaGVja01vZGUobW9kZSk6Cgl2YWxpZE1vZGVzID0gWydBVURJVCcsICdFVkVOVExPRycsICdTVEFUVVMnLCAnV0VHTE9HJywgJ0ZVTExBVURJVCcsIAoJCQkgICAJCSdNU0lORk8nLCAnVVBEQVRFJywgJ0lOU1RBTEwnLCAnUkVTRVRFVkVOVFMnXQoJaWYgbW9kZS51cHBlcigpIGluIHZhbGlkTW9kZXM6CgkJcmV0dXJuKG1vZGUpCgllbHNlOgoJCWxvZ2dlci5lcnJvcihmJ0ludmFsaWQgbW9kZSBzcGVjaWZpZWQ6IHttb2RlfScpCgkJc3lzLmV4aXQoKQoKZGVmIGdldFdlZ0NvbmZpZ0ZpbGVYKGNvbmZpZ0Rpcik6CglpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CgkJd2VnQ29uZmlnRmlsZSA9IGYne2NvbmZpZ0Rpcn13ZWd3ZWlzZXIuY29uZmlnJwoJZWxzZToJCgkJd2VnQ29uZmlnRmlsZSA9IGYne2NvbmZpZ0Rpcn13ZWd3ZWlzZXIuY29uZmlnJwoJcmV0dXJuKHdlZ0NvbmZpZ0ZpbGUpCgpkZWYgZ2V0QXBwRGlycygpOgoJaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgoJCWFwcERpciAJCT0gJ2M6XFxwcm9ncmFtIGZpbGVzICh4ODYpXFxXZWd3ZWlzZXJcXCcKCWVsc2U6CgkJYXBwRGlyIAkJPSAnL29wdC9XZWd3ZWlzZXIvJwoJbG9nRGlyIAkJPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnTG9ncycsICcnKQoJY29uZmlnRGlyIAk9IG9zLnBhdGguam9pbihhcHBEaXIsICdDb25maWcnLCAnJykKCXRlbXBEaXIgCT0gb3MucGF0aC5qb2luKGFwcERpciwgJ1RlbXAnLCAnJykKCWZpbGVzRGlyCT0gb3MucGF0aC5qb2luKGFwcERpciwgJ0ZpbGVzJyAsICcnKQoJY2hlY2tEaXJzKFthcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0Rpcl0pCglyZXR1cm4oYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIpCgpkZWYgY2hlY2tEaXJzKGRpcnNUb0NoZWNrKToKCWZvciBkaXJUb0NoZWNrIGluIGRpcnNUb0NoZWNrOgoJCWRpclRvQ2hlY2sgPSBvcy5wYXRoLmpvaW4oZGlyVG9DaGVjaywgJycpCgkJaWYgbm90IG9zLnBhdGguaXNkaXIoZGlyVG9DaGVjayk6CgkJCWxvZ2dlci5pbmZvKGYne2RpclRvQ2hlY2t9IGRvZXMgbm90IGV4aXN0LiBDcmVhdGluZy4uLicpCgkJCXRyeToKCQkJCW9zLm1ha2VkaXJzKGRpclRvQ2hlY2spCgkJCQlsb2dnZXIuaW5mbyhmJ3tkaXJUb0NoZWNrfSBjcmVhdGVkLicpCgkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBjcmVhdGUge2RpclRvQ2hlY2t9LiBSZWFzb246IHtlfScpCgkJCQlzeXMuZXhpdCgpCgpkZWYgZGVsRmlsZShmaWxlVG9EZWxldGUpOgoJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4uLicpCgl0cnk6CgkJb3MucmVtb3ZlKGZpbGVUb0RlbGV0ZSkKCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSBkZWxldGVkIHtmaWxlVG9EZWxldGV9LicpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4gUmVhc29uOiB7ZX0nKQoKZGVmIHJ1bk1zaW5mbyhtc2luZm9PdXRwdXQpOgoJbG9nZ2VyLmluZm8oJ0F0dGVtcHRpbmcgdG8gcnVuIG1zaW5mbzMyLi4uJykKCWxvZ2dlci5pbmZvKGYnV3JpdGluZyBvdXRwdXQgdG8ge21zaW5mb091dHB1dH0nKQoJdHJ5OgoJCXN1YnByb2Nlc3MucnVuKFsnbXNpbmZvMzIuZXhlJywgJy9yZXBvcnQnLCBtc2luZm9PdXRwdXRdKQoJCWxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IHdyb3RlIHttc2luZm9PdXRwdXR9JykKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gcnVuIG1zaW5mbzMyLmV4ZS4gUmVhc29uOiB7ZX0nKQoJcmV0dXJuKG1zaW5mb091dHB1dCkKCmRlZiBydW5BbmRyZWlNc0luZm8oKToKCWxvZ2dlci5pbmZvKCdDb2xsZWN0aW5nIE1TIEluZm8gc3VtbWFyaWVzLi4uJykKCW1zaWZvUHNmaWxlID0gb3MucGF0aC5qb2luKGFwcERpciwgJ3NjcmlwdHMnLCAnbXNpbmZvMzItZXZhbHVhdG9yQWdlbnQucHMxJykKCWxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gcnVuIHBvd2Vyc2hlbGwuZXhlIC1GaWxlIHttc2lmb1BzZmlsZX0nKQoJY29tbWFuZCAJPSBbJ3Bvd2Vyc2hlbGwuZXhlJywgJy1FeGVjdXRpb25Qb2xpY3knLCAnQnlwYXNzJywgJy1GaWxlJywgbXNpZm9Qc2ZpbGVdCglyZXN1bHQgCQk9IHN1YnByb2Nlc3MucnVuKGNvbW1hbmQsIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCXVybCAJCT0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCiMjIyByZW1vdmVkIFN5c3RlbVJlc291cmNlcyAoSVJRcykKIwlmaWxlTmFtZXMgCT0gWydJbnN0YWxsZWRQcm9ncmFtcycsJ05ldHdvcmtDb25maWcnLCAnUmVjZW50QXBwQ3Jhc2hlcycsICdTdG9yYWdlSW5mbycsICdTeXN0ZW1IYXJkd2FyZUNvbmZpZycsIAojCQkJICAgCQknU3lzdGVtUmVzb3VyY2VzJywgJ1N5c3RlbVNvZnR3YXJlQ29uZmlnJ10KCWZpbGVOYW1lcyAJPSBbJ0luc3RhbGxlZFByb2dyYW1zJywnTmV0d29ya0NvbmZpZycsICdSZWNlbnRBcHBDcmFzaGVzJywgJ1N0b3JhZ2VJbmZvJywgJ1N5c3RlbUhhcmR3YXJlQ29uZmlnJywgCgkJCSAgIAkJJ1N5c3RlbVNvZnR3YXJlQ29uZmlnJ10KCWZvciBmaWxlTmFtZSBpbiBmaWxlTmFtZXM6CgkJY3VycmVudEZpbGUgPSBvcy5wYXRoLmpvaW4oZmlsZXNEaXIsIGZpbGVOYW1lICsiLmpzb24iKQoJCWxvZ2dlci5pbmZvKGYnUHJvY2Vzc2luZyB7Y3VycmVudEZpbGV9JykKCQlpZiBvcy5wYXRoLmdldHNpemUoY3VycmVudEZpbGUpID09IDA6CgkJCWxvZ2dlci53YXJuaW5nKGYne2N1cnJlbnRGaWxlfSBpcyAwIGJ5dGVzLiBTa2lwcGluZy4nKQkKCQllbHNlOgkKCQkJbG9nZ2VyLmluZm8oZid7Y3VycmVudEZpbGV9IGhhcyBkYXRhLiBQcm9jZXNzaW5nLi4uJykKCQkJd2l0aCBvcGVuKGN1cnJlbnRGaWxlLCAncmInKSBhcyBmOgoJCQkJZGF0YSA9IGpzb24ubG9hZHMoZi5yZWFkKCkuZGVjb2RlKCd1dGYtMTYnKSkKCQkJYm9keSA9IHsKCQkJCSdkZXZpY2V1dWlkJzpkZXZpY2VVdWlkLAoJCQkJJ21ldGFsb2dvc190eXBlJzpmJ21zaW5mby17ZmlsZU5hbWV9JywKCQkJCSdtZXRhbG9nb3MnOmRhdGEKCQkJCX0KCQkJCgkJCWhlYWRlcnMgCT0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CgkJCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBQT1NUIHRvOiB7dXJsfScpCgkJCWxvZ2dlci5kZWJ1ZyhmJ2FuZHJlaW1zaW5mbzoge2JvZHl9JykKCQkJcmVzcG9uc2UgCT0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKGJvZHkpKQoJCQlsb2dnZXIuaW5mbyhmJ3Jlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9JykKCQkJaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAxOgoJCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIFBPU1QgZGF0YS4gUmVhc29uOiB7cmVzcG9uc2UudGV4dH0nKQoJcmV0dXJuKFRydWUpCgpkZWYgZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCk6CglpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CgkJY29tbWFuZCAJPSAiKEdldC1XbWlPYmplY3QgV2luMzJfUHJvY2Vzc29yKS5OYW1lIgoJCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5ydW4oWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQljcHVOYW1lIAk9ICcgJy5qb2luKHJlc3VsdC5zdGRvdXQuc3BsaXQoKSkKCWVsaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0xpbnV4JzoKCQljb21tYW5kIAk9ICdsc2NwdScKCQlyZXN1bHQgCQk9IHN1YnByb2Nlc3MuUG9wZW4oW2NvbW1hbmRdLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJcmVzdWx0IAkJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJCWZvciBsaW5lIGluIHJlc3VsdC5zcGxpdGxpbmVzKCk6CgkJCWlmICdNb2RlbCBuYW1lJyBpbiBsaW5lOgoJCQkJY3B1TmFtZSA9IGxpbmUuc3BsaXQoJ01vZGVsIG5hbWU6JylbMV0uc3RyaXAoKQoJbG9nZ2VyLmluZm8oZidjcHVOYW1lOiB7Y3B1TmFtZX0nKQoJZGV2aWNlRGF0YURpY3RbJ2NwdSddICAJCQkJPSB7fQoJZGV2aWNlRGF0YURpY3RbJ2NwdSddWydjcHVuYW1lJ10JPSBjcHVOYW1lCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgY2hlY2tBcHBJbnN0YWxsZWQoYXBwTmFtZSk6Cglsb2dnZXIuaW5mbyhmJ0NoZWNraW5nIGlmIHthcHBOYW1lfSBleGlzdHMuLi4nKQoJY29tbWFuZCAJPSBbIndoaWNoIiwgYXBwTmFtZV0KCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFKQoJcmVzdWx0IAkJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKS5kZWNvZGUoInV0Zi04Iikuc3RyaXAoKQoJbG9nZ2VyLmluZm8oZidFOiB7cmVzdWx0fScpCglpZiBsZW4ocmVzdWx0KSA+IDA6CgkJbG9nZ2VyLmluZm8oZid7YXBwTmFtZX0gZXhpc3RzJykKCQlyZXR1cm4oVHJ1ZSkKCWVsc2U6CgkJbG9nZ2VyLmluZm8oZid7YXBwTmFtZX0gZG9lcyBub3QgZXhpc3QnKQoJCXJldHVybihGYWxzZSkKCmRlZiBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KToKCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQljb21tYW5kIAk9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9WaWRlb0NvbnRyb2xsZXIpIgoJCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5ydW4oWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQlmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKCQkJaWYgJ1ZpZGVvUHJvY2Vzc29yJyBpbiBsaW5lOgoJCQkJcHJvZHVjdCA9IGxpbmUuc3BsaXQoJ1ZpZGVvUHJvY2Vzc29yJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCgkJCQlpZiBsZW4ocHJvZHVjdCkgPCAxOgoJCQkJCXByb2R1Y3QgPSAnTm8gZGF0YSBmb3VuZCcKCQkJaWYgJ1ZpZGVvTW9kZURlc2NyaXB0aW9uJyBpbiBsaW5lOgoJCQkJY29sb3VyRGVwdGggPSBsaW5lLnNwbGl0KCd4ICcpWzJdLnNwbGl0KCcgJylbMF0KCQkJCWNvbG91ckRlcHRoID0gaW50KG1hdGgubG9nMihpbnQoY29sb3VyRGVwdGgpKSkKCQkJCWhSZXMgCQk9IGxpbmUuc3BsaXQoJzogJylbMV0uc3BsaXQoJyAnKVswXQoJCQkJdlJlcwkJPSBsaW5lLnNwbGl0KCd4ICcpWzFdLnNwbGl0KCcgJylbMF0KCQkJaWYgJ0FkYXB0ZXJEQUNUeXBlJyBpbiBsaW5lOgoJCQkJdmVuZG9yID0gbGluZS5zcGxpdCgnQWRhcHRlckRBQ1R5cGUnKVsxXS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKCQkJCWlmIGxlbih2ZW5kb3IpIDwgMToKCQkJCQl2ZW5kb3IgPSAnTm8gZGF0YSBmb3VuZCcKCWVsaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0xpbnV4JzoKCQlpZiBjaGVja0FwcEluc3RhbGxlZCgnbHNodycpOgoJCQljb21tYW5kIAk9IFsnbHNodycsICctQycsICAnZGlzcGxheSddCgkJCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJCXJlc3VsdCAJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJCQlmb3IgbGluZSBpbiByZXN1bHQuc3BsaXRsaW5lcygpOgoJCQkJaWYgJ3ZlbmRvcicgaW4gbGluZToKCQkJCQl2ZW5kb3IgPSBsaW5lLnNwbGl0KCd2ZW5kb3I6JylbMV0uc3RyaXAoKQoJCQkJZWxzZToKCQkJCQl2ZW5kb3IgPSAnTm8gZGF0YSBmb3VuZCcKCQkJCWlmICdwcm9kdWN0JyBpbiBsaW5lOgoJCQkJCXByb2R1Y3QgPSBsaW5lLnNwbGl0KCdwcm9kdWN0OicpWzFdLnN0cmlwKCkKCQkJCWVsc2U6CgkJCQkJcHJvZHVjdCA9ICdObyBkYXRhIGZvdW5kJwoJCQkJaWYgJ2NvbmZpZ3VyYXRpb246IGRlcHRoJyBpbiBsaW5lOgoJCQkJCWNvbG91ckRlcHRoID0gbGluZS5zcGxpdCgnZGVwdGg9JylbMV0uc3BsaXQoJyAnKVswXQkKCQkJCQloUmVzCQk9IGxpbmUuc3BsaXQoJ3Jlc29sdXRpb249JylbMV0uc3BsaXQoJywnKVswXQkKCQkJCQl2UmVzIAkJPSBsaW5lLnNwbGl0KCdyZXNvbHV0aW9uPScpWzFdLnNwbGl0KCcsJylbMV0KCQkJCWVsc2U6CgkJCQkJY29sb3VyRGVwdGggPSAnTm8gZGF0YSBmb3VuZCcKCQkJCQloUmVzIAkJPSAnTm8gZGF0YSBmb3VuZCcKCQkJCQl2UmVzIAkJPSAnTm8gZGF0YSBmb3VuZCcKCQllbHNlOgoJCQlsb2dnZXIuZGVidWcoJ3NldHRpbmcgZGVmYXVsdCBsc2h3IHZhbHVlcycpCgkJCXZlbmRvciAJCQk9ICdObyBkYXRhIGZvdW5kJwoJCQlwcm9kdWN0IAkJPSAnTm8gZGF0YSBmb3VuZCcKCQkJY29sb3VyRGVwdGggCT0gLTEKCQkJaFJlcyAJCQk9IC0xCgkJCXZSZXMgCQkJPSAtMQoJZGV2aWNlRGF0YURpY3RbJ2dwdWluZm8nXQkJCQkJPSB7fQoJZGV2aWNlRGF0YURpY3RbJ2dwdWluZm8nXVsnZ3B1dmVuZG9yJ10JCT0gdmVuZG9yCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHVwcm9kdWN0J10JCT0gcHJvZHVjdAoJZGV2aWNlRGF0YURpY3RbJ2dwdWluZm8nXVsnZ3B1Y29sb3VyJ10JCT0gY29sb3VyRGVwdGgKCWRldmljZURhdGFEaWN0WydncHVpbmZvJ11bJ2dwdWhyZXMnXQkJPSBoUmVzCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHV2cmVzJ10JCT0gdlJlcwoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIHppcEZpbGUoZmlsZVRvWmlwKToKCWltcG9ydCB6aXBmaWxlCglpbkZpbGUgCQk9IG9zLnBhdGguam9pbihmaWxlc0RpciwgZmlsZVRvWmlwKQoJb3V0WmlwRmlsZSAJPSBvcy5wYXRoLmpvaW4oZmlsZXNEaXIsIGYne2ZpbGVUb1ppcH0uemlwJykKCWxvZ2dlci5pbmZvKGYnWmlwcGluZyB7aW5GaWxlfSB0byB7b3V0WmlwRmlsZX0nKQoJdHJ5OgoJCXdpdGggemlwZmlsZS5aaXBGaWxlKG91dFppcEZpbGUsICd3JywgY29tcHJlc3Npb249emlwZmlsZS5aSVBfREVGTEFURUQpIGFzIHppcGY6CgkJCXppcGYud3JpdGUoaW5GaWxlLCBvcy5wYXRoLmJhc2VuYW1lKGluRmlsZSkpCgkJbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgemlwcGVkIHtpbkZpbGV9IHRvIHtvdXRaaXBGaWxlfScpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHppcCB7aW5GaWxlfSB0byB7b3V0WmlwRmlsZX0uIFJlYXNvbjoge2V9JykKCXJldHVybihvdXRaaXBGaWxlKQoKZGVmIHNlbmRQYXlsb2FkRmxhc2socm91dGUsIG91dFppcEZpbGUsIGRldmljZVV1aWQpOgoJcGF5bG9hZE5hbWUgCT0gb3MucGF0aC5iYXNlbmFtZShvdXRaaXBGaWxlKQoJdXJsIAkJCT0gZidodHRwczovL3tob3N0fXtyb3V0ZX0nCglsb2dnZXIuaW5mbyhmJ1JlcXVlc3QgdG8gc2VuZCB7b3V0WmlwRmlsZX0gfCBwYXlsb2FkTmFtZToge3BheWxvYWROYW1lfScpCglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCgl3aXRoIG9wZW4ob3V0WmlwRmlsZSwgJ3JiJykgYXMgZjoKCQlmaWxlcyA9IHsnZmlsZSc6IChwYXlsb2FkTmFtZSwgZil9CgkJaGVhZGVycyA9IHsnZGV2aWNldXVpZCc6IGRldmljZVV1aWR9CgkJcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMsIGhlYWRlcnM9aGVhZGVycykKCQlpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CgkJCWxvZ2dlci5pbmZvKGYnc3RhdHVzX2NvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0nKQoJCQlyZXR1cm4oVHJ1ZSkKCQllbHNlOgoJCQlsb2dnZXIuZXJyb3IoZidzdGF0dXNfY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfS4gUmVhc29uOiB7cmVzcG9uc2UudGV4dH0nKQoJCQlyZXR1cm4oRmFsc2UpCgpkZWYgZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCk6CglpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CgkJY29tbWFuZCAJPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQklPUykiCgkJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLnJ1bihbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQlmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKCQkJaWYgJ01hbnVmYWN0dXJlcicgaW4gbGluZToKCQkJCXZlbmRvciA9IGxpbmUuc3BsaXQoJ01hbnVmYWN0dXJlcicpWzFdLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoJCQlpZiAnTmFtZScgaW4gbGluZToKCQkJCWJpb3NWZXJzaW9uID0gbGluZS5zcGxpdCgnTmFtZScpWzFdLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoJCQlpZiAnU2VyaWFsTnVtYmVyJyBpbiBsaW5lOgoJCQkJc2VyaWFsTnVtYmVyID0gbGluZS5zcGxpdCgnU2VyaWFsTnVtYmVyJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCgkJCWlmICdWZXJzaW9uJyBpbiBsaW5lOgoJCQkJdmVyc2lvbiA9IGxpbmUuc3BsaXQoJ1ZlcnNpb24nKVsxXS5zcGxpdCgnOicpWzFdCQoJCQkJdmVyc2lvbiA9ICcgJy5qb2luKHZlcnNpb24uc3BsaXQoKSkuc3RyaXAoKQkJCgoJZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgoJCSMgQ2hlY2sgaWYgZG1pZGVjb2RlIGNvbW1hbmQgZXhpc3RzCgkJaWYgc2h1dGlsLndoaWNoKCdkbWlkZWNvZGUnKSBpcyBOb25lOgoJCQlsb2dnZXIud2FybmluZygnZG1pZGVjb2RlIGNvbW1hbmQgbm90IGZvdW5kLiBTa2lwcGluZyBTTUJJT1MgaW5mby4gSW5zdGFsbCBkbWlkZWNvZGUgcGFja2FnZSBpZiBuZWVkZWQuJykKCQkJdmVuZG9yIAkJCT0gJ24vYScKCQkJc2VyaWFsTnVtYmVyIAk9ICduL2EnCgkJCXZlcnNpb24JCQk9ICduL2EnCgkJZWxzZToKCQkJdHJ5OgoJCQkJbG9nZ2VyLmRlYnVnKCdSdW5uaW5nIGRtaWRlY29kZScpCgkJCQljb21tYW5kIAk9IFsnZG1pZGVjb2RlJywgJy10JywgJzEnXQoJCQkJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJCQlyZXN1bHQgCQk9IHJlc3VsdC5zdGRvdXQucmVhZCgpCgkJCQlmb3IgbGluZSBpbiByZXN1bHQuc3BsaXRsaW5lcygpOgoJCQkJCWlmICdNYW51ZmFjdHVyZXI6JyBpbiBsaW5lOgoJCQkJCQl2ZW5kb3IgPSBsaW5lLnNwbGl0KCdNYW51ZmFjdHVyZXI6JylbMV0uc3RyaXAoKQoJCQkJCWlmICdTZXJpYWwgTnVtYmVyJyBpbiBsaW5lOgoJCQkJCQlzZXJpYWxOdW1iZXIgPSBsaW5lLnNwbGl0KCdTZXJpYWwgTnVtYmVyOicpWzFdLnN0cmlwKCkKCQkJCQlpZiAnTm8gU01CSU9TIG5vciBETUkgZW50cnkgcG9pbnQgZm91bmQnIGluIGxpbmU6CgkJCQkJCXZlbmRvciAJCQk9ICduL2EnCgkJCQkJCXNlcmlhbE51bWJlciAJPSAnbi9hJwoJCQkJCQl2ZXJzaW9uCQkJPSAnbi9hJwoJCQkJY29tbWFuZCAJPSBbJ2RtaWRlY29kZScsICctdCcsICdiaW9zJywgJy1xJ10KCQkJCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJCQlyZXN1bHQgCQk9IHJlc3VsdC5zdGRvdXQucmVhZCgpCgkJCQlmb3IgbGluZSBpbiByZXN1bHQuc3BsaXRsaW5lcygpOgoJCQkJCWlmICdWZXJzaW9uOicgaW4gbGluZToKCQkJCQkJdmVyc2lvbiA9IGxpbmUuc3BsaXQoJ1ZlcnNpb246JylbMV0uc3RyaXAoKQoJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IFNNQklPUyBpbmZvOiB7ZX0nKQoJCQkJdmVuZG9yIAkJCT0gJ24vYScKCQkJCXNlcmlhbE51bWJlciAJPSAnbi9hJwoJCQkJdmVyc2lvbgkJCT0gJ24vYScKCWxvZ2dlci5pbmZvKGYndmVuZG9yOiB7dmVuZG9yfScpCglsb2dnZXIuaW5mbyhmJ3NlcmlhbE51bWJlcjoge3NlcmlhbE51bWJlcn0nKQoJbG9nZ2VyLmluZm8oZid2ZXJzaW9uOiB7dmVyc2lvbn0nKQoJZGV2aWNlRGF0YURpY3RbJ2Jpb3MnXQkJCQkJPSB7fQoJZGV2aWNlRGF0YURpY3RbJ2Jpb3MnXVsnYmlvc3ZlbmRvciddCT0gdmVuZG9yCglkZXZpY2VEYXRhRGljdFsnYmlvcyddWydzZXJpYWxudW1iZXInXQk9IHNlcmlhbE51bWJlcgoJZGV2aWNlRGF0YURpY3RbJ2Jpb3MnXVsnYmlvc3ZlcnNpb24nXQk9IHZlcnNpb24KCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRTeXN0ZW1Nb2RlbEZyb21Qcm9jKCk6CglzeXN0ZW1Nb2RlbAk9ICduL2EnCgljb21tYW5kCQk9IFsnY2F0JywgJy9wcm9jL2NwdWluZm8nXQoJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCWxvZ2dlci5kZWJ1ZyhmJ3Jlc3VsdDoge3Jlc3VsdH0nKQoJb3V0dGV4dCAJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJbG9nZ2VyLmluZm8oZidvdXR0ZXh0OiB7b3V0dGV4dH0nKQoJZm9yIGxpbmUgaW4gb3V0dGV4dC5zcGxpdGxpbmVzKCk6CgkJaWYgJ01vZGVsJyBpbiBsaW5lOgoJCQlzeXN0ZW1Nb2RlbCA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCglsb2dnZXIuaW5mbyhmJ3N5c3RlbU1vZGVsOiB7c3lzdGVtTW9kZWx9JykJCglyZXR1cm4oc3lzdGVtTW9kZWwpCgpkZWYgZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpOgoJaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgoJCWNvbW1hbmQgCT0gWyd3bWljJywgJ2NzcHJvZHVjdCcsICdnZXQnLCAnbmFtZSddCgkJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLnJ1bihjb21tYW5kLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CgkJCWlmIGxpbmUuc3RyaXAoKSA9PSAnTmFtZSc6CgkJCQlwYXNzCgkJCWVsaWYgbGVuKGxpbmUpID4gMDoKCQkJCXN5c3RlbU1vZGVsID0gbGluZS5zdHJpcCgpCgkJCQlicmVhawoJZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgoJCSMgQ2hlY2sgaWYgZG1pZGVjb2RlIGNvbW1hbmQgZXhpc3RzCgkJaWYgc2h1dGlsLndoaWNoKCdkbWlkZWNvZGUnKSBpcyBOb25lOgoJCQlsb2dnZXIud2FybmluZygnZG1pZGVjb2RlIGNvbW1hbmQgbm90IGZvdW5kLiBGYWxsaW5nIGJhY2sgdG8gL3Byb2MvY3B1aW5mby4gSW5zdGFsbCBkbWlkZWNvZGUgcGFja2FnZSBpZiBuZWVkZWQuJykKCQkJc3lzdGVtTW9kZWwgPSBnZXRTeXN0ZW1Nb2RlbEZyb21Qcm9jKCkKCQllbHNlOgoJCQl0cnk6CgkJCQljb21tYW5kIAk9IFsnZG1pZGVjb2RlJywgJy10JywgJzEnXQoJCQkJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQkJCXJlc3VsdCAJCT0gcmVzdWx0LnN0ZG91dC5yZWFkKCkKCQkJCWZvciBsaW5lIGluIHJlc3VsdC5zcGxpdGxpbmVzKCk6CgkJCQkJaWYgJ1Byb2R1Y3QgTmFtZTogJyBpbiBsaW5lOgoJCQkJCQlzeXN0ZW1Nb2RlbCA9IGxpbmUuc3BsaXQoJ1Byb2R1Y3QgTmFtZTonKVsxXS5zdHJpcCgpCgkJCQkJaWYgJ05vIFNNQklPUyBub3IgRE1JIGVudHJ5IHBvaW50IGZvdW5kJyBpbiBsaW5lOgoJCQkJCQlzeXN0ZW1Nb2RlbCA9IGdldFN5c3RlbU1vZGVsRnJvbVByb2MoKQoJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHN5c3RlbSBtb2RlbCBmcm9tIGRtaWRlY29kZToge2V9LiBGYWxsaW5nIGJhY2sgdG8gL3Byb2MvY3B1aW5mby4nKQoJCQkJc3lzdGVtTW9kZWwgPSBnZXRTeXN0ZW1Nb2RlbEZyb21Qcm9jKCkKCWxvZ2dlci5pbmZvKGYnc3lzdGVtTW9kZWw6IHtzeXN0ZW1Nb2RlbH0nKQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydzeXN0ZW1tb2RlbCddCQk9IHN5c3RlbU1vZGVsCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0U2VydmljZXMoKToKCWxvZ2dlci5pbmZvKCdBdHRlbXB0aW5nIHRvIGdldCBzZXJ2aWNlcy4uLicpCglzZXJ2aWNlc0RpY3QgCT0ge30KCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQlpbXBvcnQgd2luMzJzZXJ2aWNlCgkJU0VSVklDRV9TVEFURV9BTEwgCT0gd2luMzJzZXJ2aWNlLlNFUlZJQ0VfU1RBVEVfQUxMCgkJc2VydmljZV9tYW5hZ2VyIAk9IHdpbjMyc2VydmljZS5PcGVuU0NNYW5hZ2VyKE5vbmUsIE5vbmUsIHdpbjMyc2VydmljZS5TQ19NQU5BR0VSX0VOVU1FUkFURV9TRVJWSUNFKQoJCXNlcnZpY2VzIAkJCT0gd2luMzJzZXJ2aWNlLkVudW1TZXJ2aWNlc1N0YXR1c0V4KHNlcnZpY2VfbWFuYWdlciwgd2luMzJzZXJ2aWNlLlNFUlZJQ0VfV0lOMzIsIFNFUlZJQ0VfU1RBVEVfQUxMKQoJCWZvciBzZXJ2aWNlIGluIHNlcnZpY2VzOgoJCQlpZiBzZXJ2aWNlWydDdXJyZW50U3RhdGUnXSA9PSAxOgoJCQkJZnJpZW5kbHlTdGF0ZSA9ICdTVE9QUEVEJwoJCQllbGlmIHNlcnZpY2VbJ0N1cnJlbnRTdGF0ZSddID09IDI6CgkJCQlmcmllbmRseVN0YXRlID0gJ1NUQVJUSU5HJwoJCQllbGlmIHNlcnZpY2VbJ0N1cnJlbnRTdGF0ZSddID09IDM6CgkJCQlmcmllbmRseVN0YXRlID0gJ1NUT1BQSU5HJwoJCQllbGlmIHNlcnZpY2VbJ0N1cnJlbnRTdGF0ZSddID09IDQ6CgkJCQlmcmllbmRseVN0YXRlID0gJ1JVTk5JTkcnCgkJCWVsaWYgc2VydmljZVsnQ3VycmVudFN0YXRlJ10gPT0gNzoKCQkJCWZyaWVuZGx5U3RhdGUgPSAnUEFVU0VEJwkKCQkJZWxzZToKCQkJCWZyaWVuZGx5U3RhdGUgPSAnT1RIRVInCgkJCWlmICdfJyBpbiBzZXJ2aWNlWydTZXJ2aWNlTmFtZSddOgoJCQkJc2VydmljZU5hbWUgPSBzZXJ2aWNlWydTZXJ2aWNlTmFtZSddLnNwbGl0KCdfJylbMF0KCQkJCWRpc3BsYXlOYW1lID0gc2VydmljZVsnRGlzcGxheU5hbWUnXS5zcGxpdCgnXycpWzBdCgkJCWVsc2U6CgkJCQlzZXJ2aWNlTmFtZSA9IHNlcnZpY2VbJ1NlcnZpY2VOYW1lJ10KCQkJCWRpc3BsYXlOYW1lID0gc2VydmljZVsnRGlzcGxheU5hbWUnXQoJCQlwcmludChmIntzZXJ2aWNlWydDdXJyZW50U3RhdGUnXX0gfCB7ZnJpZW5kbHlTdGF0ZX0gfCB7ZGlzcGxheU5hbWV9KHtzZXJ2aWNlTmFtZX0pIikKCQkJc2VydmljZXNEaWN0W3NlcnZpY2VOYW1lXSA9IHt9CgkJCXNlcnZpY2VzRGljdFtzZXJ2aWNlTmFtZV1bJ2Rpc3BsYXluYW1lJ10gPSBkaXNwbGF5TmFtZQoJCQlzZXJ2aWNlc0RpY3Rbc2VydmljZU5hbWVdWydjdXJyZW50c3RhdGUnXSA9IHNlcnZpY2VbJ0N1cnJlbnRTdGF0ZSddCgkJCXNlcnZpY2VzRGljdFtzZXJ2aWNlTmFtZV1bJ2ZyaWVuZGx5c3RhdGUnXSA9IGZyaWVuZGx5U3RhdGUKCWxvZ2dlci5pbmZvKCdTdWNjZXNzZnVsbHkgY29sbGVjdGVkIHNlcnZpY2VzLicpCglzZXJ2aWNlc0RpY3RGaWxlCT0gd3JpdGVTZXJ2aWNlc0pzb24oc2VydmljZXNEaWN0KQoJcm91dGUgCQkJCT0gJy9wYXlsb2FkL3NlbmRmaWxlJwoJdXBsb2FkU3VjY2VzcyAJCT0gc2VuZFBheWxvYWRGbGFzayhyb3V0ZSwgc2VydmljZXNEaWN0RmlsZSwgZGV2aWNlVXVpZCkKCWlmIHVwbG9hZFN1Y2Nlc3MgPT0gVHJ1ZToKCQlkZWxGaWxlKHNlcnZpY2VzRGljdEZpbGUpCgllbHNlOgoJCWxvZ2dlci5lcnJvcihmJ1VwbG9hZCBmYWlsZWQuJykKCXJldHVybihzZXJ2aWNlc0RpY3QpCgpkZWYgd3JpdGVTZXJ2aWNlc0pzb24oc2VydmljZXNEaWN0KToKCXNlcnZpY2VzRGljdEZpbGUgPSBmJ3tmaWxlc0Rpcn1zZXJ2aWNlcy5qc29uJwoJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHdyaXRlIHNlcnZpY2VzIHRvIHtzZXJ2aWNlc0RpY3RGaWxlfScpCgl0cnk6CgkJd2l0aCBvcGVuKHNlcnZpY2VzRGljdEZpbGUsICd3JykgYXMgZjoKCQkJZi53cml0ZShqc29uLmR1bXBzKHNlcnZpY2VzRGljdCwgaW5kZW50PTQpKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byB3cml0ZSBzZXJ2aWNlc0RpY3QgdG8ge3NlcnZpY2VzRGljdEZpbGV9LiBSZWFzb246IHtlfScpCglyZXR1cm4oc2VydmljZXNEaWN0RmlsZSkKCmRlZiBnZXRQcmludGVycyhkZXZpY2VEYXRhRGljdCk6CglwcmludGVyRGljdCAJCQkJPSB7fQoJZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gCT0gW10KCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQljb21tYW5kIAk9ICdnZXQtcHJpbnRlciB8IEZvcm1hdC1saXN0JwoJCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5ydW4oWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQlyZXN1bHQgCQk9IHJlc3VsdC5zdGRvdXQKCQlmb3IgbGluZSBpbiByZXN1bHQuc3BsaXRsaW5lcygpOgoJCQlpZiBsaW5lLnN0YXJ0c3dpdGgoJ05hbWUnKToKCQkJCXByaW50ZXJOYW1lID0gbGluZS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKCQkJCXByaW50ZXJEaWN0W3ByaW50ZXJOYW1lXSA9IHt9CgkJCWlmIGxpbmUuc3RhcnRzd2l0aCgnUG9ydE5hbWUnKToKCQkJCXBvcnROYW1lID0gJzonLmpvaW4obGluZS5zcGxpdCgnOicpWzE6XSkuc3RyaXAoKQoJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdWydwb3J0bmFtZSddID0gcG9ydE5hbWUKCQkJaWYgbGluZS5zdGFydHN3aXRoKCdEcml2ZXJOYW1lJyk6CgkJCQlkcml2ZXJOYW1lID0gbGluZS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKCQkJCXByaW50ZXJEaWN0W3ByaW50ZXJOYW1lXVsnZHJpdmVybmFtZSddID0gZHJpdmVyTmFtZQkJCgkJCWlmIGxpbmUuc3RhcnRzd2l0aCgnTG9jYXRpb24nKToKCQkJCWxvY2F0aW9uID0gJzonLmpvaW4obGluZS5zcGxpdCgnOicpWzE6XSkuc3RyaXAoKQoJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdWydsb2NhdGlvbiddID0gbG9jYXRpb24JCgkJCWlmIGxpbmUuc3RhcnRzd2l0aCgnUHJpbnRlclN0YXR1cycpOgoJCQkJcHJpbnRlclN0YXR1cyA9ICcnLmpvaW4obGluZS5zcGxpdCgnOicpWzE6XSkuc3RyaXAoKQoJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdWydwcmludGVyc3RhdHVzJ10gPSBwcmludGVyU3RhdHVzCQoJCWRldmljZURhdGFEaWN0WydwcmludGVycyddID0gcHJpbnRlckRpY3QKCWVsc2U6CgkJaWYgY2hlY2tBcHBJbnN0YWxsZWQoJ2xwc3RhdCcpOgoJCQljb21tYW5kIAkJCQkJPSBbJ2xwc3RhdCcsICctcCcsICctbCcsICctcyddCgkJCXJlc3VsdCAJCQkJCQk9IHN1YnByb2Nlc3MuUG9wZW4oY29tbWFuZCwgc3Rkb3V0ID0gc3VicHJvY2Vzcy5QSVBFLCB1bml2ZXJzYWxfbmV3bGluZXMgPSBUcnVlKQoJCQlyZXN1bHQgCQkJCQkJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJCQlsb2dnZXIuZGVidWcoZidwcmludGVyUmVzdWx0OiB7cmVzdWx0fScpCgkJCWZvciBsaW5lIGluIHJlc3VsdC5zcGxpdGxpbmVzKCk6CgkJCQlsb2dnZXIuZGVidWcoZidwcmludGVyTGluZToge2xpbmV9JykKCQkJCWlmIGxpbmUuc3RyaXAoKS5zdGFydHN3aXRoKCdwcmludGVyJyk6CgkJCQkJbG9nZ2VyLmRlYnVnKCdpIGZvdW5kIGEgcHJpbnRlcicpCgkJCQkJcHJpbnRlck5hbWUgPSBsaW5lLnNwbGl0KCdwcmludGVyICcpWzFdLnNwbGl0KCcgJylbMF0uc3RyaXAoKQoJCQkJCWxvZ2dlci5kZWJ1ZyhmJ3ByaW50ZXJOYW1lOiB7cHJpbnRlck5hbWV9JykKCQkJCQlpZiBwcmludGVyTmFtZSBub3QgaW4gcHJpbnRlckRpY3Q6CgkJCQkJCWxvZ2dlci5kZWJ1ZyhmJ2FkZGluZyB7cHJpbnRlck5hbWV9IHRvIHByaW50ZXJEaWN0JykKCQkJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdID0ge30KCQkJCQkJbG9nZ2VyLmRlYnVnKGYncHJpbnRlckRpY3Q6IHtwcmludGVyRGljdH0nKQoJCQkJaWYgbGluZS5zdHJpcCgpLnN0YXJ0c3dpdGgoJ3N5c3RlbSBkZWZhdWx0Jyk6CgkJCQkJcHJpbnRlck5hbWUgPSAnOicuam9pbihsaW5lLnNwbGl0KCc6JylbMTpdKS5zdHJpcCgpCgkJCQkJZGVmYXVsdFByaW50ZXIgPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoJCQkJCWlmIGRlZmF1bHRQcmludGVyIGluIHByaW50ZXJEaWN0OgoJCQkJCQlwcmludGVyRGljdFtwcmludGVyTmFtZV1bJ2RlZmF1bHQnXSA9IFRydWUKCgkJCQlpZiBsaW5lLnN0cmlwKCkuc3RhcnRzd2l0aCgnZGV2aWNlJyk6CgkJCQkJcHJpbnRlck5hbWUgPSBsaW5lLnNwbGl0KCdkZXZpY2UgZm9yICcpWzFdLnNwbGl0KCc6JylbMF0KCQkJCQlwcmludGVyUG9ydCA9ICc6Jy5qb2luKGxpbmUuc3BsaXQoJzonKVsxOl0pLnN0cmlwKCkKCQkJCQlpZiBwcmludGVyTmFtZSBpbiBwcmludGVyRGljdDoKCQkJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdWydwb3J0bmFtZSddID0gcHJpbnRlclBvcnQKCQkJZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gPSBwcmludGVyRGljdAkJCQoJCWVsc2U6CgkJCWRldmljZURhdGFEaWN0WydwcmludGVycyddID0ge30KCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRQY2lEZXZpY2VzKGRldmljZURhdGFEaWN0KToKCXBjaURldmljZURpY3QgCQkJCT0ge30KCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQljb21tYW5kIAk9ICJHZXQtV21pT2JqZWN0IC1RdWVyeSBcIlNFTEVDVCBQTlBDbGFzcywgTmFtZSBGUk9NIFdpbjMyX1BuUEVudGl0eSBXSEVSRSBEZXZpY2VJRCBMSUtFICclUENJJSdcIiIKCQlyZXN1bHQgCQk9IHN1YnByb2Nlc3MucnVuKFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJcmVzdWx0IAkJPSByZXN1bHQuc3Rkb3V0CgkJZm9yIGxpbmUgaW4gcmVzdWx0LnNwbGl0bGluZXMoKToKCQkJaWYgbGluZS5zdGFydHN3aXRoKCdOYW1lJyk6CgkJCQluYW1lID0gbGluZS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKCQkJCXBjaURldmljZURpY3RbbmFtZV0gPSB7fQoKCQkJaWYgbGluZS5zdGFydHN3aXRoKCdQTlBDbGFzcycpOgoJCQkJcG5wQ2xhc3MgPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoJCQkJcGNpRGV2aWNlRGljdFtuYW1lXVsncG5wY2xhc3MnXSA9IHBucENsYXNzCgkJZGV2aWNlRGF0YURpY3RbJ3BjaWRldmljZXMnXSA9IHBjaURldmljZURpY3QKCWVsc2U6CgkJIyBDaGVjayBpZiBsc3BjaSBjb21tYW5kIGV4aXN0cwoJCWlmIHNodXRpbC53aGljaCgnbHNwY2knKSBpcyBOb25lOgoJCQlsb2dnZXIud2FybmluZygnbHNwY2kgY29tbWFuZCBub3QgZm91bmQuIFNraXBwaW5nIFBDSSBkZXZpY2UgZW51bWVyYXRpb24uIEluc3RhbGwgcGNpdXRpbHMgcGFja2FnZSBpZiBuZWVkZWQuJykKCQkJZGV2aWNlRGF0YURpY3RbJ3BjaWRldmljZXMnXSA9IHt9CgkJZWxzZToKCQkJdHJ5OgoJCQkJY29tbWFuZCAJCQkJCT0gWydsc3BjaSddCgkJCQlyZXN1bHQgCQkJCQkJPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCQkJCXJlc3VsdCAJCQkJCQk9IHJlc3VsdC5zdGRvdXQucmVhZCgpCgkJCQlmb3IgbGluZSBpbiByZXN1bHQuc3BsaXRsaW5lcygpOgoJCQkJCWlmICdDYW5ub3QgJyBpbiBsaW5lOgoJCQkJCQlwYXNzCgkJCQkJZWxzZToKCQkJCQkJcG5wQ2xhc3MgCT0gJzonLmpvaW4obGluZS5zcGxpdCgnICcpWzE6XSkuc3BsaXQoJzonKVswXS5zdHJpcCgpCgkJCQkJCW5hbWUgCQk9ICc6Jy5qb2luKGxpbmUuc3BsaXQoJzogJylbMTpdKS5zdHJpcCgpCgkJCQkJCXBjaURldmljZURpY3RbbmFtZV0gPSB7fQoJCQkJCQlwY2lEZXZpY2VEaWN0W25hbWVdWydwbnBjbGFzcyddID0gcG5wQ2xhc3MKCQkJCWRldmljZURhdGFEaWN0WydwY2lkZXZpY2VzJ10gPSBwY2lEZXZpY2VEaWN0CgkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgUENJIGRldmljZXM6IHtlfScpCgkJCQlkZXZpY2VEYXRhRGljdFsncGNpZGV2aWNlcyddID0ge30KCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KToKCXVzYkRldmljZUxpc3QJCQkJCT0gW10KCXVzYkRldmljZURpY3QgCQkJCQk9IHt9CgoJaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgoJCWNvbW1hbmQgCT0gImdldC1wbnBkZXZpY2UgfCBXaGVyZS1PYmplY3QgeyAkXy5DbGFzcyAtZXEgXCJVU0JcIiB9IHwgc2VsZWN0IE5hbWUsIEluc3RhbmNlSWQsIHN0YXR1cyIKCQlwcmludChmJ2NvbW1hbmQ6IHtjb21tYW5kfScpCgkJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLnJ1bihbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwgc3Rkb3V0ID0gc3VicHJvY2Vzcy5QSVBFLCB1bml2ZXJzYWxfbmV3bGluZXMgPSBUcnVlKQoJCXJlc3VsdCAJCT0gcmVzdWx0LnN0ZG91dAoJCWZvciBsaW5lIGluIHJlc3VsdC5zcGxpdGxpbmVzKCk6CgkJCWxvZ2dlci5kZWJ1ZyhmJ2xpbmVYOiB7bGluZX0nKQoJCQlpZiBsaW5lLnN0YXJ0c3dpdGgoJ05hbWUnKSBvciBsaW5lLnN0YXJ0c3dpdGgoJy0tJykgb3IgbGVuKGxpbmUpIDwgNToKCQkJCWNvbnRpbnVlCgkJCWVsaWYgJ1VTQlxcJyBpbiBsaW5lOgoJCQkJcGFydHMgPSBsaW5lLnNwbGl0KCdVU0JcXCcpCgkJCQlwcmVmaXggPSAnVVNCXFwnCgkJCWVsaWYgJ1BDSVxcJyBpbiBsaW5lOgoJCQkJcGFydHMgPSBsaW5lLnNwbGl0KCdQQ0lcXCcpCgkJCQlwcmVmaXggPSAnUENJXFwnCgkJCWVsc2U6CgkJCQljb250aW51ZQoJCQluYW1lIAkJPSBwYXJ0c1swXS5zdHJpcCgpCgkJCWluc3RhbmNlSWQgCT0gZid7cHJlZml4fXtwYXJ0c1sxXS5zcGxpdCgiICIpWzBdLnN0cmlwKCl9JwojCQkJc3RhdHVzIAkJPSAnICcuam9pbihwYXJ0c1sxXS5zcGxpdCgpKS5zcGxpdCgnICcpWzFdLnN0cmlwKCkKCQkJaWYgaW5zdGFuY2VJZCBub3QgaW4gdXNiRGV2aWNlRGljdDoKCQkJCXVzYkRldmljZURpY3RbaW5zdGFuY2VJZF0gCQkJPSB7fQoJCQkJdXNiRGV2aWNlRGljdFtpbnN0YW5jZUlkXVsnbmFtZSddIAk9IG5hbWUKIwkJCQl1c2JEZXZpY2VEaWN0W2luc3RhbmNlSWRdWydzdGF0dXMnXSA9IHN0YXR1cwoJCWRldmljZURhdGFEaWN0Wyd1c2JkZXZpY2VzJ10gPSB1c2JEZXZpY2VEaWN0CgllbHNlOgoJCSMgQ2hlY2sgaWYgbHN1c2IgY29tbWFuZCBleGlzdHMKCQlpZiBzaHV0aWwud2hpY2goJ2xzdXNiJykgaXMgTm9uZToKCQkJbG9nZ2VyLndhcm5pbmcoJ2xzdXNiIGNvbW1hbmQgbm90IGZvdW5kLiBTa2lwcGluZyBVU0IgZGV2aWNlIGVudW1lcmF0aW9uLiBJbnN0YWxsIHVzYnV0aWxzIHBhY2thZ2UgaWYgbmVlZGVkLicpCgkJCWRldmljZURhdGFEaWN0Wyd1c2JkZXZpY2VzJ10gPSBbXQoJCWVsc2U6CgkJCXRyeToKCQkJCWNvbW1hbmQgCQkJCQk9IFsnbHN1c2InXQoJCQkJcmVzdWx0IAkJCQkJCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCgkJCQlyZXN1bHQgCQkJCQkJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJCQkJZm9yIGxpbmUgaW4gcmVzdWx0LnNwbGl0bGluZXMoKToKCQkJCQluYW1lIAkJPSAnICcuam9pbihsaW5lLnNwbGl0KCcgJylbNjpdKQoJCQkJCWlmIG5hbWUgbm90IGluIHVzYkRldmljZUxpc3Q6CgkJCQkJCXVzYkRldmljZUxpc3QuYXBwZW5kKG5hbWUpCgkJCQlkZXZpY2VEYXRhRGljdFsndXNiZGV2aWNlcyddID0gdXNiRGV2aWNlTGlzdAoJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IFVTQiBkZXZpY2VzOiB7ZX0nKQoJCQkJZGV2aWNlRGF0YURpY3RbJ3VzYmRldmljZXMnXSA9IFtdCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMgRVZFTlQgTE9HIEZVTkNUSU9OUyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiByZWFkTG9nKGxvZyk6Cglsb2dnZXIuaW5mbyhmJ1JlYWRpbmcge2xvZ30gZXZlbnQgbG9nIGZyb20gcmVjb3JkTnVtYmVyIHtsYXRlc3RFdmVudH0uLi4nKQoJb2JqZWN0TGlzdCAJPSBbXQoJaAkJCT0gd2luMzJldnRsb2cuT3BlbkV2ZW50TG9nKE5vbmUsIGxvZykKCWxvZ2dlci5kZWJ1ZyhmJ1RvdGFsIG51bWJlciBvZiByZWNvcmRzIGluIHtsb2d9IGxvZzoge3dpbjMyZXZ0bG9nLkdldE51bWJlck9mRXZlbnRMb2dSZWNvcmRzKGgpfScpCgl3aGlsZSBUcnVlOgoJCW9iamVjdHMgCT0gd2luMzJldnRsb2cuUmVhZEV2ZW50TG9nKGgsIHdpbjMyZXZ0bG9nLkVWRU5UTE9HX0JBQ0tXQVJEU19SRUFEfHdpbjMyZXZ0bG9nLkVWRU5UTE9HX1NFUVVFTlRJQUxfUkVBRCwgMCkKCQlpZiBub3Qgb2JqZWN0czoKCQkJbG9nZ2VyLmluZm8oJ0VuZCBvZiBldmVudHMuLi4nKQoJCQlicmVhawoJCWZvciBvYmplY3QgaW4gb2JqZWN0czoJCgkJCWlmIG9iamVjdC5SZWNvcmROdW1iZXIgPiBsYXRlc3RFdmVudDoKCQkJCW9iamVjdExpc3QuYXBwZW5kKG9iamVjdCkKCQkJZWxzZToKCQkJCXBhc3MKCXJldHVybihvYmplY3RMaXN0KQoKZGVmIGdldEV2ZW50VmFsdWVUb1N0cmluZyhldmVudFZhbHVlKToKCWlmIGV2ZW50VmFsdWUgPT0gMDoKCQlyZXR1cm4oJ1NVQ0NFU1MnKQoJZWxpZiBldmVudFZhbHVlID09IDE6CgkJcmV0dXJuKCdFUlJPUicpCgllbGlmIGV2ZW50VmFsdWUgPT0gMjoKCQlyZXR1cm4oJ1dBUk5JTkcnKQoJZWxpZiBldmVudFZhbHVlID09IDQ6CgkJcmV0dXJuKCdJTkZPUk1BVElPTicpCgllbGlmIGV2ZW50VmFsdWUgPT0gODoKCQlyZXR1cm4oJ0FVRElUIFNVQ0NFU1MnKQoJZWxzZToKCQlsb2dnZXIuaW5mbyhmJ09USEVSOiB7ZXZlbnRWYWx1ZX0nKQoJCXJldHVybihmJ09USEVSJykKCmRlZiBmaXhFdmVudElkKGJhZElkKToKCWlmIGJhZElkIDwgMDoKCQliYWRJZCArPSAyKioxNgoJZml4ZWRFdmVudElkID0gYmFkSWQgJiAweEZGRkYKCXJldHVybiAoZml4ZWRFdmVudElkKQkKCmRlZiBwcm9jZXNzRXZlbnRzKGxvZywgb2JqZWN0TGlzdCwgZXZlbnREaWN0KToKCW5vdyAJCQkJPSBkYXRldGltZS5kYXRldGltZS5ub3coKQoJdGhpcnR5RGF5c0FnbwkJPSBub3cgLSBkYXRldGltZS50aW1lZGVsdGEoZGF5cz0zMCkKCWZvciBvYmplY3QgaW4gb2JqZWN0TGlzdDoKCQlpZiBvYmplY3QuVGltZUdlbmVyYXRlZCA8IHRoaXJ0eURheXNBZ286CgkJCWxvZ2dlci5kZWJ1ZyhmJ1NraXBwaW5nOiB7b2JqZWN0LlJlY29yZE51bWJlcn0gfCB7b2JqZWN0LlRpbWVHZW5lcmF0ZWR9JykKCQkJYnJlYWsKCQllbHNlOgojCQkJbG9nZ2VyLmRlYnVnKGYnRm91bmQgUmVjb3JkOiB7b2JqZWN0LlJlY29yZE51bWJlcn0gfCB7b2JqZWN0LlRpbWVHZW5lcmF0ZWR9IHwge29iamVjdC5Tb3VyY2VOYW1lfSB8IHtvYmplY3QuRXZlbnRJRH0gfCB7Z2V0RXZlbnRWYWx1ZVRvU3RyaW5nKG9iamVjdC5FdmVudFR5cGUpfSB8IHt3aW4zMmV2dGxvZ3V0aWwuU2FmZUZvcm1hdE1lc3NhZ2Uob2JqZWN0LCBsb2cpfScpCgkJCWV2ZW50RGljdFtvYmplY3QuUmVjb3JkTnVtYmVyXSA9IHsKCQkJCSd0aW1lZ2VuZXJhdGVkJzogb2JqZWN0LlRpbWVHZW5lcmF0ZWQuc3RyZnRpbWUoIiVZLSVtLSVkLSVIOiVNOiVTIiksIAoJCQkJJ3NvdXJjZW5hbWUnOiBvYmplY3QuU291cmNlTmFtZSwgCgkJCQknZXZlbnRpZCc6IGZpeEV2ZW50SWQob2JqZWN0LkV2ZW50SUQpLAoJCQkJJ2V2ZW50dHlwZSc6IGdldEV2ZW50VmFsdWVUb1N0cmluZyhvYmplY3QuRXZlbnRUeXBlKSwKCQkJCSdtZXNzYWdlJzogd2luMzJldnRsb2d1dGlsLlNhZmVGb3JtYXRNZXNzYWdlKG9iamVjdCwgbG9nKQoJCQl9CglyZXR1cm4oZXZlbnREaWN0KQoKZGVmIHJlYWRFeGlzdGluZ0xvZ0pzb24obG9nKToKCWV2ZW50RGljdEZpbGUgPSBmJ3tmaWxlc0Rpcn1ldmVudHMte2xvZ30uanNvbicKCWxvZ2dlci5pbmZvKGYnQ2hlY2tpbmcgdG8gc2VlIGlmIHtldmVudERpY3RGaWxlfSBleGlzdHMuLi4nKQoJaWYgb3MucGF0aC5pc2ZpbGUoZXZlbnREaWN0RmlsZSk6CgkJbG9nZ2VyLmluZm8oZid7ZXZlbnREaWN0RmlsZX0gZXhpc3RzLiBSZWFkaW5nIGRhdGEuLi4nKQoJCXdpdGggb3BlbihldmVudERpY3RGaWxlLCAncicpIGFzIGY6CgkJCWV2ZW50RGljdCA9IGpzb24ubG9hZChmKQoJCWxvZ2dlci5pbmZvKGYnZXZlbnREaWN0IHJlYWQgZnJvbSBmaWxlLicpCgllbHNlOgoJCWxvZ2dlci5pbmZvKGYne2V2ZW50RGljdEZpbGV9IGRvZXMgbm90IGV4aXN0LiBDcmVhdGluZyBlbXB0eSBldmVudERpY3QuLi4nKQoJCWV2ZW50RGljdCA9IHt9CglyZXR1cm4oZXZlbnREaWN0KQoKZGVmIHdyaXRlTG9nSnNvbihldmVudERpY3QsIGxvZyk6CglldmVudERpY3RGaWxlID0gZid7ZmlsZXNEaXJ9ZXZlbnRzLXtsb2d9Lmpzb24nCgl3aXRoIG9wZW4oZXZlbnREaWN0RmlsZSwgJ3cnKSBhcyBmOgoJCWYud3JpdGUoanNvbi5kdW1wcyhldmVudERpY3QsIGluZGVudD00KSkKCmRlZiB3cml0ZVJlY29yZFN0YXJ0UG9pbnQobG9nKToKCWxhdGVzdEV2dEZpbGUJCT0gZid7Y29uZmlnRGlyfWxhdGVzdEV2dC17bG9nfS50eHQnCglvYmplY3RMaXN0IAkJCT0gW10KCWgJCQkJCT0gd2luMzJldnRsb2cuT3BlbkV2ZW50TG9nKE5vbmUsIGxvZykKCWxvZ2dlci5kZWJ1ZyhmJ251bWJlciBvZiByZWNvcmRzOiB7d2luMzJldnRsb2cuR2V0TnVtYmVyT2ZFdmVudExvZ1JlY29yZHMoaCl9JykKCXdoaWxlIFRydWU6CgkJb2JqZWN0cyAJPSB3aW4zMmV2dGxvZy5SZWFkRXZlbnRMb2coaCwgd2luMzJldnRsb2cuRVZFTlRMT0dfQkFDS1dBUkRTX1JFQUR8d2luMzJldnRsb2cuRVZFTlRMT0dfU0VRVUVOVElBTF9SRUFELCAwKQoJCWlmIG5vdCBvYmplY3RzOgoJCQlicmVhawoJCWZvciBvYmplY3QgaW4gb2JqZWN0czoKCQkJb2JqZWN0TGlzdC5hcHBlbmQob2JqZWN0KQoJbGF0ZXN0RXZlbnQgPSBvYmplY3RMaXN0WzBdLlJlY29yZE51bWJlcgoJbG9nZ2VyLmluZm8oZidOZXcgbGF0ZXN0IEV2ZW50OiB7bGF0ZXN0RXZlbnR9JykKCXdpdGggb3BlbihsYXRlc3RFdnRGaWxlLCAndycpIGFzIGY6CgkJZi53cml0ZShmJ3tsYXRlc3RFdmVudH0nKQoJcmV0dXJuKGxhdGVzdEV2ZW50KQoKZGVmIGdldExhdGVzdEV2ZW50KGxhdGVzdEV2dEZpbGUpOgoJbG9nZ2VyLmRlYnVnKGYnR2V0dGluZyBsYXRlc3QgZXZlbnQgZnJvbSB7bGF0ZXN0RXZ0RmlsZX0uLi4nKQoJaWYgbm90IG9zLnBhdGguaXNmaWxlKGxhdGVzdEV2dEZpbGUpOgoJCWxvZ2dlci5pbmZvKGYnbGF0ZXN0RXZ0RmlsZToge2xhdGVzdEV2dEZpbGV9IGRvZXMgbm90IGV4aXN0LiBTZXR0aW5nIG5ldyBzdGFydCBwb2ludC4nKQoJCWxhdGVzdEV2ZW50ID0gMAoJZWxzZToKCQl3aXRoIG9wZW4obGF0ZXN0RXZ0RmlsZSwgJ3InKSBhcyBmOgoJCQlsYXRlc3RFdmVudCA9IGYucmVhZGxpbmUoKQoJbG9nZ2VyLmluZm8oZidQcmV2aW91cyBsYXRlc3RFdmVudDoge2xhdGVzdEV2ZW50fScpCQoJcmV0dXJuKGludChsYXRlc3RFdmVudCkpCgpkZWYgd3JpdGVMYXRlc3RFdmVudChsYXRlc3RFdmVudCwgbG9nLCBvYmplY3RMaXN0KToKCWxhdGVzdEV2dEZpbGUJCT0gZid7Y29uZmlnRGlyfWxhdGVzdEV2dC17bG9nfS50eHQnCglsb2dnZXIuZGVidWcoZidXcml0aW5nIGxhdGVzdCBldmVudCB0byB7bGF0ZXN0RXZ0RmlsZX0uLi4nKQoJaWYgbGVuKG9iamVjdExpc3QpID4gMDoKCQlsYXRlc3RFdmVudCA9IG9iamVjdExpc3RbMF0uUmVjb3JkTnVtYmVyCgkJbG9nZ2VyLmluZm8oZidOZXcgbGF0ZXN0IEV2ZW50OiB7bGF0ZXN0RXZlbnR9JykKCQl3aXRoIG9wZW4obGF0ZXN0RXZ0RmlsZSwgJ3cnKSBhcyBmOgoJCQlmLndyaXRlKGYne2xhdGVzdEV2ZW50fScpCgllbHNlOgoJCWxvZ2dlci5pbmZvKCdObyBuZXcgZXZlbnRzLicpCgkJbG9nZ2VyLmluZm8oZidOZXcgbGF0ZXN0IEV2ZW50OiB7bGF0ZXN0RXZlbnR9IChObyBjaGFuZ2UpJykJCgojIGRlZiBnZXRTZXJ2ZXJDb2xsVmVyc2lvbihhcHBWZXJzaW9uKToKIyAJbG9nZ2VyLmluZm8oZidDaGVja2luZyBjb2xsZWN0b3IgdmVyc2lvbicpCiMgCWxvZ2dlci5pbmZvKGYnbG9jYWwgY29sbGVjdG9yVmVyc2lvbjoge2FwcFZlcnNpb259JykKIyAJciAJCT0gcmVxdWVzdHMuZ2V0KGYnaHR0cHM6Ly97aG9zdH0vZGlhZ3MvY29sbGVjdG9yVmVyc2lvbicpCiMgCWRhdGEgCT0gci5qc29uKCkKIyAJc2VydmVyQ29sbGVjdG9yVmVyc2lvbiA9IGRhdGFbJ3NlcnZlckNvbGxlY3RvclZlcnNpb24nXQojIAljb2xsSGFzaFB5IAk9IGRhdGFbJ3NlcnZlckhhc2hQeSddCiMgCWNvbGxIYXNoV2luCT0gZGF0YVsnc2VydmVySGFzaFdpbiddCiMgCWxvZ2dlci5pbmZvKGYnc2VydmVyIGNvbGxlY3RvclZlcnNpb246IHtzZXJ2ZXJDb2xsZWN0b3JWZXJzaW9ufScpCiMgCWlmIGludChhcHBWZXJzaW9uKSA8IGludChzZXJ2ZXJDb2xsZWN0b3JWZXJzaW9uKToKIyAJCWxvZ2dlci5pbmZvKCdMb2NhbCBjb2xsZWN0b3IgbmVlZHMgdXBkYXRpbmcuLi4nKQojIAkJY29sbGVjdG9yVXBkYXRlUmVxZCA9IFRydWUKIyAJZWxzZToKIyAJCWxvZ2dlci5pbmZvKCdMb2NhbCBjb2xsZWN0b3IgaXMgdXAgdG8gZGF0ZS4nKQojIAkJY29sbGVjdG9yVXBkYXRlUmVxZCA9IEZhbHNlCiMgCXJldHVybihjb2xsZWN0b3JVcGRhdGVSZXFkLCBjb2xsSGFzaFB5LCBjb2xsSGFzaFdpbikKCmRlZiBnZXRTaGEyNTZIYXNoKGZpbGVUb0hhc2gpOgoJc2hhMjU2SGFzaCA9IGhhc2hsaWIuc2hhMjU2KCkKCXdpdGggb3BlbihmaWxlVG9IYXNoLCAncmInKSBhcyBmOgoJCWZvciBieXRlQmxvY2sgaW4gaXRlcihsYW1iZGE6IGYucmVhZCg0MDk2KSwgYiIiKToKCQkJc2hhMjU2SGFzaC51cGRhdGUoYnl0ZUJsb2NrKQoJbG9nZ2VyLmluZm8oZidzaGEyNTYgb2Yge2ZpbGVUb0hhc2h9OiB7c2hhMjU2SGFzaC5oZXhkaWdlc3QoKX0nKQoJcmV0dXJuKHNoYTI1Nkhhc2guaGV4ZGlnZXN0KCkpCgojIGRlZiB1cGRhdGVDb2xsZWN0b3IoY29sbEhhc2hQeSwgY29sbEhhc2hXaW4pOgojIAlpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgojIAkJY29sbGVjdG9yVXJsID0gZidodHRwczovL3tob3N0fS9kb3dubG9hZC9jb2xsZWN0b3IucHknCiMgCQljaHVua1NpemUgPSA0MDk2CiMgCQlzYXZlVG9GaWxlID0gZid7c3lzLmFyZ3ZbMF19Lm5ldycKIyAJCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBkb3dubG9hZCB7Y29sbGVjdG9yVXJsfSB0byB7c2F2ZVRvRmlsZX0uLi4nKQojIAkJdHJ5OgojIAkJCXIgPSByZXF1ZXN0cy5nZXQoY29sbGVjdG9yVXJsLCBzdHJlYW09VHJ1ZSkKIyAJCQlpZiByLnN0YXR1c19jb2RlICE9IDIwMDoKIyAJCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGRvd25sb2FkIHtjb2xsZWN0b3JVcmx9LiBTdGF0dXMgQ29kZToge3Iuc3RhdHVzX2NvZGV9JykKIyAJCQkJcmV0dXJuKEZhbHNlKQojIAkJCXdpdGggb3BlbihzYXZlVG9GaWxlLCAnd2InKSBhcyBmOgojIAkJCQlmb3IgY2h1bmsgaW4gci5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT1jaHVua1NpemUpOgojIAkJCQkJaWYgY2h1bms6CiMgCQkJCQkJZi53cml0ZShjaHVuaykKIyAJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKIyAJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZG93bmxvYWQge2NvbGxlY3RvclVybH0gdG8ge3NhdmVUb0ZpbGV9LiBSZWFzb246IHtlfScpCiMgCQluZXdDb2xsSGFzaCA9IGdldFNoYTI1Nkhhc2goc2F2ZVRvRmlsZSkKIyAJCWxvZ2dlci5pbmZvKGYnRG93bmxvYWRlZCBIYXNoOiB7bmV3Q29sbEhhc2h9IHwgU2VydmVyIEhhc2g6IHtjb2xsSGFzaFB5fScpCiMgCQlpZiBuZXdDb2xsSGFzaCA9PSBjb2xsSGFzaFB5OgojIAkJCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byByZW5hbWUge3NhdmVUb0ZpbGV9IHRvIHtzeXMuYXJndlswXX0nKQojIAkJCXRyeToKIyAJCQkJb3MucmVuYW1lKHNhdmVUb0ZpbGUsIHN5cy5hcmd2WzBdKQojIAkJCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSB1cGdyYWRlZCB7Y29sbGVjdG9yVXJsfSB0byB7c2F2ZVRvRmlsZX0nKQojIAkJCQlsb2dnZXIuaW5mbygnTmV3IGNvbGxlY3RvciB3aWxsIHJ1biBvbiBuZXh0IGN5Y2xlJykKIyAJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiMgCQkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byByZW5hbWUge3NhdmVUb0ZpbGV9IHRvIHtzeXMuYXJndlswXX0uIFJlYXNvbjoge2V9JykKIyAJCWVsc2U6CiMgCQkJbG9nZ2VyLmVycm9yKCdIYXNoZXMgZG8gbm90IG1hdGNoLiBEZWxldGluZyBkb3dubG9hZC4nKQojIAkJCXRyeToKIyAJCQkJb3MucmVtb3ZlKHNhdmVUb0ZpbGUpCiMgCQkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgojIAkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZGVsZXRlIHtzYXZlVG9GaWxlfS4gUmVhc29uOiB7ZX0nKQoJCQojIAllbGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKIyAJCWNvbW1hbmQgPSBmJyhOZXctT2JqZWN0IFN5c3RlbS5OZXQuV2ViQ2xpZW50KS5Eb3dubG9hZEZpbGUoImh0dHBzOi8vYXBwLndlZ3dlaXNlci50ZWNoL2Rvd25sb2FkL3dlZ3dlaXNlci5leGUiLCIkZW52OlRFTVAvd2Vnd2Vpc2VyLmV4ZSIpOyBcCiMgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRlbnY6VEVNUC93ZWd3ZWlzZXIuZXhlIiAtQXJndW1lbnRMaXN0ICIvZ3JvdXB1dWlkPXtncm91cFV1aWR9IiwgIi9MT0c9JGVudjpURU1QL1dlZ3dlaXNlclNldHVwLmxvZyIsICIvU0lMRU5UIicKIyAJCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBydW46IHtjb21tYW5kfScpCiMgCQlyZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwgc3Rkb3V0ID0gc3VicHJvY2Vzcy5QSVBFLCB1bml2ZXJzYWxfbmV3bGluZXMgPSBUcnVlKQojIAkJbG9nZ2VyLmluZm8oZidyZXN1bHQ6IHtyZXN1bHQuc3Rkb3V0fScpCgpkZWYgcGFyc2VUaW1lKHRpbWVTdHIpOgogICAgcmV0dXJuIChkYXRldGltZS5kYXRldGltZS5zdHJwdGltZSh0aW1lU3RyLCAiJVktJW0tJWQtJUg6JU06JVMiKSkKCmRlZiBwYXJzZVRpbWUyKHRpbWVTdHIpOgogICAgcmV0dXJuIChkYXRldGltZS5kYXRldGltZS5zdHJwdGltZSh0aW1lU3RyLCAiJVktJW0tJWQgJUg6JU06JVMiKSkKCmRlZiByZWFkRXZlbnRKc29uKGpzb25GaWxlKToKICAgIHdpdGggb3Blbihqc29uRmlsZSwgJ3InKSBhcyBmOgogICAgICAgIGV2ZW50c0RpY3QgPSBqc29uLmxvYWQoZikKICAgIHJldHVybihldmVudHNEaWN0KQoKZGVmIGZpbHRlckV2ZW50TG9nKGxvZ05hbWUpOgoJZ3JvdXBlZERhdGEgPSB7fQoJanNvbkZpbGUgCT0gb3MucGF0aC5qb2luKGZpbGVzRGlyLCBmJ2V2ZW50cy17bG9nTmFtZX0uanNvbicpCglkYXRhIAkJPSByZWFkRXZlbnRKc29uKGpzb25GaWxlKQoKCWZvciByZWNvcmRfaWQsIHJlY29yZCBpbiBkYXRhLml0ZW1zKCk6CgkJZXZlbnRJZCAJCT0gcmVjb3JkWyJldmVudGlkIl0KCQl0aW1lR2VuZXJhdGVkIAk9IHBhcnNlVGltZShyZWNvcmRbInRpbWVnZW5lcmF0ZWQiXSkKCQltZXNzYWdlIAkJPSByZWNvcmRbIm1lc3NhZ2UiXQoJCWxldmVsIAkJCT0gcmVjb3JkWydldmVudHR5cGUnXQoJCWlmIChsZXZlbCA9PSAnV0FSTklORycpIG9yIChsZXZlbCA9PSAnRVJST1InKSBvciAobG9nTmFtZSA9PSAnU2VjdXJpdHknKToKCQkJaWYgZXZlbnRJZCBub3QgaW4gZ3JvdXBlZERhdGE6CgkJCQlncm91cGVkRGF0YVtldmVudElkXSA9IHsKCQkJCQkiY291bnQiOiAwLAoJCQkJCSJtZXNzYWdlIjogbWVzc2FnZSwKCQkJCQkibW9zdHJlY2VudHRpbWUiOiB0aW1lR2VuZXJhdGVkLAoJCQkJCSJsZXZlbCI6IGxldmVsCgkJCQl9CgkJCWdyb3VwZWREYXRhW2V2ZW50SWRdWyJjb3VudCJdICs9IDEKCQkJaWYgdGltZUdlbmVyYXRlZCA+IGdyb3VwZWREYXRhW2V2ZW50SWRdWyJtb3N0cmVjZW50dGltZSJdOgoJCQkJZ3JvdXBlZERhdGFbZXZlbnRJZF1bIm1vc3RyZWNlbnR0aW1lIl0gPSB0aW1lR2VuZXJhdGVkCgkJZWxzZToKCQkJcGFzcwojCWxvZ2dlci5kZWJ1ZyhmJ2dyb3VwZWREYXRhOiB7Z3JvdXBlZERhdGF9JykKCWZvciBldmVudElkLCBkZXRhaWxzIGluIGdyb3VwZWREYXRhLml0ZW1zKCk6CgkJZGV0YWlsc1sibW9zdHJlY2VudHRpbWUiXSA9IGRldGFpbHNbIm1vc3RyZWNlbnR0aW1lIl0uc3RyZnRpbWUoIiVZLSVtLSVkLSVIOiVNOiVTIikKCglzb3J0ZWRHcm91cGVkRGF0YSA9IHNvcnRlZChncm91cGVkRGF0YS5pdGVtcygpLCBrZXk9bGFtYmRhIHg6IHhbMV1bImNvdW50Il0sIHJldmVyc2U9VHJ1ZSlbOjEwXQoKCXRvcEV2ZW50cyA9IFtdCglmb3IgZXZlbnRJZCwgZGV0YWlscyBpbiBzb3J0ZWRHcm91cGVkRGF0YToKCQljdXJyZW50VG9wRXZlbnQgPSB7CgkJCSdNZXNzYWdlJzpkZXRhaWxzWydtZXNzYWdlJ10sIAoJCQknRXZlbnRJRCc6IGV2ZW50SWQsIAoJCQknTGV2ZWwnOiBkZXRhaWxzWydsZXZlbCddLCAKCQkJJ0NvdW50JzogZGV0YWlsc1snY291bnQnXSwgCgkJCSdMYXRlc3RPY2N1cnJlbmNlJzpkZXRhaWxzWydtb3N0cmVjZW50dGltZSddCgkJCX0KCQl0b3BFdmVudHMuYXBwZW5kKGN1cnJlbnRUb3BFdmVudCkKCglmaWx0ZXJlZEV2ZW50RGljdAkJCQkJCQk9IHt9CglmaWx0ZXJlZEV2ZW50RGljdFsnTG9nTmFtZSddIAkJCQk9IGxvZ05hbWUKCWZpbHRlcmVkRXZlbnREaWN0WydTb3VyY2VzJ10gCQkJCT0ge30KCWZpbHRlcmVkRXZlbnREaWN0WydTb3VyY2VzJ11bJ1RvcEV2ZW50cyddIAk9IHRvcEV2ZW50cwoJZmlsdGVyZWRFdmVudERpY3RbJ1NvdXJjZXMnXVsnVG90YWxFdmVudHMnXSA9IDEwCglyZXR1cm4oZmlsdGVyZWRFdmVudERpY3QpCgpkZWYgZmlsdGVyTGludXhMb2cobG9nVHlwZSk6Cglncm91cGVkRGF0YSA9IHt9Cglqc29uRmlsZSAJPSBvcy5wYXRoLmpvaW4oZmlsZXNEaXIsIGYne2xvZ1R5cGV9Lmpzb24nKQoJbG9nZ2VyLmluZm8oZidGaWx0ZXJpbmcge2pzb25GaWxlfScpCglkYXRhIAkJPSByZWFkRXZlbnRKc29uKGpzb25GaWxlKQoKCWZvciByZWNvcmRfaWQsIHJlY29yZCBpbiBkYXRhLml0ZW1zKCk6CgkJdGltZUdlbmVyYXRlZCAJPSBwYXJzZVRpbWUyKHJlY29yZFsidGltZWdlbmVyYXRlZCJdKQoJCW1lc3NhZ2UgCQk9IHJlY29yZFsibWVzc2FnZSJdCgkJc291cmNlTmFtZSAJCT0gcmVjb3JkWydzb3VyY2VuYW1lJ10KCgkJaWYgc291cmNlTmFtZSBub3QgaW4gZ3JvdXBlZERhdGE6CgkJCWdyb3VwZWREYXRhW3NvdXJjZU5hbWVdID0gewoJCQkJImNvdW50IjogMCwKCQkJCSJtZXNzYWdlIjogbWVzc2FnZSwKCQkJCSJtb3N0cmVjZW50dGltZSI6IHRpbWVHZW5lcmF0ZWQKCQkJfQoJCWdyb3VwZWREYXRhW3NvdXJjZU5hbWVdWyJjb3VudCJdICs9IDEKCQlpZiB0aW1lR2VuZXJhdGVkID4gZ3JvdXBlZERhdGFbc291cmNlTmFtZV1bIm1vc3RyZWNlbnR0aW1lIl06CgkJCWdyb3VwZWREYXRhW3NvdXJjZU5hbWVdWyJtb3N0cmVjZW50dGltZSJdID0gdGltZUdlbmVyYXRlZAoJZWxzZToKCQlwYXNzCiMJbG9nZ2VyLmRlYnVnKGYnZ3JvdXBlZERhdGE6IHtncm91cGVkRGF0YX0nKQoJZm9yIHNvdXJjZU5hbWUsIGRldGFpbHMgaW4gZ3JvdXBlZERhdGEuaXRlbXMoKToKCQlkZXRhaWxzWyJtb3N0cmVjZW50dGltZSJdID0gZGV0YWlsc1sibW9zdHJlY2VudHRpbWUiXS5zdHJmdGltZSgiJVktJW0tJWQtJUg6JU06JVMiKQoKCXNvcnRlZEdyb3VwZWREYXRhID0gc29ydGVkKGdyb3VwZWREYXRhLml0ZW1zKCksIGtleT1sYW1iZGEgeDogeFsxXVsiY291bnQiXSwgcmV2ZXJzZT1UcnVlKVs6MTBdCgoJdG9wRXZlbnRzID0gW10KCWZvciBzb3VyY2VOYW1lLCBkZXRhaWxzIGluIHNvcnRlZEdyb3VwZWREYXRhOgoJCWN1cnJlbnRUb3BFdmVudCA9IHsKCQkJJ01lc3NhZ2UnOiBkZXRhaWxzWydtZXNzYWdlJ10sIAoJCQknU291cmNlTmFtZSc6IHNvdXJjZU5hbWUsCgkJCSdDb3VudCc6IGRldGFpbHNbJ2NvdW50J10sIAoJCQknTGF0ZXN0T2NjdXJyZW5jZSc6ZGV0YWlsc1snbW9zdHJlY2VudHRpbWUnXQoJCQl9CgkJdG9wRXZlbnRzLmFwcGVuZChjdXJyZW50VG9wRXZlbnQpCgoJZmlsdGVyZWRTeXNsb2dEaWN0CQkJCQkJCT0ge30KCWZpbHRlcmVkU3lzbG9nRGljdFsnTG9nTmFtZSddIAkJCQk9IGxvZ1R5cGUKCWZpbHRlcmVkU3lzbG9nRGljdFsnU291cmNlcyddIAkJCQk9IHt9CglmaWx0ZXJlZFN5c2xvZ0RpY3RbJ1NvdXJjZXMnXVsnVG9wRXZlbnRzJ10gCT0gdG9wRXZlbnRzCglmaWx0ZXJlZFN5c2xvZ0RpY3RbJ1NvdXJjZXMnXVsnVG90YWxFdmVudHMnXSA9IDEwCglyZXR1cm4oZmlsdGVyZWRTeXNsb2dEaWN0KQoKZGVmIHNlbmRFdmVudE1ldGFkYXRhKGRldmljZVV1aWQpOgoJdXJsID0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCglsb2dOYW1lcyA9IFsnQXBwbGljYXRpb24nLCAnU3lzdGVtJywgJ1NlY3VyaXR5J10KCWZvciBsb2dOYW1lIGluIGxvZ05hbWVzOgoJCXdpdGggb3Blbihvcy5wYXRoLmpvaW4oZmlsZXNEaXIsICdldmVudHNGaWx0ZXJlZC0nICsgbG9nTmFtZSArJy5qc29uJyksICdyJykgYXMgZjoKCQkJZGF0YSA9IGpzb24ubG9hZChmKQoJCWJvZHkgPSB7CgkJCSdkZXZpY2V1dWlkJzpkZXZpY2VVdWlkLAoJCQknbWV0YWxvZ29zX3R5cGUnOmYnZXZlbnRzRmlsdGVyZWQte2xvZ05hbWV9JywKCQkJJ21ldGFsb2dvcyc6ZGF0YQoJCQl9CgkJCgkJaGVhZGVycyAJPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30KCQlsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gUE9TVCB0bzoge3VybH0nKQoJCXJlc3BvbnNlIAk9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhib2R5KSkKCQlsb2dnZXIuaW5mbyhmJ3Jlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9JykKCQlpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDE6CgkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBQT1NUIGRhdGEuIFJlYXNvbjoge3Jlc3BvbnNlLnRleHR9JykKCmRlZiBzZW5kTGludXhMb2dNZXRhZGF0YShkZXZpY2VVdWlkLCBsb2dUb1NlbmQpOgoJdXJsID0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCgl3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpbGVzRGlyLCBmJ3tsb2dUb1NlbmR9RmlsdGVyZWQuanNvbicpLCAncicpIGFzIGY6CgkJZGF0YSA9IGpzb24ubG9hZChmKQoJYm9keSA9IHsKCQknZGV2aWNldXVpZCc6ZGV2aWNlVXVpZCwKCQknbWV0YWxvZ29zX3R5cGUnOmYne2xvZ1RvU2VuZH1GaWx0ZXJlZCcsCgkJJ21ldGFsb2dvcyc6ZGF0YQoJCX0KCWhlYWRlcnMgCT0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9Cglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gUE9TVCB0bzoge3VybH0gZm9yIHtsb2dUb1NlbmR9JykKCXJlc3BvbnNlIAk9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhib2R5KSkKCWxvZ2dlci5pbmZvKGYncmVzcG9uc2U6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0nKQoJaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAxOgoJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBQT1NUIGRhdGEuIFJlYXNvbjoge3Jlc3BvbnNlLnRleHR9JykKCmRlZiBnZXREYXRlRm9ybWF0KGRhdGVTdHJpbmcpOgoJaWYgKCctJyBpbiBkYXRlU3RyaW5nKSBhbmQgKCcrJyBpbiBkYXRlU3RyaW5nKToKCQlldmVudFRpbWUgPSBkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KGRhdGVTdHJpbmcpCgllbHNlOgoJCWV2ZW50VGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLnN0cnB0aW1lKGRhdGVTdHJpbmcsICIlYiAlZCAlSDolTTolUyIpCgkJZXZlbnRUaW1lID0gZXZlbnRUaW1lLnJlcGxhY2UoeWVhcj1kYXRldGltZS5kYXRldGltZS5ub3coKS55ZWFyKQoJcmV0dXJuKGV2ZW50VGltZSkJCQoJCiMgZGVmIGNoZWNrQXJncyhhcmdzKToKIyAJaWYgYXJncy52ZXJzaW9uOgojIAkJcHJpbnQoZid7YXBwTmFtZX0gVmVyc2lvbjoge2FwcFZlcnNpb259JykKIyAJCXN5cy5leGl0KCkKIyAJaWYgYXJncy5ncm91cFV1aWQ6CiMgCQlncm91cFV1aWQgCQk9IGFyZ3MuZ3JvdXBVdWlkCiMgCWVsc2U6CiMgCQlncm91cFV1aWQJCT0gTm9uZQojIAlpZiBhcmdzLm1vZGU6CiMgCQltb2RlID0gYXJncy5tb2RlCiMgCWVsc2U6CiMgCQltb2RlID0gJ0FVRElUJwojIAlyZXR1cm4oZ3JvdXBVdWlkLCBtb2RlKQoKZGVmIHByb2Nlc3NMaW51eExvZ3MoKToKCWxpbnV4TG9nc0xpc3QgPSBbJ2F1dGgnLCAna2VybicsICdzeXNsb2cnXQoJZm9yIGxpbnV4TG9nIGluIGxpbnV4TG9nc0xpc3Q6CgkJaWYgbGludXhMb2cgPT0gJ3N5c2xvZyc6CgkJCWxpbnV4TG9nRmlsZSAJPSBmJy92YXIvbG9nL3tsaW51eExvZ30nCgkJZWxzZToKCQkJbGludXhMb2dGaWxlIAkJPSBmJy92YXIvbG9nL3tsaW51eExvZ30ubG9nJwoJCWxvZ2dlci5pbmZvKGYnUHJvY2Vzc2luZzoge2xpbnV4TG9nRmlsZX0nKQoJCW5vdyAJCQkJPSBkYXRldGltZS5kYXRldGltZS5ub3coKQoJCXRoaXJ0eURheXNBZ28JCT0gbm93IC0gZGF0ZXRpbWUudGltZWRlbHRhKGRheXM9MzApCgkJbGludXhsb2dEaWN0IAkJPSB7fQoJCXdpdGggb3BlbihsaW51eExvZ0ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgoJCQlpID0gMAoJCQlmb3IgbGluZSBpbiBmLnJlYWRsaW5lcygpOgoJCQkJbGludXhsb2dEaWN0W2ldID0ge30KCQkJCXBhcnRzID0gbGluZS5yZXBsYWNlKCcgICcsICcgJykuc3BsaXQoJyAnKQoJCQkJaWYgbGVuKHBhcnRzWzBdKSA+IDM6CgkJCQkJZXZlbnRUaW1lIAk9IGdldERhdGVGb3JtYXQocGFydHNbMF0pCgkJCQkJaWYgZXZlbnRUaW1lIDwgdGhpcnR5RGF5c0FnbzoKCQkJCQkJcGFzcwoJCQkJCWVsc2U6CgkJCQkJCWRldmljZU5hbWUgCT0gcGFydHNbMV0KCQkJCQkJcHJvY2VzcyAJPSBwYXJ0c1syXS5zcGxpdCgnWycpWzBdCgkJCQkJCW1lc3NhZ2UgCT0gJyAnLmpvaW4ocGFydHNbMzpdKS5zdHJpcCgpCgkJCQllbHNlOgoJCQkJCWV2ZW50VGltZSAJPSBnZXREYXRlRm9ybWF0KGYne3BhcnRzWzBdfSB7cGFydHNbMV19IHtwYXJ0c1syXX0nKQoJCQkJCWlmIGV2ZW50VGltZSA8IHRoaXJ0eURheXNBZ286CgkJCQkJCXByaW50KGYndG9vIG9sZDoge2V2ZW50VGltZX0nKQoJCQkJCWVsc2U6CQkJCgkJCQkJCWRldmljZU5hbWUgCT0gcGFydHNbM10KCQkJCQkJcHJvY2VzcyAJPSBwYXJ0c1s0XS5zcGxpdCgnWycpWzBdCgkJCQkJCW1lc3NhZ2UgCT0gJyAnLmpvaW4ocGFydHNbNTpdKS5zdHJpcCgpCgkJCQkJCWxpbnV4bG9nRGljdFtpXVsndGltZWdlbmVyYXRlZCddIAk9IGV2ZW50VGltZQoJCQkJCQlsaW51eGxvZ0RpY3RbaV1bJ3NvdXJjZW5hbWUnXSAJCT0gcHJvY2VzcwoJCQkJCQlsaW51eGxvZ0RpY3RbaV1bJ21lc3NhZ2UnXSAJCQk9IG1lc3NhZ2UKCQkJCQkJaSArPSAxCgkJbGludXhMb2dKc29uRmlsZQk9IG9zLnBhdGguam9pbihmaWxlc0RpciwgZid7bGludXhMb2d9Lmpzb24nKQoJCXdpdGggb3BlbihsaW51eExvZ0pzb25GaWxlLCAndycpIGFzIGY6CgkJCWYud3JpdGUoanNvbi5kdW1wcyhsaW51eGxvZ0RpY3QsIGluZGVudD00LCBkZWZhdWx0PXN0cikpCgkJb3V0WmlwRmlsZSAJCQk9IHppcEZpbGUoZid7bGludXhMb2d9Lmpzb24nKQoJCXVwbG9hZFN1Y2Nlc3MgCQk9IHNlbmRQYXlsb2FkRmxhc2socm91dGUsIG91dFppcEZpbGUsIGRldmljZVV1aWQpCgkJaWYgdXBsb2FkU3VjY2VzcyA9PSBUcnVlOgoJCQlkZWxGaWxlKG91dFppcEZpbGUpCgkJZWxzZToKCQkJbG9nZ2VyLmVycm9yKGYnVXBsb2FkIGZhaWxlZC4nKQoJCWZpbHRlcmVkbGludXhsb2dEaWN0IAk9IGZpbHRlckxpbnV4TG9nKGxpbnV4TG9nKQoJCWV2ZW50cyAJCQkJPSBmaWx0ZXJlZGxpbnV4bG9nRGljdFsiU291cmNlcyJdWyJUb3BFdmVudHMiXQoJCXRvdGFsQ291bnQgCQkJPSBzdW0oZXZlbnRbIkNvdW50Il0gZm9yIGV2ZW50IGluIGV2ZW50cykKCQlmaWx0ZXJlZGxpbnV4bG9nRGljdFsnU291cmNlcyddWydUb3RhbEV2ZW50cyddID0gdG90YWxDb3VudAoJCWxvZ2dlci5kZWJ1Zyhqc29uLmR1bXBzKGZpbHRlcmVkbGludXhsb2dEaWN0LCBpbmRlbnQ9NCkpCgkJd2l0aCBvcGVuKG9zLnBhdGguam9pbihmaWxlc0RpciwgZid7bGludXhMb2d9RmlsdGVyZWQuanNvbicpLCAndycpIGFzIGY6CgkJCWYud3JpdGUoanNvbi5kdW1wcyhmaWx0ZXJlZGxpbnV4bG9nRGljdCwgaW5kZW50PTQpKQoJCXNlbmRMaW51eExvZ01ldGFkYXRhKGRldmljZVV1aWQsIGxpbnV4TG9nKQoKZGVmIGdldE9zTGFuZyhkZXZpY2VEYXRhRGljdCk6CglzeXN0ZW1Mb2NhbGUgPSAnTm90IGRldGVjdGVkJwoJaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgoJCWlmIG5vdCBvcy5wYXRoLmlzZmlsZShtc2luZm9PdXRwdXQpOgoJCQlsb2dnZXIud2FybmluZyhmJ3ttc2luZm9PdXRwdXR9IG5vdCBmb3VuZC5OZWVkIHRvIHJ1biBGVUxMQVVESVQnKQoJCWVsc2U6CgkJCXdpdGggb3BlbiAobXNpbmZvT3V0cHV0LCAncicsIGVuY29kaW5nPSd1dGYtMTYnKSBhcyBmOgoJCQkJbXNpbmZvTGluZXMgPSBmLnJlYWRsaW5lcygpCgkJCQlmb3IgbGluZSBpbiBtc2luZm9MaW5lczoKIwkJCQkJbG9nZ2VyLmRlYnVnKGYnbXNpbmZvbGluZToge2xpbmV9JykKCQkJCQlpZiBsaW5lLnN0YXJ0c3dpdGgoJ0xvY2FsZScpOgoJCQkJCQlzeXN0ZW1Mb2NhbGUgPSBsaW5lLnNwbGl0KCdcdCcpWzFdLnN0cmlwKCkKCWVsc2U6CgkJc3lzdGVtTG9jYWxlCT0gb3MuZ2V0ZW52KCdMQU5HVUFHRScpCgkJbG9nZ2VyLmRlYnVnKGYnc3lzdGVtTG9jYWxlOiB7c3lzdGVtTG9jYWxlfScpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ3N5c3RlbWxvY2FsZSddID0gc3lzdGVtTG9jYWxlCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0TWFudWZhY3R1cmVyKGRldmljZURhdGFEaWN0KToKCXN5c3RlbU1hbnVmYWN0dXJlciA9ICdOb3QgZGV0ZWN0ZWQnCglpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CgkJaWYgbm90IG9zLnBhdGguaXNmaWxlKG1zaW5mb091dHB1dCk6CgkJCWxvZ2dlci53YXJuaW5nKGYne21zaW5mb091dHB1dH0gbm90IGZvdW5kLk5lZWQgdG8gcnVuIEZVTExBVURJVCcpCgkJZWxzZToKCQkJd2l0aCBvcGVuIChtc2luZm9PdXRwdXQsICdyJywgZW5jb2Rpbmc9J3V0Zi0xNicpIGFzIGY6CgkJCQltc2luZm9MaW5lcyA9IGYucmVhZGxpbmVzKCkKCQkJCWZvciBsaW5lIGluIG1zaW5mb0xpbmVzOgojCQkJCQlsb2dnZXIuZGVidWcoZidtc2luZm9saW5lOiB7bGluZX0nKQoJCQkJCWlmIGxpbmUuc3RhcnRzd2l0aCgnU3lzdGVtIE1hbnVmYWN0dXJlcicpOgoJCQkJCQlzeXN0ZW1NYW51ZmFjdHVyZXIgPSBsaW5lLnNwbGl0KCdcdCcpWzFdLnN0cmlwKCkKCWVsc2U6CgkJIyBDaGVjayBpZiBkbWlkZWNvZGUgY29tbWFuZCBleGlzdHMKCQlpZiBzaHV0aWwud2hpY2goJ2RtaWRlY29kZScpIGlzIE5vbmU6CgkJCWxvZ2dlci53YXJuaW5nKCdkbWlkZWNvZGUgY29tbWFuZCBub3QgZm91bmQuIFNraXBwaW5nIG1hbnVmYWN0dXJlciBkZXRlY3Rpb24uIEluc3RhbGwgZG1pZGVjb2RlIHBhY2thZ2UgaWYgbmVlZGVkLicpCgkJZWxzZToKCQkJdHJ5OgoJCQkJY29tbWFuZCAJCQk9IFsnZG1pZGVjb2RlJ10KCQkJCWdyZXBDb21tYW5kIAkJPSBbJ2dyZXAnLCAnLUEzJywgJ15TeXN0ZW0gSW5mb3JtYXRpb24nXQoJCQkJZG1pZGVjb2RlX3Byb2Nlc3MgCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFKQoJCQkJZ3JlcF9wcm9jZXNzIAkJPSBzdWJwcm9jZXNzLlBvcGVuKGdyZXBDb21tYW5kLCBzdGRpbj1kbWlkZWNvZGVfcHJvY2Vzcy5zdGRvdXQsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCgkJCQkJCQkJCQkJCQlzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLCB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSkKCgkJCQlkbWlkZWNvZGVfcHJvY2Vzcy5zdGRvdXQuY2xvc2UoKQoJCQkJb3V0cHV0LCBlcnJvciAJCT0gZ3JlcF9wcm9jZXNzLmNvbW11bmljYXRlKCkKCQkJCW91dHB1dCAJCQkJPSBvdXRwdXQgICAjLmRlY29kZSgndXRmLTgnKQoJCQkJbG9nZ2VyLmRlYnVnKGYnb3V0cHV0OiB7b3V0cHV0fScpCgkJCQlmb3IgbGluZSBpbiBvdXRwdXQuc3BsaXRsaW5lcygpOgoJCQkJCWlmIGxpbmUuc3RyaXAoKS5zdGFydHN3aXRoKCdNYW51ZmFjdHVyZXI6Jyk6CgkJCQkJCXN5c3RlbU1hbnVmYWN0dXJlciA9IGxpbmUuc3BsaXQoJ01hbnVmYWN0dXJlcjonKVsxXS5zdHJpcCgpCgkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgbWFudWZhY3R1cmVyIGluZm86IHtlfScpCglsb2dnZXIuZGVidWcoZidzeXN0ZW1NYW51ZmFjdHVyZXI6IHtzeXN0ZW1NYW51ZmFjdHVyZXJ9JykKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnc3lzdGVtbWFudWZhY3R1cmVyJ10gPSBzeXN0ZW1NYW51ZmFjdHVyZXIKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiByZW1vdmVFdmVudHMoKToKCWxvZ2dlci5pbmZvKCdSZXNldHRpbmcgZXZlbnQgbG9ncy4uLicpCglmaWxlc1RvRGVsID0gW2Yne2NvbmZpZ0Rpcn1sYXRlc3RFdnQtQXBwbGljYXRpb24udHh0JywKCQkJCWYne2NvbmZpZ0Rpcn1sYXRlc3RFdnQtU2VjdXJpdHkudHh0JywKCQkJCWYne2NvbmZpZ0Rpcn1sYXRlc3RFdnQtU3lzdGVtLnR4dCcsCgkJCQlmJ3tmaWxlc0Rpcn1ldmVudHMtQXBwbGljYXRpb24uanNvbicsCgkJCQlmJ3tmaWxlc0Rpcn1ldmVudHMtU2VjdXJpdHkuanNvbicsCgkJCQlmJ3tmaWxlc0Rpcn1ldmVudHMtU3lzdGVtLmpzb24nLAoJCQkJZid7ZmlsZXNEaXJ9ZXZlbnRzRmlsdGVyZWQtQXBwbGljYXRpb24uanNvbicsCgkJCQlmJ3tmaWxlc0Rpcn1ldmVudHNGaWx0ZXJlZC1TZWN1cml0eS5qc29uJywKCQkJCWYne2ZpbGVzRGlyfWV2ZW50c0ZpbHRlcmVkLVN5c3RlbS5qc29uJwoJCQkJXQoJZm9yIGZpbGVUb0RlbCBpbiBmaWxlc1RvRGVsOgoJCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBkZWxldGUge2ZpbGVzVG9EZWx9Li4uJykKCQl0cnk6CgkJCW9zLnJlbW92ZShmaWxlVG9EZWwpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZGVsZXRlIHtmaWxlVG9EZWx9JykKCmRlZiBnZXRNc0luZm8obXNpbmZvT3V0cHV0KToKCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKCQlyb3V0ZSAJCQkJPSAnL3BheWxvYWQvc2VuZGZpbGUnCgkJbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIE1TSU5GTyBDb2xsZWN0aW9uJykKCQltc2luZm9PdXRwdXQgCQk9IHJ1bk1zaW5mbyhtc2luZm9PdXRwdXQpCgkJb3V0WmlwRmlsZSAJCQk9IHppcEZpbGUoJ21zaW5mby50eHQnKQoJCXVwbG9hZFN1Y2Nlc3MgCQk9IHNlbmRQYXlsb2FkRmxhc2socm91dGUsIG91dFppcEZpbGUsIGRldmljZVV1aWQpCgkJaWYgdXBsb2FkU3VjY2VzcyA9PSBUcnVlOgoJCQlkZWxGaWxlKG91dFppcEZpbGUpCgkJZWxzZToKCQkJbG9nZ2VyLmVycm9yKGYnVXBsb2FkIGZhaWxlZC4nKQoJCXJlc3VsdCA9IHJ1bkFuZHJlaU1zSW5mbygpCgllbHNlOgoJCWxvZ2dlci5pbmZvKCdTa2lwcGluZyBNU0luZm8gYXMgdGhpcyBpcyBub3QgYSBXaW5kb3dzIERldmljZS4nKQoKZGVmIGdldEZpbGVWZXJzaW9uKHBhdGgsIEdldEZpbGVWZXJzaW9uSW5mbywgTE9XT1JELCBISVdPUkQpOgoJdHJ5OgoJCWluZm8gPSBHZXRGaWxlVmVyc2lvbkluZm8gKHBhdGgsICJcXCIpCgkJbXMgPSBpbmZvWydGaWxlVmVyc2lvbk1TJ10KCQlscyA9IGluZm9bJ0ZpbGVWZXJzaW9uTFMnXQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ1ZlcnNpb24gRGF0YSBub3QgZm91bmQuIFJlYXNvbjoge2V9JykKCXRyeToKCQlpbnN0YWxsZWRWZXJzaW9uID0gc3RyKEhJV09SRCAobXMpKSArICcuJyArIFwKCQkJCQkJc3RyKExPV09SRCAobXMpKSArICcuJyArIFwKCQkJCQkJc3RyKEhJV09SRCAobHMpKSArICcuJyArIFwKCQkJCQkJc3RyKExPV09SRCAobHMpKQoJCXJldHVybihpbnN0YWxsZWRWZXJzaW9uKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ2Vycm9yOiB7ZX0nKQoJCXJldHVybignMC4wLjAuMCcpCgpkZWYgZ2V0RmlsZU1vZGlmaWVkRGF0ZShwYXRoKToKCW1vZERhdGUgPSBpbnQob3MucGF0aC5nZXRtdGltZShwYXRoKSkKCXJldHVybihtb2REYXRlKQoKZGVmIGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpOgoJZHJpdmVyRGljdCA9IHt9CglpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CgkJZnJvbSB3aW4zMmFwaSBpbXBvcnQgR2V0RmlsZVZlcnNpb25JbmZvLCBMT1dPUkQsIEhJV09SRAoJCWdvb2RTZWN0aW9uID0gRmFsc2UKCQl3aXRoIG9wZW4obXNpbmZvT3V0cHV0LCAncicsIGVuY29kaW5nPSd1dGYtMTYnKSBhcyBmOgoJCQlsaW5lcyA9IGYucmVhZGxpbmVzKCkKCQkJZm9yIGxpbmUgaW4gbGluZXM6CiMJCQkJcHJpbnQoZidsaW5lOiB7bGluZS5zdHJpcCgpfSB8IHtsZW4obGluZSl9JykKCQkJCWlmICdbU3lzdGVtIERyaXZlcnNdJyBpbiBsaW5lOgoJCQkJCWdvb2RTZWN0aW9uID0gVHJ1ZQoJCQkJaWYgJ1tFbnZpcm9ubWVudCBWYXJpYWJsZXNdJyBpbiBsaW5lOgoJCQkJCWdvb2RTZWN0aW9uID0gRmFsc2UKCQkJCWlmIGdvb2RTZWN0aW9uOgoJCQkJCWlmIGxpbmUuc3RhcnRzd2l0aCgnWycpOiAKCQkJCQkJcGFzcwoJCQkJCWVsaWYgbGVuKGxpbmUpIDwgNToKCQkJCQkJcGFzcwoJCQkJCWVsaWYgbGluZS5zdGFydHN3aXRoKCdOYW1lXHREZXNjcmlwdGlvbicpOgoJCQkJCQlwYXNzCgkJCQkJZWxzZToKCQkJCQkJbGluZVBhcnRzIAk9IGxpbmUuc3BsaXQoJ1x0JykKCQkJCQkJZHJpdmVyTmFtZSAJPSBsaW5lUGFydHNbMF0KCQkJCQkJZHJpdmVyRGVzYyAJPSBsaW5lUGFydHNbMV0KCQkJCQkJZHJpdmVyUGF0aAk9IGxpbmVQYXJ0c1syXQoJCQkJCQlkcml2ZXJUeXBlIAk9IGxpbmVQYXJ0c1szXQoJCQkJCQlkcml2ZXJEaWN0W2RyaXZlck5hbWVdID0ge30KCQkJCQkJZHJpdmVyRGljdFtkcml2ZXJOYW1lXVsnZGVzY3JpcHRpb24nXSA9IGRyaXZlckRlc2MKCQkJCQkJZHJpdmVyRGljdFtkcml2ZXJOYW1lXVsnZHJpdmVycGF0aCddID0gZHJpdmVyUGF0aAoJCQkJCQlkcml2ZXJEaWN0W2RyaXZlck5hbWVdWydkcml2ZXJ0eXBlJ10gPSBkcml2ZXJUeXBlCgkJZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXSA9IGRyaXZlckRpY3QKCgkJZm9yIGRyaXZlck5hbWUsIGRyaXZlckRhdGEgaW4gZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXS5pdGVtcygpOgoJCQlpbnN0YWxsZWRWZXJzaW9uID0gZ2V0RmlsZVZlcnNpb24oZHJpdmVyRGF0YVsnZHJpdmVycGF0aCddLCBHZXRGaWxlVmVyc2lvbkluZm8sIExPV09SRCwgSElXT1JEKQoJCQlkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddW2RyaXZlck5hbWVdWyd2ZXJzaW9uJ10gPSBpbnN0YWxsZWRWZXJzaW9uCgkJCW1vZERhdGUgPSBnZXRGaWxlTW9kaWZpZWREYXRlKGRyaXZlckRhdGFbJ2RyaXZlcnBhdGgnXSkKCQkJZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXVtkcml2ZXJOYW1lXVsnZHJpdmVyZGF0ZSddID0gbW9kRGF0ZQoJZWxzZToKCQlkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddID0ge30KIwlzZW5kTWV0YU1ldGFkYXRhKGRldmljZVV1aWQsIGRldmljZURhdGFEaWN0Wydkcml2ZXJzJ10sICd3aW5kcml2ZXJzJykKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBzZW5kTWV0YU1ldGFkYXRhKGRldmljZVV1aWQsIGRhdGEsIG1ldGFOYW1lKToKCXVybCA9IGYnaHR0cHM6Ly97aG9zdH0vbWV0YWRhdGEnCglib2R5ID0gewoJCSdkZXZpY2V1dWlkJzpkZXZpY2VVdWlkLAoJCSdtZXRhbG9nb3NfdHlwZSc6IG1ldGFOYW1lLAoJCSdtZXRhbG9nb3MnOmRhdGEKCQl9CgkKCWhlYWRlcnMgCT0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9Cglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gUE9TVCB0bzoge3VybH0nKQoJcmVzcG9uc2UgCT0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKGJvZHkpKQoJbG9nZ2VyLmluZm8oZidyZXNwb25zZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfScpCglpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDE6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIFBPU1QgZGF0YS4gUmVhc29uOiB7cmVzcG9uc2UudGV4dH0nKQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBNQUlOICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlYnVnTW9kZSAJCQk9IFRydWUKaG9zdCAJCQkJPSAnYXBwLndlZ3dlaXNlci50ZWNoJwpwb3J0IAkJCQk9IDQ0MwojYXJncwkJCQk9IHBhcnNlQXJncygpCgppZiBkZWJ1Z01vZGUgPT0gVHJ1ZToKCWxvZ2dlci5pbmZvKCdmdWxsQXVkaXQgU3RhcnRpbmcuLi4nKQoKYXBwRGlyLCBcCglsb2dEaXIsIFwKCWNvbmZpZ0RpciwgXAoJdGVtcERpciwgXAoJZmlsZXNEaXIJCT0gZ2V0QXBwRGlycygpCiNsb2dGaWxlIAkJCT0gZid7bG9nRGlyfS5sb2cnCiNsb2dmaWxlKGxvZ0ZpbGUpCiNsb2dnZXIuZGVidWcoZidsb2dGaWxlOiB7bG9nRmlsZX0nKQphZ2VudENvbmZpZ0ZpbGUgCT0gZid7Y29uZmlnRGlyfWFnZW50LmNvbmZpZycKZGV2aWNlVXVpZCwgXAoJaG9zdAkJPSBnZXREZXZpY2VVdWlkKGFnZW50Q29uZmlnRmlsZSkKbXNpbmZvT3V0cHV0IAkJPSBmJ3tmaWxlc0Rpcn1tc2luZm8udHh0JwoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgTVNJTkZPICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmdldE1zSW5mbyhtc2luZm9PdXRwdXQpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIEFVRElUICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRldmljZURhdGFEaWN0CT0ge30KZGV2aWNlRGF0YURpY3QgCT0gZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QJPSBnZXRTeXN0ZW1EYXRhKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdAk9IGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgCT0gZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0IAk9IGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0QmF0dGVyeURhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0bWVtb3J5RGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgID0gZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgCT0gZ2V0TWFudWZhY3R1cmVyKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCAJPSBnZXRPc0xhbmcoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QJPSBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdAk9IGdldFNtQmlvc0luZm8oZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0CT0gZ2V0UGNpRGV2aWNlcyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QJPSBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCAJPSBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdAk9IGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpCnNlcnZpY2VzRGljdAk9IGdldFNlcnZpY2VzKCkKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgU0VORCBSRVNVTFRTICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCnJvdXRlID0gJy9wYXlsb2FkL3NlbmRhdWRpdCcKcGF5bG9hZCA9IHsKCSJkYXRhIjogZGV2aWNlRGF0YURpY3QKfQoKaWYgZGVidWdNb2RlID09IFRydWU6CglwcmludChmJ3BheWxvYWQgZHVtcHM6IHtqc29uLmR1bXBzKHBheWxvYWQsIGluZGVudD00KX0nKQoJd2l0aCBvcGVuKGYne2xvZ0Rpcn1mdWxsQXVkaXQubG9nJywgJ2EnKSBhcyBmOgoJCWYud3JpdGUoanNvbi5kdW1wcyhkZXZpY2VEYXRhRGljdCwgaW5kZW50PTQpKQpyZXNwb25zZSAJPSBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCByb3V0ZSkKbG9nZ2VyLmluZm8oZidTZXJ2ZXIgcmVzcG9uc2U6IHtyZXNwb25zZX0gfCB7cmVzcG9uc2UudGV4dH0nKQoKCgoKCgoKCgoKCg=="}}