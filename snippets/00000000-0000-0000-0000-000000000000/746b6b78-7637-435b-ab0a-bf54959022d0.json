{"settings": {"snippetUuid": "746b6b78-7637-435b-ab0a-bf54959022d0", "snippetname": "WindowsAudit", "snippettype": ".py", "created_at": 1763137543}, "payload": {"payloadsig": "bBmm46V4Y8ejRElHr2kMgUTlbk1c2BES7SXM8/lIGcC18+99D6TbMC8/GAesmCSBUelSNGwEzl95z/wLXFKNVyx9DTxFZ/nLoyBELgEoKkQysTRTsV7aKE2rXEjqZl7EVrtnxpax+qYfmPggP/TG0WieTlqp18YYBv+F8k0Ajvmth6mkCYuktco0DkQardIc+n1mZWTx2KbJutHj3sdwYI2vOEA9U81OSVLjk0OP2K/dHqJeC2kAQpDGA3wc0TMetEdXTfBLQCB315hRQrS0bywSFOsUJi+W4CAW6PfTjW+lUTfnH0+gg/oFPy4AqRwGN8jxXfBUpbeQ4kfS8JIyZ3+o/6a9/JzuHDST91ecKM4BeZvkYZGm2nbj6pYsL7JSpqgPaDC3bDiiKxeC9exox6sdOhUxRr1igkP5gHU5BaqG8gZCrMoN7oeS/7Nunl0DaE9HXaj5xVGKaD8KFYu9ivCsj84b7zXJWuWVuAx8HttMWiwMULI1Em+Ch9T14WOkc7Skzgj8F4WyWcsTE2b9TZ9hIEvHLRybPAGn57veHUO8JuU1JZhC+MJNDaUCWuUdEYoto/ZwUQoy+qfrxJrQ0st3l9pHthX7Hf1mSO6/3ysLTxPXGC3V6lyHTyqeHQ0OFtQ9XsHoeaG0O+qU/uMl+tuHhVlbXkFmd3WPfC61LXo=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvV2luZG93c0F1ZGl0LnB5CiIiIgpXaW5kb3dzLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyCkNvbGxlY3RzIGNvbXByZWhlbnNpdmUgc3lzdGVtIGluZm9ybWF0aW9uIHVzaW5nIHBzdXRpbCBhbmQgV2luZG93cy1zcGVjaWZpYyB0b29scwpTZWxmLWNvbnRhaW5lZCBzbmlwcGV0IHdpdGggYWxsIHV0aWxpdGllcyBpbmxpbmVkLgoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IHV1aWQKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBtYXRoCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgp0cnk6CiAgICBpbXBvcnQgd2luMzJhcGkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLmluZm8oJ0luc3RhbGxpbmcgcHlwaXdpbjMyLi4uJykKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKICAgIGltcG9ydCB3aW4zMmFwaQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBJTkxJTkVEIFVUSUxJVElFUyAoZnJvbSBBdWRpdENvbW1vbikgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGNvbnZlcnRTaXplKHNpemVCeXRlcyk6CiAgICAiIiJDb252ZXJ0IGJ5dGVzIHRvIGh1bWFuLXJlYWRhYmxlIGZvcm1hdCIiIgogICAgaWYgc2l6ZUJ5dGVzID09IDA6CiAgICAgICAgcmV0dXJuICIwIEIiCiAgICBzaXplTmFtZSA9ICgiQiIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIsICJaQiIsICJZQiIpCiAgICBpID0gaW50KG1hdGguZmxvb3IobWF0aC5sb2coc2l6ZUJ5dGVzLCAxMDI0KSkpCiAgICBwID0gbWF0aC5wb3coMTAyNCwgaSkKICAgIHMgPSByb3VuZChzaXplQnl0ZXMgLyBwLCAyKQogICAgcmV0dXJuIGYne3N9IHtzaXplTmFtZVtpXX0nCgpkZWYgc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgZW5kcG9pbnQsIGhvc3QsIGRlYnVnTW9kZT1GYWxzZSk6CiAgICAiIiJTZW5kIEpTT04gcGF5bG9hZCB0byBGbGFzayBlbmRwb2ludCIiIgogICAgdXJsID0gZidodHRwczovL3tob3N0fXtlbmRwb2ludH0nCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmRlYnVnKGYncGF5bG9hZCB0byBzZW5kOiB7cGF5bG9hZH0nKQogICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCiAgICBoZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhwYXlsb2FkKSkKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGdldFB1YmxpY0lwQWRkcigpOgogICAgIiIiR2V0IHB1YmxpYyBJUCBhZGRyZXNzIiIiCiAgICBvZERuc1NlcnZlciA9ICcyMDguNjcuMjIyLjIyMicKICAgIGh0dHBEbnNTZXJ2ZXIgPSAnaHR0cHM6Ly9pY2FuaGF6aXAuY29tJwogICAgZG5zUmVzb2x2ZXIgPSBkbnMucmVzb2x2ZXIuUmVzb2x2ZXIoKQogICAgZG5zUmVzb2x2ZXIubmFtZXNlcnZlcnMgPSBbb2REbnNTZXJ2ZXJdCiAgICBwdWJsaWNJcCA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgYW5zd2VycyA9IGRuc1Jlc29sdmVyLnJlc29sdmUoJ215aXAub3BlbmRucy5jb20nLCAnQScpCiAgICAgICAgZm9yIGlwIGluIGFuc3dlcnM6CiAgICAgICAgICAgIHB1YmxpY0lwID0gaXAudG9fdGV4dCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtvZERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KGh0dHBEbnNTZXJ2ZXIpCiAgICAgICAgICAgIHB1YmxpY0lwID0gci50ZXh0LnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgcHVibGljSVAgZnJvbSB7aHR0cERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgcHVibGljSXAgPSAnMC4wLjAuMCcKCiAgICByZXR1cm4gcHVibGljSXAKCmRlZiBnZXRVc2VySG9tZVBhdGgoKToKICAgICIiIkdldCB1c2VyIGhvbWUgZGlyZWN0b3J5IHBhdGgiIiIKICAgIHVzZXJIb21lUGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcigifiIpCiAgICBsb2dnZXIuaW5mbyhmJ3VzZXJIb21lUGF0aDoge3VzZXJIb21lUGF0aH0nKQogICAgcmV0dXJuIHVzZXJIb21lUGF0aAoKZGVmIGdldERldmljZVV1aWQoY29uZmlnRmlsZSk6CiAgICAiIiJHZXQgZGV2aWNlIFVVSUQgZnJvbSBjb25maWcgZmlsZSIiIgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQge2NvbmZpZ0ZpbGV9JykKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oY29uZmlnRmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikKICAgICAgICBkZXZpY2VVdWlkID0gY29uZmlnLmdldCgnZGV2aWNldXVpZCcpCiAgICAgICAgaG9zdCA9IGNvbmZpZy5nZXQoJ3NlcnZlckFkZHInLCAnYXBwLndlZ3dlaXNlci50ZWNoJykKICAgICAgICBpZiBub3QgZGV2aWNlVXVpZDoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdkZXZpY2V1dWlkIG5vdCBmb3VuZCBpbiBjb25maWcgZmlsZS4nKQogICAgICAgICAgICByZXR1cm4gTm9uZSwgaG9zdAogICAgICAgIHRyeToKICAgICAgICAgICAgdXVpZC5VVUlEKHN0cihkZXZpY2VVdWlkKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidJbnZhbGlkIGRldmljZXV1aWQgZm9ybWF0IGluIGNvbmZpZzoge2RldmljZVV1aWR9JykKICAgICAgICAgICAgcmV0dXJuIE5vbmUsIGhvc3QKICAgICAgICBsb2dnZXIuaW5mbyhmJ2RldmljZVV1aWQ6IHtkZXZpY2VVdWlkfScpCiAgICAgICAgcmV0dXJuIGRldmljZVV1aWQsIGhvc3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gcmVhZCBjb25maWcgZmlsZToge2V9JykKICAgICAgICByZXR1cm4gTm9uZSwgJ2FwcC53ZWd3ZWlzZXIudGVjaCcKCmRlZiBnZXRBcHBEaXJzKCk6CiAgICAiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMiIiIKICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKICAgICAgICBhcHBEaXIgPSByJ2M6XHByb2dyYW0gZmlsZXMgKHg4NilcV2Vnd2Vpc2VyJwogICAgICAgIGxvZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdMb2dzJykKICAgICAgICBjb25maWdEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnQ29uZmlnJykKICAgICAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ1RlbXAnKQogICAgICAgIGZpbGVzRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ0ZpbGVzJykKICAgIGVsc2U6CiAgICAgICAgIyBGYWxsYmFjayBmb3Igbm9uLVdpbmRvd3Mgb3IgZGV2IGVudmlyb25tZW50cwogICAgICAgIHVzZXJIb21lUGF0aCA9IGdldFVzZXJIb21lUGF0aCgpCiAgICAgICAgYXBwRGlyID0gb3MucGF0aC5qb2luKHVzZXJIb21lUGF0aCwgJy53ZWd3ZWlzZXInKQogICAgICAgIGxvZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdsb2dzJykKICAgICAgICBjb25maWdEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnY29uZmlnJykKICAgICAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ3RlbXAnKQogICAgICAgIGZpbGVzRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2ZpbGVzJykKCiAgICBmb3IgZGlyZWN0b3J5IGluIFthcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0Rpcl06CiAgICAgICAgb3MubWFrZWRpcnMoZGlyZWN0b3J5LCBleGlzdF9vaz1UcnVlKQoKICAgIGxvZ2dlci5pbmZvKGYnYXBwRGlyOiB7YXBwRGlyfScpCiAgICByZXR1cm4gYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIKCmRlZiBkZWxGaWxlKGZpbGVUb0RlbGV0ZSk6CiAgICAiIiJEZWxldGUgYSBmaWxlIiIiCiAgICBsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9Li4uJykKICAgIHRyeToKICAgICAgICBvcy5yZW1vdmUoZmlsZVRvRGVsZXRlKQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGRlbGV0ZWQge2ZpbGVUb0RlbGV0ZX0uJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9LiBSZWFzb246IHtlfScpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIElOTElORUQgUFNVVElMIE1FVFJJQ1MgKGZyb20gUHN1dGlsTWV0cmljcykgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIGNwdV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBDb3JlIGluZm9ybWF0aW9uCiAgICAgICAgY3B1X21ldHJpY3NbJ2NvcmVzX2xvZ2ljYWwnXSA9IHBzdXRpbC5jcHVfY291bnQobG9naWNhbD1UcnVlKQogICAgICAgIGNwdV9tZXRyaWNzWydjb3Jlc19waHlzaWNhbCddID0gcHN1dGlsLmNwdV9jb3VudChsb2dpY2FsPUZhbHNlKQoKICAgICAgICAjIEZyZXF1ZW5jeSBpbmZvcm1hdGlvbgogICAgICAgIHRyeToKICAgICAgICAgICAgZnJlcSA9IHBzdXRpbC5jcHVfZnJlcSgpCiAgICAgICAgICAgIGlmIGZyZXE6CiAgICAgICAgICAgICAgICBjcHVfbWV0cmljc1snZnJlcXVlbmN5X2N1cnJlbnQnXSA9IHJvdW5kKGZyZXEuY3VycmVudCwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWluJ10gPSByb3VuZChmcmVxLm1pbiwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWF4J10gPSByb3VuZChmcmVxLm1heCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgQ1BVIGZyZXF1ZW5jeToge2V9JykKCiAgICAgICAgIyBQZXItQ1BVIHVzYWdlIHBlcmNlbnRhZ2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNwdV9wZXJjZW50ID0gcHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTEsIHBlcmNwdT1UcnVlKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnQnXSA9IFtyb3VuZChwLCAyKSBmb3IgcCBpbiBjcHVfcGVyY2VudF0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgcGVyLUNQVSBwZXJjZW50OiB7ZX0nKQoKICAgICAgICAjIE92ZXJhbGwgQ1BVIHVzYWdlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnRfb3ZlcmFsbCddID0gcm91bmQocHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTAuMSksIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IG92ZXJhbGwgQ1BVIHBlcmNlbnQ6IHtlfScpCgogICAgICAgICMgQ1BVIHRpbWVzICh1c2VyLCBzeXN0ZW0sIGlkbGUsIGlvd2FpdCwgaXJxLCBzb2Z0aXJxKQogICAgICAgIHRyeToKICAgICAgICAgICAgdGltZXMgPSBwc3V0aWwuY3B1X3RpbWVzKCkKICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2NwdV90aW1lcyddID0gewogICAgICAgICAgICAgICAgJ3VzZXInOiByb3VuZCh0aW1lcy51c2VyLCAyKSwKICAgICAgICAgICAgICAgICdzeXN0ZW0nOiByb3VuZCh0aW1lcy5zeXN0ZW0sIDIpLAogICAgICAgICAgICAgICAgJ2lkbGUnOiByb3VuZCh0aW1lcy5pZGxlLCAyKSwKICAgICAgICAgICAgICAgICdpb3dhaXQnOiByb3VuZCh0aW1lcy5pb3dhaXQsIDIpIGlmIGhhc2F0dHIodGltZXMsICdpb3dhaXQnKSBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAnaXJxJzogcm91bmQodGltZXMuaXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnaXJxJykgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgJ3NvZnRpcnEnOiByb3VuZCh0aW1lcy5zb2Z0aXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnc29mdGlycScpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgdGltZXM6IHtlfScpCgogICAgICAgICMgQ1BVIHN0YXRpc3RpY3MgKGNvbnRleHQgc3dpdGNoZXMsIGludGVycnVwdHMpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdGF0cyA9IHBzdXRpbC5jcHVfc3RhdHMoKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3N0YXRzJ10gPSB7CiAgICAgICAgICAgICAgICAnY3R4X3N3aXRjaGVzJzogc3RhdHMuY3R4X3N3aXRjaGVzLAogICAgICAgICAgICAgICAgJ2ludGVycnVwdHMnOiBzdGF0cy5pbnRlcnJ1cHRzLAogICAgICAgICAgICAgICAgJ3NvZnRfaW50ZXJydXB0cyc6IHN0YXRzLnNvZnRfaW50ZXJydXB0cywKICAgICAgICAgICAgICAgICdzeXNjYWxscyc6IHN0YXRzLnN5c2NhbGxzIGlmIGhhc2F0dHIoc3RhdHMsICdzeXNjYWxscycpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgc3RhdHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIENQVSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gY3B1X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIENQVSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKZGVmIGdldE1lbW9yeU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIG1lbW9yeSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIG1lbW9yeV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBWaXJ0dWFsIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ2J1ZmZlcnMnXSA9IHZtZW0uYnVmZmVycyBpZiBoYXNhdHRyKHZtZW0sICdidWZmZXJzJykgZWxzZSBOb25lCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydjYWNoZWQnXSA9IHZtZW0uY2FjaGVkIGlmIGhhc2F0dHIodm1lbSwgJ2NhY2hlZCcpIGVsc2UgTm9uZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc2hhcmVkJ10gPSB2bWVtLnNoYXJlZCBpZiBoYXNhdHRyKHZtZW0sICdzaGFyZWQnKSBlbHNlIE5vbmUKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3BlcmNlbnQnXSA9IHJvdW5kKHZtZW0ucGVyY2VudCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgdmlydHVhbCBtZW1vcnkgZGV0YWlsczoge2V9JykKCiAgICAgICAgIyBTd2FwIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzd2FwID0gcHN1dGlsLnN3YXBfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdG90YWwnXSA9IHN3YXAudG90YWwKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdXNlZCddID0gc3dhcC51c2VkCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzd2FwX2ZyZWUnXSA9IHN3YXAuZnJlZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF9wZXJjZW50J10gPSByb3VuZChzd2FwLnBlcmNlbnQsIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IHN3YXAgbWVtb3J5IGRldGFpbHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIG1lbW9yeSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gbWVtb3J5X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIG1lbW9yeSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBDT05GSUdVUkFUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlYnVnTW9kZSA9IFRydWUKaG9zdCA9ICdhcHAud2Vnd2Vpc2VyLnRlY2gnCnBvcnQgPSA0NDMKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBDUFUgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICAjIEdldCBDUFUgbmFtZSBmcm9tIFdNSQogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfUHJvY2Vzc29yKS5OYW1lIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgY3B1TmFtZSA9ICcgJy5qb2luKHJlc3VsdC5zdGRvdXQuc3BsaXQoKSkgaWYgcmVzdWx0LnN0ZG91dCBlbHNlICdVbmtub3duJwogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYnY3B1TmFtZToge2NwdU5hbWV9JykKICAgICAgICAKICAgICAgICAjIEdldCBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzCiAgICAgICAgY3B1X21ldHJpY3MgPSBnZXRDcHVNZXRyaWNzKCkKICAgICAgICAKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogY3B1TmFtZSwKICAgICAgICAgICAgJ2NwdV9tZXRyaWNzJzogY3B1X21ldHJpY3MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBDUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogJ1Vua25vd24nLAogICAgICAgICAgICAnY3B1X21ldHJpY3MnOiB7fQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBtZW1vcnkgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAKICAgICAgICAjIEJhc2ljIG1lbW9yeSBpbmZvCiAgICAgICAgdG90YWxNZW1vcnkgPSB2bWVtLnRvdGFsCiAgICAgICAgYXZhaWxhYmxlTWVtb3J5ID0gdm1lbS5hdmFpbGFibGUKICAgICAgICB1c2VkTWVtb3J5ID0gdm1lbS51c2VkCiAgICAgICAgZnJlZU1lbW9yeSA9IHZtZW0uZnJlZQogICAgICAgIAogICAgICAgICMgR2V0IGNvbXByZWhlbnNpdmUgbWVtb3J5IG1ldHJpY3MKICAgICAgICBtZW1vcnlfbWV0cmljcyA9IGdldE1lbW9yeU1ldHJpY3MoKQogICAgICAgIAogICAgICAgIGRldmljZURhdGFEaWN0WydtZW1vcnknXSA9IHsKICAgICAgICAgICAgJ3RvdGFsJzogdG90YWxNZW1vcnksCiAgICAgICAgICAgICdhdmFpbGFibGUnOiBhdmFpbGFibGVNZW1vcnksCiAgICAgICAgICAgICd1c2VkJzogdXNlZE1lbW9yeSwKICAgICAgICAgICAgJ2ZyZWUnOiBmcmVlTWVtb3J5LAogICAgICAgICAgICAnbWVtb3J5X21ldHJpY3MnOiBtZW1vcnlfbWV0cmljcwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmJ01lbW9yeToge2NvbnZlcnRTaXplKHRvdGFsTWVtb3J5KX0gdG90YWwnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbWVtb3J5IGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewogICAgICAgICAgICAndG90YWwnOiAwLAogICAgICAgICAgICAnYXZhaWxhYmxlJzogMCwKICAgICAgICAgICAgJ3VzZWQnOiAwLAogICAgICAgICAgICAnZnJlZSc6IDAsCiAgICAgICAgICAgICdtZW1vcnlfbWV0cmljcyc6IHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFN5c3RlbURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIHBsYXQgPSBwbGF0Zm9ybS5zeXN0ZW0oKSBvciAnVW5rbm93bicKICAgICAgICByZWwgPSBwbGF0Zm9ybS5yZWxlYXNlKCkgb3IgJ1Vua25vd24nCiAgICAgICAgdmVyID0gcGxhdGZvcm0udmVyc2lvbigpIG9yICdVbmtub3duJwogICAgICAgIGRldmljZV9wbGF0Zm9ybSA9IGYie3BsYXR9LXtyZWx9LXt2ZXJ9IgoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ10gPSB7CiAgICAgICAgICAgICdkZXZpY2VQbGF0Zm9ybSc6IGRldmljZV9wbGF0Zm9ybSwKICAgICAgICAgICAgJ3N5c3RlbU5hbWUnOiBzb2NrZXQuZ2V0aG9zdG5hbWUoKSwKICAgICAgICAgICAgJ2N1cnJlbnRVc2VyJzogZ2V0cGFzcy5nZXR1c2VyKCksCiAgICAgICAgICAgICdjcHVVc2FnZSc6IHBzdXRpbC5jcHVfcGVyY2VudChpbnRlcnZhbD0xKSwKICAgICAgICAgICAgJ2NwdUNvdW50JzogcHN1dGlsLmNwdV9jb3VudCgpLAogICAgICAgICAgICAnYm9vdFRpbWUnOiBwc3V0aWwuYm9vdF90aW1lKCksCiAgICAgICAgICAgICdwdWJsaWNJcCc6IGdldFB1YmxpY0lwQWRkcigpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3lzdGVtIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHN5c3RlbSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgZGlzayBzdGF0aXN0aWNzIiIiCiAgICB0cnk6CiAgICAgICAgZHJpdmVzID0gW10KICAgICAgICBmb3IgcGFydGl0aW9uIGluIHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXNhZ2UgPSBwc3V0aWwuZGlza191c2FnZShwYXJ0aXRpb24ubW91bnRwb2ludCkKICAgICAgICAgICAgICAgIGRyaXZlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICduYW1lJzogcGFydGl0aW9uLmRldmljZSwKICAgICAgICAgICAgICAgICAgICAndG90YWwnOiB1c2FnZS50b3RhbCwKICAgICAgICAgICAgICAgICAgICAndXNlZCc6IHVzYWdlLnVzZWQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWUnOiB1c2FnZS5mcmVlLAogICAgICAgICAgICAgICAgICAgICd1c2VkUGVyJzogdXNhZ2UucGVyY2VudCwKICAgICAgICAgICAgICAgICAgICAnZnJlZVBlcic6IDEwMCAtIHVzYWdlLnBlcmNlbnQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZidQZXJtaXNzaW9uIGRlbmllZCBmb3Ige3BhcnRpdGlvbi5tb3VudHBvaW50fScpCgogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IGRyaXZlcwogICAgICAgIGxvZ2dlci5pbmZvKGYnRGlzayBzdGF0cyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVzKX0gZHJpdmVzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRpc2sgc3RhdHM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbmV0d29yayBpbnRlcmZhY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBuZXR3b3JrTGlzdCA9IFtdCiAgICAgICAgbmV0X2lmX3N0YXRzID0gcHN1dGlsLm5ldF9pZl9zdGF0cygpCiAgICAgICAgbmV0X2lvID0gcHN1dGlsLm5ldF9pb19jb3VudGVycyhwZXJuaWM9VHJ1ZSkKICAgICAgICBmb3IgaW50ZXJmYWNlX25hbWUsIGludGVyZmFjZV9hZGRycyBpbiBwc3V0aWwubmV0X2lmX2FkZHJzKCkuaXRlbXMoKToKICAgICAgICAgICAgc3RhdHMgPSBuZXRfaWZfc3RhdHMuZ2V0KGludGVyZmFjZV9uYW1lKQogICAgICAgICAgICBpZiBub3Qgc3RhdHM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZmFjZSA9IHsKICAgICAgICAgICAgICAgICdpZklzVXAnOiBzdGF0cy5pc3VwLAogICAgICAgICAgICAgICAgJ2lmU3BlZWQnOiBzdGF0cy5zcGVlZCwKICAgICAgICAgICAgICAgICdpZk10dSc6IHN0YXRzLm10dSwKICAgICAgICAgICAgICAgICdieXRlc1NlbnQnOiAwLAogICAgICAgICAgICAgICAgJ2J5dGVzUmVjdic6IDAsCiAgICAgICAgICAgICAgICAnZXJySW4nOiAwLAogICAgICAgICAgICAgICAgJ2Vyck91dCc6IDAsCiAgICAgICAgICAgICAgICAnYWRkcmVzczQnOiBOb25lLAogICAgICAgICAgICAgICAgJ25ldG1hc2s0JzogTm9uZSwKICAgICAgICAgICAgICAgICdicm9hZGNhc3Q0JzogTm9uZSwKICAgICAgICAgICAgICAgICdhZGRyZXNzNic6IE5vbmUsCiAgICAgICAgICAgICAgICAnbmV0bWFzazYnOiBOb25lLAogICAgICAgICAgICAgICAgJ2Jyb2FkY2FzdDYnOiBOb25lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW8gPSBuZXRfaW8uZ2V0KGludGVyZmFjZV9uYW1lKQogICAgICAgICAgICBpZiBpbzoKICAgICAgICAgICAgICAgIGlmYWNlWydieXRlc1NlbnQnXSA9IGlvLmJ5dGVzX3JlY3YKICAgICAgICAgICAgICAgIGlmYWNlWydieXRlc1JlY3YnXSA9IGlvLmJ5dGVzX3NlbnQKICAgICAgICAgICAgICAgIGlmYWNlWydlcnJJbiddID0gaW8uZXJyaW4KICAgICAgICAgICAgICAgIGlmYWNlWydlcnJPdXQnXSA9IGlvLmVycm91dAoKICAgICAgICAgICAgZm9yIGFkZHIgaW4gaW50ZXJmYWNlX2FkZHJzOgogICAgICAgICAgICAgICAgaWYgYWRkci5mYW1pbHkgPT0gc29ja2V0LkFGX0lORVQ6CiAgICAgICAgICAgICAgICAgICAgaWZhY2VbJ2FkZHJlc3M0J10gPSBhZGRyLmFkZHJlc3MKICAgICAgICAgICAgICAgICAgICBpZmFjZVsnbmV0bWFzazQnXSA9IGFkZHIubmV0bWFzawogICAgICAgICAgICAgICAgICAgIGlmYWNlWydicm9hZGNhc3Q0J10gPSBhZGRyLmJyb2FkY2FzdAogICAgICAgICAgICAgICAgZWxpZiBhZGRyLmZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDY6CiAgICAgICAgICAgICAgICAgICAgaWZhY2VbJ2FkZHJlc3M2J10gPSBhZGRyLmFkZHJlc3MKICAgICAgICAgICAgICAgICAgICBpZmFjZVsnbmV0bWFzazYnXSA9IGFkZHIubmV0bWFzawogICAgICAgICAgICAgICAgICAgIGlmYWNlWydicm9hZGNhc3Q2J10gPSBhZGRyLmJyb2FkY2FzdAoKICAgICAgICAgICAgbmV0d29ya0xpc3QuYXBwZW5kKHtpbnRlcmZhY2VfbmFtZTogaWZhY2V9KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbmV0d29ya0xpc3QnXSA9IG5ldHdvcmtMaXN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidOZXR3b3JrIGRhdGEgY29sbGVjdGVkOiB7bGVuKG5ldHdvcmtMaXN0KX0gaW50ZXJmYWNlcycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBuZXR3b3JrIGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFVzZXJEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBsb2dnZWQtaW4gdXNlcnMiIiIKICAgIHRyeToKICAgICAgICB1c2VycyA9IFtdCiAgICAgICAgdXNlcl9kaWN0ID0ge30KICAgICAgICBmb3IgaWR4LCB1c2VyIGluIGVudW1lcmF0ZShwc3V0aWwudXNlcnMoKSk6CiAgICAgICAgICAgIHVzZXJfZGljdFtzdHIoaWR4KV0gPSB7CiAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiB1c2VyLm5hbWUsCiAgICAgICAgICAgICAgICAndGVybWluYWwnOiB1c2VyLnRlcm1pbmFsIG9yICdOL0EnLAogICAgICAgICAgICAgICAgJ2hvc3QnOiB1c2VyLmhvc3Qgb3IgJ04vQScsCiAgICAgICAgICAgICAgICAnbG9nZ2VkSW4nOiB1c2VyLnN0YXJ0ZWQsCiAgICAgICAgICAgICAgICAncGlkJzogdXNlci5waWQgb3IgMAogICAgICAgICAgICB9CiAgICAgICAgdXNlcnMuYXBwZW5kKHVzZXJfZGljdCkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ1VzZXJzJ10gPSB1c2VycwogICAgICAgIGxvZ2dlci5pbmZvKGYnVXNlciBkYXRhIGNvbGxlY3RlZDoge2xlbih1c2VyX2RpY3QpfSB1c2VycycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyB1c2VyIGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ1VzZXJzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBiYXR0ZXJ5IGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgYmF0dGVyeSA9IHBzdXRpbC5zZW5zb3JzX2JhdHRlcnkoKQogICAgICAgIGlmIGJhdHRlcnk6CiAgICAgICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J10gPSB7CiAgICAgICAgICAgICAgICAnaW5zdGFsbGVkJzogVHJ1ZSwKICAgICAgICAgICAgICAgICdwY0NoYXJnZWQnOiBiYXR0ZXJ5LnBlcmNlbnQsCiAgICAgICAgICAgICAgICAnc2Vjc0xlZnQnOiBiYXR0ZXJ5LnNlY3NsZWZ0IGlmIGJhdHRlcnkuc2Vjc2xlZnQgIT0gcHN1dGlsLlBPV0VSX1RJTUVfVU5MSU1JVEVEIGVsc2UgLTEsCiAgICAgICAgICAgICAgICAncG93ZXJQbHVnJzogYmF0dGVyeS5wb3dlcl9wbHVnZ2VkCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAgICAgJ2luc3RhbGxlZCc6IEZhbHNlLAogICAgICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IDAsCiAgICAgICAgICAgICAgICAnc2Vjc0xlZnQnOiAtMSwKICAgICAgICAgICAgICAgICdwb3dlclBsdWcnOiBUcnVlCiAgICAgICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0JhdHRlcnkgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgYmF0dGVyeSBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J10gPSB7CiAgICAgICAgICAgICdpbnN0YWxsZWQnOiBGYWxzZSwKICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IDAsCiAgICAgICAgICAgICdzZWNzTGVmdCc6IC0xLAogICAgICAgICAgICAncG93ZXJQbHVnJzogVHJ1ZQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVcHRpbWVEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCB1cHRpbWUgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBib290X3RpbWUgPSBwc3V0aWwuYm9vdF90aW1lKCkKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXB0aW1lJ10gPSB7CiAgICAgICAgICAgICdib290VGltZSc6IGJvb3RfdGltZSwKICAgICAgICAgICAgJ3VwdGltZVNlY29uZHMnOiB0aW1lLnRpbWUoKSAtIGJvb3RfdGltZQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ1VwdGltZSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyB1cHRpbWUgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBjb2xsZWN0b3IgdmVyc2lvbiBpbmZvcm1hdGlvbiBhbGlnbmVkIHdpdGggc2VydmVyIGV4cGVjdGF0aW9ucyIiIgogICAgdHJ5OgogICAgICAgICMgRGV0ZXJtaW5lIGluc3RhbGwgYW5kIGNvbmZpZyBkaXJlY3RvcmllcwogICAgICAgIGFwcF9kaXIsIF8sIGNvbmZpZ19kaXIsIF8sIF8gPSBnZXRBcHBEaXJzKCkKICAgICAgICAjIFJlYWQgYWdlbnQgdmVyc2lvbiBmcm9tIENvbmZpZy9hZ2VudFZlcnNpb24udHh0IChmYWxsYmFjayB0byAwKQogICAgICAgIHZlcnNpb25fcGF0aCA9IG9zLnBhdGguam9pbihjb25maWdfZGlyLCAnYWdlbnRWZXJzaW9uLnR4dCcpCiAgICAgICAgbG9jYWxfdmVyc2lvbiA9IDAKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3Blbih2ZXJzaW9uX3BhdGgsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgIHYgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiB2LmlzZGlnaXQoKToKICAgICAgICAgICAgICAgICAgICBsb2NhbF92ZXJzaW9uID0gaW50KHYpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyB2ZToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidhZ2VudFZlcnNpb24udHh0IG5vdCBmb3VuZCBvciBpbnZhbGlkOiB7dmV9JykKICAgICAgICAgICAgbG9jYWxfdmVyc2lvbiA9IDAKICAgICAgICAjIFBvcHVsYXRlIGNvbGxlY3RvciBmaWVsZHMgZXhwZWN0ZWQgYnkgc2VydmVyCiAgICAgICAgZGV2aWNlRGF0YURpY3Quc2V0ZGVmYXVsdCgnY29sbGVjdG9yJywge30pCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2NvbGxlY3RvciddWydjb2xsdmVyc2lvbiddID0gbG9jYWxfdmVyc2lvbgogICAgICAgIGRldmljZURhdGFEaWN0Wydjb2xsZWN0b3InXVsnY29sbGluc3RhbGxkaXInXSA9IGFwcF9kaXIKICAgICAgICBsb2dnZXIuaW5mbygnQ29sbGVjdG9yIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAjIEVuc3VyZSBrZXlzIGV4aXN0IHRvIGF2b2lkIHNlcnZlci1zaWRlIEtleUVycm9yCiAgICAgICAgZGV2aWNlRGF0YURpY3Quc2V0ZGVmYXVsdCgnY29sbGVjdG9yJywge30pCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2NvbGxlY3RvciddLnNldGRlZmF1bHQoJ2NvbGx2ZXJzaW9uJywgMCkKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10uc2V0ZGVmYXVsdCgnY29sbGluc3RhbGxkaXInLCAndW5rbm93bicpCiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBjb2xsZWN0b3IgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREZXZpY2VEYXRhKGRldmljZURhdGFEaWN0LCBkZXZpY2VVdWlkKToKICAgICIiIkdldCBiYXNpYyBkZXZpY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ10gPSB7CiAgICAgICAgICAgICdkZXZpY2VVdWlkJzogZGV2aWNlVXVpZCwKICAgICAgICAgICAgJ3N5c3RlbXRpbWUnOiB0aW1lLnRpbWUoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0RldmljZSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkZXZpY2UgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBwYXJ0aXRpb24gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBwYXJ0aXRpb25zID0gW10KICAgICAgICBwYXJ0aXRpb25fZGljdCA9IHt9CiAgICAgICAgZm9yIGlkeCwgcGFydGl0aW9uIGluIGVudW1lcmF0ZShwc3V0aWwuZGlza19wYXJ0aXRpb25zKCkpOgogICAgICAgICAgICBwYXJ0aXRpb25fZGljdFtwYXJ0aXRpb24ubW91bnRwb2ludF0gPSB7CiAgICAgICAgICAgICAgICAnZGV2aWNlJzogcGFydGl0aW9uLmRldmljZSwKICAgICAgICAgICAgICAgICdmc3R5cGUnOiBwYXJ0aXRpb24uZnN0eXBlCiAgICAgICAgICAgIH0KICAgICAgICBwYXJ0aXRpb25zLmFwcGVuZChwYXJ0aXRpb25fZGljdCkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3BhcnRpdGlvbnMnXSA9IHBhcnRpdGlvbnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1BhcnRpdGlvbiBkYXRhIGNvbGxlY3RlZDoge2xlbihwYXJ0aXRpb25fZGljdCl9IHBhcnRpdGlvbnMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgcGFydGl0aW9uIGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3BhcnRpdGlvbnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0R3B1SW5mbyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgR1BVIGluZm9ybWF0aW9uIChXaW5kb3dzLXNwZWNpZmljKSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfVmlkZW9Db250cm9sbGVyKSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB2ZW5kb3IgPSAnTm8gZGF0YSBmb3VuZCcKICAgICAgICBwcm9kdWN0ID0gJ05vIGRhdGEgZm91bmQnCiAgICAgICAgY29sb3VyRGVwdGggPSAtMQogICAgICAgIGhSZXMgPSAtMQogICAgICAgIHZSZXMgPSAtMQoKICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgJ1ZpZGVvUHJvY2Vzc29yJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgcHJvZHVjdCA9IGxpbmUuc3BsaXQoJ1ZpZGVvUHJvY2Vzc29yJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgICAgIGlmICdWaWRlb01vZGVEZXNjcmlwdGlvbicgaW4gbGluZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjb2xvdXJEZXB0aCA9IGxpbmUuc3BsaXQoJ3ggJylbMl0uc3BsaXQoJyAnKVswXQogICAgICAgICAgICAgICAgICAgIGNvbG91ckRlcHRoID0gaW50KGNvbG91ckRlcHRoKQogICAgICAgICAgICAgICAgICAgIGlmIGNvbG91ckRlcHRoID4gMjE0NzQ4MzY0NzoKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3VyRGVwdGggPSAyMTQ3NDgzNjQ3CiAgICAgICAgICAgICAgICAgICAgaFJlcyA9IGludChsaW5lLnNwbGl0KCc6ICcpWzFdLnNwbGl0KCcgJylbMF0pCiAgICAgICAgICAgICAgICAgICAgdlJlcyA9IGludChsaW5lLnNwbGl0KCd4ICcpWzFdLnNwbGl0KCcgJylbMF0pCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBpZiAnQWRhcHRlckRBQ1R5cGUnIGluIGxpbmU6CiAgICAgICAgICAgICAgICB2ZW5kb3IgPSBsaW5lLnNwbGl0KCdBZGFwdGVyREFDVHlwZScpWzFdLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogdmVuZG9yLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6IHByb2R1Y3QsCiAgICAgICAgICAgICdncHVjb2xvdXInOiBjb2xvdXJEZXB0aCwKICAgICAgICAgICAgJ2dwdWhyZXMnOiBoUmVzLAogICAgICAgICAgICAnZ3B1dnJlcyc6IHZSZXMKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidHUFUgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgR1BVIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2dwdWluZm8nXSA9IHsKICAgICAgICAgICAgJ2dwdXZlbmRvcic6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdXByb2R1Y3QnOiAnTm8gZGF0YSBmb3VuZCcsCiAgICAgICAgICAgICdncHVjb2xvdXInOiAtMSwKICAgICAgICAgICAgJ2dwdWhyZXMnOiAtMSwKICAgICAgICAgICAgJ2dwdXZyZXMnOiAtMQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRNYW51ZmFjdHVyZXIoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBtYW51ZmFjdHVyZXIiIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIihHZXQtV21pT2JqZWN0IFdpbjMyX0NvbXB1dGVyU3lzdGVtUHJvZHVjdCkuVmVuZG9yIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgbWFudWZhY3R1cmVyID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpIG9yICdVbmtub3duJwogICAgICAgIGRldmljZURhdGFEaWN0WydtYW51ZmFjdHVyZXInXSA9IG1hbnVmYWN0dXJlcgogICAgICAgIGxvZ2dlci5pbmZvKGYnTWFudWZhY3R1cmVyOiB7bWFudWZhY3R1cmVyfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBtYW51ZmFjdHVyZXI6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBPUyBsYW5ndWFnZSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5NVUlMYW5ndWFnZXMiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBvc0xhbmcgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ29zTGFuZyddID0gb3NMYW5nCiAgICAgICAgbG9nZ2VyLmluZm8oZidPUyBMYW5ndWFnZToge29zTGFuZ30nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgT1MgbGFuZ3VhZ2U6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ29zTGFuZyddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgU01CSU9TIGluZm9ybWF0aW9uIChXaW5kb3dzLXNwZWNpZmljKSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfU3lzdGVtRW5jbG9zdXJlKSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBzbWJpb3NfZGljdCA9IHt9CiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdTZXJpYWxOdW1iZXInIGluIGxpbmU6CiAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnc2VyaWFsTnVtYmVyJ10gPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQogICAgICAgICAgICBpZiAnQ2hhc3Npc1R5cGVzJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgc21iaW9zX2RpY3RbJ2NoYXNzaXNUeXBlJ10gPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc21iaW9zJ10gPSBzbWJpb3NfZGljdAogICAgICAgIGxvZ2dlci5pbmZvKGYnU01CSU9TIGluZm8gY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFNNQklPUyBpbmZvOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHt9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBtb2RlbCIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQ29tcHV0ZXJTeXN0ZW0pLk1vZGVsIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgbW9kZWwgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3N5c3RlbU1vZGVsJ10gPSBtb2RlbAogICAgICAgIGxvZ2dlci5pbmZvKGYnU3lzdGVtIE1vZGVsOiB7bW9kZWx9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHN5c3RlbSBtb2RlbDoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtTW9kZWwnXSA9ICdVbmtub3duJwogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBwcmludGVyIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIiIgogICAgICAgIEdldC1XbWlPYmplY3QgV2luMzJfUHJpbnRlciB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgW1BTQ3VzdG9tT2JqZWN0XUB7CiAgICAgICAgICAgICAgICBOYW1lID0gJF8uTmFtZQogICAgICAgICAgICAgICAgRHJpdmVyTmFtZSA9ICRfLkRyaXZlck5hbWUKICAgICAgICAgICAgICAgIFBvcnROYW1lID0gJF8uUG9ydE5hbWUKICAgICAgICAgICAgICAgIExvY2F0aW9uID0gJF8uTG9jYXRpb24KICAgICAgICAgICAgICAgIFByaW50ZXJTdGF0dXMgPSAkXy5QcmludGVyU3RhdHVzCiAgICAgICAgICAgICAgICBEZWZhdWx0ID0gJF8uRGVmYXVsdAogICAgICAgICAgICB9CiAgICAgICAgfSB8IENvbnZlcnRUby1Kc29uCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKCiAgICAgICAgcHJpbnRlcnNfZGljdCA9IHt9CiAgICAgICAgaWYgcmVzdWx0LnN0ZG91dC5zdHJpcCgpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwcmludGVyc19qc29uID0ganNvbi5sb2FkcyhyZXN1bHQuc3Rkb3V0KQogICAgICAgICAgICAgICAgIyBIYW5kbGUgc2luZ2xlIHByaW50ZXIgKG5vdCBpbiBhcnJheSkgdnMgbXVsdGlwbGUgcHJpbnRlcnMgKGluIGFycmF5KQogICAgICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocHJpbnRlcnNfanNvbiwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRlcnNfanNvbiA9IFtwcmludGVyc19qc29uXQoKICAgICAgICAgICAgICAgIGZvciBwcmludGVyIGluIHByaW50ZXJzX2pzb246CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHByaW50ZXIuZ2V0KCdOYW1lJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgICAgIHByaW50ZXJzX2RpY3RbbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJuYW1lJzogcHJpbnRlci5nZXQoJ0RyaXZlck5hbWUnLCAndW5rbm93bicpLAogICAgICAgICAgICAgICAgICAgICAgICAnbG9jYXRpb24nOiBwcmludGVyLmdldCgnTG9jYXRpb24nLCAndW5rbm93bicpIGlmIHByaW50ZXIuZ2V0KCdMb2NhdGlvbicpIGVsc2UgJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAncHJpbnRlcnN0YXR1cyc6IHN0cihwcmludGVyLmdldCgnUHJpbnRlclN0YXR1cycsICd1bmtub3duJykpLAogICAgICAgICAgICAgICAgICAgICAgICAncG9ydG5hbWUnOiBwcmludGVyLmdldCgnUG9ydE5hbWUnLCAndW5rbm93bicpLAogICAgICAgICAgICAgICAgICAgICAgICAnZGVmYXVsdCc6IHByaW50ZXIuZ2V0KCdEZWZhdWx0JywgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBleGNlcHQganNvbi5KU09ORGVjb2RlRXJyb3IgYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIHBhcnNpbmcgcHJpbnRlciBKU09OOiB7ZX0nKQogICAgICAgICAgICAgICAgIyBGYWxsYmFjayB0byBzaW1wbGUgbmFtZSBjb2xsZWN0aW9uCiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBsaW5lLnN0cmlwKCkgYW5kICdOYW1lJyBub3QgaW4gbGluZSBhbmQgJy0tLScgbm90IGluIGxpbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBsaW5lLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRlcnNfZGljdFtuYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJuYW1lJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvY2F0aW9uJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ByaW50ZXJzdGF0dXMnOiAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9ydG5hbWUnOiAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVmYXVsdCc6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gPSBwcmludGVyc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidQcmludGVycyBjb2xsZWN0ZWQ6IHtsZW4ocHJpbnRlcnNfZGljdCl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHByaW50ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBVU0IgZGV2aWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1VTQkNvbnRyb2xsZXJEZXZpY2UgfCBTZWxlY3QtT2JqZWN0IERlcGVuZGVudCIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB1c2JfZGV2aWNlcyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdXaW4zMl8nIGluIGxpbmU6CiAgICAgICAgICAgICAgICB1c2JfZGV2aWNlcy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXNiRGV2aWNlcyddID0gdXNiX2RldmljZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VTQiBkZXZpY2VzIGNvbGxlY3RlZDoge2xlbih1c2JfZGV2aWNlcyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFVTQiBkZXZpY2VzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wyd1c2JEZXZpY2VzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRyaXZlciBpbmZvcm1hdGlvbiAoV2luZG93cy1zcGVjaWZpYykgYW5kIHJldHVybiBhIGRpY3Qga2V5ZWQgYnkgZHJpdmVyIG5hbWUiIiIKICAgIHRyeToKICAgICAgICAjIFVzZSBQb3dlclNoZWxsIHRvIGVtaXQgSlNPTiBmb3Igcm9idXN0IHBhcnNpbmcKICAgICAgICBjb21tYW5kID0gKAogICAgICAgICAgICAiR2V0LVdtaU9iamVjdCBXaW4zMl9TeXN0ZW1Ecml2ZXIgfCAiCiAgICAgICAgICAgICJTZWxlY3QtT2JqZWN0IE5hbWUsIERlc2NyaXB0aW9uLCBQYXRoTmFtZSwgU3RhdGUsIFN0YXJ0TW9kZSwgU2VydmljZVR5cGUgfCAiCiAgICAgICAgICAgICJDb252ZXJ0VG8tSnNvbiAtQ29tcHJlc3MiCiAgICAgICAgKQogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTUKICAgICAgICApCgogICAgICAgIGRyaXZlcnNfZGljdCA9IHt9CiAgICAgICAgcmF3ID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpCiAgICAgICAgaWYgcmF3OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhyYXcpCiAgICAgICAgICAgICAgICAjIENvbnZlcnQgc2luZ2xlIG9iamVjdCB0byBsaXN0IGZvciB1bmlmb3JtaXR5CiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsIGRpY3QpOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbZGF0YV0KICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gZGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IChpdGVtLmdldCgnTmFtZScpIG9yICcnKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAoaXRlbS5nZXQoJ0Rlc2NyaXB0aW9uJykgb3IgJ3Vua25vd24nKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZSA9IChpdGVtLmdldCgnUGF0aE5hbWUnKSBvciAndW5rbm93bicpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2V0eXBlID0gKGl0ZW0uZ2V0KCdTZXJ2aWNlVHlwZScpIG9yICd1bmtub3duJykuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9ICd1bmtub3duJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVyZGF0ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcnNfZGljdFtuYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiBkZXNjcmlwdGlvbiBpZiBkZXNjcmlwdGlvbiBlbHNlICd1bmtub3duJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZHJpdmVycGF0aCc6IHBhdGhuYW1lIGlmIHBhdGhuYW1lIGVsc2UgJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJ0eXBlJzogc2VydmljZXR5cGUgaWYgc2VydmljZXR5cGUgZWxzZSAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlcnNpb24nOiB2ZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJkYXRlJzogZHJpdmVyZGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICMgRmFsbGJhY2s6IHBhcnNlIHNpbXBsZSAiTmFtZSBTdGF0ZSIgbGluZXMgaWYgSlNPTiBwYXJzaW5nIGZhaWxzCiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiByYXcuc3BsaXRsaW5lcygpOgogICAgICAgICAgICAgICAgICAgIGxpbmUgPSBsaW5lLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICBpZiBsaW5lIGFuZCAnTmFtZScgbm90IGluIGxpbmUgYW5kICctLS0nIG5vdCBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gbGluZS5zcGxpdCgpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJzX2RpY3RbbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJwYXRoJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJ0eXBlJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2ZXJzaW9uJzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcml2ZXJkYXRlJzogMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddID0gZHJpdmVyc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidEcml2ZXJzIGNvbGxlY3RlZDoge2xlbihkcml2ZXJzX2RpY3QpfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkcml2ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXJzJ10gPSB7fQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBNQUlOIEVYRUNVVElPTiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKCdXaW5kb3dzQXVkaXQgU3RhcnRpbmcuLi4nKQoKICAgICMgU2V0dXAgZGlyZWN0b3JpZXMKICAgIGFwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyID0gZ2V0QXBwRGlycygpCgogICAgIyBHZXQgZGV2aWNlIFVVSUQgYW5kIGhvc3QKICAgIGFnZW50Q29uZmlnRmlsZSA9IG9zLnBhdGguam9pbihjb25maWdEaXIsICdhZ2VudC5jb25maWcnKQogICAgZGV2aWNlVXVpZCwgaG9zdCA9IGdldERldmljZVV1aWQoYWdlbnRDb25maWdGaWxlKQogICAgaWYgbm90IGRldmljZVV1aWQ6CiAgICAgICAgbG9nZ2VyLmVycm9yKCdNaXNzaW5nIG9yIGludmFsaWQgZGV2aWNlVXVpZC4gQWJvcnRpbmcgdXBsb2FkLicpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIENvbGxlY3QgYWxsIGRhdGEKICAgIGRldmljZURhdGFEaWN0ID0ge30KICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCwgZGV2aWNlVXVpZCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGlza1N0YXRzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNYW51ZmFjdHVyZXIoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE9zTGFuZyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0R3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREcml2ZXJzKGRldmljZURhdGFEaWN0KQoKICAgICMgVXBkYXRlIGRldmljZSBVVUlEIGluIHBheWxvYWQKICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnZGV2aWNlVXVpZCddID0gZGV2aWNlVXVpZAoKICAgICMgU2VuZCBwYXlsb2FkCiAgICByb3V0ZSA9ICcvcGF5bG9hZC9zZW5kYXVkaXQnCiAgICBwYXlsb2FkID0geydkYXRhJzogZGV2aWNlRGF0YURpY3R9CgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKGYnUGF5bG9hZDoge2pzb24uZHVtcHMocGF5bG9hZCwgaW5kZW50PTIsIGRlZmF1bHQ9c3RyKX0nKQoKICAgIHJlc3BvbnNlID0gc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgcm91dGUsIGhvc3QsIGRlYnVnTW9kZSkKICAgIGxvZ2dlci5pbmZvKGYnU2VydmVyIHJlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IHwge3Jlc3BvbnNlLnRleHR9JykKCg=="}}