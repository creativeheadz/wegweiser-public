{
  "settings": {
    "snippetUuid": "a0fd5813-c992-4d58-bad4-2531d52a6f1e",
    "snippetname": "WindowsAudit",
    "snippettype": ".py",
    "created_at": 1763041551
  },
  "payload": {
    "payloadsig": "O8+4aAIDc3/gSmX09bAWPydTjwl02YLxZuL9/Z3v+ttyzV0dp8wjASGx4fIl+7rIMojAucp6Hf5KG/VkS4Mns/T/n16malKkzoCPsnELUGR5sDdZQY4Ps4v09668DEmI4L0sr0h1dkdQS47s6Hck+XE6MTEoUT7tMFQR2gBQkGNE5RxoA8czdTfOTcLLHD7V8hn6mqKqWb5tA9avXVX9fhQ6p3/FaAaOodamDQpE270n+fLk7kEAh0mhfn35c4EPFEXNPpY69D3ebKZ2zBdbf+A76/tK1lUGEcAY8HJ3+D08UaPxsYVgLxKweec78tWzKTxlpOQwqpsuYjPZcEVBfJOfIua6W1cz9aZXTNbHC3eGw6cO9epE7cMW0YzJFDiLs74lbCZjMQccsi9oNuWBhLjD7j4LCtOv5janeY2EQXpS0nLps0REQ/u/LjLDo4Pt6IJZyPeJoQa9OHBOkzFmRMrmaXCxaFXhcwXjNoiR2nuqFi+o1lGFXtq4BBX6Xn9DuqSNOEqu2MHPGkr5UiDFPKTbWcm33tAl3JeineQaESGakcrhZinE2LNsHvDbdXDBK4Ni0wW0x/8H6X9Btd1q0QZz09XN1j68MTE4FRywWxrtchnU5c+Mro/balaHbRydNsiWo6Oo9/QmzUt/8MO1ouRP0l7bdXzLE0QHkYYksoc=",
    "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvV2luZG93c0F1ZGl0LnB5CiIiIgpXaW5kb3dzLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyCkNvbGxlY3RzIGNvbXByZWhlbnNpdmUgc3lzdGVtIGluZm9ybWF0aW9uIHVzaW5nIHBzdXRpbCBhbmQgV2luZG93cy1zcGVjaWZpYyB0b29scwpTZWxmLWNvbnRhaW5lZCBzbmlwcGV0IHdpdGggYWxsIHV0aWxpdGllcyBpbmxpbmVkLgoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBtYXRoCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgp0cnk6CiAgICBpbXBvcnQgd2luMzJhcGkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLmluZm8oJ0luc3RhbGxpbmcgcHlwaXdpbjMyLi4uJykKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKICAgIGltcG9ydCB3aW4zMmFwaQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBJTkxJTkVEIFVUSUxJVElFUyAoZnJvbSBBdWRpdENvbW1vbikgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGNvbnZlcnRTaXplKHNpemVCeXRlcyk6CiAgICAiIiJDb252ZXJ0IGJ5dGVzIHRvIGh1bWFuLXJlYWRhYmxlIGZvcm1hdCIiIgogICAgaWYgc2l6ZUJ5dGVzID09IDA6CiAgICAgICAgcmV0dXJuICIwIEIiCiAgICBzaXplTmFtZSA9ICgiQiIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIsICJaQiIsICJZQiIpCiAgICBpID0gaW50KG1hdGguZmxvb3IobWF0aC5sb2coc2l6ZUJ5dGVzLCAxMDI0KSkpCiAgICBwID0gbWF0aC5wb3coMTAyNCwgaSkKICAgIHMgPSByb3VuZChzaXplQnl0ZXMgLyBwLCAyKQogICAgcmV0dXJuIGYne3N9IHtzaXplTmFtZVtpXX0nCgpkZWYgc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgZW5kcG9pbnQsIGhvc3QsIGRlYnVnTW9kZT1GYWxzZSk6CiAgICAiIiJTZW5kIEpTT04gcGF5bG9hZCB0byBGbGFzayBlbmRwb2ludCIiIgogICAgdXJsID0gZidodHRwczovL3tob3N0fXtlbmRwb2ludH0nCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmRlYnVnKGYncGF5bG9hZCB0byBzZW5kOiB7cGF5bG9hZH0nKQogICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCiAgICBoZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhwYXlsb2FkKSkKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGdldFB1YmxpY0lwQWRkcigpOgogICAgIiIiR2V0IHB1YmxpYyBJUCBhZGRyZXNzIiIiCiAgICBvZERuc1NlcnZlciA9ICcyMDguNjcuMjIyLjIyMicKICAgIGh0dHBEbnNTZXJ2ZXIgPSAnaHR0cHM6Ly9pY2FuaGF6aXAuY29tJwogICAgZG5zUmVzb2x2ZXIgPSBkbnMucmVzb2x2ZXIuUmVzb2x2ZXIoKQogICAgZG5zUmVzb2x2ZXIubmFtZXNlcnZlcnMgPSBbb2REbnNTZXJ2ZXJdCiAgICBwdWJsaWNJcCA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgYW5zd2VycyA9IGRuc1Jlc29sdmVyLnJlc29sdmUoJ215aXAub3BlbmRucy5jb20nLCAnQScpCiAgICAgICAgZm9yIGlwIGluIGFuc3dlcnM6CiAgICAgICAgICAgIHB1YmxpY0lwID0gaXAudG9fdGV4dCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtvZERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KGh0dHBEbnNTZXJ2ZXIpCiAgICAgICAgICAgIHB1YmxpY0lwID0gci50ZXh0LnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgcHVibGljSVAgZnJvbSB7aHR0cERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgcHVibGljSXAgPSAnMC4wLjAuMCcKCiAgICByZXR1cm4gcHVibGljSXAKCmRlZiBnZXRVc2VySG9tZVBhdGgoKToKICAgICIiIkdldCB1c2VyIGhvbWUgZGlyZWN0b3J5IHBhdGgiIiIKICAgIHVzZXJIb21lUGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcigifiIpCiAgICBsb2dnZXIuaW5mbyhmJ3VzZXJIb21lUGF0aDoge3VzZXJIb21lUGF0aH0nKQogICAgcmV0dXJuIHVzZXJIb21lUGF0aAoKZGVmIGdldERldmljZVV1aWQoY29uZmlnRmlsZSk6CiAgICAiIiJHZXQgZGV2aWNlIFVVSUQgZnJvbSBjb25maWcgZmlsZSIiIgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQge2NvbmZpZ0ZpbGV9JykKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oY29uZmlnRmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgZGV2aWNlVXVpZCA9IGNvbmZpZy5nZXQoJ2RldmljZVV1aWQnKQogICAgICAgICAgICBob3N0ID0gY29uZmlnLmdldCgnaG9zdCcsICdhcHAud2Vnd2Vpc2VyLnRlY2gnKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmJ2RldmljZVV1aWQ6IHtkZXZpY2VVdWlkfScpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VVdWlkLCBob3N0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHJlYWQgY29uZmlnIGZpbGU6IHtlfScpCiAgICAgICAgcmV0dXJuIE5vbmUsICdhcHAud2Vnd2Vpc2VyLnRlY2gnCgpkZWYgZ2V0QXBwRGlycygpOgogICAgIiIiR2V0IGFwcGxpY2F0aW9uIGRpcmVjdG9yaWVzIiIiCiAgICB1c2VySG9tZVBhdGggPSBnZXRVc2VySG9tZVBhdGgoKQogICAgYXBwRGlyID0gb3MucGF0aC5qb2luKHVzZXJIb21lUGF0aCwgJy53ZWd3ZWlzZXInKQogICAgbG9nRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2xvZ3MnKQogICAgY29uZmlnRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2NvbmZpZycpCiAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ3RlbXAnKQogICAgZmlsZXNEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnZmlsZXMnKQoKICAgIGZvciBkaXJlY3RvcnkgaW4gW2FwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyXToKICAgICAgICBvcy5tYWtlZGlycyhkaXJlY3RvcnksIGV4aXN0X29rPVRydWUpCgogICAgbG9nZ2VyLmluZm8oZidhcHBEaXI6IHthcHBEaXJ9JykKICAgIHJldHVybiBhcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0RpcgoKZGVmIGRlbEZpbGUoZmlsZVRvRGVsZXRlKToKICAgICIiIkRlbGV0ZSBhIGZpbGUiIiIKICAgIGxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uLi4nKQogICAgdHJ5OgogICAgICAgIG9zLnJlbW92ZShmaWxlVG9EZWxldGUpCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZGVsZXRlZCB7ZmlsZVRvRGVsZXRlfS4nKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uIFJlYXNvbjoge2V9JykKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgSU5MSU5FRCBQU1VUSUwgTUVUUklDUyAoZnJvbSBQc3V0aWxNZXRyaWNzKSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgZ2V0Q3B1TWV0cmljcygpOgogICAgIiIiR2F0aGVyIGNvbXByZWhlbnNpdmUgQ1BVIG1ldHJpY3MgdXNpbmcgcHN1dGlsIiIiCiAgICB0cnk6CiAgICAgICAgY3B1X21ldHJpY3MgPSB7fQoKICAgICAgICAjIENvcmUgaW5mb3JtYXRpb24KICAgICAgICBjcHVfbWV0cmljc1snY29yZXNfbG9naWNhbCddID0gcHN1dGlsLmNwdV9jb3VudChsb2dpY2FsPVRydWUpCiAgICAgICAgY3B1X21ldHJpY3NbJ2NvcmVzX3BoeXNpY2FsJ10gPSBwc3V0aWwuY3B1X2NvdW50KGxvZ2ljYWw9RmFsc2UpCgogICAgICAgICMgRnJlcXVlbmN5IGluZm9ybWF0aW9uCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcmVxID0gcHN1dGlsLmNwdV9mcmVxKCkKICAgICAgICAgICAgaWYgZnJlcToKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfY3VycmVudCddID0gcm91bmQoZnJlcS5jdXJyZW50LCAyKQogICAgICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2ZyZXF1ZW5jeV9taW4nXSA9IHJvdW5kKGZyZXEubWluLCAyKQogICAgICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2ZyZXF1ZW5jeV9tYXgnXSA9IHJvdW5kKGZyZXEubWF4LCAyKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgZnJlcXVlbmN5OiB7ZX0nKQoKICAgICAgICAjIFBlci1DUFUgdXNhZ2UgcGVyY2VudGFnZQogICAgICAgIHRyeToKICAgICAgICAgICAgY3B1X3BlcmNlbnQgPSBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSwgcGVyY3B1PVRydWUpCiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfcGVyY2VudCddID0gW3JvdW5kKHAsIDIpIGZvciBwIGluIGNwdV9wZXJjZW50XQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBwZXItQ1BVIHBlcmNlbnQ6IHtlfScpCgogICAgICAgICMgT3ZlcmFsbCBDUFUgdXNhZ2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfcGVyY2VudF9vdmVyYWxsJ10gPSByb3VuZChwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MC4xKSwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgb3ZlcmFsbCBDUFUgcGVyY2VudDoge2V9JykKCiAgICAgICAgIyBDUFUgdGltZXMgKHVzZXIsIHN5c3RlbSwgaWRsZSwgaW93YWl0LCBpcnEsIHNvZnRpcnEpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0aW1lcyA9IHBzdXRpbC5jcHVfdGltZXMoKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3RpbWVzJ10gPSB7CiAgICAgICAgICAgICAgICAndXNlcic6IHJvdW5kKHRpbWVzLnVzZXIsIDIpLAogICAgICAgICAgICAgICAgJ3N5c3RlbSc6IHJvdW5kKHRpbWVzLnN5c3RlbSwgMiksCiAgICAgICAgICAgICAgICAnaWRsZSc6IHJvdW5kKHRpbWVzLmlkbGUsIDIpLAogICAgICAgICAgICAgICAgJ2lvd2FpdCc6IHJvdW5kKHRpbWVzLmlvd2FpdCwgMikgaWYgaGFzYXR0cih0aW1lcywgJ2lvd2FpdCcpIGVsc2UgTm9uZSwKICAgICAgICAgICAgICAgICdpcnEnOiByb3VuZCh0aW1lcy5pcnEsIDIpIGlmIGhhc2F0dHIodGltZXMsICdpcnEnKSBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAnc29mdGlycSc6IHJvdW5kKHRpbWVzLnNvZnRpcnEsIDIpIGlmIGhhc2F0dHIodGltZXMsICdzb2Z0aXJxJykgZWxzZSBOb25lLAogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IENQVSB0aW1lczoge2V9JykKCiAgICAgICAgIyBDUFUgc3RhdGlzdGljcyAoY29udGV4dCBzd2l0Y2hlcywgaW50ZXJydXB0cykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN0YXRzID0gcHN1dGlsLmNwdV9zdGF0cygpCiAgICAgICAgICAgIGNwdV9tZXRyaWNzWydjcHVfc3RhdHMnXSA9IHsKICAgICAgICAgICAgICAgICdjdHhfc3dpdGNoZXMnOiBzdGF0cy5jdHhfc3dpdGNoZXMsCiAgICAgICAgICAgICAgICAnaW50ZXJydXB0cyc6IHN0YXRzLmludGVycnVwdHMsCiAgICAgICAgICAgICAgICAnc29mdF9pbnRlcnJ1cHRzJzogc3RhdHMuc29mdF9pbnRlcnJ1cHRzLAogICAgICAgICAgICAgICAgJ3N5c2NhbGxzJzogc3RhdHMuc3lzY2FsbHMgaWYgaGFzYXR0cihzdGF0cywgJ3N5c2NhbGxzJykgZWxzZSBOb25lLAogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IENQVSBzdGF0czoge2V9JykKCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZ2F0aGVyZWQgQ1BVIG1ldHJpY3MnKQogICAgICAgIHJldHVybiBjcHVfbWV0cmljcwoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnYXRoZXJpbmcgQ1BVIG1ldHJpY3M6IHtlfScpCiAgICAgICAgcmV0dXJuIHt9CgpkZWYgZ2V0TWVtb3J5TWV0cmljcygpOgogICAgIiIiR2F0aGVyIGNvbXByZWhlbnNpdmUgbWVtb3J5IG1ldHJpY3MgdXNpbmcgcHN1dGlsIiIiCiAgICB0cnk6CiAgICAgICAgbWVtb3J5X21ldHJpY3MgPSB7fQoKICAgICAgICAjIFZpcnR1YWwgbWVtb3J5IGRldGFpbHMKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZtZW0gPSBwc3V0aWwudmlydHVhbF9tZW1vcnkoKQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snYnVmZmVycyddID0gdm1lbS5idWZmZXJzIGlmIGhhc2F0dHIodm1lbSwgJ2J1ZmZlcnMnKSBlbHNlIE5vbmUKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ2NhY2hlZCddID0gdm1lbS5jYWNoZWQgaWYgaGFzYXR0cih2bWVtLCAnY2FjaGVkJykgZWxzZSBOb25lCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzaGFyZWQnXSA9IHZtZW0uc2hhcmVkIGlmIGhhc2F0dHIodm1lbSwgJ3NoYXJlZCcpIGVsc2UgTm9uZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1sncGVyY2VudCddID0gcm91bmQodm1lbS5wZXJjZW50LCAyKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCB2aXJ0dWFsIG1lbW9yeSBkZXRhaWxzOiB7ZX0nKQoKICAgICAgICAjIFN3YXAgbWVtb3J5IGRldGFpbHMKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN3YXAgPSBwc3V0aWwuc3dhcF9tZW1vcnkoKQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF90b3RhbCddID0gc3dhcC50b3RhbAogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF91c2VkJ10gPSBzd2FwLnVzZWQKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfZnJlZSddID0gc3dhcC5mcmVlCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzd2FwX3BlcmNlbnQnXSA9IHJvdW5kKHN3YXAucGVyY2VudCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgc3dhcCBtZW1vcnkgZGV0YWlsczoge2V9JykKCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZ2F0aGVyZWQgbWVtb3J5IG1ldHJpY3MnKQogICAgICAgIHJldHVybiBtZW1vcnlfbWV0cmljcwoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnYXRoZXJpbmcgbWVtb3J5IG1ldHJpY3M6IHtlfScpCiAgICAgICAgcmV0dXJuIHt9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIENPTkZJR1VSQVRJT04gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVidWdNb2RlID0gVHJ1ZQpob3N0ID0gJ2FwcC53ZWd3ZWlzZXIudGVjaCcKcG9ydCA9IDQ0MwoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdUluZm8oZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IENQVSBpbmZvcm1hdGlvbiBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgogICAgdHJ5OgogICAgICAgICMgR2V0IENQVSBuYW1lIGZyb20gV01JCiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9Qcm9jZXNzb3IpLk5hbWUiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBjcHVOYW1lID0gJyAnLmpvaW4ocmVzdWx0LnN0ZG91dC5zcGxpdCgpKSBpZiByZXN1bHQuc3Rkb3V0IGVsc2UgJ1Vua25vd24nCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZidjcHVOYW1lOiB7Y3B1TmFtZX0nKQogICAgICAgIAogICAgICAgICMgR2V0IGNvbXByZWhlbnNpdmUgQ1BVIG1ldHJpY3MKICAgICAgICBjcHVfbWV0cmljcyA9IGdldENwdU1ldHJpY3MoKQogICAgICAgIAogICAgICAgIGRldmljZURhdGFEaWN0WydjcHUnXSA9IHsKICAgICAgICAgICAgJ2NwdW5hbWUnOiBjcHVOYW1lLAogICAgICAgICAgICAnY3B1X21ldHJpY3MnOiBjcHVfbWV0cmljcwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIENQVSBpbmZvOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydjcHUnXSA9IHsKICAgICAgICAgICAgJ2NwdW5hbWUnOiAnVW5rbm93bicsCiAgICAgICAgICAgICdjcHVfbWV0cmljcyc6IHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1lbW9yeURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IG1lbW9yeSBpbmZvcm1hdGlvbiBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgogICAgdHJ5OgogICAgICAgIHZtZW0gPSBwc3V0aWwudmlydHVhbF9tZW1vcnkoKQogICAgICAgIAogICAgICAgICMgQmFzaWMgbWVtb3J5IGluZm8KICAgICAgICB0b3RhbE1lbW9yeSA9IHZtZW0udG90YWwKICAgICAgICBhdmFpbGFibGVNZW1vcnkgPSB2bWVtLmF2YWlsYWJsZQogICAgICAgIHVzZWRNZW1vcnkgPSB2bWVtLnVzZWQKICAgICAgICBmcmVlTWVtb3J5ID0gdm1lbS5mcmVlCiAgICAgICAgCiAgICAgICAgIyBHZXQgY29tcHJlaGVuc2l2ZSBtZW1vcnkgbWV0cmljcwogICAgICAgIG1lbW9yeV9tZXRyaWNzID0gZ2V0TWVtb3J5TWV0cmljcygpCiAgICAgICAgCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewogICAgICAgICAgICAndG90YWwnOiB0b3RhbE1lbW9yeSwKICAgICAgICAgICAgJ2F2YWlsYWJsZSc6IGF2YWlsYWJsZU1lbW9yeSwKICAgICAgICAgICAgJ3VzZWQnOiB1c2VkTWVtb3J5LAogICAgICAgICAgICAnZnJlZSc6IGZyZWVNZW1vcnksCiAgICAgICAgICAgICdtZW1vcnlfbWV0cmljcyc6IG1lbW9yeV9tZXRyaWNzCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYnTWVtb3J5OiB7Y29udmVydFNpemUodG90YWxNZW1vcnkpfSB0b3RhbCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBtZW1vcnkgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWVtb3J5J10gPSB7CiAgICAgICAgICAgICd0b3RhbCc6IDAsCiAgICAgICAgICAgICdhdmFpbGFibGUnOiAwLAogICAgICAgICAgICAndXNlZCc6IDAsCiAgICAgICAgICAgICdmcmVlJzogMCwKICAgICAgICAgICAgJ21lbW9yeV9tZXRyaWNzJzoge30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddID0gewogICAgICAgICAgICAnZGV2aWNlUGxhdGZvcm0nOiBwbGF0Zm9ybS5zeXN0ZW0oKSwKICAgICAgICAgICAgJ3N5c3RlbU5hbWUnOiBzb2NrZXQuZ2V0aG9zdG5hbWUoKSwKICAgICAgICAgICAgJ2N1cnJlbnRVc2VyJzogZ2V0cGFzcy5nZXR1c2VyKCksCiAgICAgICAgICAgICdjcHVVc2FnZSc6IHBzdXRpbC5jcHVfcGVyY2VudChpbnRlcnZhbD0xKSwKICAgICAgICAgICAgJ2NwdUNvdW50JzogcHN1dGlsLmNwdV9jb3VudCgpLAogICAgICAgICAgICAnYm9vdFRpbWUnOiBwc3V0aWwuYm9vdF90aW1lKCksCiAgICAgICAgICAgICdwdWJsaWNJcCc6IGdldFB1YmxpY0lwQWRkcigpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3lzdGVtIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHN5c3RlbSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgZGlzayBzdGF0aXN0aWNzIiIiCiAgICB0cnk6CiAgICAgICAgZHJpdmVzID0gW10KICAgICAgICBmb3IgcGFydGl0aW9uIGluIHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXNhZ2UgPSBwc3V0aWwuZGlza191c2FnZShwYXJ0aXRpb24ubW91bnRwb2ludCkKICAgICAgICAgICAgICAgIGRyaXZlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICduYW1lJzogcGFydGl0aW9uLmRldmljZSwKICAgICAgICAgICAgICAgICAgICAndG90YWwnOiB1c2FnZS50b3RhbCwKICAgICAgICAgICAgICAgICAgICAndXNlZCc6IHVzYWdlLnVzZWQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWUnOiB1c2FnZS5mcmVlLAogICAgICAgICAgICAgICAgICAgICd1c2VkUGVyJzogdXNhZ2UucGVyY2VudCwKICAgICAgICAgICAgICAgICAgICAnZnJlZVBlcic6IDEwMCAtIHVzYWdlLnBlcmNlbnQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZidQZXJtaXNzaW9uIGRlbmllZCBmb3Ige3BhcnRpdGlvbi5tb3VudHBvaW50fScpCgogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IGRyaXZlcwogICAgICAgIGxvZ2dlci5pbmZvKGYnRGlzayBzdGF0cyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVzKX0gZHJpdmVzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRpc2sgc3RhdHM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbmV0d29yayBpbnRlcmZhY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBuZXR3b3JrTGlzdCA9IFtdCiAgICAgICAgZm9yIGludGVyZmFjZV9uYW1lLCBpbnRlcmZhY2VfYWRkcnMgaW4gcHN1dGlsLm5ldF9pZl9hZGRycygpLml0ZW1zKCk6CiAgICAgICAgICAgIG5ldF9pZl9zdGF0cyA9IHBzdXRpbC5uZXRfaWZfc3RhdHMoKQogICAgICAgICAgICBpZiBpbnRlcmZhY2VfbmFtZSBpbiBuZXRfaWZfc3RhdHM6CiAgICAgICAgICAgICAgICBzdGF0cyA9IG5ldF9pZl9zdGF0c1tpbnRlcmZhY2VfbmFtZV0KICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9uYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdpZklzVXAnOiBzdGF0cy5pc3VwLAogICAgICAgICAgICAgICAgICAgICAgICAnaWZTcGVlZCc6IHN0YXRzLnNwZWVkLAogICAgICAgICAgICAgICAgICAgICAgICAnaWZNdHUnOiBzdGF0cy5tdHUsCiAgICAgICAgICAgICAgICAgICAgICAgICdieXRlc1NlbnQnOiBzdGF0cy5ieXRlc19zZW50LAogICAgICAgICAgICAgICAgICAgICAgICAnYnl0ZXNSZWN2Jzogc3RhdHMuYnl0ZXNfcmVjdiwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VyckluJzogc3RhdHMuZXJyaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJPdXQnOiBzdGF0cy5lcnJvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzNCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICduZXRtYXNrNCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdicm9hZGNhc3Q0JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3M2JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25ldG1hc2s2JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Jyb2FkY2FzdDYnOiBOb25lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciBhZGRyIGluIGludGVyZmFjZV9hZGRyczoKICAgICAgICAgICAgICAgICAgICBpZiBhZGRyLmZhbWlseS5uYW1lID09ICdBRl9JTkVUJzoKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydhZGRyZXNzNCddID0gYWRkci5hZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnbmV0bWFzazQnXSA9IGFkZHIubmV0bWFzawogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ2Jyb2FkY2FzdDQnXSA9IGFkZHIuYnJvYWRjYXN0CiAgICAgICAgICAgICAgICAgICAgZWxpZiBhZGRyLmZhbWlseS5uYW1lID09ICdBRl9JTkVUNic6CiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYWRkcmVzczYnXSA9IGFkZHIuYWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ25ldG1hc2s2J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydicm9hZGNhc3Q2J10gPSBhZGRyLmJyb2FkY2FzdAoKICAgICAgICAgICAgICAgIG5ldHdvcmtMaXN0LmFwcGVuZChpbnRlcmZhY2VfZGF0YSkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10gPSBuZXR3b3JrTGlzdAogICAgICAgIGxvZ2dlci5pbmZvKGYnTmV0d29yayBkYXRhIGNvbGxlY3RlZDoge2xlbihuZXR3b3JrTGlzdCl9IGludGVyZmFjZXMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbmV0d29yayBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbG9nZ2VkLWluIHVzZXJzIiIiCiAgICB0cnk6CiAgICAgICAgdXNlcnMgPSBbXQogICAgICAgIHVzZXJfZGljdCA9IHt9CiAgICAgICAgZm9yIGlkeCwgdXNlciBpbiBlbnVtZXJhdGUocHN1dGlsLnVzZXJzKCkpOgogICAgICAgICAgICB1c2VyX2RpY3Rbc3RyKGlkeCldID0gewogICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogdXNlci5uYW1lLAogICAgICAgICAgICAgICAgJ3Rlcm1pbmFsJzogdXNlci50ZXJtaW5hbCBvciAnTi9BJywKICAgICAgICAgICAgICAgICdob3N0JzogdXNlci5ob3N0IG9yICdOL0EnLAogICAgICAgICAgICAgICAgJ2xvZ2dlZEluJzogdXNlci5zdGFydGVkLAogICAgICAgICAgICAgICAgJ3BpZCc6IHVzZXIucGlkIG9yIDAKICAgICAgICAgICAgfQogICAgICAgIHVzZXJzLmFwcGVuZCh1c2VyX2RpY3QpCgogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gdXNlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VzZXIgZGF0YSBjb2xsZWN0ZWQ6IHtsZW4odXNlcl9kaWN0KX0gdXNlcnMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXNlciBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRCYXR0ZXJ5RGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgYmF0dGVyeSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGJhdHRlcnkgPSBwc3V0aWwuc2Vuc29yc19iYXR0ZXJ5KCkKICAgICAgICBpZiBiYXR0ZXJ5OgogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAgICAgJ2luc3RhbGxlZCc6IFRydWUsCiAgICAgICAgICAgICAgICAncGNDaGFyZ2VkJzogYmF0dGVyeS5wZXJjZW50LAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogYmF0dGVyeS5zZWNzbGVmdCBpZiBiYXR0ZXJ5LnNlY3NsZWZ0ICE9IHBzdXRpbC5QT1dFUl9USU1FX1VOTElNSVRFRCBlbHNlICdOL0EnLAogICAgICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IGJhdHRlcnkucG93ZXJfcGx1Z2dlZAogICAgICAgICAgICB9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnOiBGYWxzZSwKICAgICAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogJ04vQScsCiAgICAgICAgICAgICAgICAncG93ZXJQbHVnJzogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidCYXR0ZXJ5IGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGJhdHRlcnkgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAnaW5zdGFsbGVkJzogRmFsc2UsCiAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAnc2Vjc0xlZnQnOiAnTi9BJywKICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IFRydWUKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgdXB0aW1lIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgYm9vdF90aW1lID0gcHN1dGlsLmJvb3RfdGltZSgpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3VwdGltZSddID0gewogICAgICAgICAgICAnYm9vdFRpbWUnOiBib290X3RpbWUsCiAgICAgICAgICAgICd1cHRpbWVTZWNvbmRzJzogdGltZS50aW1lKCkgLSBib290X3RpbWUKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidVcHRpbWUgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXB0aW1lIGRhdGE6IHtlfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgY29sbGVjdG9yIHZlcnNpb24gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10gPSB7CiAgICAgICAgICAgICd2ZXJzaW9uJzogJzIuMC4wJywKICAgICAgICAgICAgJ3R5cGUnOiAnV2luZG93c0F1ZGl0JywKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnQ29sbGVjdG9yIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGNvbGxlY3RvciBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERldmljZURhdGEoZGV2aWNlRGF0YURpY3QsIGRldmljZVV1aWQpOgogICAgIiIiR2V0IGJhc2ljIGRldmljZSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXSA9IHsKICAgICAgICAgICAgJ2RldmljZVV1aWQnOiBkZXZpY2VVdWlkLAogICAgICAgICAgICAnc3lzdGVtdGltZSc6IHRpbWUudGltZSgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnRGV2aWNlIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRldmljZSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHBhcnRpdGlvbiBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIHBhcnRpdGlvbnMgPSBbXQogICAgICAgIHBhcnRpdGlvbl9kaWN0ID0ge30KICAgICAgICBmb3IgaWR4LCBwYXJ0aXRpb24gaW4gZW51bWVyYXRlKHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKSk6CiAgICAgICAgICAgIHBhcnRpdGlvbl9kaWN0W3BhcnRpdGlvbi5tb3VudHBvaW50XSA9IHsKICAgICAgICAgICAgICAgICdkZXZpY2UnOiBwYXJ0aXRpb24uZGV2aWNlLAogICAgICAgICAgICAgICAgJ2ZzdHlwZSc6IHBhcnRpdGlvbi5mc3R5cGUKICAgICAgICAgICAgfQogICAgICAgIHBhcnRpdGlvbnMuYXBwZW5kKHBhcnRpdGlvbl9kaWN0KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gcGFydGl0aW9ucwogICAgICAgIGxvZ2dlci5pbmZvKGYnUGFydGl0aW9uIGRhdGEgY29sbGVjdGVkOiB7bGVuKHBhcnRpdGlvbl9kaWN0KX0gcGFydGl0aW9ucycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBwYXJ0aXRpb24gZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBHUFUgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9WaWRlb0NvbnRyb2xsZXIpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHZlbmRvciA9ICdObyBkYXRhIGZvdW5kJwogICAgICAgIHByb2R1Y3QgPSAnTm8gZGF0YSBmb3VuZCcKICAgICAgICBjb2xvdXJEZXB0aCA9IC0xCiAgICAgICAgaFJlcyA9IC0xCiAgICAgICAgdlJlcyA9IC0xCgogICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICBpZiAnVmlkZW9Qcm9jZXNzb3InIGluIGxpbmU6CiAgICAgICAgICAgICAgICBwcm9kdWN0ID0gbGluZS5zcGxpdCgnVmlkZW9Qcm9jZXNzb3InKVsxXS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKICAgICAgICAgICAgaWYgJ1ZpZGVvTW9kZURlc2NyaXB0aW9uJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNvbG91ckRlcHRoID0gbGluZS5zcGxpdCgneCAnKVsyXS5zcGxpdCgnICcpWzBdCiAgICAgICAgICAgICAgICAgICAgY29sb3VyRGVwdGggPSBpbnQoY29sb3VyRGVwdGgpCiAgICAgICAgICAgICAgICAgICAgaFJlcyA9IGxpbmUuc3BsaXQoJzogJylbMV0uc3BsaXQoJyAnKVswXQogICAgICAgICAgICAgICAgICAgIHZSZXMgPSBsaW5lLnNwbGl0KCd4ICcpWzFdLnNwbGl0KCcgJylbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGlmICdBZGFwdGVyREFDVHlwZScgaW4gbGluZToKICAgICAgICAgICAgICAgIHZlbmRvciA9IGxpbmUuc3BsaXQoJ0FkYXB0ZXJEQUNUeXBlJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydncHVpbmZvJ10gPSB7CiAgICAgICAgICAgICdncHV2ZW5kb3InOiB2ZW5kb3IsCiAgICAgICAgICAgICdncHVwcm9kdWN0JzogcHJvZHVjdCwKICAgICAgICAgICAgJ2dwdWNvbG91cic6IGNvbG91ckRlcHRoLAogICAgICAgICAgICAnZ3B1aHJlcyc6IGhSZXMsCiAgICAgICAgICAgICdncHV2cmVzJzogdlJlcwogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0dQVSBpbmZvIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBHUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogJ05vIGRhdGEgZm91bmQnLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdWNvbG91cic6IC0xLAogICAgICAgICAgICAnZ3B1aHJlcyc6IC0xLAogICAgICAgICAgICAnZ3B1dnJlcyc6IC0xCiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1hbnVmYWN0dXJlciIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQ29tcHV0ZXJTeXN0ZW1Qcm9kdWN0KS5WZW5kb3IiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtYW51ZmFjdHVyZXIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gbWFudWZhY3R1cmVyCiAgICAgICAgbG9nZ2VyLmluZm8oZidNYW51ZmFjdHVyZXI6IHttYW51ZmFjdHVyZXJ9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG1hbnVmYWN0dXJlcjoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWFudWZhY3R1cmVyJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRPc0xhbmcoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IE9TIGxhbmd1YWdlIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLk1VSUxhbmd1YWdlcyIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQogICAgICAgIG9zTGFuZyA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSBvc0xhbmcKICAgICAgICBsb2dnZXIuaW5mbyhmJ09TIExhbmd1YWdlOiB7b3NMYW5nfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBPUyBsYW5ndWFnZToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBTTUJJT1MgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9TeXN0ZW1FbmNsb3N1cmUpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHNtYmlvc19kaWN0ID0ge30KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgJ1NlcmlhbE51bWJlcicgaW4gbGluZToKICAgICAgICAgICAgICAgIHNtYmlvc19kaWN0WydzZXJpYWxOdW1iZXInXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgICAgIGlmICdDaGFzc2lzVHlwZXMnIGluIGxpbmU6CiAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnY2hhc3Npc1R5cGUnXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHNtYmlvc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidTTUJJT1MgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgU01CSU9TIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3NtYmlvcyddID0ge30KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1vZGVsIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9Db21wdXRlclN5c3RlbSkuTW9kZWwiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtb2RlbCA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtTW9kZWwnXSA9IG1vZGVsCiAgICAgICAgbG9nZ2VyLmluZm8oZidTeXN0ZW0gTW9kZWw6IHttb2RlbH0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgc3lzdGVtIG1vZGVsOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW1Nb2RlbCddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHByaW50ZXIgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfUHJpbnRlciB8IFNlbGVjdC1PYmplY3QgTmFtZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBwcmludGVycyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmIGxpbmUuc3RyaXAoKSBhbmQgJ05hbWUnIG5vdCBpbiBsaW5lIGFuZCAnLS0tJyBub3QgaW4gbGluZToKICAgICAgICAgICAgICAgIHByaW50ZXJzLmFwcGVuZChsaW5lLnN0cmlwKCkpCgogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gcHJpbnRlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1ByaW50ZXJzIGNvbGxlY3RlZDoge2xlbihwcmludGVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHByaW50ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBVU0IgZGV2aWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1VTQkNvbnRyb2xsZXJEZXZpY2UgfCBTZWxlY3QtT2JqZWN0IERlcGVuZGVudCIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB1c2JfZGV2aWNlcyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdXaW4zMl8nIGluIGxpbmU6CiAgICAgICAgICAgICAgICB1c2JfZGV2aWNlcy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXNiRGV2aWNlcyddID0gdXNiX2RldmljZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VTQiBkZXZpY2VzIGNvbGxlY3RlZDoge2xlbih1c2JfZGV2aWNlcyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFVTQiBkZXZpY2VzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wyd1c2JEZXZpY2VzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRyaXZlciBpbmZvcm1hdGlvbiAoV2luZG93cy1zcGVjaWZpYykiIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfU3lzdGVtRHJpdmVyIHwgU2VsZWN0LU9iamVjdCBOYW1lLCBTdGF0ZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBkcml2ZXJzID0gW10KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgbGluZS5zdHJpcCgpIGFuZCAnTmFtZScgbm90IGluIGxpbmUgYW5kICctLS0nIG5vdCBpbiBsaW5lOgogICAgICAgICAgICAgICAgZHJpdmVycy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddID0gZHJpdmVycwogICAgICAgIGxvZ2dlci5pbmZvKGYnRHJpdmVycyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRyaXZlcnM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gRVhFQ1VUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1dpbmRvd3NBdWRpdCBTdGFydGluZy4uLicpCgogICAgIyBTZXR1cCBkaXJlY3RvcmllcwogICAgYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIgPSBnZXRBcHBEaXJzKCkKCiAgICAjIEdldCBkZXZpY2UgVVVJRCBhbmQgaG9zdAogICAgYWdlbnRDb25maWdGaWxlID0gb3MucGF0aC5qb2luKGNvbmZpZ0RpciwgJ2FnZW50LmNvbmZpZycpCiAgICBkZXZpY2VVdWlkLCBob3N0ID0gZ2V0RGV2aWNlVXVpZChhZ2VudENvbmZpZ0ZpbGUpCgogICAgIyBDb2xsZWN0IGFsbCBkYXRhCiAgICBkZXZpY2VEYXRhRGljdCA9IHt9CiAgICBkZXZpY2VEYXRhRGljdCA9IGdldERldmljZURhdGEoZGV2aWNlRGF0YURpY3QsIGRldmljZVV1aWQpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFN5c3RlbURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVzZXJEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVcHRpbWVEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRCYXR0ZXJ5RGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0TWVtb3J5RGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0TWFudWZhY3R1cmVyKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRPc0xhbmcoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldENwdUluZm8oZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldEdwdUluZm8oZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFNtQmlvc0luZm8oZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFN5c3RlbU1vZGVsKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRQcmludGVycyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXNiRGV2aWNlcyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0UGFydGl0aW9uRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RHJpdmVycyhkZXZpY2VEYXRhRGljdCkKCiAgICAjIFVwZGF0ZSBkZXZpY2UgVVVJRCBpbiBwYXlsb2FkCiAgICBkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ11bJ2RldmljZVV1aWQnXSA9IGRldmljZVV1aWQKCiAgICAjIFNlbmQgcGF5bG9hZAogICAgcm91dGUgPSAnL3BheWxvYWQvc2VuZGF1ZGl0JwogICAgcGF5bG9hZCA9IHsnZGF0YSc6IGRldmljZURhdGFEaWN0fQoKICAgIGlmIGRlYnVnTW9kZToKICAgICAgICBsb2dnZXIuaW5mbyhmJ1BheWxvYWQ6IHtqc29uLmR1bXBzKHBheWxvYWQsIGluZGVudD0yLCBkZWZhdWx0PXN0cil9JykKCiAgICByZXNwb25zZSA9IHNlbmRKc29uUGF5bG9hZEZsYXNrKHBheWxvYWQsIHJvdXRlLCBob3N0LCBkZWJ1Z01vZGUpCiAgICBsb2dnZXIuaW5mbyhmJ1NlcnZlciByZXNwb25zZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSB8IHtyZXNwb25zZS50ZXh0fScpCgo="
  }
}