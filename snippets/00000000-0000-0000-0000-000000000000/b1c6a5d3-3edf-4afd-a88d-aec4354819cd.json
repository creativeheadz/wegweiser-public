{"settings": {"snippetUuid": "b1c6a5d3-3edf-4afd-a88d-aec4354819cd", "snippetname": "WindowsAudit", "snippettype": ".py", "created_at": 1763045669}, "payload": {"payloadsig": "I247nNbF6DqlTPTTt5cv6hCXv+4qc2l+xtoglOOciBYyDd2ubYejA7sjC5SJtkxuSS6PO+sGHMxL5EeQg5vzQjBUop2kwtPEpZ9bm6zTXmlYSql4GyAdOPPlyNJ0Qk8bniBclardliTu+pNGxpM52JeiTWsS7BYh7bNwnf2avtlK8p6k8cWYXtvyRjB7v4mr6O5IKZnUwb9/G0gWiVMsYtSgUFKGUncGqX18mvz4dWpzJjjh9Lya+r9vVUWIrGzHC5oI0ZCDoCDc3DU9vbHSv2kXTVB3YfoLTYQMoLpoYL+KNW+VfYBJqb8s2xZq8tyIOAXFwzcDOTvYcUU6HhH4PgXm1K4op80MlxZEsFf7D/KgZ1dc7vV9DGIwh3N2wy4F0UlFTjwb7GZSw3b6VOXJ+g5AbUf2xjRYylnGv5BNPN6GVq8iPVu14MOZ3j90laps26h2/KAzeu5jwu2JG2pvdMa5Qr4rMhZ5kQf0qzstGuaLbgnGgHZNEJewaNDt/XxKxlyznjz/JgFPZupyaDDgbbA3j5V0oBLBCfxKmEYOxxPIR5fHbcJB/cJgrouBvlxuQTnWA5KUrGuK2U7mZDdJsSNgJmogz4taCptAFDKRAyWAtVct/KUQ9UhSgE44ygSf3Vfvwp8dRQB7Q8/a/aVpAPVf8ccwSjBJbfGmz1q8IFg=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvV2luZG93c0F1ZGl0LnB5CiIiIgpXaW5kb3dzLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyCkNvbGxlY3RzIGNvbXByZWhlbnNpdmUgc3lzdGVtIGluZm9ybWF0aW9uIHVzaW5nIHBzdXRpbCBhbmQgV2luZG93cy1zcGVjaWZpYyB0b29scwpTZWxmLWNvbnRhaW5lZCBzbmlwcGV0IHdpdGggYWxsIHV0aWxpdGllcyBpbmxpbmVkLgoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IHV1aWQKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBtYXRoCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgp0cnk6CiAgICBpbXBvcnQgd2luMzJhcGkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLmluZm8oJ0luc3RhbGxpbmcgcHlwaXdpbjMyLi4uJykKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKICAgIGltcG9ydCB3aW4zMmFwaQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBJTkxJTkVEIFVUSUxJVElFUyAoZnJvbSBBdWRpdENvbW1vbikgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGNvbnZlcnRTaXplKHNpemVCeXRlcyk6CiAgICAiIiJDb252ZXJ0IGJ5dGVzIHRvIGh1bWFuLXJlYWRhYmxlIGZvcm1hdCIiIgogICAgaWYgc2l6ZUJ5dGVzID09IDA6CiAgICAgICAgcmV0dXJuICIwIEIiCiAgICBzaXplTmFtZSA9ICgiQiIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIsICJaQiIsICJZQiIpCiAgICBpID0gaW50KG1hdGguZmxvb3IobWF0aC5sb2coc2l6ZUJ5dGVzLCAxMDI0KSkpCiAgICBwID0gbWF0aC5wb3coMTAyNCwgaSkKICAgIHMgPSByb3VuZChzaXplQnl0ZXMgLyBwLCAyKQogICAgcmV0dXJuIGYne3N9IHtzaXplTmFtZVtpXX0nCgpkZWYgc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgZW5kcG9pbnQsIGhvc3QsIGRlYnVnTW9kZT1GYWxzZSk6CiAgICAiIiJTZW5kIEpTT04gcGF5bG9hZCB0byBGbGFzayBlbmRwb2ludCIiIgogICAgdXJsID0gZidodHRwczovL3tob3N0fXtlbmRwb2ludH0nCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmRlYnVnKGYncGF5bG9hZCB0byBzZW5kOiB7cGF5bG9hZH0nKQogICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCiAgICBoZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhwYXlsb2FkKSkKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGdldFB1YmxpY0lwQWRkcigpOgogICAgIiIiR2V0IHB1YmxpYyBJUCBhZGRyZXNzIiIiCiAgICBvZERuc1NlcnZlciA9ICcyMDguNjcuMjIyLjIyMicKICAgIGh0dHBEbnNTZXJ2ZXIgPSAnaHR0cHM6Ly9pY2FuaGF6aXAuY29tJwogICAgZG5zUmVzb2x2ZXIgPSBkbnMucmVzb2x2ZXIuUmVzb2x2ZXIoKQogICAgZG5zUmVzb2x2ZXIubmFtZXNlcnZlcnMgPSBbb2REbnNTZXJ2ZXJdCiAgICBwdWJsaWNJcCA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgYW5zd2VycyA9IGRuc1Jlc29sdmVyLnJlc29sdmUoJ215aXAub3BlbmRucy5jb20nLCAnQScpCiAgICAgICAgZm9yIGlwIGluIGFuc3dlcnM6CiAgICAgICAgICAgIHB1YmxpY0lwID0gaXAudG9fdGV4dCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtvZERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KGh0dHBEbnNTZXJ2ZXIpCiAgICAgICAgICAgIHB1YmxpY0lwID0gci50ZXh0LnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgcHVibGljSVAgZnJvbSB7aHR0cERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgcHVibGljSXAgPSAnMC4wLjAuMCcKCiAgICByZXR1cm4gcHVibGljSXAKCmRlZiBnZXRVc2VySG9tZVBhdGgoKToKICAgICIiIkdldCB1c2VyIGhvbWUgZGlyZWN0b3J5IHBhdGgiIiIKICAgIHVzZXJIb21lUGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcigifiIpCiAgICBsb2dnZXIuaW5mbyhmJ3VzZXJIb21lUGF0aDoge3VzZXJIb21lUGF0aH0nKQogICAgcmV0dXJuIHVzZXJIb21lUGF0aAoKZGVmIGdldERldmljZVV1aWQoY29uZmlnRmlsZSk6CiAgICAiIiJHZXQgZGV2aWNlIFVVSUQgZnJvbSBjb25maWcgZmlsZSIiIgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQge2NvbmZpZ0ZpbGV9JykKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oY29uZmlnRmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikKICAgICAgICBkZXZpY2VVdWlkID0gY29uZmlnLmdldCgnZGV2aWNldXVpZCcpCiAgICAgICAgaG9zdCA9IGNvbmZpZy5nZXQoJ3NlcnZlckFkZHInLCAnYXBwLndlZ3dlaXNlci50ZWNoJykKICAgICAgICBpZiBub3QgZGV2aWNlVXVpZDoKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdkZXZpY2V1dWlkIG5vdCBmb3VuZCBpbiBjb25maWcgZmlsZS4nKQogICAgICAgICAgICByZXR1cm4gTm9uZSwgaG9zdAogICAgICAgIHRyeToKICAgICAgICAgICAgdXVpZC5VVUlEKHN0cihkZXZpY2VVdWlkKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidJbnZhbGlkIGRldmljZXV1aWQgZm9ybWF0IGluIGNvbmZpZzoge2RldmljZVV1aWR9JykKICAgICAgICAgICAgcmV0dXJuIE5vbmUsIGhvc3QKICAgICAgICBsb2dnZXIuaW5mbyhmJ2RldmljZVV1aWQ6IHtkZXZpY2VVdWlkfScpCiAgICAgICAgcmV0dXJuIGRldmljZVV1aWQsIGhvc3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gcmVhZCBjb25maWcgZmlsZToge2V9JykKICAgICAgICByZXR1cm4gTm9uZSwgJ2FwcC53ZWd3ZWlzZXIudGVjaCcKCmRlZiBnZXRBcHBEaXJzKCk6CiAgICAiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMiIiIKICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKICAgICAgICBhcHBEaXIgPSByJ2M6XHByb2dyYW0gZmlsZXMgKHg4NilcV2Vnd2Vpc2VyJwogICAgICAgIGxvZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdMb2dzJykKICAgICAgICBjb25maWdEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnQ29uZmlnJykKICAgICAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ1RlbXAnKQogICAgICAgIGZpbGVzRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ0ZpbGVzJykKICAgIGVsc2U6CiAgICAgICAgIyBGYWxsYmFjayBmb3Igbm9uLVdpbmRvd3Mgb3IgZGV2IGVudmlyb25tZW50cwogICAgICAgIHVzZXJIb21lUGF0aCA9IGdldFVzZXJIb21lUGF0aCgpCiAgICAgICAgYXBwRGlyID0gb3MucGF0aC5qb2luKHVzZXJIb21lUGF0aCwgJy53ZWd3ZWlzZXInKQogICAgICAgIGxvZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdsb2dzJykKICAgICAgICBjb25maWdEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnY29uZmlnJykKICAgICAgICB0ZW1wRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ3RlbXAnKQogICAgICAgIGZpbGVzRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2ZpbGVzJykKCiAgICBmb3IgZGlyZWN0b3J5IGluIFthcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0Rpcl06CiAgICAgICAgb3MubWFrZWRpcnMoZGlyZWN0b3J5LCBleGlzdF9vaz1UcnVlKQoKICAgIGxvZ2dlci5pbmZvKGYnYXBwRGlyOiB7YXBwRGlyfScpCiAgICByZXR1cm4gYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIKCmRlZiBkZWxGaWxlKGZpbGVUb0RlbGV0ZSk6CiAgICAiIiJEZWxldGUgYSBmaWxlIiIiCiAgICBsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9Li4uJykKICAgIHRyeToKICAgICAgICBvcy5yZW1vdmUoZmlsZVRvRGVsZXRlKQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGRlbGV0ZWQge2ZpbGVUb0RlbGV0ZX0uJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9LiBSZWFzb246IHtlfScpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIElOTElORUQgUFNVVElMIE1FVFJJQ1MgKGZyb20gUHN1dGlsTWV0cmljcykgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIGNwdV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBDb3JlIGluZm9ybWF0aW9uCiAgICAgICAgY3B1X21ldHJpY3NbJ2NvcmVzX2xvZ2ljYWwnXSA9IHBzdXRpbC5jcHVfY291bnQobG9naWNhbD1UcnVlKQogICAgICAgIGNwdV9tZXRyaWNzWydjb3Jlc19waHlzaWNhbCddID0gcHN1dGlsLmNwdV9jb3VudChsb2dpY2FsPUZhbHNlKQoKICAgICAgICAjIEZyZXF1ZW5jeSBpbmZvcm1hdGlvbgogICAgICAgIHRyeToKICAgICAgICAgICAgZnJlcSA9IHBzdXRpbC5jcHVfZnJlcSgpCiAgICAgICAgICAgIGlmIGZyZXE6CiAgICAgICAgICAgICAgICBjcHVfbWV0cmljc1snZnJlcXVlbmN5X2N1cnJlbnQnXSA9IHJvdW5kKGZyZXEuY3VycmVudCwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWluJ10gPSByb3VuZChmcmVxLm1pbiwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWF4J10gPSByb3VuZChmcmVxLm1heCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgQ1BVIGZyZXF1ZW5jeToge2V9JykKCiAgICAgICAgIyBQZXItQ1BVIHVzYWdlIHBlcmNlbnRhZ2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNwdV9wZXJjZW50ID0gcHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTEsIHBlcmNwdT1UcnVlKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnQnXSA9IFtyb3VuZChwLCAyKSBmb3IgcCBpbiBjcHVfcGVyY2VudF0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgcGVyLUNQVSBwZXJjZW50OiB7ZX0nKQoKICAgICAgICAjIE92ZXJhbGwgQ1BVIHVzYWdlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnRfb3ZlcmFsbCddID0gcm91bmQocHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTAuMSksIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IG92ZXJhbGwgQ1BVIHBlcmNlbnQ6IHtlfScpCgogICAgICAgICMgQ1BVIHRpbWVzICh1c2VyLCBzeXN0ZW0sIGlkbGUsIGlvd2FpdCwgaXJxLCBzb2Z0aXJxKQogICAgICAgIHRyeToKICAgICAgICAgICAgdGltZXMgPSBwc3V0aWwuY3B1X3RpbWVzKCkKICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2NwdV90aW1lcyddID0gewogICAgICAgICAgICAgICAgJ3VzZXInOiByb3VuZCh0aW1lcy51c2VyLCAyKSwKICAgICAgICAgICAgICAgICdzeXN0ZW0nOiByb3VuZCh0aW1lcy5zeXN0ZW0sIDIpLAogICAgICAgICAgICAgICAgJ2lkbGUnOiByb3VuZCh0aW1lcy5pZGxlLCAyKSwKICAgICAgICAgICAgICAgICdpb3dhaXQnOiByb3VuZCh0aW1lcy5pb3dhaXQsIDIpIGlmIGhhc2F0dHIodGltZXMsICdpb3dhaXQnKSBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAnaXJxJzogcm91bmQodGltZXMuaXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnaXJxJykgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgJ3NvZnRpcnEnOiByb3VuZCh0aW1lcy5zb2Z0aXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnc29mdGlycScpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgdGltZXM6IHtlfScpCgogICAgICAgICMgQ1BVIHN0YXRpc3RpY3MgKGNvbnRleHQgc3dpdGNoZXMsIGludGVycnVwdHMpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdGF0cyA9IHBzdXRpbC5jcHVfc3RhdHMoKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3N0YXRzJ10gPSB7CiAgICAgICAgICAgICAgICAnY3R4X3N3aXRjaGVzJzogc3RhdHMuY3R4X3N3aXRjaGVzLAogICAgICAgICAgICAgICAgJ2ludGVycnVwdHMnOiBzdGF0cy5pbnRlcnJ1cHRzLAogICAgICAgICAgICAgICAgJ3NvZnRfaW50ZXJydXB0cyc6IHN0YXRzLnNvZnRfaW50ZXJydXB0cywKICAgICAgICAgICAgICAgICdzeXNjYWxscyc6IHN0YXRzLnN5c2NhbGxzIGlmIGhhc2F0dHIoc3RhdHMsICdzeXNjYWxscycpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgc3RhdHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIENQVSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gY3B1X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIENQVSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKZGVmIGdldE1lbW9yeU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIG1lbW9yeSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIG1lbW9yeV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBWaXJ0dWFsIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ2J1ZmZlcnMnXSA9IHZtZW0uYnVmZmVycyBpZiBoYXNhdHRyKHZtZW0sICdidWZmZXJzJykgZWxzZSBOb25lCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydjYWNoZWQnXSA9IHZtZW0uY2FjaGVkIGlmIGhhc2F0dHIodm1lbSwgJ2NhY2hlZCcpIGVsc2UgTm9uZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc2hhcmVkJ10gPSB2bWVtLnNoYXJlZCBpZiBoYXNhdHRyKHZtZW0sICdzaGFyZWQnKSBlbHNlIE5vbmUKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3BlcmNlbnQnXSA9IHJvdW5kKHZtZW0ucGVyY2VudCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgdmlydHVhbCBtZW1vcnkgZGV0YWlsczoge2V9JykKCiAgICAgICAgIyBTd2FwIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzd2FwID0gcHN1dGlsLnN3YXBfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdG90YWwnXSA9IHN3YXAudG90YWwKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdXNlZCddID0gc3dhcC51c2VkCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzd2FwX2ZyZWUnXSA9IHN3YXAuZnJlZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF9wZXJjZW50J10gPSByb3VuZChzd2FwLnBlcmNlbnQsIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IHN3YXAgbWVtb3J5IGRldGFpbHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIG1lbW9yeSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gbWVtb3J5X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIG1lbW9yeSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBDT05GSUdVUkFUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlYnVnTW9kZSA9IFRydWUKaG9zdCA9ICdhcHAud2Vnd2Vpc2VyLnRlY2gnCnBvcnQgPSA0NDMKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBDUFUgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICAjIEdldCBDUFUgbmFtZSBmcm9tIFdNSQogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfUHJvY2Vzc29yKS5OYW1lIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgY3B1TmFtZSA9ICcgJy5qb2luKHJlc3VsdC5zdGRvdXQuc3BsaXQoKSkgaWYgcmVzdWx0LnN0ZG91dCBlbHNlICdVbmtub3duJwogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYnY3B1TmFtZToge2NwdU5hbWV9JykKICAgICAgICAKICAgICAgICAjIEdldCBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzCiAgICAgICAgY3B1X21ldHJpY3MgPSBnZXRDcHVNZXRyaWNzKCkKICAgICAgICAKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogY3B1TmFtZSwKICAgICAgICAgICAgJ2NwdV9tZXRyaWNzJzogY3B1X21ldHJpY3MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBDUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogJ1Vua25vd24nLAogICAgICAgICAgICAnY3B1X21ldHJpY3MnOiB7fQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBtZW1vcnkgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAKICAgICAgICAjIEJhc2ljIG1lbW9yeSBpbmZvCiAgICAgICAgdG90YWxNZW1vcnkgPSB2bWVtLnRvdGFsCiAgICAgICAgYXZhaWxhYmxlTWVtb3J5ID0gdm1lbS5hdmFpbGFibGUKICAgICAgICB1c2VkTWVtb3J5ID0gdm1lbS51c2VkCiAgICAgICAgZnJlZU1lbW9yeSA9IHZtZW0uZnJlZQogICAgICAgIAogICAgICAgICMgR2V0IGNvbXByZWhlbnNpdmUgbWVtb3J5IG1ldHJpY3MKICAgICAgICBtZW1vcnlfbWV0cmljcyA9IGdldE1lbW9yeU1ldHJpY3MoKQogICAgICAgIAogICAgICAgIGRldmljZURhdGFEaWN0WydtZW1vcnknXSA9IHsKICAgICAgICAgICAgJ3RvdGFsJzogdG90YWxNZW1vcnksCiAgICAgICAgICAgICdhdmFpbGFibGUnOiBhdmFpbGFibGVNZW1vcnksCiAgICAgICAgICAgICd1c2VkJzogdXNlZE1lbW9yeSwKICAgICAgICAgICAgJ2ZyZWUnOiBmcmVlTWVtb3J5LAogICAgICAgICAgICAnbWVtb3J5X21ldHJpY3MnOiBtZW1vcnlfbWV0cmljcwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmJ01lbW9yeToge2NvbnZlcnRTaXplKHRvdGFsTWVtb3J5KX0gdG90YWwnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbWVtb3J5IGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewogICAgICAgICAgICAndG90YWwnOiAwLAogICAgICAgICAgICAnYXZhaWxhYmxlJzogMCwKICAgICAgICAgICAgJ3VzZWQnOiAwLAogICAgICAgICAgICAnZnJlZSc6IDAsCiAgICAgICAgICAgICdtZW1vcnlfbWV0cmljcyc6IHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFN5c3RlbURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW0nXSA9IHsKICAgICAgICAgICAgJ2RldmljZVBsYXRmb3JtJzogcGxhdGZvcm0uc3lzdGVtKCksCiAgICAgICAgICAgICdzeXN0ZW1OYW1lJzogc29ja2V0LmdldGhvc3RuYW1lKCksCiAgICAgICAgICAgICdjdXJyZW50VXNlcic6IGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICAgICAnY3B1VXNhZ2UnOiBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSksCiAgICAgICAgICAgICdjcHVDb3VudCc6IHBzdXRpbC5jcHVfY291bnQoKSwKICAgICAgICAgICAgJ2Jvb3RUaW1lJzogcHN1dGlsLmJvb3RfdGltZSgpLAogICAgICAgICAgICAncHVibGljSXAnOiBnZXRQdWJsaWNJcEFkZHIoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ1N5c3RlbSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBzeXN0ZW0gZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRpc2sgc3RhdGlzdGljcyIiIgogICAgdHJ5OgogICAgICAgIGRyaXZlcyA9IFtdCiAgICAgICAgZm9yIHBhcnRpdGlvbiBpbiBwc3V0aWwuZGlza19wYXJ0aXRpb25zKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVzYWdlID0gcHN1dGlsLmRpc2tfdXNhZ2UocGFydGl0aW9uLm1vdW50cG9pbnQpCiAgICAgICAgICAgICAgICBkcml2ZXMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IHBhcnRpdGlvbi5kZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsJzogdXNhZ2UudG90YWwsCiAgICAgICAgICAgICAgICAgICAgJ3VzZWQnOiB1c2FnZS51c2VkLAogICAgICAgICAgICAgICAgICAgICdmcmVlJzogdXNhZ2UuZnJlZSwKICAgICAgICAgICAgICAgICAgICAndXNlZFBlcic6IHVzYWdlLnBlcmNlbnQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWVQZXInOiAxMDAgLSB1c2FnZS5wZXJjZW50CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnUGVybWlzc2lvbiBkZW5pZWQgZm9yIHtwYXJ0aXRpb24ubW91bnRwb2ludH0nKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVzJ10gPSBkcml2ZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ0Rpc2sgc3RhdHMgY29sbGVjdGVkOiB7bGVuKGRyaXZlcyl9IGRyaXZlcycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkaXNrIHN0YXRzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IG5ldHdvcmsgaW50ZXJmYWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgbmV0d29ya0xpc3QgPSBbXQogICAgICAgIG5ldF9pZl9zdGF0cyA9IHBzdXRpbC5uZXRfaWZfc3RhdHMoKQogICAgICAgIG5ldF9pbyA9IHBzdXRpbC5uZXRfaW9fY291bnRlcnMocGVybmljPVRydWUpCiAgICAgICAgZm9yIGludGVyZmFjZV9uYW1lLCBpbnRlcmZhY2VfYWRkcnMgaW4gcHN1dGlsLm5ldF9pZl9hZGRycygpLml0ZW1zKCk6CiAgICAgICAgICAgIHN0YXRzID0gbmV0X2lmX3N0YXRzLmdldChpbnRlcmZhY2VfbmFtZSkKICAgICAgICAgICAgaWYgbm90IHN0YXRzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWZhY2UgPSB7CiAgICAgICAgICAgICAgICAnaWZJc1VwJzogc3RhdHMuaXN1cCwKICAgICAgICAgICAgICAgICdpZlNwZWVkJzogc3RhdHMuc3BlZWQsCiAgICAgICAgICAgICAgICAnaWZNdHUnOiBzdGF0cy5tdHUsCiAgICAgICAgICAgICAgICAnYnl0ZXNTZW50JzogMCwKICAgICAgICAgICAgICAgICdieXRlc1JlY3YnOiAwLAogICAgICAgICAgICAgICAgJ2VyckluJzogMCwKICAgICAgICAgICAgICAgICdlcnJPdXQnOiAwLAogICAgICAgICAgICAgICAgJ2FkZHJlc3M0JzogTm9uZSwKICAgICAgICAgICAgICAgICduZXRtYXNrNCc6IE5vbmUsCiAgICAgICAgICAgICAgICAnYnJvYWRjYXN0NCc6IE5vbmUsCiAgICAgICAgICAgICAgICAnYWRkcmVzczYnOiBOb25lLAogICAgICAgICAgICAgICAgJ25ldG1hc2s2JzogTm9uZSwKICAgICAgICAgICAgICAgICdicm9hZGNhc3Q2JzogTm9uZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlvID0gbmV0X2lvLmdldChpbnRlcmZhY2VfbmFtZSkKICAgICAgICAgICAgaWYgaW86CiAgICAgICAgICAgICAgICBpZmFjZVsnYnl0ZXNTZW50J10gPSBpby5ieXRlc19yZWN2CiAgICAgICAgICAgICAgICBpZmFjZVsnYnl0ZXNSZWN2J10gPSBpby5ieXRlc19zZW50CiAgICAgICAgICAgICAgICBpZmFjZVsnZXJySW4nXSA9IGlvLmVycmluCiAgICAgICAgICAgICAgICBpZmFjZVsnZXJyT3V0J10gPSBpby5lcnJvdXQKCiAgICAgICAgICAgIGZvciBhZGRyIGluIGludGVyZmFjZV9hZGRyczoKICAgICAgICAgICAgICAgIGlmIGFkZHIuZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUOgogICAgICAgICAgICAgICAgICAgIGlmYWNlWydhZGRyZXNzNCddID0gYWRkci5hZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgaWZhY2VbJ25ldG1hc2s0J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICBpZmFjZVsnYnJvYWRjYXN0NCddID0gYWRkci5icm9hZGNhc3QKICAgICAgICAgICAgICAgIGVsaWYgYWRkci5mYW1pbHkgPT0gc29ja2V0LkFGX0lORVQ2OgogICAgICAgICAgICAgICAgICAgIGlmYWNlWydhZGRyZXNzNiddID0gYWRkci5hZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgaWZhY2VbJ25ldG1hc2s2J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICBpZmFjZVsnYnJvYWRjYXN0NiddID0gYWRkci5icm9hZGNhc3QKCiAgICAgICAgICAgIG5ldHdvcmtMaXN0LmFwcGVuZCh7aW50ZXJmYWNlX25hbWU6IGlmYWNlfSkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10gPSBuZXR3b3JrTGlzdAogICAgICAgIGxvZ2dlci5pbmZvKGYnTmV0d29yayBkYXRhIGNvbGxlY3RlZDoge2xlbihuZXR3b3JrTGlzdCl9IGludGVyZmFjZXMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbmV0d29yayBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbG9nZ2VkLWluIHVzZXJzIiIiCiAgICB0cnk6CiAgICAgICAgdXNlcnMgPSBbXQogICAgICAgIHVzZXJfZGljdCA9IHt9CiAgICAgICAgZm9yIGlkeCwgdXNlciBpbiBlbnVtZXJhdGUocHN1dGlsLnVzZXJzKCkpOgogICAgICAgICAgICB1c2VyX2RpY3Rbc3RyKGlkeCldID0gewogICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogdXNlci5uYW1lLAogICAgICAgICAgICAgICAgJ3Rlcm1pbmFsJzogdXNlci50ZXJtaW5hbCBvciAnTi9BJywKICAgICAgICAgICAgICAgICdob3N0JzogdXNlci5ob3N0IG9yICdOL0EnLAogICAgICAgICAgICAgICAgJ2xvZ2dlZEluJzogdXNlci5zdGFydGVkLAogICAgICAgICAgICAgICAgJ3BpZCc6IHVzZXIucGlkIG9yIDAKICAgICAgICAgICAgfQogICAgICAgIHVzZXJzLmFwcGVuZCh1c2VyX2RpY3QpCgogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gdXNlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VzZXIgZGF0YSBjb2xsZWN0ZWQ6IHtsZW4odXNlcl9kaWN0KX0gdXNlcnMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXNlciBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRCYXR0ZXJ5RGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgYmF0dGVyeSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGJhdHRlcnkgPSBwc3V0aWwuc2Vuc29yc19iYXR0ZXJ5KCkKICAgICAgICBpZiBiYXR0ZXJ5OgogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAgICAgJ2luc3RhbGxlZCc6IFRydWUsCiAgICAgICAgICAgICAgICAncGNDaGFyZ2VkJzogYmF0dGVyeS5wZXJjZW50LAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogYmF0dGVyeS5zZWNzbGVmdCBpZiBiYXR0ZXJ5LnNlY3NsZWZ0ICE9IHBzdXRpbC5QT1dFUl9USU1FX1VOTElNSVRFRCBlbHNlICdOL0EnLAogICAgICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IGJhdHRlcnkucG93ZXJfcGx1Z2dlZAogICAgICAgICAgICB9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnOiBGYWxzZSwKICAgICAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogJ04vQScsCiAgICAgICAgICAgICAgICAncG93ZXJQbHVnJzogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidCYXR0ZXJ5IGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGJhdHRlcnkgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAnaW5zdGFsbGVkJzogRmFsc2UsCiAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAnc2Vjc0xlZnQnOiAnTi9BJywKICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IFRydWUKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgdXB0aW1lIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgYm9vdF90aW1lID0gcHN1dGlsLmJvb3RfdGltZSgpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3VwdGltZSddID0gewogICAgICAgICAgICAnYm9vdFRpbWUnOiBib290X3RpbWUsCiAgICAgICAgICAgICd1cHRpbWVTZWNvbmRzJzogdGltZS50aW1lKCkgLSBib290X3RpbWUKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidVcHRpbWUgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXB0aW1lIGRhdGE6IHtlfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgY29sbGVjdG9yIHZlcnNpb24gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10gPSB7CiAgICAgICAgICAgICd2ZXJzaW9uJzogJzIuMC4wJywKICAgICAgICAgICAgJ3R5cGUnOiAnV2luZG93c0F1ZGl0JywKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnQ29sbGVjdG9yIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGNvbGxlY3RvciBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERldmljZURhdGEoZGV2aWNlRGF0YURpY3QsIGRldmljZVV1aWQpOgogICAgIiIiR2V0IGJhc2ljIGRldmljZSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXSA9IHsKICAgICAgICAgICAgJ2RldmljZVV1aWQnOiBkZXZpY2VVdWlkLAogICAgICAgICAgICAnc3lzdGVtdGltZSc6IHRpbWUudGltZSgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnRGV2aWNlIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRldmljZSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHBhcnRpdGlvbiBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIHBhcnRpdGlvbnMgPSBbXQogICAgICAgIHBhcnRpdGlvbl9kaWN0ID0ge30KICAgICAgICBmb3IgaWR4LCBwYXJ0aXRpb24gaW4gZW51bWVyYXRlKHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKSk6CiAgICAgICAgICAgIHBhcnRpdGlvbl9kaWN0W3BhcnRpdGlvbi5tb3VudHBvaW50XSA9IHsKICAgICAgICAgICAgICAgICdkZXZpY2UnOiBwYXJ0aXRpb24uZGV2aWNlLAogICAgICAgICAgICAgICAgJ2ZzdHlwZSc6IHBhcnRpdGlvbi5mc3R5cGUKICAgICAgICAgICAgfQogICAgICAgIHBhcnRpdGlvbnMuYXBwZW5kKHBhcnRpdGlvbl9kaWN0KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gcGFydGl0aW9ucwogICAgICAgIGxvZ2dlci5pbmZvKGYnUGFydGl0aW9uIGRhdGEgY29sbGVjdGVkOiB7bGVuKHBhcnRpdGlvbl9kaWN0KX0gcGFydGl0aW9ucycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBwYXJ0aXRpb24gZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBHUFUgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9WaWRlb0NvbnRyb2xsZXIpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHZlbmRvciA9ICdObyBkYXRhIGZvdW5kJwogICAgICAgIHByb2R1Y3QgPSAnTm8gZGF0YSBmb3VuZCcKICAgICAgICBjb2xvdXJEZXB0aCA9IC0xCiAgICAgICAgaFJlcyA9IC0xCiAgICAgICAgdlJlcyA9IC0xCgogICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICBpZiAnVmlkZW9Qcm9jZXNzb3InIGluIGxpbmU6CiAgICAgICAgICAgICAgICBwcm9kdWN0ID0gbGluZS5zcGxpdCgnVmlkZW9Qcm9jZXNzb3InKVsxXS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKICAgICAgICAgICAgaWYgJ1ZpZGVvTW9kZURlc2NyaXB0aW9uJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNvbG91ckRlcHRoID0gbGluZS5zcGxpdCgneCAnKVsyXS5zcGxpdCgnICcpWzBdCiAgICAgICAgICAgICAgICAgICAgY29sb3VyRGVwdGggPSBpbnQoY29sb3VyRGVwdGgpCiAgICAgICAgICAgICAgICAgICAgaFJlcyA9IGxpbmUuc3BsaXQoJzogJylbMV0uc3BsaXQoJyAnKVswXQogICAgICAgICAgICAgICAgICAgIHZSZXMgPSBsaW5lLnNwbGl0KCd4ICcpWzFdLnNwbGl0KCcgJylbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGlmICdBZGFwdGVyREFDVHlwZScgaW4gbGluZToKICAgICAgICAgICAgICAgIHZlbmRvciA9IGxpbmUuc3BsaXQoJ0FkYXB0ZXJEQUNUeXBlJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydncHVpbmZvJ10gPSB7CiAgICAgICAgICAgICdncHV2ZW5kb3InOiB2ZW5kb3IsCiAgICAgICAgICAgICdncHVwcm9kdWN0JzogcHJvZHVjdCwKICAgICAgICAgICAgJ2dwdWNvbG91cic6IGNvbG91ckRlcHRoLAogICAgICAgICAgICAnZ3B1aHJlcyc6IGhSZXMsCiAgICAgICAgICAgICdncHV2cmVzJzogdlJlcwogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0dQVSBpbmZvIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBHUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogJ05vIGRhdGEgZm91bmQnLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdWNvbG91cic6IC0xLAogICAgICAgICAgICAnZ3B1aHJlcyc6IC0xLAogICAgICAgICAgICAnZ3B1dnJlcyc6IC0xCiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1hbnVmYWN0dXJlciIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQ29tcHV0ZXJTeXN0ZW1Qcm9kdWN0KS5WZW5kb3IiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtYW51ZmFjdHVyZXIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gbWFudWZhY3R1cmVyCiAgICAgICAgbG9nZ2VyLmluZm8oZidNYW51ZmFjdHVyZXI6IHttYW51ZmFjdHVyZXJ9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG1hbnVmYWN0dXJlcjoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWFudWZhY3R1cmVyJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRPc0xhbmcoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IE9TIGxhbmd1YWdlIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLk1VSUxhbmd1YWdlcyIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQogICAgICAgIG9zTGFuZyA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSBvc0xhbmcKICAgICAgICBsb2dnZXIuaW5mbyhmJ09TIExhbmd1YWdlOiB7b3NMYW5nfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBPUyBsYW5ndWFnZToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBTTUJJT1MgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9TeXN0ZW1FbmNsb3N1cmUpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHNtYmlvc19kaWN0ID0ge30KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgJ1NlcmlhbE51bWJlcicgaW4gbGluZToKICAgICAgICAgICAgICAgIHNtYmlvc19kaWN0WydzZXJpYWxOdW1iZXInXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgICAgIGlmICdDaGFzc2lzVHlwZXMnIGluIGxpbmU6CiAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnY2hhc3Npc1R5cGUnXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHNtYmlvc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidTTUJJT1MgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgU01CSU9TIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3NtYmlvcyddID0ge30KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1vZGVsIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9Db21wdXRlclN5c3RlbSkuTW9kZWwiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtb2RlbCA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtTW9kZWwnXSA9IG1vZGVsCiAgICAgICAgbG9nZ2VyLmluZm8oZidTeXN0ZW0gTW9kZWw6IHttb2RlbH0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgc3lzdGVtIG1vZGVsOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW1Nb2RlbCddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHByaW50ZXIgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfUHJpbnRlciB8IFNlbGVjdC1PYmplY3QgTmFtZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBwcmludGVycyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmIGxpbmUuc3RyaXAoKSBhbmQgJ05hbWUnIG5vdCBpbiBsaW5lIGFuZCAnLS0tJyBub3QgaW4gbGluZToKICAgICAgICAgICAgICAgIHByaW50ZXJzLmFwcGVuZChsaW5lLnN0cmlwKCkpCgogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gcHJpbnRlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1ByaW50ZXJzIGNvbGxlY3RlZDoge2xlbihwcmludGVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHByaW50ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBVU0IgZGV2aWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1VTQkNvbnRyb2xsZXJEZXZpY2UgfCBTZWxlY3QtT2JqZWN0IERlcGVuZGVudCIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB1c2JfZGV2aWNlcyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdXaW4zMl8nIGluIGxpbmU6CiAgICAgICAgICAgICAgICB1c2JfZGV2aWNlcy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXNiRGV2aWNlcyddID0gdXNiX2RldmljZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VTQiBkZXZpY2VzIGNvbGxlY3RlZDoge2xlbih1c2JfZGV2aWNlcyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFVTQiBkZXZpY2VzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wyd1c2JEZXZpY2VzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRyaXZlciBpbmZvcm1hdGlvbiAoV2luZG93cy1zcGVjaWZpYykiIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfU3lzdGVtRHJpdmVyIHwgU2VsZWN0LU9iamVjdCBOYW1lLCBTdGF0ZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBkcml2ZXJzID0gW10KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgbGluZS5zdHJpcCgpIGFuZCAnTmFtZScgbm90IGluIGxpbmUgYW5kICctLS0nIG5vdCBpbiBsaW5lOgogICAgICAgICAgICAgICAgZHJpdmVycy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddID0gZHJpdmVycwogICAgICAgIGxvZ2dlci5pbmZvKGYnRHJpdmVycyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRyaXZlcnM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gRVhFQ1VUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1dpbmRvd3NBdWRpdCBTdGFydGluZy4uLicpCgogICAgIyBTZXR1cCBkaXJlY3RvcmllcwogICAgYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIgPSBnZXRBcHBEaXJzKCkKCiAgICAjIEdldCBkZXZpY2UgVVVJRCBhbmQgaG9zdAogICAgYWdlbnRDb25maWdGaWxlID0gb3MucGF0aC5qb2luKGNvbmZpZ0RpciwgJ2FnZW50LmNvbmZpZycpCiAgICBkZXZpY2VVdWlkLCBob3N0ID0gZ2V0RGV2aWNlVXVpZChhZ2VudENvbmZpZ0ZpbGUpCiAgICBpZiBub3QgZGV2aWNlVXVpZDoKICAgICAgICBsb2dnZXIuZXJyb3IoJ01pc3Npbmcgb3IgaW52YWxpZCBkZXZpY2VVdWlkLiBBYm9ydGluZyB1cGxvYWQuJykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgQ29sbGVjdCBhbGwgZGF0YQogICAgZGV2aWNlRGF0YURpY3QgPSB7fQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREZXZpY2VEYXRhKGRldmljZURhdGFEaWN0LCBkZXZpY2VVdWlkKQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTeXN0ZW1EYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE5ldHdvcmtEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0QmF0dGVyeURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE1lbW9yeURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldENvbGxlY3RvckRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVzYkRldmljZXMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpCgogICAgIyBVcGRhdGUgZGV2aWNlIFVVSUQgaW4gcGF5bG9hZAogICAgZGV2aWNlRGF0YURpY3RbJ2RldmljZSddWydkZXZpY2VVdWlkJ10gPSBkZXZpY2VVdWlkCgogICAgIyBTZW5kIHBheWxvYWQKICAgIHJvdXRlID0gJy9wYXlsb2FkL3NlbmRhdWRpdCcKICAgIHBheWxvYWQgPSB7J2RhdGEnOiBkZXZpY2VEYXRhRGljdH0KCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmluZm8oZidQYXlsb2FkOiB7anNvbi5kdW1wcyhwYXlsb2FkLCBpbmRlbnQ9MiwgZGVmYXVsdD1zdHIpfScpCgogICAgcmVzcG9uc2UgPSBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCByb3V0ZSwgaG9zdCwgZGVidWdNb2RlKQogICAgbG9nZ2VyLmluZm8oZidTZXJ2ZXIgcmVzcG9uc2U6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0gfCB7cmVzcG9uc2UudGV4dH0nKQoK"}}