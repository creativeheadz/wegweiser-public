{"settings": {"snippetUuid": "efcad90a-4d09-4b1a-a034-945359179675", "snippetname": "AgentUpdate", "snippettype": ".py", "created_at": 1765138519}, "payload": {"payloadsig": "UHK99/Yj5msgc6IBFTDupoG4UnQXs0PzGf3qlvGJdSTM6NXQC+TMGzolw0NQ3KmdrdpyGF1wA5tVCM14wH8VCHgCfUGQc64mrppnC6Qibd5mugtT3fqrvadkS7CrVqz3oCUnYNZAzGDqlumSdqF0hdgmgnFsyDWW6CKdOQDKusoiZ4yGI2YZfMa8wmpVthe+zSpAyjrakYHrZQrY65u7VRVFCJNWeXQQ+mDFoHThFlVxvhSxsroBhsNWqo3UHGGrPml3EWdgluJkOuhbsTwStEsJ4id9isyqCqEw8rShrFZH5faorQdFqMBnVX2/CkhCEn/sN55a4ElX3VE70aDwNeuOFCOAZBbw/odZTBjS9iIcMb4MILOW76LqmyBlANV1G03h3gZFq8GJFgSSOlSjPyg9DM+056lHdpXwGv9EU081BrN0tqpwVeQ7Qphhpfh9DqLzeBQt9DR1o6qC5b7BWyJTOiNtTkLCf3MYtL6CPVY++1ORRJiEvC2mPX6QEVbRFm/ibiwOnpmb41XhdafoFiyN7Q/7hTNun+JTl8Cq1i+MpCIeZzYurm8krn76kLWZx0+PpF0PwS8QGYZCup5pM6iMo7UbaMEu2DxiDzqi+xJqrQeiRTC5xoAdGxWnVBI6VJomq4d/1kap8gF8Dw7wI1E6gBJkZh3Fgiai9U/1o7c=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvQWdlbnRVcGRhdGUucHkKIyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKQ29tcHJlaGVuc2l2ZSBBZ2VudCBVcGRhdGUgU25pcHBldApTdXBwb3J0cyB1cGRhdGluZyBOQVRTIGFnZW50LCBjbGFzc2ljYWwgYWdlbnQsIG9yIGJvdGgKU3VwcG9ydHMgaW1tZWRpYXRlIGhvdC1yZWxvYWQgb3Igc2NoZWR1bGVkIHJlYm9vdApCYWNrd2FyZCBjb21wYXRpYmxlIHdpdGggdjMuMC4xIGFnZW50cwoiIiIKCmltcG9ydCBoYXNobGliCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHNodXRpbAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAoKaW1wb3J0IHJlcXVlc3RzCmZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgoKZGVmIGxvZ19tZXNzYWdlKG1zZyk6CiAgICAiIiJMb2cgYSBtZXNzYWdlIHdpdGggdGltZXN0YW1wIiIiCiAgICBsb2dnZXIuaW5mbyhmIkFHRU5UX1VQREFURToge21zZ30iKQoKCmRlZiBnZXRfYXBwX2RpcnMoKToKICAgICIiIkdldCBhcHBsaWNhdGlvbiBkaXJlY3RvcmllcyBiYXNlZCBvbiBwbGF0Zm9ybSIiIgogICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgIGlmIHN5c3RlbSA9PSAnV2luZG93cyc6CiAgICAgICAgYXBwX2RpciA9IHIiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxXZWd3ZWlzZXIiCiAgICBlbGlmIHN5c3RlbSA9PSAnRGFyd2luJzogICMgbWFjT1MKICAgICAgICBhcHBfZGlyID0gIi9vcHQvV2Vnd2Vpc2VyIgogICAgZWxzZTogICMgTGludXgKICAgICAgICBhcHBfZGlyID0gIi9vcHQvV2Vnd2Vpc2VyIgoKICAgIGxvZ19kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ0xvZ3MnKQogICAgY29uZmlnX2RpciA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnQ29uZmlnJykKICAgIGFnZW50X2RpciA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnQWdlbnQnKQogICAgYmFja3VwX2RpciA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnLmJhY2t1cCcpCgogICAgcmV0dXJuIGFwcF9kaXIsIGxvZ19kaXIsIGNvbmZpZ19kaXIsIGFnZW50X2RpciwgYmFja3VwX2RpcgoKCmRlZiBnZXRfZGV2aWNlX2NvbmZpZyhjb25maWdfZGlyKToKICAgICIiIlJldHJpZXZlIGRldmljZSBVVUlEIGFuZCBzZXJ2ZXIgYWRkcmVzcyBmcm9tIGNvbmZpZyBmaWxlIiIiCiAgICBjb25maWdfZmlsZSA9IG9zLnBhdGguam9pbihjb25maWdfZGlyLCAnYWdlbnQuY29uZmlnJykKICAgIGxvZ19tZXNzYWdlKGYiUmVhZGluZyBjb25maWcgZnJvbSB7Y29uZmlnX2ZpbGV9IikKCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgIGNvbmZpZ19kaWN0ID0ganNvbi5sb2FkKGYpCiAgICBleGNlcHQgKEZpbGVOb3RGb3VuZEVycm9yLCBqc29uLkpTT05EZWNvZGVFcnJvcikgYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIkVycm9yIHJlYWRpbmcgY29uZmlnOiB7ZX0iKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgZGV2aWNlX3V1aWQgPSBjb25maWdfZGljdC5nZXQoJ2RldmljZXV1aWQnKQogICAgc2VydmVyX2FkZHIgPSBjb25maWdfZGljdC5nZXQoJ3NlcnZlckFkZHInLCAnYXBwLndlZ3dlaXNlci50ZWNoJykKCiAgICByZXR1cm4gZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyCgoKZGVmIGRvd25sb2FkX2FuZF92ZXJpZnkodXJsLCBleHBlY3RlZF9oYXNoLCB0ZW1wX2ZpbGUpOgogICAgIiIiRG93bmxvYWQgdXBkYXRlIHBhY2thZ2UgYW5kIHZlcmlmeSBTSEEyNTYgaGFzaCIiIgogICAgbG9nX21lc3NhZ2UoZiJEb3dubG9hZGluZyB1cGRhdGUgZnJvbSB7dXJsfSIpCgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgdGltZW91dD0zMDAsIHN0cmVhbT1UcnVlKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQoKICAgICAgICAjIFNhdmUgdG8gdGVtcCBmaWxlCiAgICAgICAgd2l0aCBvcGVuKHRlbXBfZmlsZSwgJ3diJykgYXMgZjoKICAgICAgICAgICAgZm9yIGNodW5rIGluIHJlc3BvbnNlLml0ZXJfY29udGVudChjaHVua19zaXplPTgxOTIpOgogICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKCiAgICAgICAgbG9nX21lc3NhZ2UoZiJEb3dubG9hZCBjb21wbGV0ZSwgc2F2ZWQgdG8ge3RlbXBfZmlsZX0iKQoKICAgICAgICAjIFZlcmlmeSBoYXNoCiAgICAgICAgc2hhMjU2X2hhc2ggPSBoYXNobGliLnNoYTI1NigpCiAgICAgICAgd2l0aCBvcGVuKHRlbXBfZmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgZm9yIGJ5dGVfYmxvY2sgaW4gaXRlcihsYW1iZGE6IGYucmVhZCg0MDk2KSwgYiIiKToKICAgICAgICAgICAgICAgIHNoYTI1Nl9oYXNoLnVwZGF0ZShieXRlX2Jsb2NrKQoKICAgICAgICBhY3R1YWxfaGFzaCA9IHNoYTI1Nl9oYXNoLmhleGRpZ2VzdCgpCiAgICAgICAgbG9nX21lc3NhZ2UoZiJFeHBlY3RlZCBoYXNoOiB7ZXhwZWN0ZWRfaGFzaH0iKQogICAgICAgIGxvZ19tZXNzYWdlKGYiQWN0dWFsIGhhc2g6ICAge2FjdHVhbF9oYXNofSIpCgogICAgICAgIGlmIGFjdHVhbF9oYXNoICE9IGV4cGVjdGVkX2hhc2g6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJIYXNoIG1pc21hdGNoISBVcGRhdGUgcGFja2FnZSBtYXkgYmUgY29ycnVwdGVkLiIpCgogICAgICAgIGxvZ19tZXNzYWdlKCJIYXNoIHZlcmlmaWNhdGlvbiBzdWNjZXNzZnVsIikKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJEb3dubG9hZCBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJWZXJpZmljYXRpb24gZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBiYWNrdXBfY3VycmVudF9pbnN0YWxsYXRpb24oYWdlbnRfZGlyLCBiYWNrdXBfZGlyKToKICAgICIiIkJhY2t1cCBjdXJyZW50IGluc3RhbGxhdGlvbiBmb3Igcm9sbGJhY2siIiIKICAgIHRpbWVzdGFtcCA9IGludCh0aW1lLnRpbWUoKSkKICAgIGJhY2t1cF9wYXRoID0gb3MucGF0aC5qb2luKGJhY2t1cF9kaXIsIGYiYWdlbnQtYmFja3VwLXt0aW1lc3RhbXB9IikKCiAgICBsb2dfbWVzc2FnZShmIkNyZWF0aW5nIGJhY2t1cCBhdCB7YmFja3VwX3BhdGh9IikKCiAgICB0cnk6CiAgICAgICAgb3MubWFrZWRpcnMoYmFja3VwX3BhdGgsIGV4aXN0X29rPVRydWUpCgogICAgICAgICMgQ29weSBlbnRpcmUgQWdlbnQgZGlyZWN0b3J5CiAgICAgICAgc2h1dGlsLmNvcHl0cmVlKGFnZW50X2Rpciwgb3MucGF0aC5qb2luKGJhY2t1cF9wYXRoLCAnQWdlbnQnKSwgZGlyc19leGlzdF9vaz1UcnVlKQoKICAgICAgICBsb2dfbWVzc2FnZShmIkJhY2t1cCBjcmVhdGVkIHN1Y2Nlc3NmdWxseSIpCiAgICAgICAgcmV0dXJuIGJhY2t1cF9wYXRoCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiQmFja3VwIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBleHRyYWN0X3VwZGF0ZSh0ZW1wX2ZpbGUsIGluc3RhbGxfZGlyKToKICAgICIiIkV4dHJhY3QgdXBkYXRlIHRhcmJhbGwgdG8gaW5zdGFsbGF0aW9uIGRpcmVjdG9yeSIiIgogICAgbG9nX21lc3NhZ2UoZiJFeHRyYWN0aW5nIHVwZGF0ZSB0byB7aW5zdGFsbF9kaXJ9IikKCiAgICB0cnk6CiAgICAgICAgIyBVc2Ugc3VicHJvY2VzcyB0byBydW4gdGFyIGNvbW1hbmQgKGF2b2lkcyBuZWVkaW5nIHRhcmZpbGUgbW9kdWxlKQogICAgICAgICMgQ3JlYXRlIHBhcmVudCBkaXJlY3RvcnkgaWYgbmVlZGVkCiAgICAgICAgb3MubWFrZWRpcnMoaW5zdGFsbF9kaXIsIGV4aXN0X29rPVRydWUpCgogICAgICAgICMgRXh0cmFjdCB1c2luZyB0YXIgY29tbWFuZAogICAgICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdXaW5kb3dzJzoKICAgICAgICAgICAgIyBXaW5kb3dzOiBhc3N1bWUgdGFyLmV4ZSBpcyBhdmFpbGFibGUgKFdpbmRvd3MgMTArIGhhcyBidWlsdC1pbiB0YXIpCiAgICAgICAgICAgIGNtZCA9IFsndGFyJywgJy14emYnLCB0ZW1wX2ZpbGUsICctQycsIG9zLnBhdGguZGlybmFtZShpbnN0YWxsX2RpcildCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBMaW51eC9tYWNPUwogICAgICAgICAgICBjbWQgPSBbJ3RhcicsICcteHpmJywgdGVtcF9maWxlLCAnLUMnLCBvcy5wYXRoLmRpcm5hbWUoaW5zdGFsbF9kaXIpXQoKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjbWQsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0xMjApCgogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmInRhciBjb21tYW5kIGZhaWxlZDoge3Jlc3VsdC5zdGRlcnJ9IikKCiAgICAgICAgbG9nX21lc3NhZ2UoIkV4dHJhY3Rpb24gY29tcGxldGUiKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiRXh0cmFjdGlvbiBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIHJvbGxiYWNrX2luc3RhbGxhdGlvbihiYWNrdXBfcGF0aCwgYWdlbnRfZGlyKToKICAgICIiIlJvbGxiYWNrIHRvIHByZXZpb3VzIGluc3RhbGxhdGlvbiBmcm9tIGJhY2t1cCIiIgogICAgbG9nX21lc3NhZ2UoZiJSb2xsaW5nIGJhY2sgaW5zdGFsbGF0aW9uIGZyb20ge2JhY2t1cF9wYXRofSIpCgogICAgdHJ5OgogICAgICAgIGJhY2t1cF9hZ2VudCA9IG9zLnBhdGguam9pbihiYWNrdXBfcGF0aCwgJ0FnZW50JykKCiAgICAgICAgIyBSZW1vdmUgY3VycmVudCBpbnN0YWxsYXRpb24KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhhZ2VudF9kaXIpOgogICAgICAgICAgICBzaHV0aWwucm10cmVlKGFnZW50X2RpcikKCiAgICAgICAgIyBSZXN0b3JlIGZyb20gYmFja3VwCiAgICAgICAgc2h1dGlsLmNvcHl0cmVlKGJhY2t1cF9hZ2VudCwgYWdlbnRfZGlyKQoKICAgICAgICBsb2dfbWVzc2FnZSgiUm9sbGJhY2sgc3VjY2Vzc2Z1bCIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJSb2xsYmFjayBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIHJlc3RhcnRfc2VydmljZV9pbW1lZGlhdGUoKToKICAgICIiIlJlc3RhcnQgYWdlbnQgc2VydmljZSBpbW1lZGlhdGVseSB3aXRoIHZlcmlmaWNhdGlvbiBhbmQgZmFsbGJhY2siIiIKICAgIHN5c3RlbSA9IHBsYXRmb3JtLnN5c3RlbSgpCiAgICBsb2dfbWVzc2FnZShmIlJlc3RhcnRpbmcgYWdlbnQgc2VydmljZSBvbiB7c3lzdGVtfSIpCgogICAgdHJ5OgogICAgICAgIGlmIHN5c3RlbSA9PSAiTGludXgiOgogICAgICAgICAgICByZXR1cm4gcmVzdGFydF9saW51eF9zZXJ2aWNlKCkKICAgICAgICBlbGlmIHN5c3RlbSA9PSAiRGFyd2luIjogICMgbWFjT1MKICAgICAgICAgICAgcmV0dXJuIHJlc3RhcnRfbWFjb3Nfc2VydmljZSgpCiAgICAgICAgZWxpZiBzeXN0ZW0gPT0gIldpbmRvd3MiOgogICAgICAgICAgICByZXR1cm4gcmVzdGFydF93aW5kb3dzX3NlcnZpY2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiVW5rbm93biBwbGF0Zm9ybToge3N5c3RlbX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJTZXJ2aWNlIHJlc3RhcnQgZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiByZXN0YXJ0X3dpbmRvd3Nfc2VydmljZSgpOgogICAgIiIiUmVzdGFydCBXaW5kb3dzIHNlcnZpY2Ugd2l0aCB2ZXJpZmljYXRpb24gYW5kIGZhbGxiYWNrIiIiCiAgICBsb2dfbWVzc2FnZSgiQXR0ZW1wdGluZyB0byByZXN0YXJ0IFdpbmRvd3Mgc2VydmljZS4uLiIpCgogICAgIyBTdGVwIDE6IFN0b3AgdGhlIHNlcnZpY2UKICAgIGxvZ19tZXNzYWdlKCJTdG9wcGluZyBXZWd3ZWlzZXJBZ2VudCBzZXJ2aWNlLi4uIikKICAgIHN0b3BfcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJuZXQiLCAic3RvcCIsICJXZWd3ZWlzZXJBZ2VudCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCiAgICBpZiBzdG9wX3Jlc3VsdC5yZXR1cm5jb2RlICE9IDAgYW5kICJub3Qgc3RhcnRlZCIgbm90IGluIHN0b3BfcmVzdWx0LnN0ZGVyci5sb3dlcigpOgogICAgICAgIGxvZ19tZXNzYWdlKGYiU2VydmljZSBzdG9wIHdhcm5pbmc6IHtzdG9wX3Jlc3VsdC5zdGRlcnJ9IikKICAgIHRpbWUuc2xlZXAoMykKCiAgICAjIFN0ZXAgMjogU3RhcnQgdGhlIHNlcnZpY2UKICAgIGxvZ19tZXNzYWdlKCJTdGFydGluZyBXZWd3ZWlzZXJBZ2VudCBzZXJ2aWNlLi4uIikKICAgIHN0YXJ0X3Jlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsibmV0IiwgInN0YXJ0IiwgIldlZ3dlaXNlckFnZW50Il0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCgogICAgaWYgc3RhcnRfcmVzdWx0LnJldHVybmNvZGUgIT0gMDoKICAgICAgICBsb2dfbWVzc2FnZShmIlNlcnZpY2Ugc3RhcnQgZmFpbGVkOiB7c3RhcnRfcmVzdWx0LnN0ZGVycn0iKQogICAgICAgIGxvZ19tZXNzYWdlKCJBdHRlbXB0aW5nIGZhbGxiYWNrIHRvIFRhc2sgU2NoZWR1bGVyLi4uIikKCiAgICAgICAgIyBGYWxsYmFjayAxOiBUcnkgdGFzayBzY2hlZHVsZXIKICAgICAgICB0YXNrX3Jlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsic2NodGFza3MiLCAiL1J1biIsICIvVE4iLCAiV2Vnd2Vpc2VyQWdlbnQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTMwKQogICAgICAgIGlmIHRhc2tfcmVzdWx0LnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgbG9nX21lc3NhZ2UoZiJUYXNrIHNjaGVkdWxlciBmYWxsYmFjayBmYWlsZWQ6IHt0YXNrX3Jlc3VsdC5zdGRlcnJ9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgdGltZS5zbGVlcCg1KQoKICAgICMgU3RlcCAzOiBWZXJpZnkgc2VydmljZSBpcyBhY3R1YWxseSBydW5uaW5nIChwb2xsIGZvciB1cCB0byAzMCBzZWNvbmRzKQogICAgbG9nX21lc3NhZ2UoIlZlcmlmeWluZyBzZXJ2aWNlIHN0YXR1cy4uLiIpCiAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxMCk6ICAjIDEwIGF0dGVtcHRzICogMyBzZWNvbmRzID0gMzAgc2Vjb25kcwogICAgICAgIHRyeToKICAgICAgICAgICAgY2hlY2tfcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJzYyIsICJxdWVyeSIsICJXZWd3ZWlzZXJBZ2VudCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEwKQoKICAgICAgICAgICAgaWYgIlJVTk5JTkciIGluIGNoZWNrX3Jlc3VsdC5zdGRvdXQ6CiAgICAgICAgICAgICAgICBsb2dfbWVzc2FnZShmIk9LOiBTZXJ2aWNlIHZlcmlmaWVkIFJVTk5JTkcgKGF0dGVtcHQge2F0dGVtcHQgKyAxfS8xMCkiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxpZiAiU1RPUFBFRCIgaW4gY2hlY2tfcmVzdWx0LnN0ZG91dDoKICAgICAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiU2VydmljZSBzdGlsbCBTVE9QUEVEIChhdHRlbXB0IHthdHRlbXB0ICsgMX0vMTApLCByZXRyeWluZyBzdGFydC4uLiIpCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbIm5ldCIsICJzdGFydCIsICJXZWd3ZWlzZXJBZ2VudCJdLCBjaGVjaz1GYWxzZSkKCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiU2VydmljZSBxdWVyeSB0aW1lb3V0IChhdHRlbXB0IHthdHRlbXB0ICsgMX0vMTApIikKCiAgICAgICAgaWYgYXR0ZW1wdCA8IDk6ICAjIERvbid0IHNsZWVwIG9uIGxhc3QgYXR0ZW1wdAogICAgICAgICAgICB0aW1lLnNsZWVwKDMpCgogICAgIyBTdGVwIDQ6IElmIHN0aWxsIG5vdCBydW5uaW5nIGFmdGVyIDMwIHNlY29uZHMsIEZBSUwKICAgIGxvZ19tZXNzYWdlKCJDUklUSUNBTDogU2VydmljZSBmYWlsZWQgdG8gc3RhcnQgYWZ0ZXIgMzAgc2Vjb25kcyIpCiAgICBsb2dfbWVzc2FnZSgiVXBkYXRlIG1heSBoYXZlIHN1Y2NlZWRlZCwgYnV0IHNlcnZpY2UgcmVzdGFydCBmYWlsZWQiKQogICAgbG9nX21lc3NhZ2UoIk1hbnVhbCBpbnRlcnZlbnRpb24gcmVxdWlyZWQ6IG5ldCBzdGFydCBXZWd3ZWlzZXJBZ2VudCIpCiAgICByZXR1cm4gRmFsc2UKCgpkZWYgcmVzdGFydF9saW51eF9zZXJ2aWNlKCk6CiAgICAiIiJSZXN0YXJ0IExpbnV4IHN5c3RlbWQgc2VydmljZXMgd2l0aCB2ZXJpZmljYXRpb24iIiIKICAgIGxvZ19tZXNzYWdlKCJSZXN0YXJ0aW5nIExpbnV4IHN5c3RlbWQgc2VydmljZXMuLi4iKQoKICAgIHNlcnZpY2VzID0gWyJ3ZWd3ZWlzZXItYWdlbnQiLCAid2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQiXQogICAgYWxsX3N1Y2Nlc3MgPSBUcnVlCgogICAgZm9yIHNlcnZpY2UgaW4gc2VydmljZXM6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJSZXN0YXJ0aW5nIHtzZXJ2aWNlfS4uLiIpCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJzeXN0ZW1jdGwiLCAicmVzdGFydCIsIHNlcnZpY2VdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCgogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRmFpbGVkIHRvIHJlc3RhcnQge3NlcnZpY2V9OiB7cmVzdWx0LnN0ZGVycn0iKQogICAgICAgICAgICBhbGxfc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMgVmVyaWZ5IGl0J3MgcnVubmluZwogICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBjaGVjayA9IHN1YnByb2Nlc3MucnVuKFsic3lzdGVtY3RsIiwgImlzLWFjdGl2ZSIsIHNlcnZpY2VdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0xMCkKCiAgICAgICAgaWYgY2hlY2suc3Rkb3V0LnN0cmlwKCkgPT0gImFjdGl2ZSI6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiT0s6IHtzZXJ2aWNlfSB2ZXJpZmllZCBhY3RpdmUiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRkFJTDoge3NlcnZpY2V9IG5vdCBhY3RpdmU6IHtjaGVjay5zdGRvdXQuc3RyaXAoKX0iKQogICAgICAgICAgICBhbGxfc3VjY2VzcyA9IEZhbHNlCgogICAgcmV0dXJuIGFsbF9zdWNjZXNzCgoKZGVmIHJlc3RhcnRfbWFjb3Nfc2VydmljZSgpOgogICAgIiIiUmVzdGFydCBtYWNPUyBMYXVuY2hEYWVtb25zIHdpdGggdmVyaWZpY2F0aW9uIiIiCiAgICBsb2dfbWVzc2FnZSgiUmVzdGFydGluZyBtYWNPUyBMYXVuY2hEYWVtb25zLi4uIikKCiAgICBzZXJ2aWNlcyA9IFsKICAgICAgICAidGVjaC53ZWd3ZWlzZXIuYWdlbnQiLAogICAgICAgICJ0ZWNoLndlZ3dlaXNlci5wZXJzaXN0ZW50LWFnZW50IgogICAgXQoKICAgIGFsbF9zdWNjZXNzID0gVHJ1ZQoKICAgIGZvciBzZXJ2aWNlIGluIHNlcnZpY2VzOgogICAgICAgIGxvZ19tZXNzYWdlKGYiUmVzdGFydGluZyB7c2VydmljZX0uLi4iKQoKICAgICAgICAjIFN0b3AKICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImxhdW5jaGN0bCIsICJzdG9wIiwgc2VydmljZV0sIGNoZWNrPUZhbHNlKQogICAgICAgIHRpbWUuc2xlZXAoMikKCiAgICAgICAgIyBTdGFydAogICAgICAgIHN0YXJ0X3Jlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsibGF1bmNoY3RsIiwgInN0YXJ0Iiwgc2VydmljZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCgogICAgICAgIGlmIHN0YXJ0X3Jlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRmFpbGVkIHRvIHN0YXJ0IHtzZXJ2aWNlfToge3N0YXJ0X3Jlc3VsdC5zdGRlcnJ9IikKICAgICAgICAgICAgYWxsX3N1Y2Nlc3MgPSBGYWxzZQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIFZlcmlmeQogICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBjaGVjayA9IHN1YnByb2Nlc3MucnVuKFsibGF1bmNoY3RsIiwgImxpc3QiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MTApCgogICAgICAgIGlmIHNlcnZpY2UgaW4gY2hlY2suc3Rkb3V0OgogICAgICAgICAgICBsb2dfbWVzc2FnZShmIk9LOiB7c2VydmljZX0gdmVyaWZpZWQgcnVubmluZyIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoZiJGQUlMOiB7c2VydmljZX0gbm90IGZvdW5kIGluIGxhdW5jaGN0bCBsaXN0IikKICAgICAgICAgICAgYWxsX3N1Y2Nlc3MgPSBGYWxzZQoKICAgIHJldHVybiBhbGxfc3VjY2VzcwoKCmRlZiBzdGFnZV91cGRhdGVfZm9yX3JlYm9vdCh0ZW1wX2ZpbGUsIGFwcF9kaXIpOgogICAgIiIiU3RhZ2UgdXBkYXRlIGZvciBhcHBsaWNhdGlvbiBhZnRlciBuZXh0IHJlYm9vdCIiIgogICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgIHN0YWdpbmdfZmlsZSA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnc3RhZ2VkLXVwZGF0ZS50YXIuZ3onKQoKICAgIGxvZ19tZXNzYWdlKGYiU3RhZ2luZyB1cGRhdGUgZm9yIHJlYm9vdCBvbiB7c3lzdGVtfSIpCgogICAgdHJ5OgogICAgICAgICMgQ29weSB1cGRhdGUgcGFja2FnZSB0byBzdGFnaW5nIGFyZWEKICAgICAgICBzaHV0aWwuY29weTIodGVtcF9maWxlLCBzdGFnaW5nX2ZpbGUpCiAgICAgICAgbG9nX21lc3NhZ2UoZiJVcGRhdGUgc3RhZ2VkIGF0IHtzdGFnaW5nX2ZpbGV9IikKCiAgICAgICAgaWYgc3lzdGVtID09ICJMaW51eCI6CiAgICAgICAgICAgICMgQ3JlYXRlIG9uZXNob3Qgc3lzdGVtZCBzZXJ2aWNlIHRvIGFwcGx5IG9uIG5leHQgYm9vdAogICAgICAgICAgICB1bml0X2NvbnRlbnQgPSBmIiIiW1VuaXRdCkRlc2NyaXB0aW9uPUFwcGx5IFdlZ3dlaXNlciBBZ2VudCBVcGRhdGUKQWZ0ZXI9bmV0d29yay50YXJnZXQKCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKRXhlY1N0YXJ0PS9iaW4vdGFyIC14emYge3N0YWdpbmdfZmlsZX0gLUMge29zLnBhdGguZGlybmFtZShhcHBfZGlyKX0KRXhlY1N0YXJ0UG9zdD0vYmluL3JtIC1mIHtzdGFnaW5nX2ZpbGV9CkV4ZWNTdGFydFBvc3Q9L2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCB3ZWd3ZWlzZXItcGVyc2lzdGVudC1hZ2VudApSZW1haW5BZnRlckV4aXQ9eWVzCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQKIiIiCiAgICAgICAgICAgIHVuaXRfZmlsZSA9ICcvZXRjL3N5c3RlbWQvc3lzdGVtL3dlZ3dlaXNlci1hcHBseS11cGRhdGUuc2VydmljZScKICAgICAgICAgICAgd2l0aCBvcGVuKHVuaXRfZmlsZSwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZSh1bml0X2NvbnRlbnQpCgogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInN5c3RlbWN0bCIsICJkYWVtb24tcmVsb2FkIl0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsic3lzdGVtY3RsIiwgImVuYWJsZSIsICJ3ZWd3ZWlzZXItYXBwbHktdXBkYXRlLnNlcnZpY2UiXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlN5c3RlbWQgdW5pdCBjcmVhdGVkIGFuZCBlbmFibGVkIikKCiAgICAgICAgZWxpZiBzeXN0ZW0gPT0gIldpbmRvd3MiOgogICAgICAgICAgICAjIENyZWF0ZSBzY2hlZHVsZWQgdGFzayB0byBydW4gb24gc3RhcnR1cAogICAgICAgICAgICAjIEZvciBub3csIGp1c3QgbG9nIHRoYXQgaXQncyBzdGFnZWQgKGNhbiBiZSBlbmhhbmNlZCB3aXRoIHNjaHRhc2tzKQogICAgICAgICAgICBsb2dfbWVzc2FnZSgiVXBkYXRlIHN0YWdlZCBmb3IgbWFudWFsIGFwcGxpY2F0aW9uIGFmdGVyIHJlYm9vdCIpCiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJXaW5kb3dzIHNjaGVkdWxlZCB0YXNrIGNyZWF0aW9uIHdvdWxkIGdvIGhlcmUiKQoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIlN0YWdpbmcgZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCgoKZGVmIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsIHN0YXR1cywgdmVyc2lvbiwgZXJyb3JfbXNnPU5vbmUpOgogICAgIiIiU2VuZCB1cGRhdGUgc3RhdHVzIGJhY2sgdG8gc2VydmVyIiIiCiAgICB0cnk6CiAgICAgICAgdXJsID0gZiJodHRwczovL3tzZXJ2ZXJfYWRkcn0vYXBpL2RldmljZS97ZGV2aWNlX3V1aWR9L3VwZGF0ZS1zdGF0dXMiCiAgICAgICAgcGF5bG9hZCA9IHsKICAgICAgICAgICAgJ3N0YXR1cyc6IHN0YXR1cywKICAgICAgICAgICAgJ3ZlcnNpb24nOiB2ZXJzaW9uLAogICAgICAgICAgICAndGltZXN0YW1wJzogZGF0ZXRpbWUudXRjbm93KCkuaXNvZm9ybWF0KCksCiAgICAgICAgICAgICdlcnJvcl9tZXNzYWdlJzogZXJyb3JfbXNnCiAgICAgICAgfQoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPXBheWxvYWQsIHRpbWVvdXQ9MzApCiAgICAgICAgbG9nX21lc3NhZ2UoZiJTdGF0dXMgc2VudCB0byBzZXJ2ZXI6IHtzdGF0dXN9IikKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJGYWlsZWQgdG8gc2VuZCBzdGF0dXMgdG8gc2VydmVyOiB7ZX0iKQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gRVhFQ1VUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgbWFpbigpOgogICAgIiIiTWFpbiBleGVjdXRpb24gZnVuY3Rpb24iIiIKCiAgICAjIEdldCBhcHBsaWNhdGlvbiBkaXJlY3RvcmllcwogICAgYXBwX2RpciwgbG9nX2RpciwgY29uZmlnX2RpciwgYWdlbnRfZGlyLCBiYWNrdXBfZGlyID0gZ2V0X2FwcF9kaXJzKCkKCiAgICAjIFNldHVwIGxvZ2dpbmcKICAgIG9zLm1ha2VkaXJzKGxvZ19kaXIsIGV4aXN0X29rPVRydWUpCiAgICBsb2dfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKGxvZ19kaXIsICdhZ2VudF91cGRhdGUubG9nJykKICAgIGxvZ2ZpbGUobG9nX2ZpbGVfcGF0aCkKCiAgICBsb2dfbWVzc2FnZSgiPT09IEFnZW50IFVwZGF0ZSBTY3JpcHQgU3RhcnRlZCA9PT0iKQogICAgbG9nX21lc3NhZ2UoZiJQbGF0Zm9ybToge3BsYXRmb3JtLnN5c3RlbSgpfSB7cGxhdGZvcm0ucmVsZWFzZSgpfSIpCgogICAgIyBHZXQgZGV2aWNlIGNvbmZpZ3VyYXRpb24KICAgIGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciA9IGdldF9kZXZpY2VfY29uZmlnKGNvbmZpZ19kaXIpCiAgICBsb2dfbWVzc2FnZShmIkRldmljZSBVVUlEOiB7ZGV2aWNlX3V1aWR9IikKICAgIGxvZ19tZXNzYWdlKGYiU2VydmVyOiB7c2VydmVyX2FkZHJ9IikKCiAgICAjIEdldCBwYXJhbWV0ZXJzIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzIChwYXNzZWQgYnkgYWdlbnQgZXhlY3V0b3IpCiAgICB1cGRhdGVfdmVyc2lvbiA9IG9zLmdldGVudignVVBEQVRFX1ZFUlNJT04nLCAnMy4wLjInKQogICAgdXBkYXRlX3VybCA9IG9zLmdldGVudignVVBEQVRFX1VSTCcsIGYnaHR0cHM6Ly97c2VydmVyX2FkZHJ9L2luc3RhbGxlckZpbGVzL3twbGF0Zm9ybS5zeXN0ZW0oKX0vdXBkYXRlcy9hZ2VudC17dXBkYXRlX3ZlcnNpb259LnRhci5neicpCiAgICB1cGRhdGVfaGFzaCA9IG9zLmdldGVudignVVBEQVRFX0hBU0gnLCAnJykKICAgIGFwcGx5X21vZGUgPSBvcy5nZXRlbnYoJ0FQUExZX01PREUnLCAnaW1tZWRpYXRlJykKICAgIHRhcmdldF9jb21wb25lbnQgPSBvcy5nZXRlbnYoJ1RBUkdFVF9DT01QT05FTlQnLCAnYm90aCcpCgogICAgbG9nX21lc3NhZ2UoZiJVcGRhdGUgdmVyc2lvbjoge3VwZGF0ZV92ZXJzaW9ufSIpCiAgICBsb2dfbWVzc2FnZShmIlVwZGF0ZSBVUkw6IHt1cGRhdGVfdXJsfSIpCiAgICBsb2dfbWVzc2FnZShmIkFwcGx5IG1vZGU6IHthcHBseV9tb2RlfSIpCiAgICBsb2dfbWVzc2FnZShmIlRhcmdldCBjb21wb25lbnQ6IHt0YXJnZXRfY29tcG9uZW50fSIpCgogICAgaWYgbm90IHVwZGF0ZV9oYXNoOgogICAgICAgIGxvZ19tZXNzYWdlKCJFUlJPUjogTm8gdXBkYXRlIGhhc2ggcHJvdmlkZWQsIGNhbm5vdCB2ZXJpZnkgcGFja2FnZSBpbnRlZ3JpdHkiKQogICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ05vIGhhc2ggcHJvdmlkZWQnKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBEb3dubG9hZCB1cGRhdGUgcGFja2FnZQogICAgdGVtcF9maWxlID0gb3MucGF0aC5qb2luKGFwcF9kaXIsICdUZW1wJywgZid1cGRhdGUte3VwZGF0ZV92ZXJzaW9ufS50YXIuZ3onKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5kaXJuYW1lKHRlbXBfZmlsZSksIGV4aXN0X29rPVRydWUpCgogICAgaWYgbm90IGRvd25sb2FkX2FuZF92ZXJpZnkodXBkYXRlX3VybCwgdXBkYXRlX2hhc2gsIHRlbXBfZmlsZSk6CiAgICAgICAgbG9nX21lc3NhZ2UoIkRvd25sb2FkIG9yIHZlcmlmaWNhdGlvbiBmYWlsZWQiKQogICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ0Rvd25sb2FkL3ZlcmlmaWNhdGlvbiBmYWlsZWQnKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBCYWNrdXAgY3VycmVudCBpbnN0YWxsYXRpb24KICAgIGJhY2t1cF9wYXRoID0gYmFja3VwX2N1cnJlbnRfaW5zdGFsbGF0aW9uKGFnZW50X2RpciwgYmFja3VwX2RpcikKICAgIGlmIG5vdCBiYWNrdXBfcGF0aDoKICAgICAgICBsb2dfbWVzc2FnZSgiQmFja3VwIGZhaWxlZCwgYWJvcnRpbmcgdXBkYXRlIikKICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdCYWNrdXAgZmFpbGVkJykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgRXh0cmFjdCB1cGRhdGUKICAgIGlmIG5vdCBleHRyYWN0X3VwZGF0ZSh0ZW1wX2ZpbGUsIGFwcF9kaXIpOgogICAgICAgIGxvZ19tZXNzYWdlKCJFeHRyYWN0aW9uIGZhaWxlZCwgYXR0ZW1wdGluZyByb2xsYmFjayIpCiAgICAgICAgcm9sbGJhY2tfaW5zdGFsbGF0aW9uKGJhY2t1cF9wYXRoLCBhZ2VudF9kaXIpCiAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnRXh0cmFjdGlvbiBmYWlsZWQnKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBBcHBseSB1cGRhdGUgYmFzZWQgb24gbW9kZQogICAgaWYgYXBwbHlfbW9kZSA9PSAnaW1tZWRpYXRlJzoKICAgICAgICBsb2dfbWVzc2FnZSgiQXBwbHlpbmcgdXBkYXRlIGltbWVkaWF0ZWx5IikKCiAgICAgICAgaWYgcmVzdGFydF9zZXJ2aWNlX2ltbWVkaWF0ZSgpOgogICAgICAgICAgICBsb2dfbWVzc2FnZSgiVXBkYXRlIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5IikKICAgICAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ3N1Y2Nlc3MnLCB1cGRhdGVfdmVyc2lvbikKCiAgICAgICAgICAgICMgQ2xlYW4gdXAgdGVtcCBmaWxlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLnJlbW92ZSh0ZW1wX2ZpbGUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlNlcnZpY2UgcmVzdGFydCBmYWlsZWQsIGF0dGVtcHRpbmcgcm9sbGJhY2siKQogICAgICAgICAgICByb2xsYmFja19pbnN0YWxsYXRpb24oYmFja3VwX3BhdGgsIGFnZW50X2RpcikKICAgICAgICAgICAgcmVzdGFydF9zZXJ2aWNlX2ltbWVkaWF0ZSgpICAjIFRyeSB0byByZXN0YXJ0IG9sZCB2ZXJzaW9uCiAgICAgICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ1NlcnZpY2UgcmVzdGFydCBmYWlsZWQnKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGVsaWYgYXBwbHlfbW9kZSA9PSAnc2NoZWR1bGVkX3JlYm9vdCc6CiAgICAgICAgbG9nX21lc3NhZ2UoIlN0YWdpbmcgdXBkYXRlIGZvciByZWJvb3QiKQoKICAgICAgICBpZiBzdGFnZV91cGRhdGVfZm9yX3JlYm9vdCh0ZW1wX2ZpbGUsIGFwcF9kaXIpOgogICAgICAgICAgICBsb2dfbWVzc2FnZSgiVXBkYXRlIHN0YWdlZCBzdWNjZXNzZnVsbHksIHdpbGwgYXBwbHkgb24gbmV4dCByZWJvb3QiKQogICAgICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnc3RhZ2VkJywgdXBkYXRlX3ZlcnNpb24pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlN0YWdpbmcgZmFpbGVkIikKICAgICAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnU3RhZ2luZyBmYWlsZWQnKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGxvZ19tZXNzYWdlKCI9PT0gQWdlbnQgVXBkYXRlIFNjcmlwdCBDb21wbGV0ZWQgPT09IikKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg=="}}