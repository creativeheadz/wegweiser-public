{"settings": {"snippetUuid": "11ad307e-e3c2-415a-8407-a16e029cbfd5", "snippetname": "WindowsAudit", "snippettype": ".py", "created_at": 1763042825}, "payload": {"payloadsig": "OIGkwhBwHJPHHJRo2JBV1+Doxf7qBgEwTrHp7uJvGzNlPVJ/bJmyh2PflMWKAcZa8dW3/RLPrAGtF/ZQMwhP1zjcu9yvCDBQPgKo8LFRg+urwMzlZNMF50ZLtfOrMZg+HSHwNX0qkjOLkGjaD9guFdb80Wofpdt+03mHh162abcY+v93e6cvj/Q4PkmPPlvUHuftqxXS4mhli4cy34Kv44GXII7xisRQOeO1VQWgH++FEnD2xbuEVbd10Vg7bgriJH1ommwovdAeouWlbS80W2AL89Ak5gsY0izKMr7OmBI6SK3MZrtgjxDLW5CxphwJqHss1I8e3QUKqM4Bpd+T4po9KsDB98+0TGM77W2dJGkMNCUdNRMU46gz6V5G8FspQQcbaybxsybO865SwV8SJgipGxnck1db8U/0BUhaQljUGFnpdyjhX7VCJlk7KM02koXRdcUb9bKXdZklqMlnKnen9zuYGrWgcfvts/rJJET29hHzzDotX/f+qxA5wF/gB9pu6YCEqpuY3SXPcKWfV4RZEYL3/Jx+sa5XZXg6/iXpQn03U7xISHR26A42Swmbgj0ySSmXyUVWFkQi4rFGS1qkwkMEISh5b6W2q1r0gUHkBMCQxBCO8wLanXkbFwJIj8MQQOKGA9SeUfWfNT9LrXLr2Sh595FQ9BRzrBWEnmc=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvV2luZG93c0F1ZGl0LnB5CiIiIgpXaW5kb3dzLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyCkNvbGxlY3RzIGNvbXByZWhlbnNpdmUgc3lzdGVtIGluZm9ybWF0aW9uIHVzaW5nIHBzdXRpbCBhbmQgV2luZG93cy1zcGVjaWZpYyB0b29scwpTZWxmLWNvbnRhaW5lZCBzbmlwcGV0IHdpdGggYWxsIHV0aWxpdGllcyBpbmxpbmVkLgoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBtYXRoCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgp0cnk6CiAgICBpbXBvcnQgd2luMzJhcGkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLmluZm8oJ0luc3RhbGxpbmcgcHlwaXdpbjMyLi4uJykKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKICAgIGltcG9ydCB3aW4zMmFwaQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBJTkxJTkVEIFVUSUxJVElFUyAoZnJvbSBBdWRpdENvbW1vbikgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGNvbnZlcnRTaXplKHNpemVCeXRlcyk6CiAgICAiIiJDb252ZXJ0IGJ5dGVzIHRvIGh1bWFuLXJlYWRhYmxlIGZvcm1hdCIiIgogICAgaWYgc2l6ZUJ5dGVzID09IDA6CiAgICAgICAgcmV0dXJuICIwIEIiCiAgICBzaXplTmFtZSA9ICgiQiIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIsICJaQiIsICJZQiIpCiAgICBpID0gaW50KG1hdGguZmxvb3IobWF0aC5sb2coc2l6ZUJ5dGVzLCAxMDI0KSkpCiAgICBwID0gbWF0aC5wb3coMTAyNCwgaSkKICAgIHMgPSByb3VuZChzaXplQnl0ZXMgLyBwLCAyKQogICAgcmV0dXJuIGYne3N9IHtzaXplTmFtZVtpXX0nCgpkZWYgc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgZW5kcG9pbnQsIGhvc3QsIGRlYnVnTW9kZT1GYWxzZSk6CiAgICAiIiJTZW5kIEpTT04gcGF5bG9hZCB0byBGbGFzayBlbmRwb2ludCIiIgogICAgdXJsID0gZidodHRwczovL3tob3N0fXtlbmRwb2ludH0nCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmRlYnVnKGYncGF5bG9hZCB0byBzZW5kOiB7cGF5bG9hZH0nKQogICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCiAgICBoZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhwYXlsb2FkKSkKICAgIHJldHVybiByZXNwb25zZQoKZGVmIGdldFB1YmxpY0lwQWRkcigpOgogICAgIiIiR2V0IHB1YmxpYyBJUCBhZGRyZXNzIiIiCiAgICBvZERuc1NlcnZlciA9ICcyMDguNjcuMjIyLjIyMicKICAgIGh0dHBEbnNTZXJ2ZXIgPSAnaHR0cHM6Ly9pY2FuaGF6aXAuY29tJwogICAgZG5zUmVzb2x2ZXIgPSBkbnMucmVzb2x2ZXIuUmVzb2x2ZXIoKQogICAgZG5zUmVzb2x2ZXIubmFtZXNlcnZlcnMgPSBbb2REbnNTZXJ2ZXJdCiAgICBwdWJsaWNJcCA9IE5vbmUKCiAgICB0cnk6CiAgICAgICAgYW5zd2VycyA9IGRuc1Jlc29sdmVyLnJlc29sdmUoJ215aXAub3BlbmRucy5jb20nLCAnQScpCiAgICAgICAgZm9yIGlwIGluIGFuc3dlcnM6CiAgICAgICAgICAgIHB1YmxpY0lwID0gaXAudG9fdGV4dCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtvZERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gcmVxdWVzdHMuZ2V0KGh0dHBEbnNTZXJ2ZXIpCiAgICAgICAgICAgIHB1YmxpY0lwID0gci50ZXh0LnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgcHVibGljSVAgZnJvbSB7aHR0cERuc1NlcnZlcn0uIFJlYXNvbjoge2V9JykKCiAgICBpZiBub3QgcHVibGljSXA6CiAgICAgICAgcHVibGljSXAgPSAnMC4wLjAuMCcKCiAgICByZXR1cm4gcHVibGljSXAKCmRlZiBnZXRVc2VySG9tZVBhdGgoKToKICAgICIiIkdldCB1c2VyIGhvbWUgZGlyZWN0b3J5IHBhdGgiIiIKICAgIHVzZXJIb21lUGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcigifiIpCiAgICBsb2dnZXIuaW5mbyhmJ3VzZXJIb21lUGF0aDoge3VzZXJIb21lUGF0aH0nKQogICAgcmV0dXJuIHVzZXJIb21lUGF0aAoKZGVmIGdldERldmljZVV1aWQoY29uZmlnRmlsZSk6CiAgICAiIiJHZXQgZGV2aWNlIFVVSUQgZnJvbSBjb25maWcgZmlsZSIiIgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQge2NvbmZpZ0ZpbGV9JykKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oY29uZmlnRmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgZGV2aWNlVXVpZCA9IGNvbmZpZy5nZXQoJ2RldmljZXV1aWQnKSAgIyBsb3dlcmNhc2UgdG8gbWF0Y2ggY29uZmlnIGZpbGUKICAgICAgICAgICAgaG9zdCA9IGNvbmZpZy5nZXQoJ3NlcnZlckFkZHInLCAnYXBwLndlZ3dlaXNlci50ZWNoJykKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZidkZXZpY2VVdWlkOiB7ZGV2aWNlVXVpZH0nKQogICAgICAgICAgICByZXR1cm4gZGV2aWNlVXVpZCwgaG9zdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byByZWFkIGNvbmZpZyBmaWxlOiB7ZX0nKQogICAgICAgIHJldHVybiBOb25lLCAnYXBwLndlZ3dlaXNlci50ZWNoJwoKZGVmIGdldEFwcERpcnMoKToKICAgICIiIkdldCBhcHBsaWNhdGlvbiBkaXJlY3RvcmllcyIiIgogICAgdXNlckhvbWVQYXRoID0gZ2V0VXNlckhvbWVQYXRoKCkKICAgIGFwcERpciA9IG9zLnBhdGguam9pbih1c2VySG9tZVBhdGgsICcud2Vnd2Vpc2VyJykKICAgIGxvZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdsb2dzJykKICAgIGNvbmZpZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdjb25maWcnKQogICAgdGVtcERpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICd0ZW1wJykKICAgIGZpbGVzRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ2ZpbGVzJykKCiAgICBmb3IgZGlyZWN0b3J5IGluIFthcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0Rpcl06CiAgICAgICAgb3MubWFrZWRpcnMoZGlyZWN0b3J5LCBleGlzdF9vaz1UcnVlKQoKICAgIGxvZ2dlci5pbmZvKGYnYXBwRGlyOiB7YXBwRGlyfScpCiAgICByZXR1cm4gYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIKCmRlZiBkZWxGaWxlKGZpbGVUb0RlbGV0ZSk6CiAgICAiIiJEZWxldGUgYSBmaWxlIiIiCiAgICBsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9Li4uJykKICAgIHRyeToKICAgICAgICBvcy5yZW1vdmUoZmlsZVRvRGVsZXRlKQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGRlbGV0ZWQge2ZpbGVUb0RlbGV0ZX0uJykKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZGVsZXRlIHtmaWxlVG9EZWxldGV9LiBSZWFzb246IHtlfScpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIElOTElORUQgUFNVVElMIE1FVFJJQ1MgKGZyb20gUHN1dGlsTWV0cmljcykgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIGNwdV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBDb3JlIGluZm9ybWF0aW9uCiAgICAgICAgY3B1X21ldHJpY3NbJ2NvcmVzX2xvZ2ljYWwnXSA9IHBzdXRpbC5jcHVfY291bnQobG9naWNhbD1UcnVlKQogICAgICAgIGNwdV9tZXRyaWNzWydjb3Jlc19waHlzaWNhbCddID0gcHN1dGlsLmNwdV9jb3VudChsb2dpY2FsPUZhbHNlKQoKICAgICAgICAjIEZyZXF1ZW5jeSBpbmZvcm1hdGlvbgogICAgICAgIHRyeToKICAgICAgICAgICAgZnJlcSA9IHBzdXRpbC5jcHVfZnJlcSgpCiAgICAgICAgICAgIGlmIGZyZXE6CiAgICAgICAgICAgICAgICBjcHVfbWV0cmljc1snZnJlcXVlbmN5X2N1cnJlbnQnXSA9IHJvdW5kKGZyZXEuY3VycmVudCwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWluJ10gPSByb3VuZChmcmVxLm1pbiwgMikKICAgICAgICAgICAgICAgIGNwdV9tZXRyaWNzWydmcmVxdWVuY3lfbWF4J10gPSByb3VuZChmcmVxLm1heCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgQ1BVIGZyZXF1ZW5jeToge2V9JykKCiAgICAgICAgIyBQZXItQ1BVIHVzYWdlIHBlcmNlbnRhZ2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNwdV9wZXJjZW50ID0gcHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTEsIHBlcmNwdT1UcnVlKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnQnXSA9IFtyb3VuZChwLCAyKSBmb3IgcCBpbiBjcHVfcGVyY2VudF0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgcGVyLUNQVSBwZXJjZW50OiB7ZX0nKQoKICAgICAgICAjIE92ZXJhbGwgQ1BVIHVzYWdlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3BlcmNlbnRfb3ZlcmFsbCddID0gcm91bmQocHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTAuMSksIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IG92ZXJhbGwgQ1BVIHBlcmNlbnQ6IHtlfScpCgogICAgICAgICMgQ1BVIHRpbWVzICh1c2VyLCBzeXN0ZW0sIGlkbGUsIGlvd2FpdCwgaXJxLCBzb2Z0aXJxKQogICAgICAgIHRyeToKICAgICAgICAgICAgdGltZXMgPSBwc3V0aWwuY3B1X3RpbWVzKCkKICAgICAgICAgICAgY3B1X21ldHJpY3NbJ2NwdV90aW1lcyddID0gewogICAgICAgICAgICAgICAgJ3VzZXInOiByb3VuZCh0aW1lcy51c2VyLCAyKSwKICAgICAgICAgICAgICAgICdzeXN0ZW0nOiByb3VuZCh0aW1lcy5zeXN0ZW0sIDIpLAogICAgICAgICAgICAgICAgJ2lkbGUnOiByb3VuZCh0aW1lcy5pZGxlLCAyKSwKICAgICAgICAgICAgICAgICdpb3dhaXQnOiByb3VuZCh0aW1lcy5pb3dhaXQsIDIpIGlmIGhhc2F0dHIodGltZXMsICdpb3dhaXQnKSBlbHNlIE5vbmUsCiAgICAgICAgICAgICAgICAnaXJxJzogcm91bmQodGltZXMuaXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnaXJxJykgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgJ3NvZnRpcnEnOiByb3VuZCh0aW1lcy5zb2Z0aXJxLCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnc29mdGlycScpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgdGltZXM6IHtlfScpCgogICAgICAgICMgQ1BVIHN0YXRpc3RpY3MgKGNvbnRleHQgc3dpdGNoZXMsIGludGVycnVwdHMpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdGF0cyA9IHBzdXRpbC5jcHVfc3RhdHMoKQogICAgICAgICAgICBjcHVfbWV0cmljc1snY3B1X3N0YXRzJ10gPSB7CiAgICAgICAgICAgICAgICAnY3R4X3N3aXRjaGVzJzogc3RhdHMuY3R4X3N3aXRjaGVzLAogICAgICAgICAgICAgICAgJ2ludGVycnVwdHMnOiBzdGF0cy5pbnRlcnJ1cHRzLAogICAgICAgICAgICAgICAgJ3NvZnRfaW50ZXJydXB0cyc6IHN0YXRzLnNvZnRfaW50ZXJydXB0cywKICAgICAgICAgICAgICAgICdzeXNjYWxscyc6IHN0YXRzLnN5c2NhbGxzIGlmIGhhc2F0dHIoc3RhdHMsICdzeXNjYWxscycpIGVsc2UgTm9uZSwKICAgICAgICAgICAgfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBDUFUgc3RhdHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIENQVSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gY3B1X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIENQVSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKZGVmIGdldE1lbW9yeU1ldHJpY3MoKToKICAgICIiIkdhdGhlciBjb21wcmVoZW5zaXZlIG1lbW9yeSBtZXRyaWNzIHVzaW5nIHBzdXRpbCIiIgogICAgdHJ5OgogICAgICAgIG1lbW9yeV9tZXRyaWNzID0ge30KCiAgICAgICAgIyBWaXJ0dWFsIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ2J1ZmZlcnMnXSA9IHZtZW0uYnVmZmVycyBpZiBoYXNhdHRyKHZtZW0sICdidWZmZXJzJykgZWxzZSBOb25lCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydjYWNoZWQnXSA9IHZtZW0uY2FjaGVkIGlmIGhhc2F0dHIodm1lbSwgJ2NhY2hlZCcpIGVsc2UgTm9uZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc2hhcmVkJ10gPSB2bWVtLnNoYXJlZCBpZiBoYXNhdHRyKHZtZW0sICdzaGFyZWQnKSBlbHNlIE5vbmUKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3BlcmNlbnQnXSA9IHJvdW5kKHZtZW0ucGVyY2VudCwgMikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgdmlydHVhbCBtZW1vcnkgZGV0YWlsczoge2V9JykKCiAgICAgICAgIyBTd2FwIG1lbW9yeSBkZXRhaWxzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzd2FwID0gcHN1dGlsLnN3YXBfbWVtb3J5KCkKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdG90YWwnXSA9IHN3YXAudG90YWwKICAgICAgICAgICAgbWVtb3J5X21ldHJpY3NbJ3N3YXBfdXNlZCddID0gc3dhcC51c2VkCiAgICAgICAgICAgIG1lbW9yeV9tZXRyaWNzWydzd2FwX2ZyZWUnXSA9IHN3YXAuZnJlZQogICAgICAgICAgICBtZW1vcnlfbWV0cmljc1snc3dhcF9wZXJjZW50J10gPSByb3VuZChzd2FwLnBlcmNlbnQsIDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IHN3YXAgbWVtb3J5IGRldGFpbHM6IHtlfScpCgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IGdhdGhlcmVkIG1lbW9yeSBtZXRyaWNzJykKICAgICAgICByZXR1cm4gbWVtb3J5X21ldHJpY3MKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2F0aGVyaW5nIG1lbW9yeSBtZXRyaWNzOiB7ZX0nKQogICAgICAgIHJldHVybiB7fQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBDT05GSUdVUkFUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlYnVnTW9kZSA9IFRydWUKaG9zdCA9ICdhcHAud2Vnd2Vpc2VyLnRlY2gnCnBvcnQgPSA0NDMKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBDUFUgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICAjIEdldCBDUFUgbmFtZSBmcm9tIFdNSQogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfUHJvY2Vzc29yKS5OYW1lIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgY3B1TmFtZSA9ICcgJy5qb2luKHJlc3VsdC5zdGRvdXQuc3BsaXQoKSkgaWYgcmVzdWx0LnN0ZG91dCBlbHNlICdVbmtub3duJwogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYnY3B1TmFtZToge2NwdU5hbWV9JykKICAgICAgICAKICAgICAgICAjIEdldCBjb21wcmVoZW5zaXZlIENQVSBtZXRyaWNzCiAgICAgICAgY3B1X21ldHJpY3MgPSBnZXRDcHVNZXRyaWNzKCkKICAgICAgICAKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogY3B1TmFtZSwKICAgICAgICAgICAgJ2NwdV9tZXRyaWNzJzogY3B1X21ldHJpY3MKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBDUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CiAgICAgICAgICAgICdjcHVuYW1lJzogJ1Vua25vd24nLAogICAgICAgICAgICAnY3B1X21ldHJpY3MnOiB7fQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBtZW1vcnkgaW5mb3JtYXRpb24gaW5jbHVkaW5nIGNvbXByZWhlbnNpdmUgcHN1dGlsIG1ldHJpY3MiIiIKICAgIHRyeToKICAgICAgICB2bWVtID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKICAgICAgICAKICAgICAgICAjIEJhc2ljIG1lbW9yeSBpbmZvCiAgICAgICAgdG90YWxNZW1vcnkgPSB2bWVtLnRvdGFsCiAgICAgICAgYXZhaWxhYmxlTWVtb3J5ID0gdm1lbS5hdmFpbGFibGUKICAgICAgICB1c2VkTWVtb3J5ID0gdm1lbS51c2VkCiAgICAgICAgZnJlZU1lbW9yeSA9IHZtZW0uZnJlZQogICAgICAgIAogICAgICAgICMgR2V0IGNvbXByZWhlbnNpdmUgbWVtb3J5IG1ldHJpY3MKICAgICAgICBtZW1vcnlfbWV0cmljcyA9IGdldE1lbW9yeU1ldHJpY3MoKQogICAgICAgIAogICAgICAgIGRldmljZURhdGFEaWN0WydtZW1vcnknXSA9IHsKICAgICAgICAgICAgJ3RvdGFsJzogdG90YWxNZW1vcnksCiAgICAgICAgICAgICdhdmFpbGFibGUnOiBhdmFpbGFibGVNZW1vcnksCiAgICAgICAgICAgICd1c2VkJzogdXNlZE1lbW9yeSwKICAgICAgICAgICAgJ2ZyZWUnOiBmcmVlTWVtb3J5LAogICAgICAgICAgICAnbWVtb3J5X21ldHJpY3MnOiBtZW1vcnlfbWV0cmljcwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmJ01lbW9yeToge2NvbnZlcnRTaXplKHRvdGFsTWVtb3J5KX0gdG90YWwnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbWVtb3J5IGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewogICAgICAgICAgICAndG90YWwnOiAwLAogICAgICAgICAgICAnYXZhaWxhYmxlJzogMCwKICAgICAgICAgICAgJ3VzZWQnOiAwLAogICAgICAgICAgICAnZnJlZSc6IDAsCiAgICAgICAgICAgICdtZW1vcnlfbWV0cmljcyc6IHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFN5c3RlbURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW0nXSA9IHsKICAgICAgICAgICAgJ2RldmljZVBsYXRmb3JtJzogcGxhdGZvcm0uc3lzdGVtKCksCiAgICAgICAgICAgICdzeXN0ZW1OYW1lJzogc29ja2V0LmdldGhvc3RuYW1lKCksCiAgICAgICAgICAgICdjdXJyZW50VXNlcic6IGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICAgICAnY3B1VXNhZ2UnOiBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSksCiAgICAgICAgICAgICdjcHVDb3VudCc6IHBzdXRpbC5jcHVfY291bnQoKSwKICAgICAgICAgICAgJ2Jvb3RUaW1lJzogcHN1dGlsLmJvb3RfdGltZSgpLAogICAgICAgICAgICAncHVibGljSXAnOiBnZXRQdWJsaWNJcEFkZHIoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ1N5c3RlbSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBzeXN0ZW0gZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRpc2sgc3RhdGlzdGljcyIiIgogICAgdHJ5OgogICAgICAgIGRyaXZlcyA9IFtdCiAgICAgICAgZm9yIHBhcnRpdGlvbiBpbiBwc3V0aWwuZGlza19wYXJ0aXRpb25zKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVzYWdlID0gcHN1dGlsLmRpc2tfdXNhZ2UocGFydGl0aW9uLm1vdW50cG9pbnQpCiAgICAgICAgICAgICAgICBkcml2ZXMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IHBhcnRpdGlvbi5kZXZpY2UsCiAgICAgICAgICAgICAgICAgICAgJ3RvdGFsJzogdXNhZ2UudG90YWwsCiAgICAgICAgICAgICAgICAgICAgJ3VzZWQnOiB1c2FnZS51c2VkLAogICAgICAgICAgICAgICAgICAgICdmcmVlJzogdXNhZ2UuZnJlZSwKICAgICAgICAgICAgICAgICAgICAndXNlZFBlcic6IHVzYWdlLnBlcmNlbnQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWVQZXInOiAxMDAgLSB1c2FnZS5wZXJjZW50CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOgogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnUGVybWlzc2lvbiBkZW5pZWQgZm9yIHtwYXJ0aXRpb24ubW91bnRwb2ludH0nKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVzJ10gPSBkcml2ZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ0Rpc2sgc3RhdHMgY29sbGVjdGVkOiB7bGVuKGRyaXZlcyl9IGRyaXZlcycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkaXNrIHN0YXRzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IG5ldHdvcmsgaW50ZXJmYWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgbmV0d29ya0xpc3QgPSBbXQogICAgICAgIGZvciBpbnRlcmZhY2VfbmFtZSwgaW50ZXJmYWNlX2FkZHJzIGluIHBzdXRpbC5uZXRfaWZfYWRkcnMoKS5pdGVtcygpOgogICAgICAgICAgICBuZXRfaWZfc3RhdHMgPSBwc3V0aWwubmV0X2lmX3N0YXRzKCkKICAgICAgICAgICAgaWYgaW50ZXJmYWNlX25hbWUgaW4gbmV0X2lmX3N0YXRzOgogICAgICAgICAgICAgICAgc3RhdHMgPSBuZXRfaWZfc3RhdHNbaW50ZXJmYWNlX25hbWVdCiAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfbmFtZTogewogICAgICAgICAgICAgICAgICAgICAgICAnaWZJc1VwJzogc3RhdHMuaXN1cCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lmU3BlZWQnOiBzdGF0cy5zcGVlZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lmTXR1Jzogc3RhdHMubXR1LAogICAgICAgICAgICAgICAgICAgICAgICAnYnl0ZXNTZW50Jzogc3RhdHMuYnl0ZXNfc2VudCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2J5dGVzUmVjdic6IHN0YXRzLmJ5dGVzX3JlY3YsCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJJbic6IHN0YXRzLmVycmluLAogICAgICAgICAgICAgICAgICAgICAgICAnZXJyT3V0Jzogc3RhdHMuZXJyb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzczQnOiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAnbmV0bWFzazQnOiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAnYnJvYWRjYXN0NCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzNic6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICduZXRtYXNrNic6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdicm9hZGNhc3Q2JzogTm9uZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgYWRkciBpbiBpbnRlcmZhY2VfYWRkcnM6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkci5mYW1pbHkubmFtZSA9PSAnQUZfSU5FVCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYWRkcmVzczQnXSA9IGFkZHIuYWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ25ldG1hc2s0J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydicm9hZGNhc3Q0J10gPSBhZGRyLmJyb2FkY2FzdAogICAgICAgICAgICAgICAgICAgIGVsaWYgYWRkci5mYW1pbHkubmFtZSA9PSAnQUZfSU5FVDYnOgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ2FkZHJlc3M2J10gPSBhZGRyLmFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWyduZXRtYXNrNiddID0gYWRkci5uZXRtYXNrCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYnJvYWRjYXN0NiddID0gYWRkci5icm9hZGNhc3QKCiAgICAgICAgICAgICAgICBuZXR3b3JrTGlzdC5hcHBlbmQoaW50ZXJmYWNlX2RhdGEpCgogICAgICAgIGRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddID0gbmV0d29ya0xpc3QKICAgICAgICBsb2dnZXIuaW5mbyhmJ05ldHdvcmsgZGF0YSBjb2xsZWN0ZWQ6IHtsZW4obmV0d29ya0xpc3QpfSBpbnRlcmZhY2VzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG5ldHdvcmsgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbmV0d29ya0xpc3QnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGxvZ2dlZC1pbiB1c2VycyIiIgogICAgdHJ5OgogICAgICAgIHVzZXJzID0gW10KICAgICAgICB1c2VyX2RpY3QgPSB7fQogICAgICAgIGZvciBpZHgsIHVzZXIgaW4gZW51bWVyYXRlKHBzdXRpbC51c2VycygpKToKICAgICAgICAgICAgdXNlcl9kaWN0W3N0cihpZHgpXSA9IHsKICAgICAgICAgICAgICAgICd1c2VybmFtZSc6IHVzZXIubmFtZSwKICAgICAgICAgICAgICAgICd0ZXJtaW5hbCc6IHVzZXIudGVybWluYWwgb3IgJ04vQScsCiAgICAgICAgICAgICAgICAnaG9zdCc6IHVzZXIuaG9zdCBvciAnTi9BJywKICAgICAgICAgICAgICAgICdsb2dnZWRJbic6IHVzZXIuc3RhcnRlZCwKICAgICAgICAgICAgICAgICdwaWQnOiB1c2VyLnBpZCBvciAwCiAgICAgICAgICAgIH0KICAgICAgICB1c2Vycy5hcHBlbmQodXNlcl9kaWN0KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnVXNlcnMnXSA9IHVzZXJzCiAgICAgICAgbG9nZ2VyLmluZm8oZidVc2VyIGRhdGEgY29sbGVjdGVkOiB7bGVuKHVzZXJfZGljdCl9IHVzZXJzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHVzZXIgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnVXNlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0QmF0dGVyeURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGJhdHRlcnkgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBiYXR0ZXJ5ID0gcHN1dGlsLnNlbnNvcnNfYmF0dGVyeSgpCiAgICAgICAgaWYgYmF0dGVyeToKICAgICAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnOiBUcnVlLAogICAgICAgICAgICAgICAgJ3BjQ2hhcmdlZCc6IGJhdHRlcnkucGVyY2VudCwKICAgICAgICAgICAgICAgICdzZWNzTGVmdCc6IGJhdHRlcnkuc2Vjc2xlZnQgaWYgYmF0dGVyeS5zZWNzbGVmdCAhPSBwc3V0aWwuUE9XRVJfVElNRV9VTkxJTUlURUQgZWxzZSAnTi9BJywKICAgICAgICAgICAgICAgICdwb3dlclBsdWcnOiBiYXR0ZXJ5LnBvd2VyX3BsdWdnZWQKICAgICAgICAgICAgfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J10gPSB7CiAgICAgICAgICAgICAgICAnaW5zdGFsbGVkJzogRmFsc2UsCiAgICAgICAgICAgICAgICAncGNDaGFyZ2VkJzogMCwKICAgICAgICAgICAgICAgICdzZWNzTGVmdCc6ICdOL0EnLAogICAgICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IFRydWUKICAgICAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnQmF0dGVyeSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBiYXR0ZXJ5IGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgJ2luc3RhbGxlZCc6IEZhbHNlLAogICAgICAgICAgICAncGNDaGFyZ2VkJzogMCwKICAgICAgICAgICAgJ3NlY3NMZWZ0JzogJ04vQScsCiAgICAgICAgICAgICdwb3dlclBsdWcnOiBUcnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHVwdGltZSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGJvb3RfdGltZSA9IHBzdXRpbC5ib290X3RpbWUoKQogICAgICAgIGRldmljZURhdGFEaWN0Wyd1cHRpbWUnXSA9IHsKICAgICAgICAgICAgJ2Jvb3RUaW1lJzogYm9vdF90aW1lLAogICAgICAgICAgICAndXB0aW1lU2Vjb25kcyc6IHRpbWUudGltZSgpIC0gYm9vdF90aW1lCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnVXB0aW1lIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHVwdGltZSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldENvbGxlY3RvckRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGNvbGxlY3RvciB2ZXJzaW9uIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2NvbGxlY3RvciddID0gewogICAgICAgICAgICAndmVyc2lvbic6ICcyLjAuMCcsCiAgICAgICAgICAgICd0eXBlJzogJ1dpbmRvd3NBdWRpdCcsCiAgICAgICAgICAgICd0aW1lc3RhbXAnOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0NvbGxlY3RvciBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBjb2xsZWN0b3IgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREZXZpY2VEYXRhKGRldmljZURhdGFEaWN0LCBkZXZpY2VVdWlkKToKICAgICIiIkdldCBiYXNpYyBkZXZpY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZGV2aWNlJ10gPSB7CiAgICAgICAgICAgICdkZXZpY2VVdWlkJzogZGV2aWNlVXVpZCwKICAgICAgICAgICAgJ3N5c3RlbXRpbWUnOiB0aW1lLnRpbWUoKQogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0RldmljZSBkYXRhIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkZXZpY2UgZGF0YToge2V9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBwYXJ0aXRpb24gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBwYXJ0aXRpb25zID0gW10KICAgICAgICBwYXJ0aXRpb25fZGljdCA9IHt9CiAgICAgICAgZm9yIGlkeCwgcGFydGl0aW9uIGluIGVudW1lcmF0ZShwc3V0aWwuZGlza19wYXJ0aXRpb25zKCkpOgogICAgICAgICAgICBwYXJ0aXRpb25fZGljdFtwYXJ0aXRpb24ubW91bnRwb2ludF0gPSB7CiAgICAgICAgICAgICAgICAnZGV2aWNlJzogcGFydGl0aW9uLmRldmljZSwKICAgICAgICAgICAgICAgICdmc3R5cGUnOiBwYXJ0aXRpb24uZnN0eXBlCiAgICAgICAgICAgIH0KICAgICAgICBwYXJ0aXRpb25zLmFwcGVuZChwYXJ0aXRpb25fZGljdCkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3BhcnRpdGlvbnMnXSA9IHBhcnRpdGlvbnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1BhcnRpdGlvbiBkYXRhIGNvbGxlY3RlZDoge2xlbihwYXJ0aXRpb25fZGljdCl9IHBhcnRpdGlvbnMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgcGFydGl0aW9uIGRhdGE6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3BhcnRpdGlvbnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0R3B1SW5mbyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgR1BVIGluZm9ybWF0aW9uIChXaW5kb3dzLXNwZWNpZmljKSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfVmlkZW9Db250cm9sbGVyKSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB2ZW5kb3IgPSAnTm8gZGF0YSBmb3VuZCcKICAgICAgICBwcm9kdWN0ID0gJ05vIGRhdGEgZm91bmQnCiAgICAgICAgY29sb3VyRGVwdGggPSAtMQogICAgICAgIGhSZXMgPSAtMQogICAgICAgIHZSZXMgPSAtMQoKICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgJ1ZpZGVvUHJvY2Vzc29yJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgcHJvZHVjdCA9IGxpbmUuc3BsaXQoJ1ZpZGVvUHJvY2Vzc29yJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgICAgIGlmICdWaWRlb01vZGVEZXNjcmlwdGlvbicgaW4gbGluZToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjb2xvdXJEZXB0aCA9IGxpbmUuc3BsaXQoJ3ggJylbMl0uc3BsaXQoJyAnKVswXQogICAgICAgICAgICAgICAgICAgIGNvbG91ckRlcHRoID0gaW50KGNvbG91ckRlcHRoKQogICAgICAgICAgICAgICAgICAgIGhSZXMgPSBsaW5lLnNwbGl0KCc6ICcpWzFdLnNwbGl0KCcgJylbMF0KICAgICAgICAgICAgICAgICAgICB2UmVzID0gbGluZS5zcGxpdCgneCAnKVsxXS5zcGxpdCgnICcpWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBpZiAnQWRhcHRlckRBQ1R5cGUnIGluIGxpbmU6CiAgICAgICAgICAgICAgICB2ZW5kb3IgPSBsaW5lLnNwbGl0KCdBZGFwdGVyREFDVHlwZScpWzFdLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogdmVuZG9yLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6IHByb2R1Y3QsCiAgICAgICAgICAgICdncHVjb2xvdXInOiBjb2xvdXJEZXB0aCwKICAgICAgICAgICAgJ2dwdWhyZXMnOiBoUmVzLAogICAgICAgICAgICAnZ3B1dnJlcyc6IHZSZXMKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidHUFUgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgR1BVIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2dwdWluZm8nXSA9IHsKICAgICAgICAgICAgJ2dwdXZlbmRvcic6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdXByb2R1Y3QnOiAnTm8gZGF0YSBmb3VuZCcsCiAgICAgICAgICAgICdncHVjb2xvdXInOiAtMSwKICAgICAgICAgICAgJ2dwdWhyZXMnOiAtMSwKICAgICAgICAgICAgJ2dwdXZyZXMnOiAtMQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRNYW51ZmFjdHVyZXIoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBtYW51ZmFjdHVyZXIiIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIihHZXQtV21pT2JqZWN0IFdpbjMyX0NvbXB1dGVyU3lzdGVtUHJvZHVjdCkuVmVuZG9yIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgbWFudWZhY3R1cmVyID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpIG9yICdVbmtub3duJwogICAgICAgIGRldmljZURhdGFEaWN0WydtYW51ZmFjdHVyZXInXSA9IG1hbnVmYWN0dXJlcgogICAgICAgIGxvZ2dlci5pbmZvKGYnTWFudWZhY3R1cmVyOiB7bWFudWZhY3R1cmVyfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBtYW51ZmFjdHVyZXI6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBPUyBsYW5ndWFnZSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5NVUlMYW5ndWFnZXMiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBvc0xhbmcgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ29zTGFuZyddID0gb3NMYW5nCiAgICAgICAgbG9nZ2VyLmluZm8oZidPUyBMYW5ndWFnZToge29zTGFuZ30nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgT1MgbGFuZ3VhZ2U6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ29zTGFuZyddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgU01CSU9TIGluZm9ybWF0aW9uIChXaW5kb3dzLXNwZWNpZmljKSIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfU3lzdGVtRW5jbG9zdXJlKSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBzbWJpb3NfZGljdCA9IHt9CiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdTZXJpYWxOdW1iZXInIGluIGxpbmU6CiAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnc2VyaWFsTnVtYmVyJ10gPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQogICAgICAgICAgICBpZiAnQ2hhc3Npc1R5cGVzJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgc21iaW9zX2RpY3RbJ2NoYXNzaXNUeXBlJ10gPSBsaW5lLnNwbGl0KCc6JylbMV0uc3RyaXAoKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc21iaW9zJ10gPSBzbWJpb3NfZGljdAogICAgICAgIGxvZ2dlci5pbmZvKGYnU01CSU9TIGluZm8gY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFNNQklPUyBpbmZvOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHt9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHN5c3RlbSBtb2RlbCIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQ29tcHV0ZXJTeXN0ZW0pLk1vZGVsIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCiAgICAgICAgbW9kZWwgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3N5c3RlbU1vZGVsJ10gPSBtb2RlbAogICAgICAgIGxvZ2dlci5pbmZvKGYnU3lzdGVtIE1vZGVsOiB7bW9kZWx9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHN5c3RlbSBtb2RlbDoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtTW9kZWwnXSA9ICdVbmtub3duJwogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBwcmludGVyIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1ByaW50ZXIgfCBTZWxlY3QtT2JqZWN0IE5hbWUiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKCiAgICAgICAgcHJpbnRlcnMgPSBbXQogICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICBpZiBsaW5lLnN0cmlwKCkgYW5kICdOYW1lJyBub3QgaW4gbGluZSBhbmQgJy0tLScgbm90IGluIGxpbmU6CiAgICAgICAgICAgICAgICBwcmludGVycy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsncHJpbnRlcnMnXSA9IHByaW50ZXJzCiAgICAgICAgbG9nZ2VyLmluZm8oZidQcmludGVycyBjb2xsZWN0ZWQ6IHtsZW4ocHJpbnRlcnMpfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBwcmludGVyczoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsncHJpbnRlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXNiRGV2aWNlcyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgVVNCIGRldmljZSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiR2V0LVdtaU9iamVjdCBXaW4zMl9VU0JDb250cm9sbGVyRGV2aWNlIHwgU2VsZWN0LU9iamVjdCBEZXBlbmRlbnQiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKCiAgICAgICAgdXNiX2RldmljZXMgPSBbXQogICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICBpZiAnV2luMzJfJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgdXNiX2RldmljZXMuYXBwZW5kKGxpbmUuc3RyaXAoKSkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3VzYkRldmljZXMnXSA9IHVzYl9kZXZpY2VzCiAgICAgICAgbG9nZ2VyLmluZm8oZidVU0IgZGV2aWNlcyBjb2xsZWN0ZWQ6IHtsZW4odXNiX2RldmljZXMpfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBVU0IgZGV2aWNlczoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXNiRGV2aWNlcyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXREcml2ZXJzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBkcml2ZXIgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1N5c3RlbURyaXZlciB8IFNlbGVjdC1PYmplY3QgTmFtZSwgU3RhdGUiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKCiAgICAgICAgZHJpdmVycyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmIGxpbmUuc3RyaXAoKSBhbmQgJ05hbWUnIG5vdCBpbiBsaW5lIGFuZCAnLS0tJyBub3QgaW4gbGluZToKICAgICAgICAgICAgICAgIGRyaXZlcnMuYXBwZW5kKGxpbmUuc3RyaXAoKSkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXSA9IGRyaXZlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ0RyaXZlcnMgY29sbGVjdGVkOiB7bGVuKGRyaXZlcnMpfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBkcml2ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXJzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBNQUlOIEVYRUNVVElPTiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKCdXaW5kb3dzQXVkaXQgU3RhcnRpbmcuLi4nKQoKICAgICMgU2V0dXAgZGlyZWN0b3JpZXMKICAgIGFwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyID0gZ2V0QXBwRGlycygpCgogICAgIyBHZXQgZGV2aWNlIFVVSUQgYW5kIGhvc3QKICAgIGFnZW50Q29uZmlnRmlsZSA9IG9zLnBhdGguam9pbihjb25maWdEaXIsICdhZ2VudC5jb25maWcnKQogICAgZGV2aWNlVXVpZCwgaG9zdCA9IGdldERldmljZVV1aWQoYWdlbnRDb25maWdGaWxlKQoKICAgICMgQ29sbGVjdCBhbGwgZGF0YQogICAgZGV2aWNlRGF0YURpY3QgPSB7fQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREZXZpY2VEYXRhKGRldmljZURhdGFEaWN0LCBkZXZpY2VVdWlkKQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTeXN0ZW1EYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE5ldHdvcmtEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0QmF0dGVyeURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE1lbW9yeURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldENvbGxlY3RvckRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVzYkRldmljZXMoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpCgogICAgIyBVcGRhdGUgZGV2aWNlIFVVSUQgaW4gcGF5bG9hZAogICAgZGV2aWNlRGF0YURpY3RbJ2RldmljZSddWydkZXZpY2VVdWlkJ10gPSBkZXZpY2VVdWlkCgogICAgIyBTZW5kIHBheWxvYWQKICAgIHJvdXRlID0gJy9wYXlsb2FkL3NlbmRhdWRpdCcKICAgIHBheWxvYWQgPSB7J2RhdGEnOiBkZXZpY2VEYXRhRGljdH0KCiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmluZm8oZidQYXlsb2FkOiB7anNvbi5kdW1wcyhwYXlsb2FkLCBpbmRlbnQ9MiwgZGVmYXVsdD1zdHIpfScpCgogICAgcmVzcG9uc2UgPSBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCByb3V0ZSwgaG9zdCwgZGVidWdNb2RlKQogICAgbG9nZ2VyLmluZm8oZidTZXJ2ZXIgcmVzcG9uc2U6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0gfCB7cmVzcG9uc2UudGV4dH0nKQoK"}}