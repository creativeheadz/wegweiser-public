{"settings": {"snippetUuid": "ff8e9df5-d355-4d09-b3f9-42bcc5c8cc05", "snippetname": "MacOSMeta", "snippettype": ".py", "created_at": 1751703814}, "payload": {"payloadsig": "wU3dJWNZY0nf8MImPwtkgUsBCUyk26vUOrxSy6wJq0WwBsrbLqgiOYMjrN9+2bNANocb54Tg/cOmyA36sNZHIMZU9i2tATRWm31MGWBuRYzI2+gJUaffzEfbiaM5nFEYJ32rvp2WaCzCwy4piqZv8sGIDmY6OwwL0atm0cfpiars6ugXktqM5HPfZmoR61WTU3gOK59pm7bvqH0Oz6qyhpEIwZ3T3OdIxtZdsl5Jijd2CXFTI9PGzP1Ad1Q9awHtoKk7YLgDFfSS0fsZt6ywJeOh5NWONwIbPevOBvRNIbYaAiFPLFCaYEoahHvxEDUpPF1KNGhVsTdBVsBRkGvdN7LSY48fmzpfymi06oC3EbX8cla15KIAf3d9tQLjRhFuZr6BqUJHI1NZr2/MdK6aV0JJdIVoSrCeJBx5p/COegNM1P5NL/qVmKHoQ6FI7LD4DDHM7S/SysCJ6HExrUcz0EiLiASq5szb4FE7jswLsFbozSwQCNxngzL+GwbYCKSjhAxVDgTR+2oEAiL7mPYFxXx663Pdkep+d2IwimJ7x+zb0MWzIbvJmky747rdmEjpG8QnJhLi5W0qjRuTzYfd5h90yar5oXY0qNhufnO5MUHfSc7AQHW1KMav2MRQbjkKb4DEkHs7FeP2Ybpo+nkwsvy3PoxvtpTQowmHw+aalhc=", "payloadb64": "aW1wb3J0IHBsYXRmb3JtCmZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCmltcG9ydCBkYXRldGltZQppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IHppcGZpbGUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKCiMgR2xvYmFsIHZhcmlhYmxlcyBmb3IgZGlyZWN0b3JpZXMgYW5kIGNvbmZpZwphcHBEaXIgPSAnL29wdC9XZWd3ZWlzZXIvJwpsb2dEaXIgPSBmJ3thcHBEaXJ9TG9ncy8nCmNvbmZpZ0RpciA9IGYne2FwcERpcn1Db25maWcvJwpmaWxlc0RpciA9IGYne2FwcERpcn1GaWxlcy8nCnRlbXBEaXIgPSBvcy5nZXRlbnYoJ1RNUERJUicpIG9yICcvdG1wJwpob3N0ID0gTm9uZQoKZGVmIGdldEFwcERpcnMoKToKICAgICIiIkluaXRpYWxpemUgYW5kIGNyZWF0ZSByZXF1aXJlZCBkaXJlY3RvcmllcyIiIgogICAgZm9yIGRpcmVjdG9yeSBpbiBbYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgZmlsZXNEaXJdOgogICAgICAgIGNoZWNrRGlyKGRpcmVjdG9yeSkKICAgIHJldHVybihhcHBEaXIsIGxvZ0RpciwgY29uZmlnRGlyLCB0ZW1wRGlyLCBmaWxlc0RpcikKCmRlZiBjaGVja0RpcihkaXJUb0NoZWNrKToKICAgIGRpclRvQ2hlY2sgPSBvcy5wYXRoLmpvaW4oZGlyVG9DaGVjaywgJycpCiAgICBpZiBub3Qgb3MucGF0aC5pc2RpcihkaXJUb0NoZWNrKToKICAgICAgICBsb2dnZXIuaW5mbyhmJ3tkaXJUb0NoZWNrfSBkb2VzIG5vdCBleGlzdC4gQ3JlYXRpbmcuLi4nKQogICAgICAgIHRyeToKICAgICAgICAgICAgb3MubWFrZWRpcnMoZGlyVG9DaGVjaykKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZid7ZGlyVG9DaGVja30gY3JlYXRlZC4nKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGNyZWF0ZSB7ZGlyVG9DaGVja30uIFJlYXNvbjoge2V9JykKICAgICAgICAgICAgc3lzLmV4aXQoKQogICAgcmV0dXJuKGRpclRvQ2hlY2spCgpkZWYgemlwRmlsZShmaWxlVG9aaXApOgogICAgIiIiWmlwIGEgZmlsZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZyIiIgogICAgaW5GaWxlID0gb3MucGF0aC5qb2luKGZpbGVzRGlyLCBmaWxlVG9aaXApCiAgICBvdXRaaXBGaWxlID0gb3MucGF0aC5qb2luKGZpbGVzRGlyLCBmIntmaWxlVG9aaXB9LnppcCIpCiAgICAKICAgIGxvZ2dlci5pbmZvKGYnWmlwcGluZyB7aW5GaWxlfSB0byB7b3V0WmlwRmlsZX0nKQogICAgdHJ5OgogICAgICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKG91dFppcEZpbGUsICd3JywgY29tcHJlc3Npb249emlwZmlsZS5aSVBfREVGTEFURUQpIGFzIHppcGY6CiAgICAgICAgICAgIHppcGYud3JpdGUoaW5GaWxlLCBvcy5wYXRoLmJhc2VuYW1lKGluRmlsZSkpCiAgICAgICAgbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgemlwcGVkIHtpbkZpbGV9IHRvIHtvdXRaaXBGaWxlfScpCiAgICAgICAgcmV0dXJuIG91dFppcEZpbGUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gY3JlYXRlIHppcCBmaWxlOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0RGV2aWNlVXVpZChjb25maWdGaWxlKToKICAgICIiIkdldCBkZXZpY2UgVVVJRCBhbmQgaG9zdCBmcm9tIGNvbmZpZyIiIgogICAgZ2xvYmFsIGhvc3QKICAgIGxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byByZWFkIGNvbmZpZyBmaWxlOiB7Y29uZmlnRmlsZX0uLi4nKQogICAgdHJ5OgogICAgICAgIHdpdGggb3Blbihjb25maWdGaWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgIGNvbmZpZ0RpY3QgPSBqc29uLmxvYWQoZikKICAgICAgICBsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSByZWFkIHtjb25maWdGaWxlfScpCiAgICAgICAgZGV2aWNlVXVpZCA9IGNvbmZpZ0RpY3RbJ2RldmljZXV1aWQnXQogICAgICAgIGhvc3QgPSBjb25maWdEaWN0LmdldCgnc2VydmVyQWRkcicsICdhcHAud2Vnd2Vpc2VyLnRlY2gnKQogICAgICAgIHJldHVybiBkZXZpY2VVdWlkLCBob3N0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHJlYWQge2NvbmZpZ0ZpbGV9OiB7ZX0nKQogICAgICAgIHN5cy5leGl0KDEpCgpkZWYgZGVsRmlsZShmaWxlVG9EZWxldGUpOgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4uLicpCiAgICB0cnk6CiAgICAgICAgb3MucmVtb3ZlKGZpbGVUb0RlbGV0ZSkKICAgICAgICBsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSBkZWxldGVkIHtmaWxlVG9EZWxldGV9LicpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4gUmVhc29uOiB7ZX0nKQoKZGVmIHNlbmRQYXlsb2FkRmxhc2socm91dGUsIG91dFppcEZpbGUsIGRldmljZVV1aWQpOgogICAgcGF5bG9hZE5hbWUgCT0gb3MucGF0aC5iYXNlbmFtZShvdXRaaXBGaWxlKQogICAgdXJsIAkJCT0gZidodHRwczovL3tob3N0fXtyb3V0ZX0nCiAgICBsb2dnZXIuaW5mbyhmJ1JlcXVlc3QgdG8gc2VuZCB7b3V0WmlwRmlsZX0gfCBwYXlsb2FkTmFtZToge3BheWxvYWROYW1lfScpCiAgICBsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gY29ubmVjdCB0byB7dXJsfScpCiAgICB3aXRoIG9wZW4ob3V0WmlwRmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICBmaWxlcyA9IHsnZmlsZSc6IChwYXlsb2FkTmFtZSwgZil9CiAgICAgICAgaGVhZGVycyA9IHsnZGV2aWNldXVpZCc6IGRldmljZVV1aWR9CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgZmlsZXM9ZmlsZXMsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYnc3RhdHVzX2NvZGU6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0nKQogICAgICAgICAgICByZXR1cm4oVHJ1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidzdGF0dXNfY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfS4gUmVhc29uOiB7cmVzcG9uc2UudGV4dH0nKQogICAgICAgICAgICByZXR1cm4oRmFsc2UpCgpkZWYgZ2V0X3N5c3RlbV9sb2dzKGRheXM9MzApOgogICAgIiIiQ29sbGVjdCBhbmQgc3VtbWFyaXplIDMwIGRheXMgb2Ygc3lzdGVtIGxvZ3MgbG9jYWxseSIiIgogICAgbG9nZ2VyLmluZm8oZiJDb2xsZWN0aW5nIGFuZCBwcm9jZXNzaW5nIHtkYXlzfSBkYXlzIG9mIHN5c3RlbSBsb2dzLi4uIikKCiAgICAjIERlZmluZSBlbmhhbmNlZCBsb2cgY2F0ZWdvcmllcyB0byBjb2xsZWN0IG1vcmUgbWVhbmluZ2Z1bCBkYXRhCiAgICBsb2dfY2F0ZWdvcmllcyA9IFsKICAgICAgICB7CiAgICAgICAgICAgICduYW1lJzogJ2Vycm9ycycsCiAgICAgICAgICAgICdwcmVkaWNhdGUnOiAnbWVzc2FnZVR5cGUgPj0gMTYnLCAgIyBFcnJvciBhbmQgRmF1bHQgbGV2ZWxzCiAgICAgICAgICAgICdkZXNjcmlwdGlvbic6ICdTeXN0ZW0gZXJyb3JzIGFuZCBmYXVsdHMnLAogICAgICAgICAgICAnc3R5bGUnOiAnanNvbicgICMgR2V0IHN0cnVjdHVyZWQgZGF0YQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAnbmFtZSc6ICdzZWN1cml0eScsCiAgICAgICAgICAgICdwcmVkaWNhdGUnOiAnKHN1YnN5c3RlbSBDT05UQUlOUyAic2VjdXJpdHkiIE9SIGNhdGVnb3J5IENPTlRBSU5TICJzZWN1cml0eSIgT1Igc3Vic3lzdGVtIENPTlRBSU5TICJhdXRob3JpemF0aW9uIiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgImF1dGhlbnRpY2F0aW9uIiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgImtleWNoYWluIiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgImNlcnRpZmljYXRlIiknLAogICAgICAgICAgICAnZGVzY3JpcHRpb24nOiAnU2VjdXJpdHksIGF1dGhlbnRpY2F0aW9uIGFuZCBhdXRob3JpemF0aW9uIGV2ZW50cycsCiAgICAgICAgICAgICdzdHlsZSc6ICdqc29uJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAnbmFtZSc6ICdjcmFzaGVzJywKICAgICAgICAgICAgJ3ByZWRpY2F0ZSc6ICcoZXZlbnRNZXNzYWdlIENPTlRBSU5TICJjcmFzaCIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJwYW5pYyIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJhYm9ydCIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJzZWdtZW50YXRpb24gZmF1bHQiIE9SIGV2ZW50TWVzc2FnZSBDT05UQUlOUyAidGVybWluYXRlZCIgT1Igc3Vic3lzdGVtIENPTlRBSU5TICJjcmFzaCIpJywKICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogJ0FwcGxpY2F0aW9uIGNyYXNoZXMsIHBhbmljcyBhbmQgYWJub3JtYWwgdGVybWluYXRpb25zJywKICAgICAgICAgICAgJ3N0eWxlJzogJ2pzb24nCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICduYW1lJzogJ25ldHdvcmsnLAogICAgICAgICAgICAncHJlZGljYXRlJzogJyhzdWJzeXN0ZW0gQ09OVEFJTlMgIm5ldHdvcmsiIE9SIGNhdGVnb3J5IENPTlRBSU5TICJuZXR3b3JrIiBPUiBzdWJzeXN0ZW0gQ09OVEFJTlMgIndpZmkiIE9SIHN1YnN5c3RlbSBDT05UQUlOUyAiYmx1ZXRvb3RoIiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgImNvbm5lY3Rpb24iIE9SIGV2ZW50TWVzc2FnZSBDT05UQUlOUyAic29ja2V0IiknLAogICAgICAgICAgICAnZGVzY3JpcHRpb24nOiAnTmV0d29yayBjb25uZWN0aXZpdHksIFdpRmksIEJsdWV0b290aCBhbmQgc29ja2V0IGV2ZW50cycsCiAgICAgICAgICAgICdzdHlsZSc6ICdqc29uJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAnbmFtZSc6ICdwZXJmb3JtYW5jZScsCiAgICAgICAgICAgICdwcmVkaWNhdGUnOiAnKGV2ZW50TWVzc2FnZSBDT05UQUlOUyAic2xvdyIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJ0aW1lb3V0IiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgIm1lbW9yeSIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJjcHUiIE9SIHN1YnN5c3RlbSBDT05UQUlOUyAicGVyZm9ybWFuY2UiIE9SIGNhdGVnb3J5IENPTlRBSU5TICJwZXJmb3JtYW5jZSIpJywKICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogJ1BlcmZvcm1hbmNlIGlzc3VlcywgdGltZW91dHMgYW5kIHJlc291cmNlIHByb2JsZW1zJywKICAgICAgICAgICAgJ3N0eWxlJzogJ2pzb24nCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICduYW1lJzogJ2Rpc2tfaW8nLAogICAgICAgICAgICAncHJlZGljYXRlJzogJyhzdWJzeXN0ZW0gQ09OVEFJTlMgImRpc2siIE9SIHN1YnN5c3RlbSBDT05UQUlOUyAic3RvcmFnZSIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJkaXNrIiBPUiBldmVudE1lc3NhZ2UgQ09OVEFJTlMgInZvbHVtZSIgT1IgZXZlbnRNZXNzYWdlIENPTlRBSU5TICJmaWxlc3lzdGVtIiknLAogICAgICAgICAgICAnZGVzY3JpcHRpb24nOiAnRGlzayBJL08sIHN0b3JhZ2UgYW5kIGZpbGVzeXN0ZW0gZXZlbnRzJywKICAgICAgICAgICAgJ3N0eWxlJzogJ2pzb24nCiAgICAgICAgfQogICAgXQoKICAgIHN1bW1hcnlfZGF0YSA9IHsKICAgICAgICAnY29sbGVjdGlvbl9wZXJpb2QnOiBmJ3tkYXlzfSBkYXlzJywKICAgICAgICAnY2F0ZWdvcmllcyc6IHt9LAogICAgICAgICd0b3RhbF9ldmVudHNfcHJvY2Vzc2VkJzogMCwKICAgICAgICAnY29sbGVjdGlvbl90aW1lc3RhbXAnOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKQogICAgfQoKICAgIGZvciBjYXRlZ29yeSBpbiBsb2dfY2F0ZWdvcmllczoKICAgICAgICBsb2dnZXIuaW5mbyhmIlByb2Nlc3Npbmcge2NhdGVnb3J5WyduYW1lJ119IGxvZ3MuLi4iKQoKICAgICAgICAjIFVzZSBKU09OIHN0eWxlIGZvciBiZXR0ZXIgc3RydWN0dXJlZCBwYXJzaW5nIHdoZW4gYXZhaWxhYmxlCiAgICAgICAgc3R5bGUgPSBjYXRlZ29yeS5nZXQoJ3N0eWxlJywgJ2NvbXBhY3QnKQogICAgICAgIGNtZCA9IFsKICAgICAgICAgICAgImxvZyIsICJzaG93IiwKICAgICAgICAgICAgIi0tbGFzdCIsIGYie2RheXN9ZCIsCiAgICAgICAgICAgICItLXByZWRpY2F0ZSIsIGNhdGVnb3J5WydwcmVkaWNhdGUnXSwKICAgICAgICAgICAgIi0tc3R5bGUiLCBzdHlsZQogICAgICAgIF0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFVzZSBsb25nZXIgdGltZW91dCBmb3IgMzAgZGF5cyBvZiBkYXRhCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTMwMCkKCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmImxvZyBzaG93IGZvciB7Y2F0ZWdvcnlbJ25hbWUnXX0gcmV0dXJuZWQgZXJyb3I6IHtyZXN1bHQuc3RkZXJyfSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgIyBQcm9jZXNzIGFuZCBncm91cCB0aGUgbG9ncyBiYXNlZCBvbiBmb3JtYXQKICAgICAgICAgICAgaWYgc3R5bGUgPT0gJ2pzb24nOgogICAgICAgICAgICAgICAgZ3JvdXBlZF9ldmVudHMgPSBwcm9jZXNzX2pzb25fbG9nX291dHB1dChyZXN1bHQuc3Rkb3V0LCBjYXRlZ29yeVsnbmFtZSddKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZ3JvdXBlZF9ldmVudHMgPSBwcm9jZXNzX2xvZ19vdXRwdXQocmVzdWx0LnN0ZG91dCwgY2F0ZWdvcnlbJ25hbWUnXSkKCiAgICAgICAgICAgICMgQ2FsY3VsYXRlIGhlYWx0aCBpbmRpY2F0b3JzIGZvciB0aGlzIGNhdGVnb3J5CiAgICAgICAgICAgIGhlYWx0aF9pbmRpY2F0b3JzID0gY2FsY3VsYXRlX2NhdGVnb3J5X2hlYWx0aChncm91cGVkX2V2ZW50cywgY2F0ZWdvcnlbJ25hbWUnXSkKCiAgICAgICAgICAgIHN1bW1hcnlfZGF0YVsnY2F0ZWdvcmllcyddW2NhdGVnb3J5WyduYW1lJ11dID0gewogICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJzogY2F0ZWdvcnlbJ2Rlc2NyaXB0aW9uJ10sCiAgICAgICAgICAgICAgICAndG90YWxfcmF3X2xpbmVzJzogbGVuKHJlc3VsdC5zdGRvdXQuc3BsaXQoJ1xuJykpLAogICAgICAgICAgICAgICAgJ2dyb3VwZWRfZXZlbnRzJzogZ3JvdXBlZF9ldmVudHNbJ3RvcF9ldmVudHMnXSwKICAgICAgICAgICAgICAgICd1bmlxdWVfZXZlbnRfdHlwZXMnOiBsZW4oZ3JvdXBlZF9ldmVudHNbJ2FsbF9ncm91cHMnXSksCiAgICAgICAgICAgICAgICAndG90YWxfZXZlbnRzJzogZ3JvdXBlZF9ldmVudHNbJ3RvdGFsX2NvdW50J10sCiAgICAgICAgICAgICAgICAncGFyc2luZ19zdWNjZXNzX3JhdGUnOiBncm91cGVkX2V2ZW50cy5nZXQoJ3BhcnNpbmdfc3VjY2Vzc19yYXRlJywgMCksCiAgICAgICAgICAgICAgICAnaGVhbHRoX2luZGljYXRvcnMnOiBoZWFsdGhfaW5kaWNhdG9ycywKICAgICAgICAgICAgICAgICdmb3JtYXQnOiBncm91cGVkX2V2ZW50cy5nZXQoJ2Zvcm1hdCcsICd0ZXh0JykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3VtbWFyeV9kYXRhWyd0b3RhbF9ldmVudHNfcHJvY2Vzc2VkJ10gKz0gZ3JvdXBlZF9ldmVudHNbJ3RvdGFsX2NvdW50J10KICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJQcm9jZXNzZWQge2dyb3VwZWRfZXZlbnRzWyd0b3RhbF9jb3VudCddfSB7Y2F0ZWdvcnlbJ25hbWUnXX0gZXZlbnRzIGludG8ge2xlbihncm91cGVkX2V2ZW50c1snYWxsX2dyb3VwcyddKX0gZ3JvdXBzIikKCiAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuVGltZW91dEV4cGlyZWQ6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlRpbWVvdXQgY29sbGVjdGluZyB7Y2F0ZWdvcnlbJ25hbWUnXX0gbG9ncyIpCiAgICAgICAgICAgIHN1bW1hcnlfZGF0YVsnY2F0ZWdvcmllcyddW2NhdGVnb3J5WyduYW1lJ11dID0geydlcnJvcic6ICd0aW1lb3V0J30KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkVycm9yIGNvbGxlY3Rpbmcge2NhdGVnb3J5WyduYW1lJ119IGxvZ3M6IHtlfSIpCiAgICAgICAgICAgIHN1bW1hcnlfZGF0YVsnY2F0ZWdvcmllcyddW2NhdGVnb3J5WyduYW1lJ11dID0geydlcnJvcic6IHN0cihlKX0KCiAgICByZXR1cm4gc3VtbWFyeV9kYXRhCgpkZWYgcHJvY2Vzc19qc29uX2xvZ19vdXRwdXQobG9nX291dHB1dCwgY2F0ZWdvcnlfbmFtZSk6CiAgICAiIiJQcm9jZXNzIEpTT04tZm9ybWF0dGVkIGxvZyBvdXRwdXQgZm9yIGJldHRlciBzdHJ1Y3R1cmVkIGRhdGEiIiIKICAgIGxpbmVzID0gbG9nX291dHB1dC5zdHJpcCgpLnNwbGl0KCdcbicpCiAgICBldmVudF9ncm91cHMgPSB7fQogICAgdG90YWxfY291bnQgPSAwCiAgICBwYXJzaW5nX2Vycm9ycyA9IDAKCiAgICBsb2dnZXIuaW5mbyhmIlByb2Nlc3Npbmcge2xlbihsaW5lcyl9IEpTT04gbG9nIGxpbmVzIGZvciB7Y2F0ZWdvcnlfbmFtZX0iKQoKICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgIGlmIG5vdCBsaW5lLnN0cmlwKCk6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBQYXJzZSBKU09OIGxvZyBlbnRyeQogICAgICAgICAgICBsb2dfZW50cnkgPSBqc29uLmxvYWRzKGxpbmUpCiAgICAgICAgICAgIHRvdGFsX2NvdW50ICs9IDEKCiAgICAgICAgICAgICMgRXh0cmFjdCBzdHJ1Y3R1cmVkIGZpZWxkcwogICAgICAgICAgICBwcm9jZXNzID0gbG9nX2VudHJ5LmdldCgncHJvY2VzcycsICd1bmtub3duJykKICAgICAgICAgICAgc3Vic3lzdGVtID0gbG9nX2VudHJ5LmdldCgnc3Vic3lzdGVtJywgJ3Vua25vd24nKQogICAgICAgICAgICBjYXRlZ29yeSA9IGxvZ19lbnRyeS5nZXQoJ2NhdGVnb3J5JywgJ3Vua25vd24nKQogICAgICAgICAgICBtZXNzYWdlID0gbG9nX2VudHJ5LmdldCgnZXZlbnRNZXNzYWdlJywgJycpCiAgICAgICAgICAgIHRpbWVzdGFtcCA9IGxvZ19lbnRyeS5nZXQoJ3RpbWVzdGFtcCcsICdyZWNlbnQnKQogICAgICAgICAgICBtZXNzYWdlX3R5cGUgPSBsb2dfZW50cnkuZ2V0KCdtZXNzYWdlVHlwZScsICdkZWZhdWx0JykKCiAgICAgICAgICAgICMgTWFwIG1lc3NhZ2VUeXBlIHRvIHNldmVyaXR5CiAgICAgICAgICAgIHNldmVyaXR5X21hcCA9IHsKICAgICAgICAgICAgICAgIDE2OiAnZXJyb3InLAogICAgICAgICAgICAgICAgMTc6ICdmYXVsdCcsCiAgICAgICAgICAgICAgICAwOiAnZGVmYXVsdCcsCiAgICAgICAgICAgICAgICAxOiAnaW5mbycsCiAgICAgICAgICAgICAgICAyOiAnZGVidWcnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V2ZXJpdHkgPSBzZXZlcml0eV9tYXAuZ2V0KG1lc3NhZ2VfdHlwZSwgJ3Vua25vd24nKQoKICAgICAgICAgICAgIyBOb3JtYWxpemUgbWVzc2FnZSBmb3IgZ3JvdXBpbmcKICAgICAgICAgICAgbm9ybWFsaXplZF9tZXNzYWdlID0gbm9ybWFsaXplX21lc3NhZ2VfZW5oYW5jZWQobWVzc2FnZSkKCiAgICAgICAgICAgICMgQ3JlYXRlIG1lYW5pbmdmdWwgZ3JvdXBpbmcga2V5CiAgICAgICAgICAgIGlmIGNhdGVnb3J5X25hbWUgPT0gJ25ldHdvcmsnOgogICAgICAgICAgICAgICAgZ3JvdXBfa2V5ID0gZiJORVRfe3N1YnN5c3RlbX1fe2NhdGVnb3J5fTp7bm9ybWFsaXplZF9tZXNzYWdlWzo4MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ3NlY3VyaXR5JzoKICAgICAgICAgICAgICAgIGdyb3VwX2tleSA9IGYiU0VDX3twcm9jZXNzfV97c3Vic3lzdGVtfTp7bm9ybWFsaXplZF9tZXNzYWdlWzo4MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ2Vycm9ycyc6CiAgICAgICAgICAgICAgICBncm91cF9rZXkgPSBmIkVSUl97c2V2ZXJpdHl9X3twcm9jZXNzfTp7bm9ybWFsaXplZF9tZXNzYWdlWzo4MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ2NyYXNoZXMnOgogICAgICAgICAgICAgICAgZ3JvdXBfa2V5ID0gZiJDUkFTSF97cHJvY2Vzc306e25vcm1hbGl6ZWRfbWVzc2FnZVs6ODBdfSIKICAgICAgICAgICAgZWxpZiBjYXRlZ29yeV9uYW1lID09ICdwZXJmb3JtYW5jZSc6CiAgICAgICAgICAgICAgICBncm91cF9rZXkgPSBmIlBFUkZfe3Byb2Nlc3N9X3tzdWJzeXN0ZW19Ontub3JtYWxpemVkX21lc3NhZ2VbOjgwXX0iCiAgICAgICAgICAgIGVsaWYgY2F0ZWdvcnlfbmFtZSA9PSAnZGlza19pbyc6CiAgICAgICAgICAgICAgICBncm91cF9rZXkgPSBmIkRJU0tfe3Byb2Nlc3N9X3tzdWJzeXN0ZW19Ontub3JtYWxpemVkX21lc3NhZ2VbOjgwXX0iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBncm91cF9rZXkgPSBmIntwcm9jZXNzfV97c3Vic3lzdGVtfTp7bm9ybWFsaXplZF9tZXNzYWdlWzo4MF19IgoKICAgICAgICAgICAgaWYgZ3JvdXBfa2V5IG5vdCBpbiBldmVudF9ncm91cHM6CiAgICAgICAgICAgICAgICBldmVudF9ncm91cHNbZ3JvdXBfa2V5XSA9IHsKICAgICAgICAgICAgICAgICAgICAncHJvY2Vzcyc6IHByb2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgJ3N1YnN5c3RlbSc6IHN1YnN5c3RlbSwKICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiBjYXRlZ29yeSwKICAgICAgICAgICAgICAgICAgICAnc2V2ZXJpdHknOiBzZXZlcml0eSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZV90eXBlJzogbWVzc2FnZV90eXBlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlX3BhdHRlcm4nOiBub3JtYWxpemVkX21lc3NhZ2VbOjQwMF0sCiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMCwKICAgICAgICAgICAgICAgICAgICAnZmlyc3Rfc2Vlbic6IHRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAnc2FtcGxlX21lc3NhZ2UnOiBtZXNzYWdlWzo1MDBdLAogICAgICAgICAgICAgICAgICAgICdzdHJ1Y3R1cmVkX2RhdGEnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdwcm9jZXNzJzogcHJvY2VzcywKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1YnN5c3RlbSc6IHN1YnN5c3RlbSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3J5JzogY2F0ZWdvcnkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICBldmVudF9ncm91cHNbZ3JvdXBfa2V5XVsnY291bnQnXSArPSAxCgogICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgcGFyc2luZ19lcnJvcnMgKz0gMQogICAgICAgICAgICAjIEZhbGxiYWNrIHRvIHRleHQgcHJvY2Vzc2luZyBmb3Igbm9uLUpTT04gbGluZXMKICAgICAgICAgICAgY29udGludWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHBhcnNpbmdfZXJyb3JzICs9IDEKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYiRXJyb3IgcHJvY2Vzc2luZyBKU09OIGxvZyBlbnRyeToge2V9IikKICAgICAgICAgICAgY29udGludWUKCiAgICBsb2dnZXIuaW5mbyhmIkNyZWF0ZWQge2xlbihldmVudF9ncm91cHMpfSBldmVudCBncm91cHMgZnJvbSB7dG90YWxfY291bnR9IEpTT04gbG9nIGVudHJpZXMiKQogICAgbG9nZ2VyLmluZm8oZiJKU09OIHBhcnNpbmcgZXJyb3JzOiB7cGFyc2luZ19lcnJvcnN9IikKCiAgICAjIFNvcnQgYnkgY291bnQgYW5kIHRha2UgdG9wIGV2ZW50cwogICAgc29ydGVkX2dyb3VwcyA9IHNvcnRlZChldmVudF9ncm91cHMuaXRlbXMoKSwga2V5PWxhbWJkYSB4OiB4WzFdWydjb3VudCddLCByZXZlcnNlPVRydWUpCiAgICB0b3BfZXZlbnRzID0gW10KCiAgICBmb3IgZ3JvdXBfa2V5LCBkYXRhIGluIHNvcnRlZF9ncm91cHNbOjMwXTogICMgVG9wIDMwIGZvciBKU09OIGRhdGEKICAgICAgICB0b3BfZXZlbnRzLmFwcGVuZCh7CiAgICAgICAgICAgICdwcm9jZXNzJzogZGF0YVsncHJvY2VzcyddLAogICAgICAgICAgICAnc3Vic3lzdGVtJzogZGF0YVsnc3Vic3lzdGVtJ10sCiAgICAgICAgICAgICdjYXRlZ29yeSc6IGRhdGFbJ2NhdGVnb3J5J10sCiAgICAgICAgICAgICdzZXZlcml0eSc6IGRhdGFbJ3NldmVyaXR5J10sCiAgICAgICAgICAgICdtZXNzYWdlX3R5cGUnOiBkYXRhWydtZXNzYWdlX3R5cGUnXSwKICAgICAgICAgICAgJ21lc3NhZ2VfcGF0dGVybic6IGRhdGFbJ21lc3NhZ2VfcGF0dGVybiddLAogICAgICAgICAgICAnY291bnQnOiBkYXRhWydjb3VudCddLAogICAgICAgICAgICAnZmlyc3Rfc2Vlbic6IGRhdGFbJ2ZpcnN0X3NlZW4nXSwKICAgICAgICAgICAgJ3NhbXBsZV9tZXNzYWdlJzogZGF0YVsnc2FtcGxlX21lc3NhZ2UnXSwKICAgICAgICAgICAgJ3BlcmNlbnRhZ2UnOiByb3VuZCgoZGF0YVsnY291bnQnXSAvIHRvdGFsX2NvdW50KSAqIDEwMCwgMikgaWYgdG90YWxfY291bnQgPiAwIGVsc2UgMCwKICAgICAgICAgICAgJ2dyb3VwX2tleSc6IGdyb3VwX2tleSwKICAgICAgICAgICAgJ3N0cnVjdHVyZWRfZGF0YSc6IGRhdGFbJ3N0cnVjdHVyZWRfZGF0YSddCiAgICAgICAgfSkKCiAgICByZXR1cm4gewogICAgICAgICd0b3BfZXZlbnRzJzogdG9wX2V2ZW50cywKICAgICAgICAnYWxsX2dyb3Vwcyc6IGV2ZW50X2dyb3VwcywKICAgICAgICAndG90YWxfY291bnQnOiB0b3RhbF9jb3VudCwKICAgICAgICAncGFyc2luZ19zdWNjZXNzX3JhdGUnOiByb3VuZCgoKHRvdGFsX2NvdW50IC0gcGFyc2luZ19lcnJvcnMpIC8gdG90YWxfY291bnQpICogMTAwLCAyKSBpZiB0b3RhbF9jb3VudCA+IDAgZWxzZSAwLAogICAgICAgICdmb3JtYXQnOiAnanNvbicKICAgIH0KCmRlZiBwcm9jZXNzX2xvZ19vdXRwdXQobG9nX291dHB1dCwgY2F0ZWdvcnlfbmFtZSk6CiAgICAiIiJQcm9jZXNzIHJhdyBsb2cgb3V0cHV0IGFuZCBncm91cCBzaW1pbGFyIGV2ZW50cyB3aXRoIGVuaGFuY2VkIHBhcnNpbmciIiIKICAgIGxpbmVzID0gbG9nX291dHB1dC5zdHJpcCgpLnNwbGl0KCdcbicpCiAgICBldmVudF9ncm91cHMgPSB7fQogICAgdG90YWxfY291bnQgPSAwCiAgICBwYXJzaW5nX2Vycm9ycyA9IDAKCiAgICBsb2dnZXIuaW5mbyhmIlByb2Nlc3Npbmcge2xlbihsaW5lcyl9IGxpbmVzIGZvciB7Y2F0ZWdvcnlfbmFtZX0iKQoKICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgIGlmIG5vdCBsaW5lLnN0cmlwKCkgb3IgbGVuKGxpbmUpIDwgMTA6CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHRvdGFsX2NvdW50ICs9IDEKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEVuaGFuY2VkIHBhcnNpbmcgZm9yIG1hY09TIHVuaWZpZWQgbG9nIGZvcm1hdAogICAgICAgICAgICBwcm9jZXNzID0gJ3Vua25vd24nCiAgICAgICAgICAgIHN1YnN5c3RlbSA9ICd1bmtub3duJwogICAgICAgICAgICBjYXRlZ29yeSA9ICd1bmtub3duJwogICAgICAgICAgICBtZXNzYWdlID0gbGluZS5zdHJpcCgpCiAgICAgICAgICAgIHNldmVyaXR5ID0gJ2luZm8nCgogICAgICAgICAgICAjIG1hY09TIHVuaWZpZWQgbG9nIGZvcm1hdCBwYXJzaW5nCiAgICAgICAgICAgICMgRm9ybWF0OiB0aW1lc3RhbXAgaG9zdG5hbWUgcHJvY2Vzc1twaWRdIDxzdWJzeXN0ZW06Y2F0ZWdvcnk+IHNldmVyaXR5OiBtZXNzYWdlCgogICAgICAgICAgICAjIEV4dHJhY3QgdGltZXN0YW1wIChmaXJzdCBwYXJ0KQogICAgICAgICAgICBwYXJ0cyA9IGxpbmUuc3BsaXQoKQogICAgICAgICAgICBpZiBsZW4ocGFydHMpIDwgNDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIEZpbmQgcHJvY2VzcyBuYW1lICh1c3VhbGx5IGhhcyBbcGlkXSBvciBqdXN0IHByb2Nlc3MgbmFtZSkKICAgICAgICAgICAgcHJvY2Vzc19mb3VuZCA9IEZhbHNlCiAgICAgICAgICAgIGZvciBpLCBwYXJ0IGluIGVudW1lcmF0ZShwYXJ0cyk6CiAgICAgICAgICAgICAgICBpZiAnWycgaW4gcGFydCBhbmQgJ10nIGluIHBhcnQ6CiAgICAgICAgICAgICAgICAgICAgIyBGb3VuZCBwcm9jZXNzW3BpZF0gZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgcHJvY2VzcyA9IHBhcnQuc3BsaXQoJ1snKVswXQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NfZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgaSA+PSAyIGFuZCBub3QgcHJvY2Vzc19mb3VuZDogICMgU2tpcCB0aW1lc3RhbXAgYW5kIGhvc3RuYW1lCiAgICAgICAgICAgICAgICAgICAgIyBNaWdodCBiZSBqdXN0IHByb2Nlc3MgbmFtZQogICAgICAgICAgICAgICAgICAgIGlmICc6JyBub3QgaW4gcGFydCBhbmQgJzwnIG5vdCBpbiBwYXJ0OgogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzID0gcGFydAogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgIyBFeHRyYWN0IHN1YnN5c3RlbSBhbmQgY2F0ZWdvcnkgZnJvbSA8c3Vic3lzdGVtOmNhdGVnb3J5PiBmb3JtYXQKICAgICAgICAgICAgaWYgJzwnIGluIGxpbmUgYW5kICc+JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgc3Vic3lzdGVtX3N0YXJ0ID0gbGluZS5maW5kKCc8JykgKyAxCiAgICAgICAgICAgICAgICBzdWJzeXN0ZW1fZW5kID0gbGluZS5maW5kKCc+Jywgc3Vic3lzdGVtX3N0YXJ0KQogICAgICAgICAgICAgICAgaWYgc3Vic3lzdGVtX2VuZCA+IHN1YnN5c3RlbV9zdGFydDoKICAgICAgICAgICAgICAgICAgICBzdWJzeXN0ZW1faW5mbyA9IGxpbmVbc3Vic3lzdGVtX3N0YXJ0OnN1YnN5c3RlbV9lbmRdCiAgICAgICAgICAgICAgICAgICAgaWYgJzonIGluIHN1YnN5c3RlbV9pbmZvOgogICAgICAgICAgICAgICAgICAgICAgICBzdWJzeXN0ZW0sIGNhdGVnb3J5ID0gc3Vic3lzdGVtX2luZm8uc3BsaXQoJzonLCAxKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnN5c3RlbSA9IHN1YnN5c3RlbV9pbmZvCgogICAgICAgICAgICAjIEV4dHJhY3Qgc2V2ZXJpdHkgbGV2ZWwKICAgICAgICAgICAgc2V2ZXJpdHlfaW5kaWNhdG9ycyA9IFsnRXJyb3InLCAnRmF1bHQnLCAnRGVmYXVsdCcsICdJbmZvJywgJ0RlYnVnJ10KICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBzZXZlcml0eV9pbmRpY2F0b3JzOgogICAgICAgICAgICAgICAgaWYgaW5kaWNhdG9yIGluIGxpbmU6CiAgICAgICAgICAgICAgICAgICAgc2V2ZXJpdHkgPSBpbmRpY2F0b3IubG93ZXIoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAjIEV4dHJhY3QgdGhlIGFjdHVhbCBtZXNzYWdlIChldmVyeXRoaW5nIGFmdGVyIHRoZSBsYXN0IGNvbG9uKQogICAgICAgICAgICBjb2xvbl9wb3NpdGlvbnMgPSBbaSBmb3IgaSwgY2hhciBpbiBlbnVtZXJhdGUobGluZSkgaWYgY2hhciA9PSAnOiddCiAgICAgICAgICAgIGlmIGNvbG9uX3Bvc2l0aW9uczoKICAgICAgICAgICAgICAgICMgVGFrZSBtZXNzYWdlIGFmdGVyIHRoZSBsYXN0IG1lYW5pbmdmdWwgY29sb24KICAgICAgICAgICAgICAgIGZvciBwb3MgaW4gcmV2ZXJzZWQoY29sb25fcG9zaXRpb25zKToKICAgICAgICAgICAgICAgICAgICBwb3RlbnRpYWxfbWVzc2FnZSA9IGxpbmVbcG9zKzE6XS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBvdGVudGlhbF9tZXNzYWdlKSA+IDEwOiAgIyBNZWFuaW5nZnVsIG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IHBvdGVudGlhbF9tZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAjIE5vcm1hbGl6ZSBtZXNzYWdlIGZvciBiZXR0ZXIgZ3JvdXBpbmcKICAgICAgICAgICAgbm9ybWFsaXplZF9tZXNzYWdlID0gbm9ybWFsaXplX21lc3NhZ2VfZW5oYW5jZWQobWVzc2FnZSkKCiAgICAgICAgICAgICMgQ3JlYXRlIG1vcmUgbWVhbmluZ2Z1bCBncm91cGluZyBrZXlzCiAgICAgICAgICAgIGlmIGNhdGVnb3J5X25hbWUgPT0gJ25ldHdvcmsnOgogICAgICAgICAgICAgICAgZ3JvdXBfa2V5ID0gZiJORVRfe3N1YnN5c3RlbX1fe2NhdGVnb3J5fTp7bm9ybWFsaXplZF9tZXNzYWdlWzo2MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ3NlY3VyaXR5JzoKICAgICAgICAgICAgICAgIGdyb3VwX2tleSA9IGYiU0VDX3twcm9jZXNzfV97c3Vic3lzdGVtfTp7bm9ybWFsaXplZF9tZXNzYWdlWzo2MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ2Vycm9ycyc6CiAgICAgICAgICAgICAgICBncm91cF9rZXkgPSBmIkVSUl97c2V2ZXJpdHl9X3twcm9jZXNzfTp7bm9ybWFsaXplZF9tZXNzYWdlWzo2MF19IgogICAgICAgICAgICBlbGlmIGNhdGVnb3J5X25hbWUgPT0gJ2NyYXNoZXMnOgogICAgICAgICAgICAgICAgZ3JvdXBfa2V5ID0gZiJDUkFTSF97cHJvY2Vzc306e25vcm1hbGl6ZWRfbWVzc2FnZVs6NjBdfSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGdyb3VwX2tleSA9IGYie3Byb2Nlc3N9X3tzdWJzeXN0ZW19Ontub3JtYWxpemVkX21lc3NhZ2VbOjYwXX0iCgogICAgICAgICAgICBpZiBncm91cF9rZXkgbm90IGluIGV2ZW50X2dyb3VwczoKICAgICAgICAgICAgICAgIGV2ZW50X2dyb3Vwc1tncm91cF9rZXldID0gewogICAgICAgICAgICAgICAgICAgICdwcm9jZXNzJzogcHJvY2VzcywKICAgICAgICAgICAgICAgICAgICAnc3Vic3lzdGVtJzogc3Vic3lzdGVtLAogICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeSc6IGNhdGVnb3J5LAogICAgICAgICAgICAgICAgICAgICdzZXZlcml0eSc6IHNldmVyaXR5LAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlX3BhdHRlcm4nOiBub3JtYWxpemVkX21lc3NhZ2VbOjMwMF0sCiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMCwKICAgICAgICAgICAgICAgICAgICAnZmlyc3Rfc2Vlbic6IHBhcnRzWzBdIGlmIGxlbihwYXJ0cykgPiAwIGVsc2UgJ3JlY2VudCcsCiAgICAgICAgICAgICAgICAgICAgJ3NhbXBsZV9tZXNzYWdlJzogbWVzc2FnZVs6NDAwXSwKICAgICAgICAgICAgICAgICAgICAncmF3X3NhbXBsZSc6IGxpbmVbOjUwMF0gICMgS2VlcCByYXcgc2FtcGxlIGZvciBkZWJ1Z2dpbmcKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGV2ZW50X2dyb3Vwc1tncm91cF9rZXldWydjb3VudCddICs9IDEKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwYXJzaW5nX2Vycm9ycyArPSAxCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmIkZhaWxlZCB0byBwYXJzZSBsaW5lOiB7bGluZVs6MTAwXX0uLi4gRXJyb3I6IHtlfSIpCgogICAgICAgICAgICAjIEZhbGxiYWNrOiBhdCBsZWFzdCBjb3VudCB0aGUgZXZlbnQgZXZlbiBpZiBwYXJzaW5nIGZhaWxzCiAgICAgICAgICAgIGZhbGxiYWNrX2tleSA9IGYiVU5QQVJTRURfe2NhdGVnb3J5X25hbWV9OmdlbmVyaWNfZXZlbnQiCiAgICAgICAgICAgIGlmIGZhbGxiYWNrX2tleSBub3QgaW4gZXZlbnRfZ3JvdXBzOgogICAgICAgICAgICAgICAgZXZlbnRfZ3JvdXBzW2ZhbGxiYWNrX2tleV0gPSB7CiAgICAgICAgICAgICAgICAgICAgJ3Byb2Nlc3MnOiAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgJ3N1YnN5c3RlbSc6ICd1bmtub3duJywKICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknOiAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgJ3NldmVyaXR5JzogJ3Vua25vd24nLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlX3BhdHRlcm4nOiAnRmFpbGVkIHRvIHBhcnNlIGxvZyBlbnRyeScsCiAgICAgICAgICAgICAgICAgICAgJ2NvdW50JzogMCwKICAgICAgICAgICAgICAgICAgICAnZmlyc3Rfc2Vlbic6ICdyZWNlbnQnLAogICAgICAgICAgICAgICAgICAgICdzYW1wbGVfbWVzc2FnZSc6IGxpbmVbOjIwMF0sCiAgICAgICAgICAgICAgICAgICAgJ3Jhd19zYW1wbGUnOiBsaW5lWzozMDBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50X2dyb3Vwc1tmYWxsYmFja19rZXldWydjb3VudCddICs9IDEKICAgICAgICAgICAgY29udGludWUKCiAgICBsb2dnZXIuaW5mbyhmIkNyZWF0ZWQge2xlbihldmVudF9ncm91cHMpfSBldmVudCBncm91cHMgZnJvbSB7dG90YWxfY291bnR9IHRvdGFsIGV2ZW50cyIpCiAgICBsb2dnZXIuaW5mbyhmIlBhcnNpbmcgZXJyb3JzOiB7cGFyc2luZ19lcnJvcnN9IikKCiAgICAjIFNvcnQgYnkgY291bnQgYW5kIHRha2UgdG9wIGV2ZW50cwogICAgc29ydGVkX2dyb3VwcyA9IHNvcnRlZChldmVudF9ncm91cHMuaXRlbXMoKSwga2V5PWxhbWJkYSB4OiB4WzFdWydjb3VudCddLCByZXZlcnNlPVRydWUpCiAgICB0b3BfZXZlbnRzID0gW10KCiAgICBmb3IgZ3JvdXBfa2V5LCBkYXRhIGluIHNvcnRlZF9ncm91cHNbOjI1XTogICMgVG9wIDI1IGV2ZW50IHR5cGVzIGZvciBiZXR0ZXIgaW5zaWdodAogICAgICAgIHRvcF9ldmVudHMuYXBwZW5kKHsKICAgICAgICAgICAgJ3Byb2Nlc3MnOiBkYXRhWydwcm9jZXNzJ10sCiAgICAgICAgICAgICdzdWJzeXN0ZW0nOiBkYXRhWydzdWJzeXN0ZW0nXSwKICAgICAgICAgICAgJ2NhdGVnb3J5JzogZGF0YVsnY2F0ZWdvcnknXSwKICAgICAgICAgICAgJ3NldmVyaXR5JzogZGF0YVsnc2V2ZXJpdHknXSwKICAgICAgICAgICAgJ21lc3NhZ2VfcGF0dGVybic6IGRhdGFbJ21lc3NhZ2VfcGF0dGVybiddLAogICAgICAgICAgICAnY291bnQnOiBkYXRhWydjb3VudCddLAogICAgICAgICAgICAnZmlyc3Rfc2Vlbic6IGRhdGFbJ2ZpcnN0X3NlZW4nXSwKICAgICAgICAgICAgJ3NhbXBsZV9tZXNzYWdlJzogZGF0YVsnc2FtcGxlX21lc3NhZ2UnXSwKICAgICAgICAgICAgJ3BlcmNlbnRhZ2UnOiByb3VuZCgoZGF0YVsnY291bnQnXSAvIHRvdGFsX2NvdW50KSAqIDEwMCwgMikgaWYgdG90YWxfY291bnQgPiAwIGVsc2UgMCwKICAgICAgICAgICAgJ2dyb3VwX2tleSc6IGdyb3VwX2tleSAgIyBGb3IgZGVidWdnaW5nCiAgICAgICAgfSkKCiAgICByZXR1cm4gewogICAgICAgICd0b3BfZXZlbnRzJzogdG9wX2V2ZW50cywKICAgICAgICAnYWxsX2dyb3Vwcyc6IGV2ZW50X2dyb3VwcywKICAgICAgICAndG90YWxfY291bnQnOiB0b3RhbF9jb3VudCwKICAgICAgICAncGFyc2luZ19zdWNjZXNzX3JhdGUnOiByb3VuZCgoKHRvdGFsX2NvdW50IC0gcGFyc2luZ19lcnJvcnMpIC8gdG90YWxfY291bnQpICogMTAwLCAyKSBpZiB0b3RhbF9jb3VudCA+IDAgZWxzZSAwCiAgICB9CgpkZWYgbm9ybWFsaXplX21lc3NhZ2UobWVzc2FnZSk6CiAgICAiIiJOb3JtYWxpemUgbG9nIG1lc3NhZ2VzIGZvciBncm91cGluZyBieSByZW1vdmluZyB2YXJpYWJsZSBkYXRhIiIiCiAgICBpbXBvcnQgcmUKCiAgICAjIFJlbW92ZSBjb21tb24gdmFyaWFibGUgcGF0dGVybnMKICAgIG5vcm1hbGl6ZWQgPSBtZXNzYWdlCgogICAgIyBSZW1vdmUgZmlsZSBwYXRocwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJy9bL1x3XC4tXSsnLCAnW1BBVEhdJywgbm9ybWFsaXplZCkKCiAgICAjIFJlbW92ZSBQSURzIGFuZCBudW1lcmljIElEcwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ1xiXGR7Myx9XGInLCAnW0lEXScsIG5vcm1hbGl6ZWQpCgogICAgIyBSZW1vdmUgbWVtb3J5IGFkZHJlc3NlcwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJzB4WzAtOWEtZkEtRl0rJywgJ1tBRERSXScsIG5vcm1hbGl6ZWQpCgogICAgIyBSZW1vdmUgVVVJRHMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidbMC05YS1mQS1GXXs4fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXsxMn0nLCAnW1VVSURdJywgbm9ybWFsaXplZCkKCiAgICAjIFJlbW92ZSB0aW1lc3RhbXBzCiAgICBub3JtYWxpemVkID0gcmUuc3ViKHInXGR7NH0tXGR7Mn0tXGR7Mn1bXHNcVF1cZHsyfTpcZHsyfTpcZHsyfScsICdbVElNRVNUQU1QXScsIG5vcm1hbGl6ZWQpCgogICAgIyBSZW1vdmUgSVAgYWRkcmVzc2VzCiAgICBub3JtYWxpemVkID0gcmUuc3ViKHInXGJcZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XGInLCAnW0lQXScsIG5vcm1hbGl6ZWQpCgogICAgIyBDb2xsYXBzZSBtdWx0aXBsZSBzcGFjZXMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidccysnLCAnICcsIG5vcm1hbGl6ZWQpCgogICAgcmV0dXJuIG5vcm1hbGl6ZWQuc3RyaXAoKQoKZGVmIG5vcm1hbGl6ZV9tZXNzYWdlX2VuaGFuY2VkKG1lc3NhZ2UpOgogICAgIiIiRW5oYW5jZWQgbm9ybWFsaXphdGlvbiBmb3IgYmV0dGVyIGV2ZW50IGdyb3VwaW5nIHdpdGggbW9yZSBzcGVjaWZpYyBwYXR0ZXJucyIiIgogICAgaW1wb3J0IHJlCgogICAgIyBTdGFydCB3aXRoIGJhc2ljIG5vcm1hbGl6YXRpb24KICAgIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVfbWVzc2FnZShtZXNzYWdlKQoKICAgICMgQWRkaXRpb25hbCBtYWNPUy1zcGVjaWZpYyBwYXR0ZXJucwoKICAgICMgUmVtb3ZlIGJ1bmRsZSBpZGVudGlmaWVycyBidXQga2VlcCB0aGUgYXBwIG5hbWUKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidjb21cLlthLXpBLVowLTlcLi1dK1wuKFthLXpBLVowLTldKyknLCByJ1tCVU5ETEVdLlwxJywgbm9ybWFsaXplZCkKCiAgICAjIFJlbW92ZSB2ZXJzaW9uIG51bWJlcnMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidcYnY/XGQrXC5cZCsoXC5cZCspKlxiJywgJ1tWRVJTSU9OXScsIG5vcm1hbGl6ZWQpCgogICAgIyBSZW1vdmUgcG9ydCBudW1iZXJzCiAgICBub3JtYWxpemVkID0gcmUuc3ViKHInOlxkezIsNX1cYicsICc6W1BPUlRdJywgbm9ybWFsaXplZCkKCiAgICAjIFJlbW92ZSBNQUMgYWRkcmVzc2VzCiAgICBub3JtYWxpemVkID0gcmUuc3ViKHInKFswLTlhLWZBLUZdezJ9WzotXSl7NX1bMC05YS1mQS1GXXsyfScsICdbTUFDXScsIG5vcm1hbGl6ZWQpCgogICAgIyBSZW1vdmUgc3BlY2lmaWMgbnVtZXJpYyB2YWx1ZXMgYnV0IGtlZXAgZXJyb3IgY29kZXMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidcYlxkezEsMn1cYig/IVxzKihlcnJvcnxjb2RlfHN0YXR1cykpJywgJ1tOVU1dJywgbm9ybWFsaXplZCkKCiAgICAjIFJlbW92ZSB0ZW1wb3JhcnkgZmlsZSBuYW1lcwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ3RtcFthLXpBLVowLTldKycsICdbVE1QRklMRV0nLCBub3JtYWxpemVkKQoKICAgICMgUmVtb3ZlIHNlc3Npb24gSURzIGFuZCB0b2tlbnMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidcYlthLXpBLVowLTldezIwLH1cYicsICdbVE9LRU5dJywgbm9ybWFsaXplZCkKCiAgICAjIE5vcm1hbGl6ZSBjb21tb24gbmV0d29yayBwYXR0ZXJucwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ2J5dGVzPzpccypcZCsnLCAnYnl0ZXM6IFtTSVpFXScsIG5vcm1hbGl6ZWQpCiAgICBub3JtYWxpemVkID0gcmUuc3ViKHIndGltZW91dDpccypcZCsnLCAndGltZW91dDogW1RJTUVdJywgbm9ybWFsaXplZCkKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidwb3J0XHMrXGQrJywgJ3BvcnQgW1BPUlRdJywgbm9ybWFsaXplZCkKCiAgICAjIE5vcm1hbGl6ZSBlcnJvciBwYXR0ZXJucwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ2Vycm9yXHMqWy06XT9ccypcZCsnLCAnZXJyb3IgW0NPREVdJywgbm9ybWFsaXplZCkKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidlcnJub1xzKj0/XHMqXGQrJywgJ2Vycm5vPVtDT0RFXScsIG5vcm1hbGl6ZWQpCgogICAgIyBOb3JtYWxpemUgbWVtb3J5L3NpemUgcGF0dGVybnMKICAgIG5vcm1hbGl6ZWQgPSByZS5zdWIocidcZCtccyooS0J8TUJ8R0J8Ynl0ZXM/KScsICdbU0laRV0nLCBub3JtYWxpemVkKQoKICAgICMgUmVtb3ZlIHNwZWNpZmljIGRldmljZSBpZGVudGlmaWVycwogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ2RldmljZVxzK1thLXpBLVowLTlcLV0rJywgJ2RldmljZSBbSURdJywgbm9ybWFsaXplZCkKCiAgICAjIENvbGxhcHNlIG11bHRpcGxlIHNwYWNlcyBhZ2FpbgogICAgbm9ybWFsaXplZCA9IHJlLnN1YihyJ1xzKycsICcgJywgbm9ybWFsaXplZCkKCiAgICByZXR1cm4gbm9ybWFsaXplZC5zdHJpcCgpCgpkZWYgZ2V0X3N5c3RlbV9pbmZvKCk6CiAgICAiIiJDb2xsZWN0IHN5c3RlbSBpbmZvcm1hdGlvbiB1c2luZyBzeXN0ZW1fcHJvZmlsZXIgd2l0aCBmaWx0ZXJlZCBjYXRlZ29yaWVzIiIiCiAgICBsb2dnZXIuaW5mbygiQ29sbGVjdGluZyBzeXN0ZW0gaW5mb3JtYXRpb24uLi4iKQogICAgIyBSZWR1Y2UgbnVtYmVyIG9mIGNhdGVnb3JpZXMgY29sbGVjdGVkCiAgICBlc3NlbnRpYWxfY2F0ZWdvcmllcyA9IFsKICAgICAgICAiU1BIYXJkd2FyZURhdGFUeXBlIiwgICMgQmFzaWMgaGFyZHdhcmUgaW5mbwogICAgICAgICJTUFN0b3JhZ2VEYXRhVHlwZSIsICAgIyBTdG9yYWdlIGluZm8gb25seQogICAgXQogICAgc3lzdGVtX2luZm8gPSB7fQogICAgCiAgICBmb3IgY2F0ZWdvcnkgaW4gZXNzZW50aWFsX2NhdGVnb3JpZXM6CiAgICAgICAgY21kID0gWyJzeXN0ZW1fcHJvZmlsZXIiLCBjYXRlZ29yeSwgIi1qc29uIiwgIi1kZXRhaWxMZXZlbCIsICJtaW5pIl0KICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhyZXN1bHQuc3Rkb3V0KQogICAgICAgICAgICAjIEZpbHRlciBvdXQgdW5uZWNlc3NhcnkgZmllbGRzCiAgICAgICAgICAgIGlmIGNhdGVnb3J5IGluIGRhdGE6CiAgICAgICAgICAgICAgICBmaWx0ZXJlZF9kYXRhID0ge30KICAgICAgICAgICAgICAgIGZvciBrZXksIHZhbHVlIGluIGRhdGFbY2F0ZWdvcnldWzBdLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYga2V5IGluIFsic2VyaWFsX251bWJlciIsICJjYXBhY2l0eSIsICJzaXplIiwgIm1vZGVsIiwgInR5cGUiXToKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRfZGF0YVtrZXldID0gdmFsdWUKICAgICAgICAgICAgICAgIHN5c3RlbV9pbmZvW2NhdGVnb3J5XSA9IGZpbHRlcmVkX2RhdGEKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBjb2xsZWN0IHtjYXRlZ29yeX06IHtlfSIpCiAgICAKICAgIHJldHVybiBzeXN0ZW1faW5mbwoKZGVmIGdldF9zeXN0ZW1fc3RhdHMoKToKICAgICIiIkNvbGxlY3QgZXNzZW50aWFsIHN5c3RlbSBzdGF0aXN0aWNzIG9ubHkiIiIKICAgIGxvZ2dlci5pbmZvKCJDb2xsZWN0aW5nIHN5c3RlbSBzdGF0aXN0aWNzLi4uIikKICAgIHN0YXRzID0ge30KICAgIAogICAgIyBEaXNrIHVzYWdlIC0gc3VtbWFyeSBvbmx5CiAgICB0cnk6CiAgICAgICAgZGYgPSBzdWJwcm9jZXNzLnJ1bihbImRmIiwgIi1oIiwgIi8iXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgIHN0YXRzWyJkaXNrX3VzYWdlIl0gPSBkZi5zdGRvdXQuc3BsaXQoIlxuIilbMV0gICMgR2V0IG9ubHkgcm9vdCBwYXJ0aXRpb24gaW5mbwogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBjb2xsZWN0IGRpc2sgdXNhZ2U6IHtlfSIpCiAgICAKICAgICMgTWVtb3J5IHVzYWdlIC0gc3VtbWFyeSBvbmx5CiAgICB0cnk6CiAgICAgICAgdm1fc3RhdCA9IHN1YnByb2Nlc3MucnVuKFsidm1fc3RhdCJdLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgc3RhdHNbIm1lbW9yeV9zdGF0cyJdID0gIlxuIi5qb2luKHZtX3N0YXQuc3Rkb3V0LnNwbGl0KCJcbiIpWzo1XSkgICMgR2V0IG9ubHkgZmlyc3QgNSBsaW5lcwogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBjb2xsZWN0IG1lbW9yeSBzdGF0czoge2V9IikKICAgIAogICAgIyBDUFUgbG9hZCAtIHN1bW1hcnkgb25seSAgCiAgICB0cnk6CiAgICAgICAgdG9wID0gc3VicHJvY2Vzcy5ydW4oWyJ0b3AiLCAiLWwiLCAiMSIsICItbiIsICIxIiwgIi1zdGF0cyIsICJwaWQsY29tbWFuZCxjcHUiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICBzdGF0c1siY3B1X3N0YXRzIl0gPSAiXG4iLmpvaW4odG9wLnN0ZG91dC5zcGxpdCgiXG4iKVs6MTBdKSAgIyBHZXQgb25seSBmaXJzdCAxMCBwcm9jZXNzZXMKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gY29sbGVjdCBDUFUgc3RhdHM6IHtlfSIpCiAgICAKICAgIHJldHVybiBzdGF0cwoKZGVmIGNvbGxlY3RfbWFjb3NfbWV0YWRhdGEoKToKICAgICIiIk1haW4gZnVuY3Rpb24gdG8gY29sbGVjdCBhbGwgTWFjT1MgbWV0YWRhdGEiIiIKICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpICE9ICJEYXJ3aW4iOgogICAgICAgIGxvZ2dlci5lcnJvcigiVGhpcyBzY3JpcHQgb25seSBydW5zIG9uIE1hY09TIikKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgdHJ5OgogICAgICAgIGxvZ2dlci5pbmZvKCJTdGFydGluZyBNYWNPUyBtZXRhZGF0YSBjb2xsZWN0aW9uLi4uIikKCiAgICAgICAgIyBDb2xsZWN0IGJhc2ljIHN5c3RlbSBpbmZvIChmYXN0KQogICAgICAgIGxvZ2dlci5pbmZvKCJDb2xsZWN0aW5nIGJhc2ljIHN5c3RlbSBpbmZvcm1hdGlvbi4uLiIpCiAgICAgICAgc3lzdGVtX2luZm8gPSBnZXRfc3lzdGVtX2luZm8oKQogICAgICAgIHN5c3RlbV9zdGF0cyA9IGdldF9zeXN0ZW1fc3RhdHMoKQoKICAgICAgICAjIFByb2Nlc3MgMzAgZGF5cyBvZiBsb2dzIGFuZCBjcmVhdGUgc3VtbWFyeSAodGhpcyB0YWtlcyB0aW1lKQogICAgICAgIGxvZ2dlci5pbmZvKCJQcm9jZXNzaW5nIDMwIGRheXMgb2Ygc3lzdGVtIGxvZ3MgLSB0aGlzIG1heSB0YWtlIHNldmVyYWwgbWludXRlcy4uLiIpCiAgICAgICAgc3lzdGVtX2xvZ3Nfc3VtbWFyeSA9IGdldF9zeXN0ZW1fbG9ncyhkYXlzPTMwKQoKICAgICAgICBtZXRhZGF0YSA9IHsKICAgICAgICAgICAgInRpbWVzdGFtcCI6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAiaG9zdG5hbWUiOiBwbGF0Zm9ybS5ub2RlKCksCiAgICAgICAgICAgICJvc192ZXJzaW9uIjogcGxhdGZvcm0ucGxhdGZvcm0oKSwKICAgICAgICAgICAgImRhdGFfdHlwZSI6ICJtYWNvc19tZXRhZGF0YV93aXRoX2xvZ19zdW1tYXJ5IiwKICAgICAgICAgICAgInN5c3RlbV9sb2dzX3N1bW1hcnkiOiBzeXN0ZW1fbG9nc19zdW1tYXJ5LCAgIyBTdW1tYXJpemVkLCBub3QgcmF3CiAgICAgICAgICAgICJzeXN0ZW1faW5mbyI6IHN5c3RlbV9pbmZvLAogICAgICAgICAgICAic3lzdGVtX3N0YXRzIjogc3lzdGVtX3N0YXRzLAogICAgICAgICAgICAic3VtbWFyeV9zdGF0cyI6IHsKICAgICAgICAgICAgICAgICJ0b3RhbF9ldmVudHNfcHJvY2Vzc2VkIjogc3lzdGVtX2xvZ3Nfc3VtbWFyeS5nZXQoJ3RvdGFsX2V2ZW50c19wcm9jZXNzZWQnLCAwKSwKICAgICAgICAgICAgICAgICJjYXRlZ29yaWVzX2FuYWx5emVkIjogbGVuKHN5c3RlbV9sb2dzX3N1bW1hcnkuZ2V0KCdjYXRlZ29yaWVzJywge30pKSwKICAgICAgICAgICAgICAgICJjb2xsZWN0aW9uX3BlcmlvZCI6IHN5c3RlbV9sb2dzX3N1bW1hcnkuZ2V0KCdjb2xsZWN0aW9uX3BlcmlvZCcsICczMCBkYXlzJykKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbG9nZ2VyLmluZm8oZiJNYWNPUyBtZXRhZGF0YSBjb2xsZWN0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkiKQogICAgICAgIGxvZ2dlci5pbmZvKGYiUHJvY2Vzc2VkIHttZXRhZGF0YVsnc3VtbWFyeV9zdGF0cyddWyd0b3RhbF9ldmVudHNfcHJvY2Vzc2VkJ119IGxvZyBldmVudHMiKQogICAgICAgIGxvZ2dlci5pbmZvKGYiQW5hbHl6ZWQge21ldGFkYXRhWydzdW1tYXJ5X3N0YXRzJ11bJ2NhdGVnb3JpZXNfYW5hbHl6ZWQnXX0gbG9nIGNhdGVnb3JpZXMiKQoKICAgICAgICByZXR1cm4gbWV0YWRhdGEKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBjb2xsZWN0aW5nIG1ldGFkYXRhOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgc2VuZF9tZXRhZGF0YV90b19zZXJ2ZXIoZGV2aWNlVXVpZCwgaG9zdCwgbWV0YWRhdGEpOgogICAgIiIiU2VuZCBtZXRhZGF0YSB1c2luZyB0aGUgY29ycmVjdCBBUEkgZW5kcG9pbnQiIiIKICAgIHRyeToKICAgICAgICBib2R5ID0gewogICAgICAgICAgICAnZGV2aWNldXVpZCc6IGRldmljZVV1aWQsCiAgICAgICAgICAgICdtZXRhbG9nb3NfdHlwZSc6ICdtYWNvcy1sb2ctc3VtbWFyeScsCiAgICAgICAgICAgICdtZXRhbG9nb3MnOiBtZXRhZGF0YQogICAgICAgIH0KCiAgICAgICAgdXJsID0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCiAgICAgICAgaGVhZGVycyA9IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfQogICAgICAgIGxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBQT1NUIG1ldGFkYXRhIHRvOiB7dXJsfScpCgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKGJvZHkpKQogICAgICAgIGxvZ2dlci5pbmZvKGYnTWV0YWRhdGEgQVBJIHJlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9JykKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgaW4gWzIwMCwgMjAxXToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlN1Y2Nlc3NmdWxseSBzZW50IG1hY09TIG1ldGFkYXRhIHRvIHNlcnZlciIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIHNlbmQgbWV0YWRhdGEuIFN0YXR1czoge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSwgUmVzcG9uc2U6IHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBzZW5kaW5nIG1ldGFkYXRhOiB7c3RyKGUpfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgbWFpbigpOgogICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgIT0gIkRhcndpbiI6CiAgICAgICAgbG9nZ2VyLmVycm9yKCJUaGlzIHNjcmlwdCBvbmx5IHJ1bnMgb24gTWFjT1MiKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBJbml0aWFsaXplIGxvZ2dpbmcKICAgIGxvZ2ZpbGUob3MucGF0aC5qb2luKGxvZ0RpciwgIm1hY29zX21ldGFkYXRhLmxvZyIpKQoKICAgICMgR2V0IGNvbmZpZyBhbmQgZGV2aWNlIFVVSUQKICAgIHdlZ0NvbmZpZ0ZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnQuY29uZmlnJykKICAgIGRldmljZVV1aWQsIGhvc3QgPSBnZXREZXZpY2VVdWlkKHdlZ0NvbmZpZ0ZpbGUpCgogICAgdHJ5OgogICAgICAgICMgQ29sbGVjdCBtZXRhZGF0YQogICAgICAgIG1ldGFkYXRhID0gY29sbGVjdF9tYWNvc19tZXRhZGF0YSgpCiAgICAgICAgaWYgbWV0YWRhdGEgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJGYWlsZWQgdG8gY29sbGVjdCBtZXRhZGF0YSIpCgogICAgICAgICMgU2F2ZSBtZXRhZGF0YSB0byBmaWxlIGZvciBkZWJ1Z2dpbmcKICAgICAgICBvdXRwdXRfZmlsZSA9IG9zLnBhdGguam9pbihmaWxlc0RpciwgIm1hY29zX21ldGFkYXRhLmpzb24iKQogICAgICAgIHdpdGggb3BlbihvdXRwdXRfZmlsZSwgInciKSBhcyBmOgogICAgICAgICAgICBqc29uLmR1bXAobWV0YWRhdGEsIGYsIGluZGVudD00KQogICAgICAgIGxvZ2dlci5pbmZvKGYiTWV0YWRhdGEgc2F2ZWQgdG8ge291dHB1dF9maWxlfSIpCgogICAgICAgICMgU2VuZCBtZXRhZGF0YSB1c2luZyB0aGUgY29ycmVjdCBBUEkgZW5kcG9pbnQKICAgICAgICBpZiBzZW5kX21ldGFkYXRhX3RvX3NlcnZlcihkZXZpY2VVdWlkLCBob3N0LCBtZXRhZGF0YSk6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJNYWNPUyBtZXRhZGF0YSBjb2xsZWN0aW9uIGFuZCB1cGxvYWQgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gdXBsb2FkIG1ldGFkYXRhIHRvIHNlcnZlciIpCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byBjb2xsZWN0IE1hY09TIG1ldGFkYXRhOiB7ZX0iKQogICAgICAgIHN5cy5leGl0KDEpCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigp"}, "resigned_at": 1761308225}