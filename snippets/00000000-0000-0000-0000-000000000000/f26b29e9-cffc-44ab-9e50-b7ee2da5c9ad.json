{"settings": {"snippetUuid": "f26b29e9-cffc-44ab-9e50-b7ee2da5c9ad", "snippetname": "AgentUpdate", "snippettype": ".py", "created_at": 1765142887}, "payload": {"payloadsig": "QZ0Mj7CKQmMf0uyeaTaZoNSu7pVg5i1Ie1KV/o+mpLaiBlGmbxqi2adyaeyGbFFxwb+MC32TnQVvgUnBmnN5jscJldvL6ZgE/9AgVJOO80Pi+M52FSEEY3y4WNq6pzYpzlJErlb9dSUVAfGwx2F5tkxKv7BEfuJU5uH4SWhGzcGQn4DEXDQLQ18k+08dHEkZiS+LCyTMTh2dSo1sfkk8clZ/rVzEePY/E8HLNSVW6Ktj23N7jhlNVBU/qaiKaIUQ7YJOICzYFIg4y7nKGi95sbcQACWe0MZ6//c8/9H4tvFr1bNaMhhjqZ8Je8zpeiq4ZE9i1tC4JtwYx6gj4CRqWZsjaH+Dvl0W07IAba8kEWHjit2s2w4BMvIQPEMPo/d80qvPrheOqAUzpMu1KYE55w/lH8p5Ztq6pVzgR/9mz8GssgREFFk9wNI/1+U8to7wd6w2mxhL3EcWus1OO9dT6fUPHJ2Fe0ZfQAj3yunJ5V3Q+iW45gvojzTtpr/+aKRRFoLNbO5tR95t0VnXylKj76z5vk9JI+bjocN3o0kM5a/v60iO2jKCIafOSS11Ryk1SD096xKQISbFkasEz4pUSot6X3UoL6BIwa/OYq+w4miAgSCfOEeJzNLc6s/Mb4mf3NpgR0odkeZWHxH9dLvv5GxcN6TK2oe05oRCokn3bV4=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvQWdlbnRVcGRhdGUucHkKIyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKQ29tcHJlaGVuc2l2ZSBBZ2VudCBVcGRhdGUgU25pcHBldApTdXBwb3J0cyB1cGRhdGluZyBOQVRTIGFnZW50LCBjbGFzc2ljYWwgYWdlbnQsIG9yIGJvdGgKU3VwcG9ydHMgaW1tZWRpYXRlIGhvdC1yZWxvYWQgb3Igc2NoZWR1bGVkIHJlYm9vdApCYWNrd2FyZCBjb21wYXRpYmxlIHdpdGggdjMuMC4xIGFnZW50cwoiIiIKCmltcG9ydCBoYXNobGliCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHNodXRpbAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmltcG9ydCBkYXRldGltZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKCmltcG9ydCByZXF1ZXN0cwpmcm9tIGxvZ3plcm8gaW1wb3J0IGxvZ2dlciwgbG9nZmlsZQoKCmRlZiBsb2dfbWVzc2FnZShtc2cpOgogICAgIiIiTG9nIGEgbWVzc2FnZSB3aXRoIHRpbWVzdGFtcCIiIgogICAgbG9nZ2VyLmluZm8oZiJBR0VOVF9VUERBVEU6IHttc2d9IikKCgpkZWYgZ2V0X2FwcF9kaXJzKCk6CiAgICAiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMgYmFzZWQgb24gcGxhdGZvcm0iIiIKICAgIHN5c3RlbSA9IHBsYXRmb3JtLnN5c3RlbSgpCiAgICBpZiBzeXN0ZW0gPT0gJ1dpbmRvd3MnOgogICAgICAgIGFwcF9kaXIgPSByIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcV2Vnd2Vpc2VyIgogICAgZWxpZiBzeXN0ZW0gPT0gJ0Rhcndpbic6ICAjIG1hY09TCiAgICAgICAgYXBwX2RpciA9ICIvb3B0L1dlZ3dlaXNlciIKICAgIGVsc2U6ICAjIExpbnV4CiAgICAgICAgYXBwX2RpciA9ICIvb3B0L1dlZ3dlaXNlciIKCiAgICBsb2dfZGlyID0gb3MucGF0aC5qb2luKGFwcF9kaXIsICdMb2dzJykKICAgIGNvbmZpZ19kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ0NvbmZpZycpCiAgICBhZ2VudF9kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ0FnZW50JykKICAgIGJhY2t1cF9kaXIgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJy5iYWNrdXAnKQoKICAgIHJldHVybiBhcHBfZGlyLCBsb2dfZGlyLCBjb25maWdfZGlyLCBhZ2VudF9kaXIsIGJhY2t1cF9kaXIKCgpkZWYgZ2V0X2RldmljZV9jb25maWcoY29uZmlnX2Rpcik6CiAgICAiIiJSZXRyaWV2ZSBkZXZpY2UgVVVJRCBhbmQgc2VydmVyIGFkZHJlc3MgZnJvbSBjb25maWcgZmlsZSIiIgogICAgY29uZmlnX2ZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnX2RpciwgJ2FnZW50LmNvbmZpZycpCiAgICBsb2dfbWVzc2FnZShmIlJlYWRpbmcgY29uZmlnIGZyb20ge2NvbmZpZ19maWxlfSIpCgogICAgdHJ5OgogICAgICAgIHdpdGggb3Blbihjb25maWdfZmlsZSwgJ3InKSBhcyBmOgogICAgICAgICAgICBjb25maWdfZGljdCA9IGpzb24ubG9hZChmKQogICAgZXhjZXB0IChGaWxlTm90Rm91bmRFcnJvciwganNvbi5KU09ORGVjb2RlRXJyb3IpIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJFcnJvciByZWFkaW5nIGNvbmZpZzoge2V9IikKICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGRldmljZV91dWlkID0gY29uZmlnX2RpY3QuZ2V0KCdkZXZpY2V1dWlkJykKICAgIHNlcnZlcl9hZGRyID0gY29uZmlnX2RpY3QuZ2V0KCdzZXJ2ZXJBZGRyJywgJ2FwcC53ZWd3ZWlzZXIudGVjaCcpCgogICAgcmV0dXJuIGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkcgoKCmRlZiBkb3dubG9hZF9hbmRfdmVyaWZ5KHVybCwgZXhwZWN0ZWRfaGFzaCwgdGVtcF9maWxlKToKICAgICIiIkRvd25sb2FkIHVwZGF0ZSBwYWNrYWdlIGFuZCB2ZXJpZnkgU0hBMjU2IGhhc2giIiIKICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWRpbmcgdXBkYXRlIGZyb20ge3VybH0iKQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHRpbWVvdXQ9MzAwLCBzdHJlYW09VHJ1ZSkKICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKCiAgICAgICAgIyBTYXZlIHRvIHRlbXAgZmlsZQogICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGUsICd3YicpIGFzIGY6CiAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT04MTkyKToKICAgICAgICAgICAgICAgIGlmIGNodW5rOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCgogICAgICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWQgY29tcGxldGUsIHNhdmVkIHRvIHt0ZW1wX2ZpbGV9IikKCiAgICAgICAgIyBWZXJpZnkgaGFzaAogICAgICAgIHNoYTI1Nl9oYXNoID0gaGFzaGxpYi5zaGEyNTYoKQogICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgIGZvciBieXRlX2Jsb2NrIGluIGl0ZXIobGFtYmRhOiBmLnJlYWQoNDA5NiksIGIiIik6CiAgICAgICAgICAgICAgICBzaGEyNTZfaGFzaC51cGRhdGUoYnl0ZV9ibG9jaykKCiAgICAgICAgYWN0dWFsX2hhc2ggPSBzaGEyNTZfaGFzaC5oZXhkaWdlc3QoKQogICAgICAgIGxvZ19tZXNzYWdlKGYiRXhwZWN0ZWQgaGFzaDoge2V4cGVjdGVkX2hhc2h9IikKICAgICAgICBsb2dfbWVzc2FnZShmIkFjdHVhbCBoYXNoOiAgIHthY3R1YWxfaGFzaH0iKQoKICAgICAgICBpZiBhY3R1YWxfaGFzaCAhPSBleHBlY3RlZF9oYXNoOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiSGFzaCBtaXNtYXRjaCEgVXBkYXRlIHBhY2thZ2UgbWF5IGJlIGNvcnJ1cHRlZC4iKQoKICAgICAgICBsb2dfbWVzc2FnZSgiSGFzaCB2ZXJpZmljYXRpb24gc3VjY2Vzc2Z1bCIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiRG93bmxvYWQgZmFpbGVkOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiVmVyaWZpY2F0aW9uIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgYmFja3VwX2N1cnJlbnRfaW5zdGFsbGF0aW9uKGFnZW50X2RpciwgYmFja3VwX2Rpcik6CiAgICAiIiJCYWNrdXAgY3VycmVudCBpbnN0YWxsYXRpb24gZm9yIHJvbGxiYWNrIiIiCiAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICBiYWNrdXBfcGF0aCA9IG9zLnBhdGguam9pbihiYWNrdXBfZGlyLCBmImFnZW50LWJhY2t1cC17dGltZXN0YW1wfSIpCgogICAgbG9nX21lc3NhZ2UoZiJDcmVhdGluZyBiYWNrdXAgYXQge2JhY2t1cF9wYXRofSIpCgogICAgdHJ5OgogICAgICAgIG9zLm1ha2VkaXJzKGJhY2t1cF9wYXRoLCBleGlzdF9vaz1UcnVlKQoKICAgICAgICAjIENvcHkgZW50aXJlIEFnZW50IGRpcmVjdG9yeQogICAgICAgIHNodXRpbC5jb3B5dHJlZShhZ2VudF9kaXIsIG9zLnBhdGguam9pbihiYWNrdXBfcGF0aCwgJ0FnZW50JyksIGRpcnNfZXhpc3Rfb2s9VHJ1ZSkKCiAgICAgICAgbG9nX21lc3NhZ2UoZiJCYWNrdXAgY3JlYXRlZCBzdWNjZXNzZnVsbHkiKQogICAgICAgIHJldHVybiBiYWNrdXBfcGF0aAoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIkJhY2t1cCBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCgpkZWYgZXh0cmFjdF91cGRhdGUodGVtcF9maWxlLCBpbnN0YWxsX2Rpcik6CiAgICAiIiJFeHRyYWN0IHVwZGF0ZSB0YXJiYWxsIHRvIGluc3RhbGxhdGlvbiBkaXJlY3RvcnkiIiIKICAgIGxvZ19tZXNzYWdlKGYiRXh0cmFjdGluZyB1cGRhdGUgdG8ge2luc3RhbGxfZGlyfSIpCgogICAgdHJ5OgogICAgICAgICMgRW5zdXJlIGluc3RhbGxhdGlvbiBkaXJlY3RvcnkgZXhpc3RzCiAgICAgICAgb3MubWFrZWRpcnMoaW5zdGFsbF9kaXIsIGV4aXN0X29rPVRydWUpCgogICAgICAgICMgRXh0cmFjdCB1c2luZyB0YXIgY29tbWFuZCAodGFyYmFsbCByb290IGlzICJBZ2VudC8iIHNvIHdlIGV4dHJhY3QKICAgICAgICAjIGRpcmVjdGx5IGludG8gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeSwgZS5nLiBDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFdlZ3dlaXNlcgogICAgICAgICMgb3IgL29wdC9XZWd3ZWlzZXIpCiAgICAgICAgY21kID0gWyd0YXInLCAnLXh6ZicsIHRlbXBfZmlsZSwgJy1DJywgaW5zdGFsbF9kaXJdCgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEyMCkKCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKGYidGFyIGNvbW1hbmQgZmFpbGVkOiB7cmVzdWx0LnN0ZGVycn0iKQoKICAgICAgICBsb2dfbWVzc2FnZSgiRXh0cmFjdGlvbiBjb21wbGV0ZSIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJFeHRyYWN0aW9uIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcm9sbGJhY2tfaW5zdGFsbGF0aW9uKGJhY2t1cF9wYXRoLCBhZ2VudF9kaXIpOgogICAgIiIiUm9sbGJhY2sgdG8gcHJldmlvdXMgaW5zdGFsbGF0aW9uIGZyb20gYmFja3VwIiIiCiAgICBsb2dfbWVzc2FnZShmIlJvbGxpbmcgYmFjayBpbnN0YWxsYXRpb24gZnJvbSB7YmFja3VwX3BhdGh9IikKCiAgICB0cnk6CiAgICAgICAgYmFja3VwX2FnZW50ID0gb3MucGF0aC5qb2luKGJhY2t1cF9wYXRoLCAnQWdlbnQnKQoKICAgICAgICAjIFJlbW92ZSBjdXJyZW50IGluc3RhbGxhdGlvbgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGFnZW50X2Rpcik6CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUoYWdlbnRfZGlyKQoKICAgICAgICAjIFJlc3RvcmUgZnJvbSBiYWNrdXAKICAgICAgICBzaHV0aWwuY29weXRyZWUoYmFja3VwX2FnZW50LCBhZ2VudF9kaXIpCgogICAgICAgIGxvZ19tZXNzYWdlKCJSb2xsYmFjayBzdWNjZXNzZnVsIikKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIlJvbGxiYWNrIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcmVzdGFydF9zZXJ2aWNlX2ltbWVkaWF0ZSgpOgogICAgIiIiUmVzdGFydCBhZ2VudCBzZXJ2aWNlIGltbWVkaWF0ZWx5IHdpdGggdmVyaWZpY2F0aW9uIGFuZCBmYWxsYmFjayIiIgogICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgIGxvZ19tZXNzYWdlKGYiUmVzdGFydGluZyBhZ2VudCBzZXJ2aWNlIG9uIHtzeXN0ZW19IikKCiAgICB0cnk6CiAgICAgICAgaWYgc3lzdGVtID09ICJMaW51eCI6CiAgICAgICAgICAgIHJldHVybiByZXN0YXJ0X2xpbnV4X3NlcnZpY2UoKQogICAgICAgIGVsaWYgc3lzdGVtID09ICJEYXJ3aW4iOiAgIyBtYWNPUwogICAgICAgICAgICByZXR1cm4gcmVzdGFydF9tYWNvc19zZXJ2aWNlKCkKICAgICAgICBlbGlmIHN5c3RlbSA9PSAiV2luZG93cyI6CiAgICAgICAgICAgICMgT24gV2luZG93cyB0aGUgdXBkYXRlIHNuaXBwZXQgb2Z0ZW4gcnVucyBpbnNpZGUgdGhlCiAgICAgICAgICAgICMgV2Vnd2Vpc2VyQWdlbnQgc2VydmljZSBwcm9jZXNzIChOQVRTIGFnZW50KS4gU3RvcHBpbmcgdGhlCiAgICAgICAgICAgICMgc2VydmljZSBkaXJlY3RseSBmcm9tIGhlcmUgd291bGQgdGVybWluYXRlIHRoaXMgcHJvY2VzcyBiZWZvcmUgaXQKICAgICAgICAgICAgIyBjYW4gc3RhcnQgaXQgYWdhaW4uIEluc3RlYWQsIGRlbGVnYXRlIHJlc3RhcnQgdG8gYSBUYXNrIFNjaGVkdWxlcgogICAgICAgICAgICAjIHRhc2sgdGhhdCBydW5zIG91dC1vZi1wcm9jZXNzIHVuZGVyIFNZU1RFTS4KICAgICAgICAgICAgcmV0dXJuIHJlc3RhcnRfd2luZG93c19zZXJ2aWNlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dfbWVzc2FnZShmIlVua25vd24gcGxhdGZvcm06IHtzeXN0ZW19IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ19tZXNzYWdlKGYiU2VydmljZSByZXN0YXJ0IGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcmVzdGFydF93aW5kb3dzX3NlcnZpY2UoKToKICAgICIiIlNjaGVkdWxlIGEgV2luZG93cyBzZXJ2aWNlIHJlc3RhcnQgdmlhIFRhc2sgU2NoZWR1bGVyLgoKICAgIFRoZSB1cGRhdGUgc25pcHBldCB0eXBpY2FsbHkgcnVucyBpbnNpZGUgdGhlIFdlZ3dlaXNlckFnZW50IHNlcnZpY2UKICAgIHByb2Nlc3MuIElmIHdlIHRyaWVkIHRvIHN0b3AgdGhlIHNlcnZpY2UgZGlyZWN0bHkgZnJvbSBoZXJlLCBXaW5kb3dzCiAgICB3b3VsZCB0ZXJtaW5hdGUgdGhpcyBwcm9jZXNzIGJlZm9yZSBpdCBjb3VsZCBzdGFydCB0aGUgc2VydmljZSBhZ2Fpbi4KCiAgICBUbyBhdm9pZCB0aGlzLCB3ZSBjcmVhdGUvdXBkYXRlIGEgVGFzayBTY2hlZHVsZXIgdGFzayB0aGF0IHJ1bnMgdW5kZXIKICAgIFNZU1RFTSBhbmQgZXhlY3V0ZXMgYSBzbWFsbCBQb3dlclNoZWxsIGNvbW1hbmQgdG8gcmVzdGFydCB0aGUKICAgIFdlZ3dlaXNlckFnZW50IHNlcnZpY2Ugb3V0LW9mLXByb2Nlc3MuIFdlIHRoZW4gdHJpZ2dlciB0aGF0IHRhc2sgb25jZS4KICAgICIiIgoKICAgIHRhc2tfbmFtZSA9ICJXZWd3ZWlzZXIgQWdlbnQgUmVzdGFydCIKCiAgICAjIFBvd2VyU2hlbGwgY29tbWFuZCBleGVjdXRlZCBieSB0aGUgc2NoZWR1bGVkIHRhc2suIFVzaW5nIHNpbmdsZSBxdW90ZXMKICAgICMgaW5zaWRlIHRoZSAtQ29tbWFuZCBhcmd1bWVudCBrZWVwcyBxdW90aW5nIHNpbXBsZS4KICAgIGFjdGlvbiA9ICgKICAgICAgICAicG93ZXJzaGVsbC5leGUgLU5vUHJvZmlsZSAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAiCiAgICAgICAgIi1Db21tYW5kICdTdGFydC1TbGVlcCAtU2Vjb25kcyAzOyBSZXN0YXJ0LVNlcnZpY2UgV2Vnd2Vpc2VyQWdlbnQgLUZvcmNlJyIKICAgICkKCiAgICB0cnk6CiAgICAgICAgbG9nX21lc3NhZ2UoIkNyZWF0aW5nL3VwZGF0aW5nIFRhc2sgU2NoZWR1bGVyIGpvYiB0byByZXN0YXJ0IFdlZ3dlaXNlckFnZW50Li4uIikKCiAgICAgICAgY3JlYXRlX2NtZCA9IFsKICAgICAgICAgICAgInNjaHRhc2tzIiwgIlx4MkZDcmVhdGUiLCAgIyB1c2UgbGl0ZXJhbCAvIHRvIGF2b2lkIGVzY2FwaW5nIGlzc3VlcwogICAgICAgICAgICAiL1ROIiwgdGFza19uYW1lLAogICAgICAgICAgICAiL1NDIiwgIk9OQ0UiLAogICAgICAgICAgICAiL1NUIiwgIjAwOjAwIiwKICAgICAgICAgICAgIi9SVSIsICJTWVNURU0iLAogICAgICAgICAgICAiL1JMIiwgIkhJR0hFU1QiLAogICAgICAgICAgICAiL1RSIiwgYWN0aW9uLAogICAgICAgICAgICAiL0YiLAogICAgICAgIF0KCiAgICAgICAgIyBOb3JtYWxpemUgYW55IGVzY2FwZWQgc2xhc2ggdGhhdCBtaWdodCBzbmVhayBpbjsgc2NodGFza3MgZXhwZWN0cyAnLycKICAgICAgICBjcmVhdGVfY21kID0gW2FyZy5yZXBsYWNlKCJcXHgyRiIsICIvIikgZm9yIGFyZyBpbiBjcmVhdGVfY21kXQoKICAgICAgICBjcmVhdGVfcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIGNyZWF0ZV9jbWQsCiAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsCiAgICAgICAgICAgIHRleHQ9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0zMCwKICAgICAgICApCgogICAgICAgIGlmIGNyZWF0ZV9yZXN1bHQucmV0dXJuY29kZSAhPSAwOgogICAgICAgICAgICBsb2dfbWVzc2FnZSgKICAgICAgICAgICAgICAgICJGYWlsZWQgdG8gY3JlYXRlL3VwZGF0ZSByZXN0YXJ0IHRhc2s6ICIKICAgICAgICAgICAgICAgIGYie2NyZWF0ZV9yZXN1bHQuc3RkZXJyIG9yIGNyZWF0ZV9yZXN1bHQuc3Rkb3V0fSIKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgbG9nX21lc3NhZ2UoIlJlc3RhcnQgdGFzayBjcmVhdGVkL3VwZGF0ZWQgc3VjY2Vzc2Z1bGx5LCB0cmlnZ2VyaW5nIGl0IG5vdy4uLiIpCgogICAgICAgIHJ1bl9jbWQgPSBbInNjaHRhc2tzIiwgIi9SdW4iLCAiL1ROIiwgdGFza19uYW1lXQogICAgICAgIHJ1bl9yZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgcnVuX2NtZCwKICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwKICAgICAgICAgICAgdGV4dD1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTMwLAogICAgICAgICkKCiAgICAgICAgaWYgcnVuX3Jlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKAogICAgICAgICAgICAgICAgIkZhaWxlZCB0byBydW4gcmVzdGFydCB0YXNrOiAiCiAgICAgICAgICAgICAgICBmIntydW5fcmVzdWx0LnN0ZGVyciBvciBydW5fcmVzdWx0LnN0ZG91dH0iCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGxvZ19tZXNzYWdlKAogICAgICAgICAgICAiUmVzdGFydCB0YXNrIHRyaWdnZXJlZCBzdWNjZXNzZnVsbHk7ICIKICAgICAgICAgICAgIldlZ3dlaXNlckFnZW50IHdpbGwgYmUgcmVzdGFydGVkIGJ5IFRhc2sgU2NoZWR1bGVyLiIKICAgICAgICApCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJXaW5kb3dzIHNlcnZpY2UgcmVzdGFydCBzY2hlZHVsaW5nIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgcmVzdGFydF9saW51eF9zZXJ2aWNlKCk6CiAgICAiIiJSZXN0YXJ0IExpbnV4IHN5c3RlbWQgc2VydmljZXMgd2l0aCB2ZXJpZmljYXRpb24iIiIKICAgIGxvZ19tZXNzYWdlKCJSZXN0YXJ0aW5nIExpbnV4IHN5c3RlbWQgc2VydmljZXMuLi4iKQoKICAgIHNlcnZpY2VzID0gWyJ3ZWd3ZWlzZXItYWdlbnQiLCAid2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQiXQogICAgYWxsX3N1Y2Nlc3MgPSBUcnVlCgogICAgZm9yIHNlcnZpY2UgaW4gc2VydmljZXM6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJSZXN0YXJ0aW5nIHtzZXJ2aWNlfS4uLiIpCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyJzeXN0ZW1jdGwiLCAicmVzdGFydCIsIHNlcnZpY2VdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCgogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRmFpbGVkIHRvIHJlc3RhcnQge3NlcnZpY2V9OiB7cmVzdWx0LnN0ZGVycn0iKQogICAgICAgICAgICBhbGxfc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICMgVmVyaWZ5IGl0J3MgcnVubmluZwogICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBjaGVjayA9IHN1YnByb2Nlc3MucnVuKFsic3lzdGVtY3RsIiwgImlzLWFjdGl2ZSIsIHNlcnZpY2VdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0xMCkKCiAgICAgICAgaWYgY2hlY2suc3Rkb3V0LnN0cmlwKCkgPT0gImFjdGl2ZSI6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiT0s6IHtzZXJ2aWNlfSB2ZXJpZmllZCBhY3RpdmUiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRkFJTDoge3NlcnZpY2V9IG5vdCBhY3RpdmU6IHtjaGVjay5zdGRvdXQuc3RyaXAoKX0iKQogICAgICAgICAgICBhbGxfc3VjY2VzcyA9IEZhbHNlCgogICAgcmV0dXJuIGFsbF9zdWNjZXNzCgoKZGVmIHJlc3RhcnRfbWFjb3Nfc2VydmljZSgpOgogICAgIiIiUmVzdGFydCBtYWNPUyBMYXVuY2hEYWVtb25zIHdpdGggdmVyaWZpY2F0aW9uIiIiCiAgICBsb2dfbWVzc2FnZSgiUmVzdGFydGluZyBtYWNPUyBMYXVuY2hEYWVtb25zLi4uIikKCiAgICBzZXJ2aWNlcyA9IFsKICAgICAgICAidGVjaC53ZWd3ZWlzZXIuYWdlbnQiLAogICAgICAgICJ0ZWNoLndlZ3dlaXNlci5wZXJzaXN0ZW50LWFnZW50IgogICAgXQoKICAgIGFsbF9zdWNjZXNzID0gVHJ1ZQoKICAgIGZvciBzZXJ2aWNlIGluIHNlcnZpY2VzOgogICAgICAgIGxvZ19tZXNzYWdlKGYiUmVzdGFydGluZyB7c2VydmljZX0uLi4iKQoKICAgICAgICAjIFN0b3AKICAgICAgICBzdWJwcm9jZXNzLnJ1bihbImxhdW5jaGN0bCIsICJzdG9wIiwgc2VydmljZV0sIGNoZWNrPUZhbHNlKQogICAgICAgIHRpbWUuc2xlZXAoMikKCiAgICAgICAgIyBTdGFydAogICAgICAgIHN0YXJ0X3Jlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsibGF1bmNoY3RsIiwgInN0YXJ0Iiwgc2VydmljZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MzApCgogICAgICAgIGlmIHN0YXJ0X3Jlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKGYiRmFpbGVkIHRvIHN0YXJ0IHtzZXJ2aWNlfToge3N0YXJ0X3Jlc3VsdC5zdGRlcnJ9IikKICAgICAgICAgICAgYWxsX3N1Y2Nlc3MgPSBGYWxzZQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAjIFZlcmlmeQogICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBjaGVjayA9IHN1YnByb2Nlc3MucnVuKFsibGF1bmNoY3RsIiwgImxpc3QiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MTApCgogICAgICAgIGlmIHNlcnZpY2UgaW4gY2hlY2suc3Rkb3V0OgogICAgICAgICAgICBsb2dfbWVzc2FnZShmIk9LOiB7c2VydmljZX0gdmVyaWZpZWQgcnVubmluZyIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nX21lc3NhZ2UoZiJGQUlMOiB7c2VydmljZX0gbm90IGZvdW5kIGluIGxhdW5jaGN0bCBsaXN0IikKICAgICAgICAgICAgYWxsX3N1Y2Nlc3MgPSBGYWxzZQoKICAgIHJldHVybiBhbGxfc3VjY2VzcwoKCmRlZiBzdGFnZV91cGRhdGVfZm9yX3JlYm9vdCh0ZW1wX2ZpbGUsIGFwcF9kaXIpOgogICAgIiIiU3RhZ2UgdXBkYXRlIGZvciBhcHBsaWNhdGlvbiBhZnRlciBuZXh0IHJlYm9vdCIiIgogICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgIHN0YWdpbmdfZmlsZSA9IG9zLnBhdGguam9pbihhcHBfZGlyLCAnc3RhZ2VkLXVwZGF0ZS50YXIuZ3onKQoKICAgIGxvZ19tZXNzYWdlKGYiU3RhZ2luZyB1cGRhdGUgZm9yIHJlYm9vdCBvbiB7c3lzdGVtfSIpCgogICAgdHJ5OgogICAgICAgICMgQ29weSB1cGRhdGUgcGFja2FnZSB0byBzdGFnaW5nIGFyZWEKICAgICAgICBzaHV0aWwuY29weTIodGVtcF9maWxlLCBzdGFnaW5nX2ZpbGUpCiAgICAgICAgbG9nX21lc3NhZ2UoZiJVcGRhdGUgc3RhZ2VkIGF0IHtzdGFnaW5nX2ZpbGV9IikKCiAgICAgICAgaWYgc3lzdGVtID09ICJMaW51eCI6CiAgICAgICAgICAgICMgQ3JlYXRlIG9uZXNob3Qgc3lzdGVtZCBzZXJ2aWNlIHRvIGFwcGx5IG9uIG5leHQgYm9vdAogICAgICAgICAgICB1bml0X2NvbnRlbnQgPSBmIiIiW1VuaXRdCkRlc2NyaXB0aW9uPUFwcGx5IFdlZ3dlaXNlciBBZ2VudCBVcGRhdGUKQWZ0ZXI9bmV0d29yay50YXJnZXQKCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKRXhlY1N0YXJ0PS9iaW4vdGFyIC14emYge3N0YWdpbmdfZmlsZX0gLUMge2FwcF9kaXJ9CkV4ZWNTdGFydFBvc3Q9L2Jpbi9ybSAtZiB7c3RhZ2luZ19maWxlfQpFeGVjU3RhcnRQb3N0PS9iaW4vc3lzdGVtY3RsIHJlc3RhcnQgd2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQKUmVtYWluQWZ0ZXJFeGl0PXllcwoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0CiIiIgogICAgICAgICAgICB1bml0X2ZpbGUgPSAnL2V0Yy9zeXN0ZW1kL3N5c3RlbS93ZWd3ZWlzZXItYXBwbHktdXBkYXRlLnNlcnZpY2UnCiAgICAgICAgICAgIHdpdGggb3Blbih1bml0X2ZpbGUsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUodW5pdF9jb250ZW50KQoKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJzeXN0ZW1jdGwiLCAiZGFlbW9uLXJlbG9hZCJdLCBjaGVjaz1UcnVlKQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInN5c3RlbWN0bCIsICJlbmFibGUiLCAid2Vnd2Vpc2VyLWFwcGx5LXVwZGF0ZS5zZXJ2aWNlIl0sIGNoZWNrPVRydWUpCiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJTeXN0ZW1kIHVuaXQgY3JlYXRlZCBhbmQgZW5hYmxlZCIpCgogICAgICAgIGVsaWYgc3lzdGVtID09ICJXaW5kb3dzIjoKICAgICAgICAgICAgIyBDcmVhdGUgc2NoZWR1bGVkIHRhc2sgdG8gcnVuIG9uIHN0YXJ0dXAKICAgICAgICAgICAgIyBGb3Igbm93LCBqdXN0IGxvZyB0aGF0IGl0J3Mgc3RhZ2VkIChjYW4gYmUgZW5oYW5jZWQgd2l0aCBzY2h0YXNrcykKICAgICAgICAgICAgbG9nX21lc3NhZ2UoIlVwZGF0ZSBzdGFnZWQgZm9yIG1hbnVhbCBhcHBsaWNhdGlvbiBhZnRlciByZWJvb3QiKQogICAgICAgICAgICBsb2dfbWVzc2FnZSgiV2luZG93cyBzY2hlZHVsZWQgdGFzayBjcmVhdGlvbiB3b3VsZCBnbyBoZXJlIikKCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nX21lc3NhZ2UoZiJTdGFnaW5nIGZhaWxlZDoge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCgoKCmRlZiBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCBzdGF0dXMsIHZlcnNpb24sIGVycm9yX21zZz1Ob25lKToKICAgICIiIlNlbmQgdXBkYXRlIHN0YXR1cyBiYWNrIHRvIHNlcnZlciIiIgogICAgdHJ5OgogICAgICAgIHVybCA9IGYiaHR0cHM6Ly97c2VydmVyX2FkZHJ9L2FwaS9kZXZpY2Uve2RldmljZV91dWlkfS91cGRhdGUtc3RhdHVzIgogICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICdzdGF0dXMnOiBzdGF0dXMsCiAgICAgICAgICAgICd2ZXJzaW9uJzogdmVyc2lvbiwKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdyhkYXRldGltZS5VVEMpLmlzb2Zvcm1hdCgpLAogICAgICAgICAgICAnZXJyb3JfbWVzc2FnZSc6IGVycm9yX21zZywKICAgICAgICB9CgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGpzb249cGF5bG9hZCwgdGltZW91dD0zMCkKICAgICAgICBsb2dfbWVzc2FnZShmIlN0YXR1cyBzZW50IHRvIHNlcnZlcjoge3N0YXR1c30iKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dfbWVzc2FnZShmIkZhaWxlZCB0byBzZW5kIHN0YXR1cyB0byBzZXJ2ZXI6IHtlfSIpCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgTUFJTiBFWEVDVVRJT04gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiBtYWluKCk6CiAgICAiIiJNYWluIGV4ZWN1dGlvbiBmdW5jdGlvbiIiIgoKICAgICMgR2V0IGFwcGxpY2F0aW9uIGRpcmVjdG9yaWVzCiAgICBhcHBfZGlyLCBsb2dfZGlyLCBjb25maWdfZGlyLCBhZ2VudF9kaXIsIGJhY2t1cF9kaXIgPSBnZXRfYXBwX2RpcnMoKQoKICAgICMgU2V0dXAgbG9nZ2luZwogICAgb3MubWFrZWRpcnMobG9nX2RpciwgZXhpc3Rfb2s9VHJ1ZSkKICAgIGxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obG9nX2RpciwgJ2FnZW50X3VwZGF0ZS5sb2cnKQogICAgbG9nZmlsZShsb2dfZmlsZV9wYXRoKQoKICAgIGxvZ19tZXNzYWdlKCI9PT0gQWdlbnQgVXBkYXRlIFNjcmlwdCBTdGFydGVkID09PSIpCiAgICBsb2dfbWVzc2FnZShmIlBsYXRmb3JtOiB7cGxhdGZvcm0uc3lzdGVtKCl9IHtwbGF0Zm9ybS5yZWxlYXNlKCl9IikKCiAgICAjIEdldCBkZXZpY2UgY29uZmlndXJhdGlvbgogICAgZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyID0gZ2V0X2RldmljZV9jb25maWcoY29uZmlnX2RpcikKICAgIGxvZ19tZXNzYWdlKGYiRGV2aWNlIFVVSUQ6IHtkZXZpY2VfdXVpZH0iKQogICAgbG9nX21lc3NhZ2UoZiJTZXJ2ZXI6IHtzZXJ2ZXJfYWRkcn0iKQoKICAgICMgR2V0IHBhcmFtZXRlcnMgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgKHBhc3NlZCBieSBhZ2VudCBleGVjdXRvcikKICAgIHVwZGF0ZV92ZXJzaW9uID0gb3MuZ2V0ZW52KCdVUERBVEVfVkVSU0lPTicsICczLjAuMicpCiAgICB1cGRhdGVfdXJsID0gb3MuZ2V0ZW52KCdVUERBVEVfVVJMJywgZidodHRwczovL3tzZXJ2ZXJfYWRkcn0vaW5zdGFsbGVyRmlsZXMve3BsYXRmb3JtLnN5c3RlbSgpfS91cGRhdGVzL2FnZW50LXt1cGRhdGVfdmVyc2lvbn0udGFyLmd6JykKICAgIHVwZGF0ZV9oYXNoID0gb3MuZ2V0ZW52KCdVUERBVEVfSEFTSCcsICcnKQogICAgYXBwbHlfbW9kZSA9IG9zLmdldGVudignQVBQTFlfTU9ERScsICdpbW1lZGlhdGUnKQogICAgdGFyZ2V0X2NvbXBvbmVudCA9IG9zLmdldGVudignVEFSR0VUX0NPTVBPTkVOVCcsICdib3RoJykKCiAgICBsb2dfbWVzc2FnZShmIlVwZGF0ZSB2ZXJzaW9uOiB7dXBkYXRlX3ZlcnNpb259IikKICAgIGxvZ19tZXNzYWdlKGYiVXBkYXRlIFVSTDoge3VwZGF0ZV91cmx9IikKICAgIGxvZ19tZXNzYWdlKGYiQXBwbHkgbW9kZToge2FwcGx5X21vZGV9IikKICAgIGxvZ19tZXNzYWdlKGYiVGFyZ2V0IGNvbXBvbmVudDoge3RhcmdldF9jb21wb25lbnR9IikKCiAgICBpZiBub3QgdXBkYXRlX2hhc2g6CiAgICAgICAgbG9nX21lc3NhZ2UoIkVSUk9SOiBObyB1cGRhdGUgaGFzaCBwcm92aWRlZCwgY2Fubm90IHZlcmlmeSBwYWNrYWdlIGludGVncml0eSIpCiAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnTm8gaGFzaCBwcm92aWRlZCcpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIERvd25sb2FkIHVwZGF0ZSBwYWNrYWdlCiAgICB0ZW1wX2ZpbGUgPSBvcy5wYXRoLmpvaW4oYXBwX2RpciwgJ1RlbXAnLCBmJ3VwZGF0ZS17dXBkYXRlX3ZlcnNpb259LnRhci5neicpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmRpcm5hbWUodGVtcF9maWxlKSwgZXhpc3Rfb2s9VHJ1ZSkKCiAgICBpZiBub3QgZG93bmxvYWRfYW5kX3ZlcmlmeSh1cGRhdGVfdXJsLCB1cGRhdGVfaGFzaCwgdGVtcF9maWxlKToKICAgICAgICBsb2dfbWVzc2FnZSgiRG93bmxvYWQgb3IgdmVyaWZpY2F0aW9uIGZhaWxlZCIpCiAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnRG93bmxvYWQvdmVyaWZpY2F0aW9uIGZhaWxlZCcpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIEJhY2t1cCBjdXJyZW50IGluc3RhbGxhdGlvbgogICAgYmFja3VwX3BhdGggPSBiYWNrdXBfY3VycmVudF9pbnN0YWxsYXRpb24oYWdlbnRfZGlyLCBiYWNrdXBfZGlyKQogICAgaWYgbm90IGJhY2t1cF9wYXRoOgogICAgICAgIGxvZ19tZXNzYWdlKCJCYWNrdXAgZmFpbGVkLCBhYm9ydGluZyB1cGRhdGUiKQogICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdmYWlsZWQnLCB1cGRhdGVfdmVyc2lvbiwgJ0JhY2t1cCBmYWlsZWQnKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBFeHRyYWN0IHVwZGF0ZQogICAgaWYgbm90IGV4dHJhY3RfdXBkYXRlKHRlbXBfZmlsZSwgYXBwX2Rpcik6CiAgICAgICAgbG9nX21lc3NhZ2UoIkV4dHJhY3Rpb24gZmFpbGVkLCBhdHRlbXB0aW5nIHJvbGxiYWNrIikKICAgICAgICByb2xsYmFja19pbnN0YWxsYXRpb24oYmFja3VwX3BhdGgsIGFnZW50X2RpcikKICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdFeHRyYWN0aW9uIGZhaWxlZCcpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIEFwcGx5IHVwZGF0ZSBiYXNlZCBvbiBtb2RlCiAgICBpZiBhcHBseV9tb2RlID09ICdpbW1lZGlhdGUnOgogICAgICAgIGxvZ19tZXNzYWdlKCJBcHBseWluZyB1cGRhdGUgaW1tZWRpYXRlbHkiKQoKICAgICAgICBpZiByZXN0YXJ0X3NlcnZpY2VfaW1tZWRpYXRlKCk6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJVcGRhdGUgYXBwbGllZCBzdWNjZXNzZnVsbHkiKQogICAgICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnc3VjY2VzcycsIHVwZGF0ZV92ZXJzaW9uKQoKICAgICAgICAgICAgIyBDbGVhbiB1cCB0ZW1wIGZpbGUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKHRlbXBfZmlsZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dfbWVzc2FnZSgiU2VydmljZSByZXN0YXJ0IGZhaWxlZCwgYXR0ZW1wdGluZyByb2xsYmFjayIpCiAgICAgICAgICAgIHJvbGxiYWNrX2luc3RhbGxhdGlvbihiYWNrdXBfcGF0aCwgYWdlbnRfZGlyKQogICAgICAgICAgICByZXN0YXJ0X3NlcnZpY2VfaW1tZWRpYXRlKCkgICMgVHJ5IHRvIHJlc3RhcnQgb2xkIHZlcnNpb24KICAgICAgICAgICAgc2VuZF91cGRhdGVfc3RhdHVzKGRldmljZV91dWlkLCBzZXJ2ZXJfYWRkciwgJ2ZhaWxlZCcsIHVwZGF0ZV92ZXJzaW9uLCAnU2VydmljZSByZXN0YXJ0IGZhaWxlZCcpCiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgZWxpZiBhcHBseV9tb2RlID09ICdzY2hlZHVsZWRfcmVib290JzoKICAgICAgICBsb2dfbWVzc2FnZSgiU3RhZ2luZyB1cGRhdGUgZm9yIHJlYm9vdCIpCgogICAgICAgIGlmIHN0YWdlX3VwZGF0ZV9mb3JfcmVib290KHRlbXBfZmlsZSwgYXBwX2Rpcik6CiAgICAgICAgICAgIGxvZ19tZXNzYWdlKCJVcGRhdGUgc3RhZ2VkIHN1Y2Nlc3NmdWxseSwgd2lsbCBhcHBseSBvbiBuZXh0IHJlYm9vdCIpCiAgICAgICAgICAgIHNlbmRfdXBkYXRlX3N0YXR1cyhkZXZpY2VfdXVpZCwgc2VydmVyX2FkZHIsICdzdGFnZWQnLCB1cGRhdGVfdmVyc2lvbikKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dfbWVzc2FnZSgiU3RhZ2luZyBmYWlsZWQiKQogICAgICAgICAgICBzZW5kX3VwZGF0ZV9zdGF0dXMoZGV2aWNlX3V1aWQsIHNlcnZlcl9hZGRyLCAnZmFpbGVkJywgdXBkYXRlX3ZlcnNpb24sICdTdGFnaW5nIGZhaWxlZCcpCiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgbG9nX21lc3NhZ2UoIj09PSBBZ2VudCBVcGRhdGUgU2NyaXB0IENvbXBsZXRlZCA9PT0iKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCkK"}}