{"settings": {"snippetUuid": "8f19c07b-83de-4356-a16d-23ae1bb17350", "snippetname": "updateAgentWithPersistent", "snippettype": ".py", "created_at": 1749649288}, "payload": {"payloadsig": "soJlct+3iNnx8aoHlgOpHjueG0h3Igf0QRltcLHc5bof6RfwluVhdL5hP2Y0rLji7SgGW+SUqcWz1q1xXxkViT3OlgGZ2cS0zGtfjroyPDXHa/JXRsFBQQMxHXETNEAQCAQUBWui0812oDMMDJ34htXcuiP1qZiRsTM4196FG/wZkwT8iW5LcKKDTTmIRLlqgk1ikywBjzc590s2NZiMynw67i1GlHMycYcguUmJxvmyoptjbToxpIy5TUPDT57dqKY5vOu1GwWWouI7xbbspK5iY1IUa4X6Ps8NhnOZ9nCDrDRdglr4u7LqGKpoCZNOcMJ53qEwT5pLrdvUMJmrEqSVRM69JY5Szj69yeyUH/ic3zN4jntYcxfXohTZ+bOj8ULEBSVk7ppYUf+VC7EQLzj9bYfAus2/LKzIzzUxYJ78KOIYYEJgAU2K1s6NWURzydRh6NmFTQT4CM9NC7UwatIuV7veD47xt5jI5T3x17b8lq5p9B++mtpv+5hpIHR8nN9hifcVi7uR+pFRxoQcCuig65weAvHzpKchMquqsFwhX/xrsMIfnT34QHV2Kilf4b5qsR++7vmhG5L3DbA0PCCds+6ty5V1IKpu4giqjMV4igjPaecd6JAVp0P4vkq6IuVqjj78PtP7reOeGX9KHwOGyt05OiHC6+Mq4nuafpw=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvdXBkYXRlQWdlbnRXaXRoUGVyc2lzdGVudC5weQppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyCgpkZWYgZ2V0RGV2aWNlQ29uZmlnKGNvbmZpZ0ZpbGUpOgogICAgbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlYWQgY29uZmlnIGZpbGU6IHtjb25maWdGaWxlfS4uLicpCiAgICBpZiBvcy5wYXRoLmlzZmlsZShjb25maWdGaWxlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3Blbihjb25maWdGaWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICBjb25maWdEaWN0ID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IHJlYWQge2NvbmZpZ0ZpbGV9JykKICAgICAgICAgICAgZGV2aWNlVXVpZCA9IGNvbmZpZ0RpY3RbJ2RldmljZXV1aWQnXQoKICAgICAgICAgICAgIyBUaGUgY29uZmlnIGZpbGUgZG9lc24ndCBzdG9yZSBncm91cHV1aWQsIHdlIG5lZWQgdG8gZ2V0IGl0IGZyb20gdGhlIGRldmljZSByZWdpc3RyYXRpb24KICAgICAgICAgICAgIyBGb3Igbm93LCB3ZSdsbCB1c2UgYSBwbGFjZWhvbGRlciBhbmQgbGV0IHRoZSBzY3JpcHQgaGFuZGxlIGRldmljZSBsb29rdXAKICAgICAgICAgICAgIyBUaGUgaW5zdGFsbEFnZW50LnNoIHNjcmlwdCBvbmx5IG5lZWRzIGdyb3VwdXVpZCBmb3IgTkVXIHJlZ2lzdHJhdGlvbnMKICAgICAgICAgICAgIyBGb3IgZXhpc3RpbmcgZGV2aWNlcywgaXQgd2lsbCBza2lwIHJlZ2lzdHJhdGlvbiBhbmQganVzdCB1cGRhdGUKICAgICAgICAgICAgZ3JvdXBVdWlkID0gJ2V4aXN0aW5nLWRldmljZScgICMgUGxhY2Vob2xkZXIgZm9yIGV4aXN0aW5nIGluc3RhbGxhdGlvbnMKCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYnRGV2aWNlIFVVSUQ6IHtkZXZpY2VVdWlkfScpCiAgICAgICAgICAgIHJldHVybiBkZXZpY2VVdWlkLCBncm91cFV1aWQsIGNvbmZpZ0RpY3QKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byByZWFkIHtjb25maWdGaWxlfToge2V9JykKICAgICAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUsIE5vbmUKICAgIGVsc2U6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYne2NvbmZpZ0ZpbGV9IGRvZXMgbm90IGV4aXN0LicpCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUsIE5vbmUKCmRlZiBnZXRBcHBEaXJzKCk6CiAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CiAgICAgICAgYXBwRGlyID0gJ2M6XFxwcm9ncmFtIGZpbGVzICh4ODYpXFxXZWd3ZWlzZXJcXCcKICAgIGVsc2U6CiAgICAgICAgYXBwRGlyID0gJy9vcHQvV2Vnd2Vpc2VyLycKICAgIGNvbmZpZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdDb25maWcnLCAnJykKICAgIHJldHVybiBhcHBEaXIsIGNvbmZpZ0RpcgoKZGVmIHJ1bkFnZW50VXBkYXRlKCk6CiAgICAiIiJSdW4gdGhlIGVuaGFuY2VkIGluc3RhbGxBZ2VudC5zaCBzY3JpcHQgdG8gdXBkYXRlIGJvdGggYWdlbnRzIiIiCiAgICAKICAgICMgT25seSBydW4gb24gTGludXggc3lzdGVtcwogICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgIT0gJ0xpbnV4JzoKICAgICAgICBsb2dnZXIuaW5mbygnRW5oYW5jZWQgYWdlbnQgdXBkYXRlIG9ubHkgc3VwcG9ydGVkIG9uIExpbnV4IHN5c3RlbXMnKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICAjIEdldCBkZXZpY2UgY29uZmlndXJhdGlvbgogICAgYXBwRGlyLCBjb25maWdEaXIgPSBnZXRBcHBEaXJzKCkKICAgIGNvbmZpZ0ZpbGUgPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnQuY29uZmlnJykKICAgIGRldmljZVV1aWQsIGdyb3VwVXVpZCwgY29uZmlnRGljdCA9IGdldERldmljZUNvbmZpZyhjb25maWdGaWxlKQoKICAgIGlmIG5vdCBkZXZpY2VVdWlkOgogICAgICAgIGxvZ2dlci5lcnJvcignQ291bGQgbm90IGRldGVybWluZSBkZXZpY2UgVVVJRCBmcm9tIGNvbmZpZycpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgbG9nZ2VyLmluZm8oZidVcGRhdGluZyBhZ2VudCBmb3IgZGV2aWNlIHtkZXZpY2VVdWlkfScpCgogICAgdHJ5OgogICAgICAgICMgU3RvcCBwZXJzaXN0ZW50IGFnZW50IHNlcnZpY2UgZmlyc3QgaWYgaXQncyBydW5uaW5nCiAgICAgICAgbG9nZ2VyLmluZm8oJ0NoZWNraW5nIGFuZCBzdG9wcGluZyBwZXJzaXN0ZW50IGFnZW50IHNlcnZpY2UuLi4nKQogICAgICAgIHRyeToKICAgICAgICAgICAgc2VydmljZV9zdGF0dXMgPSBzdWJwcm9jZXNzLnJ1bihbJ3N1ZG8nLCAnc3lzdGVtY3RsJywgJ2lzLWFjdGl2ZScsICd3ZWd3ZWlzZXItcGVyc2lzdGVudC1hZ2VudC5zZXJ2aWNlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICAgICAgaWYgc2VydmljZV9zdGF0dXMucmV0dXJuY29kZSA9PSAwOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1N0b3BwaW5nIHBlcnNpc3RlbnQgYWdlbnQgc2VydmljZSBiZWZvcmUgdXBkYXRlLi4uJykKICAgICAgICAgICAgICAgIHN0b3BfcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ3N5c3RlbWN0bCcsICdzdG9wJywgJ3dlZ3dlaXNlci1wZXJzaXN0ZW50LWFnZW50LnNlcnZpY2UnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0zMCkKICAgICAgICAgICAgICAgIGlmIHN0b3BfcmVzdWx0LnJldHVybmNvZGUgPT0gMDoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnUGVyc2lzdGVudCBhZ2VudCBzZXJ2aWNlIHN0b3BwZWQgc3VjY2Vzc2Z1bGx5JykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidGYWlsZWQgdG8gc3RvcCBzZXJ2aWNlOiB7c3RvcF9yZXN1bHQuc3RkZXJyfScpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnUGVyc2lzdGVudCBhZ2VudCBzZXJ2aWNlIGlzIG5vdCBydW5uaW5nJykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnQ291bGQgbm90IGNoZWNrL3N0b3AgcGVyc2lzdGVudCBhZ2VudCBzZXJ2aWNlOiB7ZX0nKQoKICAgICAgICAjIFVzZSB0aGUgV2Vnd2Vpc2VyIHRlbXAgZGlyZWN0b3J5IHdoaWNoIHNob3VsZCBiZSB3cml0YWJsZQogICAgICAgIGltcG9ydCB0aW1lCiAgICAgICAgdGVtcF9kaXIgPSAnL29wdC9XZWd3ZWlzZXIvVGVtcCcKCiAgICAgICAgIyBFbnN1cmUgdGVtcCBkaXJlY3RvcnkgZXhpc3RzCiAgICAgICAgb3MubWFrZWRpcnModGVtcF9kaXIsIGV4aXN0X29rPVRydWUpCgogICAgICAgICMgQ3JlYXRlIHVuaXF1ZSB0ZW1wIHNjcmlwdCBuYW1lCiAgICAgICAgdGVtcF9zY3JpcHQgPSBvcy5wYXRoLmpvaW4odGVtcF9kaXIsIGYnaW5zdGFsbEFnZW50X3tpbnQodGltZS50aW1lKCkpfS5zaCcpCgogICAgICAgICMgRG93bmxvYWQgdGhlIHNjcmlwdCBmaXJzdAogICAgICAgIGxvZ2dlci5pbmZvKCdEb3dubG9hZGluZyBlbmhhbmNlZCBpbnN0YWxsYXRpb24gc2NyaXB0Li4uJykKICAgICAgICBkb3dubG9hZF9jbWQgPSBmJ2N1cmwgLW8ge3RlbXBfc2NyaXB0fSBodHRwczovL2FwcC53ZWd3ZWlzZXIudGVjaC9kb3dubG9hZC9pbnN0YWxsQWdlbnQuc2gnCiAgICAgICAgZG93bmxvYWRfcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oZG93bmxvYWRfY21kLCBzaGVsbD1UcnVlLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9NjApCgogICAgICAgIGlmIGRvd25sb2FkX3Jlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkb3dubG9hZCBzY3JpcHQ6IHtkb3dubG9hZF9yZXN1bHQuc3RkZXJyfScpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAjIE1ha2UgaXQgZXhlY3V0YWJsZQogICAgICAgIG9zLmNobW9kKHRlbXBfc2NyaXB0LCAwbzc1NSkKCiAgICAgICAgIyBGb3IgZXhpc3RpbmcgZGV2aWNlcywgd2UgY2FuIHVzZSBhbnkgZ3JvdXAgVVVJRCBhcyBwbGFjZWhvbGRlciBzaW5jZSByZWdpc3RyYXRpb24gd2lsbCBiZSBza2lwcGVkCiAgICAgICAgcGxhY2Vob2xkZXJfZ3JvdXAgPSAnZXhpc3RpbmctZGV2aWNlLXVwZGF0ZScKCiAgICAgICAgIyBSdW4gdGhlIGluc3RhbGxhdGlvbiBzY3JpcHQKICAgICAgICBsb2dnZXIuaW5mbyhmJ1J1bm5pbmcgZW5oYW5jZWQgaW5zdGFsbGF0aW9uIHNjcmlwdC4uLicpCiAgICAgICAgcnVuX2NtZCA9IGYnc3VkbyB7dGVtcF9zY3JpcHR9IHtwbGFjZWhvbGRlcl9ncm91cH0nCgogICAgICAgIGxvZ2dlci5pbmZvKGYnRXhlY3V0aW5nOiB7cnVuX2NtZH0nKQogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKHJ1bl9jbWQsIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0zMDApCgogICAgICAgICMgQ2xlYW4gdXAgdGVtcCBzY3JpcHQKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnJlbW92ZSh0ZW1wX3NjcmlwdCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnQ291bGQgbm90IHJlbW92ZSB0ZW1wIHNjcmlwdCB7dGVtcF9zY3JpcHR9OiB7ZX0nKQogICAgICAgIAogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdBZ2VudCB1cGRhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYnVXBkYXRlIG91dHB1dDoge3Jlc3VsdC5zdGRvdXR9JykKCiAgICAgICAgICAgICMgV2FpdCBhIG1vbWVudCBmb3Igc2VydmljZSB0byBzdGFydAogICAgICAgICAgICBpbXBvcnQgdGltZQogICAgICAgICAgICB0aW1lLnNsZWVwKDUpCgogICAgICAgICAgICAjIENoZWNrIGlmIHBlcnNpc3RlbnQgYWdlbnQgc2VydmljZSBpcyBydW5uaW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlcnZpY2Vfc3RhdHVzID0gc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ3N5c3RlbWN0bCcsICdpcy1hY3RpdmUnLCAnd2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQuc2VydmljZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICAgICAgaWYgc2VydmljZV9zdGF0dXMucmV0dXJuY29kZSA9PSAwOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdQZXJzaXN0ZW50IGFnZW50IHNlcnZpY2UgaXMgcnVubmluZyBhZnRlciB1cGRhdGUnKQoKICAgICAgICAgICAgICAgICAgICAjIEFsc28gY2hlY2sgc2VydmljZSBsb2dzIGZvciBhbnkgaW1tZWRpYXRlIGVycm9ycwogICAgICAgICAgICAgICAgICAgIGxvZ19jaGVjayA9IHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICdqb3VybmFsY3RsJywgJy11JywgJ3dlZ3dlaXNlci1wZXJzaXN0ZW50LWFnZW50LnNlcnZpY2UnLCAnLS1zaW5jZScsICcxIG1pbnV0ZSBhZ28nLCAnLW4nLCAnMTAnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgICAgIGlmIGxvZ19jaGVjay5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdSZWNlbnQgc2VydmljZSBsb2dzOicpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGxvZ19jaGVjay5zdGRvdXQpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCdQZXJzaXN0ZW50IGFnZW50IHNlcnZpY2UgaXMgbm90IHJ1bm5pbmcgYWZ0ZXIgdXBkYXRlJykKICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBnZXQgc2VydmljZSBzdGF0dXMgZm9yIGRlYnVnZ2luZwogICAgICAgICAgICAgICAgICAgIHN0YXR1c19jaGVjayA9IHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICdzeXN0ZW1jdGwnLCAnc3RhdHVzJywgJ3dlZ3dlaXNlci1wZXJzaXN0ZW50LWFnZW50LnNlcnZpY2UnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEwKQogICAgICAgICAgICAgICAgICAgIGlmIHN0YXR1c19jaGVjay5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ1NlcnZpY2Ugc3RhdHVzOiB7c3RhdHVzX2NoZWNrLnN0ZG91dH0nKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidDb3VsZCBub3QgY2hlY2sgcGVyc2lzdGVudCBhZ2VudCBzZXJ2aWNlIHN0YXR1czoge2V9JykKCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnQWdlbnQgdXBkYXRlIGZhaWxlZCB3aXRoIHJldHVybiBjb2RlIHtyZXN1bHQucmV0dXJuY29kZX0nKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBvdXRwdXQ6IHtyZXN1bHQuc3RkZXJyfScpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlRpbWVvdXRFeHBpcmVkOgogICAgICAgIGxvZ2dlci5lcnJvcignQWdlbnQgdXBkYXRlIHRpbWVkIG91dCBhZnRlciA1IG1pbnV0ZXMnKQogICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIHJ1bm5pbmcgYWdlbnQgdXBkYXRlOiB7ZX0nKQogICAgICAgIHJldHVybiBGYWxzZQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgTUFJTiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIGVuaGFuY2VkIGFnZW50IHVwZGF0ZSAoY3JvbiArIHBlcnNpc3RlbnQpJykKCnN1Y2Nlc3MgPSBydW5BZ2VudFVwZGF0ZSgpCgppZiBzdWNjZXNzOgogICAgbG9nZ2VyLmluZm8oJ0VuaGFuY2VkIGFnZW50IHVwZGF0ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5JykKICAgIGxvZ2dlci5pbmZvKCdCb3RoIGNyb24tYmFzZWQgYW5kIHBlcnNpc3RlbnQgYWdlbnRzIGhhdmUgYmVlbiB1cGRhdGVkJykKICAgIGxvZ2dlci5pbmZvKCdUaGUgcGVyc2lzdGVudCBhZ2VudCBzZXJ2aWNlIHNob3VsZCBub3cgYmUgcnVubmluZyB3aXRoIHRoZSBsYXRlc3QgY29kZScpCmVsc2U6CiAgICBsb2dnZXIuZXJyb3IoJ0VuaGFuY2VkIGFnZW50IHVwZGF0ZSBmYWlsZWQnKQogICAgbG9nZ2VyLmluZm8oJ0NoZWNrIHRoZSBsb2dzIGFib3ZlIGZvciBkZXRhaWxzJykK"}, "resigned_at": 1761308222}