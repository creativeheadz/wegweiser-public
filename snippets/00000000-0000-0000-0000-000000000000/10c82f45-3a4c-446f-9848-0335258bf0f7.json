{"settings": {"snippetUuid": "10c82f45-3a4c-446f-9848-0335258bf0f7", "snippetname": "WindowsAudit", "snippettype": ".py", "created_at": 1763039211}, "payload": {"payloadsig": "CXYlZlsI0OXmPOb+fG1ROcQlCD7Z+ApnhqXfBuGBRn4EWIvqk0rlWQNnR+joOhJV9MmEumN2aJUhgbij4F2yqQ0/S7r75Hu654mIQulc3RXKPohEyc7xN5HHHohAJXkhohbicQ6B8ME2xV9FdU5IM/SuACFv7Lw6ifPJXPBMvK805EyO4QaZGPVfyRdGoCa1GjrVePKeTcXicLWEjMTLpXq2Jm8qLN27BsfQiQV9VecsA7LBbwnTYVPqpK+208bWup6ZtqjnZZtuWgCc+wmDnfPdIGkcoycViR22CmwLujDcxDJ+xm9+CYOTrZTf6lvJ6gbZoOZ+9488gyuC0Kc4mun7vAbHs/pW2r5OZmG+7ygUw5Blb5884JBRgYPF0iUXKdizsVsDI8pl72hhgvdZoX1YBXXqL/XElJ9hPX5XY5zTv9i4LXnszxn0NUmCQ/0zrcU/4K9+nzlqmITP4dorabsSoNFyciI5JkigpAnG05K40O+DmokAyUnJncxyiQs5/0oUu9I3wqYamMfngsJkMWWztNSZuYjxWvRhaMPQiUc6NAfdbPs2rbH1bYoQBd+7G667Sh4tM1TDpEfifbl/RYn5Cn1VlLd2eFuafqBlYKv+Fa3vPv3/2J11s00bmOG1+hKfWlTnQ8BgVFpIQkB8C3lyUFxgM6NbSBQEQbDZx/s=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvV2luZG93c0F1ZGl0LnB5CiIiIgpXaW5kb3dzLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyCkNvbGxlY3RzIGNvbXByZWhlbnNpdmUgc3lzdGVtIGluZm9ybWF0aW9uIHVzaW5nIHBzdXRpbCBhbmQgV2luZG93cy1zcGVjaWZpYyB0b29scwoiIiIKaW1wb3J0IHNvY2tldAppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCB0aW1lCmltcG9ydCBnZXRwYXNzCmltcG9ydCBzeXMKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IGRhdGV0aW1lCgojIEltcG9ydCBkZXBlbmRlbmNpZXMKdHJ5OgogICAgZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKICAgIGZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCgp0cnk6CiAgICBpbXBvcnQgcHN1dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdwc3V0aWwnXSkKICAgIGltcG9ydCBwc3V0aWwKCnRyeToKICAgIGltcG9ydCByZXF1ZXN0cwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAncmVxdWVzdHMnXSkKICAgIGltcG9ydCByZXF1ZXN0cwoKdHJ5OgogICAgaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCiAgICBpbXBvcnQgZG5zLnJlc29sdmVyCgp0cnk6CiAgICBpbXBvcnQgd2luMzJhcGkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgbG9nZ2VyLmluZm8oJ0luc3RhbGxpbmcgcHlwaXdpbjMyLi4uJykKICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICctbScsICdwaXAnLCAnaW5zdGFsbCcsICdweXBpd2luMzInXSkKICAgIGltcG9ydCB3aW4zMmFwaQoKIyBJbXBvcnQgc2hhcmVkIHV0aWxpdGllcwpmcm9tIEF1ZGl0Q29tbW9uIGltcG9ydCAoCiAgICBjb252ZXJ0U2l6ZSwgc2VuZEpzb25QYXlsb2FkRmxhc2ssIGdldFB1YmxpY0lwQWRkciwgZ2V0VXNlckhvbWVQYXRoLAogICAgZ2V0RGV2aWNlVXVpZCwgZ2V0QXBwRGlycywgZGVsRmlsZSwgZW5zdXJlUHN1dGlsCikKZnJvbSBQc3V0aWxNZXRyaWNzIGltcG9ydCBnZXRDcHVNZXRyaWNzLCBnZXRNZW1vcnlNZXRyaWNzCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIENPTkZJR1VSQVRJT04gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVidWdNb2RlID0gVHJ1ZQpob3N0ID0gJ2FwcC53ZWd3ZWlzZXIudGVjaCcKcG9ydCA9IDQ0MwoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVmIGdldENwdUluZm8oZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IENQVSBpbmZvcm1hdGlvbiBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgogICAgdHJ5OgogICAgICAgICMgR2V0IENQVSBuYW1lIGZyb20gV01JCiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9Qcm9jZXNzb3IpLk5hbWUiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBjcHVOYW1lID0gJyAnLmpvaW4ocmVzdWx0LnN0ZG91dC5zcGxpdCgpKSBpZiByZXN1bHQuc3Rkb3V0IGVsc2UgJ1Vua25vd24nCiAgICAgICAgCiAgICAgICAgbG9nZ2VyLmluZm8oZidjcHVOYW1lOiB7Y3B1TmFtZX0nKQogICAgICAgIAogICAgICAgICMgR2V0IGNvbXByZWhlbnNpdmUgQ1BVIG1ldHJpY3MKICAgICAgICBjcHVfbWV0cmljcyA9IGdldENwdU1ldHJpY3MoKQogICAgICAgIAogICAgICAgIGRldmljZURhdGFEaWN0WydjcHUnXSA9IHsKICAgICAgICAgICAgJ2NwdW5hbWUnOiBjcHVOYW1lLAogICAgICAgICAgICAnY3B1X21ldHJpY3MnOiBjcHVfbWV0cmljcwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIENQVSBpbmZvOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydjcHUnXSA9IHsKICAgICAgICAgICAgJ2NwdW5hbWUnOiAnVW5rbm93bicsCiAgICAgICAgICAgICdjcHVfbWV0cmljcyc6IHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1lbW9yeURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IG1lbW9yeSBpbmZvcm1hdGlvbiBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgogICAgdHJ5OgogICAgICAgIHZtZW0gPSBwc3V0aWwudmlydHVhbF9tZW1vcnkoKQogICAgICAgIAogICAgICAgICMgQmFzaWMgbWVtb3J5IGluZm8KICAgICAgICB0b3RhbE1lbW9yeSA9IHZtZW0udG90YWwKICAgICAgICBhdmFpbGFibGVNZW1vcnkgPSB2bWVtLmF2YWlsYWJsZQogICAgICAgIHVzZWRNZW1vcnkgPSB2bWVtLnVzZWQKICAgICAgICBmcmVlTWVtb3J5ID0gdm1lbS5mcmVlCiAgICAgICAgCiAgICAgICAgIyBHZXQgY29tcHJlaGVuc2l2ZSBtZW1vcnkgbWV0cmljcwogICAgICAgIG1lbW9yeV9tZXRyaWNzID0gZ2V0TWVtb3J5TWV0cmljcygpCiAgICAgICAgCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewogICAgICAgICAgICAndG90YWwnOiB0b3RhbE1lbW9yeSwKICAgICAgICAgICAgJ2F2YWlsYWJsZSc6IGF2YWlsYWJsZU1lbW9yeSwKICAgICAgICAgICAgJ3VzZWQnOiB1c2VkTWVtb3J5LAogICAgICAgICAgICAnZnJlZSc6IGZyZWVNZW1vcnksCiAgICAgICAgICAgICdtZW1vcnlfbWV0cmljcyc6IG1lbW9yeV9tZXRyaWNzCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvZ2dlci5pbmZvKGYnTWVtb3J5OiB7Y29udmVydFNpemUodG90YWxNZW1vcnkpfSB0b3RhbCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBtZW1vcnkgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWVtb3J5J10gPSB7CiAgICAgICAgICAgICd0b3RhbCc6IDAsCiAgICAgICAgICAgICdhdmFpbGFibGUnOiAwLAogICAgICAgICAgICAndXNlZCc6IDAsCiAgICAgICAgICAgICdmcmVlJzogMCwKICAgICAgICAgICAgJ21lbW9yeV9tZXRyaWNzJzoge30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddID0gewogICAgICAgICAgICAnZGV2aWNlUGxhdGZvcm0nOiBwbGF0Zm9ybS5zeXN0ZW0oKSwKICAgICAgICAgICAgJ3N5c3RlbU5hbWUnOiBzb2NrZXQuZ2V0aG9zdG5hbWUoKSwKICAgICAgICAgICAgJ2N1cnJlbnRVc2VyJzogZ2V0cGFzcy5nZXR1c2VyKCksCiAgICAgICAgICAgICdjcHVVc2FnZSc6IHBzdXRpbC5jcHVfcGVyY2VudChpbnRlcnZhbD0xKSwKICAgICAgICAgICAgJ2NwdUNvdW50JzogcHN1dGlsLmNwdV9jb3VudCgpLAogICAgICAgICAgICAnYm9vdFRpbWUnOiBwc3V0aWwuYm9vdF90aW1lKCksCiAgICAgICAgICAgICdwdWJsaWNJcCc6IGdldFB1YmxpY0lwQWRkcigpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnU3lzdGVtIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHN5c3RlbSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgZGlzayBzdGF0aXN0aWNzIiIiCiAgICB0cnk6CiAgICAgICAgZHJpdmVzID0gW10KICAgICAgICBmb3IgcGFydGl0aW9uIGluIHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXNhZ2UgPSBwc3V0aWwuZGlza191c2FnZShwYXJ0aXRpb24ubW91bnRwb2ludCkKICAgICAgICAgICAgICAgIGRyaXZlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICduYW1lJzogcGFydGl0aW9uLmRldmljZSwKICAgICAgICAgICAgICAgICAgICAndG90YWwnOiB1c2FnZS50b3RhbCwKICAgICAgICAgICAgICAgICAgICAndXNlZCc6IHVzYWdlLnVzZWQsCiAgICAgICAgICAgICAgICAgICAgJ2ZyZWUnOiB1c2FnZS5mcmVlLAogICAgICAgICAgICAgICAgICAgICd1c2VkUGVyJzogdXNhZ2UucGVyY2VudCwKICAgICAgICAgICAgICAgICAgICAnZnJlZVBlcic6IDEwMCAtIHVzYWdlLnBlcmNlbnQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZidQZXJtaXNzaW9uIGRlbmllZCBmb3Ige3BhcnRpdGlvbi5tb3VudHBvaW50fScpCgogICAgICAgIGRldmljZURhdGFEaWN0Wydkcml2ZXMnXSA9IGRyaXZlcwogICAgICAgIGxvZ2dlci5pbmZvKGYnRGlzayBzdGF0cyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVzKX0gZHJpdmVzJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRpc2sgc3RhdHM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbmV0d29yayBpbnRlcmZhY2UgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBuZXR3b3JrTGlzdCA9IFtdCiAgICAgICAgZm9yIGludGVyZmFjZV9uYW1lLCBpbnRlcmZhY2VfYWRkcnMgaW4gcHN1dGlsLm5ldF9pZl9hZGRycygpLml0ZW1zKCk6CiAgICAgICAgICAgIG5ldF9pZl9zdGF0cyA9IHBzdXRpbC5uZXRfaWZfc3RhdHMoKQogICAgICAgICAgICBpZiBpbnRlcmZhY2VfbmFtZSBpbiBuZXRfaWZfc3RhdHM6CiAgICAgICAgICAgICAgICBzdGF0cyA9IG5ldF9pZl9zdGF0c1tpbnRlcmZhY2VfbmFtZV0KICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhID0gewogICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9uYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdpZklzVXAnOiBzdGF0cy5pc3VwLAogICAgICAgICAgICAgICAgICAgICAgICAnaWZTcGVlZCc6IHN0YXRzLnNwZWVkLAogICAgICAgICAgICAgICAgICAgICAgICAnaWZNdHUnOiBzdGF0cy5tdHUsCiAgICAgICAgICAgICAgICAgICAgICAgICdieXRlc1NlbnQnOiBzdGF0cy5ieXRlc19zZW50LAogICAgICAgICAgICAgICAgICAgICAgICAnYnl0ZXNSZWN2Jzogc3RhdHMuYnl0ZXNfcmVjdiwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VyckluJzogc3RhdHMuZXJyaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJPdXQnOiBzdGF0cy5lcnJvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzNCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICduZXRtYXNrNCc6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICdicm9hZGNhc3Q0JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3M2JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25ldG1hc2s2JzogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Jyb2FkY2FzdDYnOiBOb25lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciBhZGRyIGluIGludGVyZmFjZV9hZGRyczoKICAgICAgICAgICAgICAgICAgICBpZiBhZGRyLmZhbWlseS5uYW1lID09ICdBRl9JTkVUJzoKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydhZGRyZXNzNCddID0gYWRkci5hZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnbmV0bWFzazQnXSA9IGFkZHIubmV0bWFzawogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ2Jyb2FkY2FzdDQnXSA9IGFkZHIuYnJvYWRjYXN0CiAgICAgICAgICAgICAgICAgICAgZWxpZiBhZGRyLmZhbWlseS5uYW1lID09ICdBRl9JTkVUNic6CiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZV9kYXRhW2ludGVyZmFjZV9uYW1lXVsnYWRkcmVzczYnXSA9IGFkZHIuYWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfZGF0YVtpbnRlcmZhY2VfbmFtZV1bJ25ldG1hc2s2J10gPSBhZGRyLm5ldG1hc2sKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlX2RhdGFbaW50ZXJmYWNlX25hbWVdWydicm9hZGNhc3Q2J10gPSBhZGRyLmJyb2FkY2FzdAoKICAgICAgICAgICAgICAgIG5ldHdvcmtMaXN0LmFwcGVuZChpbnRlcmZhY2VfZGF0YSkKCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10gPSBuZXR3b3JrTGlzdAogICAgICAgIGxvZ2dlci5pbmZvKGYnTmV0d29yayBkYXRhIGNvbGxlY3RlZDoge2xlbihuZXR3b3JrTGlzdCl9IGludGVyZmFjZXMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbmV0d29yayBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WyduZXR3b3JrTGlzdCddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgbG9nZ2VkLWluIHVzZXJzIiIiCiAgICB0cnk6CiAgICAgICAgdXNlcnMgPSBbXQogICAgICAgIHVzZXJfZGljdCA9IHt9CiAgICAgICAgZm9yIGlkeCwgdXNlciBpbiBlbnVtZXJhdGUocHN1dGlsLnVzZXJzKCkpOgogICAgICAgICAgICB1c2VyX2RpY3Rbc3RyKGlkeCldID0gewogICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogdXNlci5uYW1lLAogICAgICAgICAgICAgICAgJ3Rlcm1pbmFsJzogdXNlci50ZXJtaW5hbCBvciAnTi9BJywKICAgICAgICAgICAgICAgICdob3N0JzogdXNlci5ob3N0IG9yICdOL0EnLAogICAgICAgICAgICAgICAgJ2xvZ2dlZEluJzogdXNlci5zdGFydGVkLAogICAgICAgICAgICAgICAgJ3BpZCc6IHVzZXIucGlkIG9yIDAKICAgICAgICAgICAgfQogICAgICAgIHVzZXJzLmFwcGVuZCh1c2VyX2RpY3QpCgogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gdXNlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VzZXIgZGF0YSBjb2xsZWN0ZWQ6IHtsZW4odXNlcl9kaWN0KX0gdXNlcnMnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXNlciBkYXRhOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydVc2VycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRCYXR0ZXJ5RGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgYmF0dGVyeSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGJhdHRlcnkgPSBwc3V0aWwuc2Vuc29yc19iYXR0ZXJ5KCkKICAgICAgICBpZiBiYXR0ZXJ5OgogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAgICAgJ2luc3RhbGxlZCc6IFRydWUsCiAgICAgICAgICAgICAgICAncGNDaGFyZ2VkJzogYmF0dGVyeS5wZXJjZW50LAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogYmF0dGVyeS5zZWNzbGVmdCBpZiBiYXR0ZXJ5LnNlY3NsZWZ0ICE9IHBzdXRpbC5QT1dFUl9USU1FX1VOTElNSVRFRCBlbHNlICdOL0EnLAogICAgICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IGJhdHRlcnkucG93ZXJfcGx1Z2dlZAogICAgICAgICAgICB9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXSA9IHsKICAgICAgICAgICAgICAgICdpbnN0YWxsZWQnOiBGYWxzZSwKICAgICAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAgICAgJ3NlY3NMZWZ0JzogJ04vQScsCiAgICAgICAgICAgICAgICAncG93ZXJQbHVnJzogVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidCYXR0ZXJ5IGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGJhdHRlcnkgZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddID0gewogICAgICAgICAgICAnaW5zdGFsbGVkJzogRmFsc2UsCiAgICAgICAgICAgICdwY0NoYXJnZWQnOiAwLAogICAgICAgICAgICAnc2Vjc0xlZnQnOiAnTi9BJywKICAgICAgICAgICAgJ3Bvd2VyUGx1Zyc6IFRydWUKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgdXB0aW1lIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgYm9vdF90aW1lID0gcHN1dGlsLmJvb3RfdGltZSgpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3VwdGltZSddID0gewogICAgICAgICAgICAnYm9vdFRpbWUnOiBib290X3RpbWUsCiAgICAgICAgICAgICd1cHRpbWVTZWNvbmRzJzogdGltZS50aW1lKCkgLSBib290X3RpbWUKICAgICAgICB9CiAgICAgICAgbG9nZ2VyLmluZm8oZidVcHRpbWUgZGF0YSBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgdXB0aW1lIGRhdGE6IHtlfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgY29sbGVjdG9yIHZlcnNpb24gaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ10gPSB7CiAgICAgICAgICAgICd2ZXJzaW9uJzogJzIuMC4wJywKICAgICAgICAgICAgJ3R5cGUnOiAnV2luZG93c0F1ZGl0JywKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnQ29sbGVjdG9yIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGNvbGxlY3RvciBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERldmljZURhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGJhc2ljIGRldmljZSBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXSA9IHsKICAgICAgICAgICAgJ2RldmljZVV1aWQnOiAncGxhY2Vob2xkZXInLAogICAgICAgICAgICAnc3lzdGVtdGltZSc6IHRpbWUudGltZSgpCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKGYnRGV2aWNlIGRhdGEgY29sbGVjdGVkJykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRldmljZSBkYXRhOiB7ZX0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHBhcnRpdGlvbiBpbmZvcm1hdGlvbiIiIgogICAgdHJ5OgogICAgICAgIHBhcnRpdGlvbnMgPSBbXQogICAgICAgIHBhcnRpdGlvbl9kaWN0ID0ge30KICAgICAgICBmb3IgaWR4LCBwYXJ0aXRpb24gaW4gZW51bWVyYXRlKHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKSk6CiAgICAgICAgICAgIHBhcnRpdGlvbl9kaWN0W3BhcnRpdGlvbi5tb3VudHBvaW50XSA9IHsKICAgICAgICAgICAgICAgICdkZXZpY2UnOiBwYXJ0aXRpb24uZGV2aWNlLAogICAgICAgICAgICAgICAgJ2ZzdHlwZSc6IHBhcnRpdGlvbi5mc3R5cGUKICAgICAgICAgICAgfQogICAgICAgIHBhcnRpdGlvbnMuYXBwZW5kKHBhcnRpdGlvbl9kaWN0KQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gcGFydGl0aW9ucwogICAgICAgIGxvZ2dlci5pbmZvKGYnUGFydGl0aW9uIGRhdGEgY29sbGVjdGVkOiB7bGVuKHBhcnRpdGlvbl9kaWN0KX0gcGFydGl0aW9ucycpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBwYXJ0aXRpb24gZGF0YToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsncGFydGl0aW9ucyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBHUFUgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9WaWRlb0NvbnRyb2xsZXIpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHZlbmRvciA9ICdObyBkYXRhIGZvdW5kJwogICAgICAgIHByb2R1Y3QgPSAnTm8gZGF0YSBmb3VuZCcKICAgICAgICBjb2xvdXJEZXB0aCA9IC0xCiAgICAgICAgaFJlcyA9IC0xCiAgICAgICAgdlJlcyA9IC0xCgogICAgICAgIGZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICBpZiAnVmlkZW9Qcm9jZXNzb3InIGluIGxpbmU6CiAgICAgICAgICAgICAgICBwcm9kdWN0ID0gbGluZS5zcGxpdCgnVmlkZW9Qcm9jZXNzb3InKVsxXS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKICAgICAgICAgICAgaWYgJ1ZpZGVvTW9kZURlc2NyaXB0aW9uJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNvbG91ckRlcHRoID0gbGluZS5zcGxpdCgneCAnKVsyXS5zcGxpdCgnICcpWzBdCiAgICAgICAgICAgICAgICAgICAgY29sb3VyRGVwdGggPSBpbnQoY29sb3VyRGVwdGgpCiAgICAgICAgICAgICAgICAgICAgaFJlcyA9IGxpbmUuc3BsaXQoJzogJylbMV0uc3BsaXQoJyAnKVswXQogICAgICAgICAgICAgICAgICAgIHZSZXMgPSBsaW5lLnNwbGl0KCd4ICcpWzFdLnNwbGl0KCcgJylbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGlmICdBZGFwdGVyREFDVHlwZScgaW4gbGluZToKICAgICAgICAgICAgICAgIHZlbmRvciA9IGxpbmUuc3BsaXQoJ0FkYXB0ZXJEQUNUeXBlJylbMV0uc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydncHVpbmZvJ10gPSB7CiAgICAgICAgICAgICdncHV2ZW5kb3InOiB2ZW5kb3IsCiAgICAgICAgICAgICdncHVwcm9kdWN0JzogcHJvZHVjdCwKICAgICAgICAgICAgJ2dwdWNvbG91cic6IGNvbG91ckRlcHRoLAogICAgICAgICAgICAnZ3B1aHJlcyc6IGhSZXMsCiAgICAgICAgICAgICdncHV2cmVzJzogdlJlcwogICAgICAgIH0KICAgICAgICBsb2dnZXIuaW5mbyhmJ0dQVSBpbmZvIGNvbGxlY3RlZCcpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBHUFUgaW5mbzoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0gewogICAgICAgICAgICAnZ3B1dmVuZG9yJzogJ05vIGRhdGEgZm91bmQnLAogICAgICAgICAgICAnZ3B1cHJvZHVjdCc6ICdObyBkYXRhIGZvdW5kJywKICAgICAgICAgICAgJ2dwdWNvbG91cic6IC0xLAogICAgICAgICAgICAnZ3B1aHJlcyc6IC0xLAogICAgICAgICAgICAnZ3B1dnJlcyc6IC0xCiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1hbnVmYWN0dXJlciIiIgogICAgdHJ5OgogICAgICAgIGNvbW1hbmQgPSAiKEdldC1XbWlPYmplY3QgV2luMzJfQ29tcHV0ZXJTeXN0ZW1Qcm9kdWN0KS5WZW5kb3IiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtYW51ZmFjdHVyZXIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgJ1Vua25vd24nCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ21hbnVmYWN0dXJlciddID0gbWFudWZhY3R1cmVyCiAgICAgICAgbG9nZ2VyLmluZm8oZidNYW51ZmFjdHVyZXI6IHttYW51ZmFjdHVyZXJ9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIG1hbnVmYWN0dXJlcjoge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnbWFudWZhY3R1cmVyJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRPc0xhbmcoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IE9TIGxhbmd1YWdlIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLk1VSUxhbmd1YWdlcyIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQogICAgICAgIG9zTGFuZyA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSBvc0xhbmcKICAgICAgICBsb2dnZXIuaW5mbyhmJ09TIExhbmd1YWdlOiB7b3NMYW5nfScpCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBPUyBsYW5ndWFnZToge2V9JykKICAgICAgICBkZXZpY2VEYXRhRGljdFsnb3NMYW5nJ10gPSAnVW5rbm93bicKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBTTUJJT1MgaW5mb3JtYXRpb24gKFdpbmRvd3Mtc3BlY2lmaWMpIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9TeXN0ZW1FbmNsb3N1cmUpIgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBjb21tYW5kXSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUsCiAgICAgICAgICAgIHRpbWVvdXQ9MTAKICAgICAgICApCgogICAgICAgIHNtYmlvc19kaWN0ID0ge30KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgJ1NlcmlhbE51bWJlcicgaW4gbGluZToKICAgICAgICAgICAgICAgIHNtYmlvc19kaWN0WydzZXJpYWxOdW1iZXInXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCiAgICAgICAgICAgIGlmICdDaGFzc2lzVHlwZXMnIGluIGxpbmU6CiAgICAgICAgICAgICAgICBzbWJpb3NfZGljdFsnY2hhc3Npc1R5cGUnXSA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCgogICAgICAgIGRldmljZURhdGFEaWN0WydzbWJpb3MnXSA9IHNtYmlvc19kaWN0CiAgICAgICAgbG9nZ2VyLmluZm8oZidTTUJJT1MgaW5mbyBjb2xsZWN0ZWQnKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgU01CSU9TIGluZm86IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ3NtYmlvcyddID0ge30KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1vZGVsIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICIoR2V0LVdtaU9iamVjdCBXaW4zMl9Db21wdXRlclN5c3RlbSkuTW9kZWwiCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZSwKICAgICAgICAgICAgdGltZW91dD0xMAogICAgICAgICkKICAgICAgICBtb2RlbCA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKSBvciAnVW5rbm93bicKICAgICAgICBkZXZpY2VEYXRhRGljdFsnc3lzdGVtTW9kZWwnXSA9IG1vZGVsCiAgICAgICAgbG9nZ2VyLmluZm8oZidTeXN0ZW0gTW9kZWw6IHttb2RlbH0nKQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgc3lzdGVtIG1vZGVsOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW1Nb2RlbCddID0gJ1Vua25vd24nCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgpkZWYgZ2V0UHJpbnRlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IHByaW50ZXIgaW5mb3JtYXRpb24iIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfUHJpbnRlciB8IFNlbGVjdC1PYmplY3QgTmFtZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBwcmludGVycyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmIGxpbmUuc3RyaXAoKSBhbmQgJ05hbWUnIG5vdCBpbiBsaW5lIGFuZCAnLS0tJyBub3QgaW4gbGluZToKICAgICAgICAgICAgICAgIHByaW50ZXJzLmFwcGVuZChsaW5lLnN0cmlwKCkpCgogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gcHJpbnRlcnMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1ByaW50ZXJzIGNvbGxlY3RlZDoge2xlbihwcmludGVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIHByaW50ZXJzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0WydwcmludGVycyddID0gW10KICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKCmRlZiBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KToKICAgICIiIkdldCBVU0IgZGV2aWNlIGluZm9ybWF0aW9uIiIiCiAgICB0cnk6CiAgICAgICAgY29tbWFuZCA9ICJHZXQtV21pT2JqZWN0IFdpbjMyX1VTQkNvbnRyb2xsZXJEZXZpY2UgfCBTZWxlY3QtT2JqZWN0IERlcGVuZGVudCIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICB1c2JfZGV2aWNlcyA9IFtdCiAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICdXaW4zMl8nIGluIGxpbmU6CiAgICAgICAgICAgICAgICB1c2JfZGV2aWNlcy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsndXNiRGV2aWNlcyddID0gdXNiX2RldmljZXMKICAgICAgICBsb2dnZXIuaW5mbyhmJ1VTQiBkZXZpY2VzIGNvbGxlY3RlZDoge2xlbih1c2JfZGV2aWNlcyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIFVTQiBkZXZpY2VzOiB7ZX0nKQogICAgICAgIGRldmljZURhdGFEaWN0Wyd1c2JEZXZpY2VzJ10gPSBbXQogICAgICAgIHJldHVybiBkZXZpY2VEYXRhRGljdAoKZGVmIGdldERyaXZlcnMoZGV2aWNlRGF0YURpY3QpOgogICAgIiIiR2V0IGRyaXZlciBpbmZvcm1hdGlvbiAoV2luZG93cy1zcGVjaWZpYykiIiIKICAgIHRyeToKICAgICAgICBjb21tYW5kID0gIkdldC1XbWlPYmplY3QgV2luMzJfU3lzdGVtRHJpdmVyIHwgU2VsZWN0LU9iamVjdCBOYW1lLCBTdGF0ZSIKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJwb3dlcnNoZWxsIiwgIi1Db21tYW5kIiwgY29tbWFuZF0sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlLAogICAgICAgICAgICB0aW1lb3V0PTEwCiAgICAgICAgKQoKICAgICAgICBkcml2ZXJzID0gW10KICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKICAgICAgICAgICAgaWYgbGluZS5zdHJpcCgpIGFuZCAnTmFtZScgbm90IGluIGxpbmUgYW5kICctLS0nIG5vdCBpbiBsaW5lOgogICAgICAgICAgICAgICAgZHJpdmVycy5hcHBlbmQobGluZS5zdHJpcCgpKQoKICAgICAgICBkZXZpY2VEYXRhRGljdFsnZHJpdmVycyddID0gZHJpdmVycwogICAgICAgIGxvZ2dlci5pbmZvKGYnRHJpdmVycyBjb2xsZWN0ZWQ6IHtsZW4oZHJpdmVycyl9JykKICAgICAgICByZXR1cm4gZGV2aWNlRGF0YURpY3QKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBnZXR0aW5nIGRyaXZlcnM6IHtlfScpCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2RyaXZlcnMnXSA9IFtdCiAgICAgICAgcmV0dXJuIGRldmljZURhdGFEaWN0CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gRVhFQ1VUSU9OICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBpZiBkZWJ1Z01vZGU6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1dpbmRvd3NBdWRpdCBTdGFydGluZy4uLicpCgogICAgIyBTZXR1cCBkaXJlY3RvcmllcwogICAgYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXIgPSBnZXRBcHBEaXJzKCkKCiAgICAjIEdldCBkZXZpY2UgVVVJRCBhbmQgaG9zdAogICAgYWdlbnRDb25maWdGaWxlID0gZid7Y29uZmlnRGlyfWFnZW50LmNvbmZpZycKICAgIGRldmljZVV1aWQsIGhvc3QgPSBnZXREZXZpY2VVdWlkKGFnZW50Q29uZmlnRmlsZSkKCiAgICAjIENvbGxlY3QgYWxsIGRhdGEKICAgIGRldmljZURhdGFEaWN0ID0ge30KICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGV2aWNlRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0RGlza1N0YXRzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXROZXR3b3JrRGF0YShkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFVwdGltZURhdGEoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRDb2xsZWN0b3JEYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRNYW51ZmFjdHVyZXIoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldE9zTGFuZyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0R3B1SW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCkKICAgIGRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpCiAgICBkZXZpY2VEYXRhRGljdCA9IGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRVc2JEZXZpY2VzKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXRQYXJ0aXRpb25EYXRhKGRldmljZURhdGFEaWN0KQogICAgZGV2aWNlRGF0YURpY3QgPSBnZXREcml2ZXJzKGRldmljZURhdGFEaWN0KQoKICAgICMgVXBkYXRlIGRldmljZSBVVUlEIGluIHBheWxvYWQKICAgIGRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnZGV2aWNlVXVpZCddID0gZGV2aWNlVXVpZAoKICAgICMgU2VuZCBwYXlsb2FkCiAgICByb3V0ZSA9ICcvcGF5bG9hZC9zZW5kYXVkaXQnCiAgICBwYXlsb2FkID0geydkYXRhJzogZGV2aWNlRGF0YURpY3R9CgogICAgaWYgZGVidWdNb2RlOgogICAgICAgIGxvZ2dlci5pbmZvKGYnUGF5bG9hZDoge2pzb24uZHVtcHMocGF5bG9hZCwgaW5kZW50PTIsIGRlZmF1bHQ9c3RyKX0nKQoKICAgIHJlc3BvbnNlID0gc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgcm91dGUsIGhvc3QsIGRlYnVnTW9kZSkKICAgIGxvZ2dlci5pbmZvKGYnU2VydmVyIHJlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IHwge3Jlc3BvbnNlLnRleHR9JykKCg=="}}