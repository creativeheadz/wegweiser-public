{"settings": {"snippetUuid": "80f859e0-5ea5-4d88-8ba0-c92a57a9fc71", "snippetname": "MacAudit", "snippettype": ".py", "created_at": 1763062570}, "payload": {"payloadsig": "HlpjKDPDNxSGw67I7dLWKF9jGcsLT7H6Zh/nAOJnWAJX952fGNiLWRyL96rfguTk1FG0VKt7kzTmpiY8LOojy7FqRJMYerXHARkOwYpBYFKp7hp4TRSU0to4RkNyahywGBnwnYnYl7d/Ln7hToGbd+z0ZJMDH0+veXcjKRTsMtfTZxeXslfDew9/OsgI9oBupToW+i7EKjwLIpgN3YsSGFi2p6dFMUMoAJv4oLSYJerVGqzn6kB1BIfBewClSvLHVPyZo9teYDunqDSTfOsvWaraVF4LIyLmtBp3udKVi30Is2RuGzVNvL17PXoxzuY/a3JvlX8wQay3ZnqCUArd66niUNTw1UmwBEM6NRndMoP7m0FS8skWPEkUd2uBwdMycw4NHrFx7p8wNIIA8LHJYXSpF6v8OrzBhVrMSUrUyUhosFfb/cBocd+KluCBA5K+vHSCTDZxhUOBoTaMhlZ+3VBfXkr+2fHg28RWd33d5U5S18D4pGYRxnKwzP35OxE8iTygj0hw5BCwq0BrwmSAwI3afbwx1xC5hxBW3+E3QhqcpUHsTrZ+TOpw60VPzLNfTWQKeZYZHI9lMgbCTTtCLbPTjl6Kji3KvmUIzuYS6c0BJ9q29Ur5j73DJQYYZL91+O/wo0p/sD6zyhXaE2pzn/uIfMUnVzegeidYdOy96B4=", "payloadb64": "IyBGaWxlcGF0aDogc25pcHBldHMvdW5TaWduZWQvTWFjQXVkaXQucHkKIiIiCm1hY09TLXNwZWNpZmljIGF1ZGl0IGNvbGxlY3RvciBmb3IgV2Vnd2Vpc2VyClNlbGYtY29udGFpbmVkIHNuaXBwZXQgd2l0aCBhbGwgdXRpbGl0aWVzIGlubGluZWQuCiIiIgppbXBvcnQgc29ja2V0CmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHRpbWUKaW1wb3J0IGdldHBhc3MKaW1wb3J0IHNodXRpbAppbXBvcnQgbWF0aAppbXBvcnQgYXJncGFyc2UKaW1wb3J0IHN5cwppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IGhhc2hsaWIKdHJ5OgoJZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIsIGxvZ2ZpbGUKZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ2xvZ3plcm8nXSkKCWZyb20gbG9nemVybyBpbXBvcnQgbG9nZ2VyLCBsb2dmaWxlCnRyeToKCWltcG9ydCBwc3V0aWwKZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ3BzdXRpbCddKQoJaW1wb3J0IHBzdXRpbAp0cnk6CglpbXBvcnQgcmVxdWVzdHMKZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJc3VicHJvY2Vzcy5jaGVja19jYWxsKFtzeXMuZXhlY3V0YWJsZSwgJy1tJywgJ3BpcCcsICdpbnN0YWxsJywgJ3JlcXVlc3RzJ10pCglpbXBvcnQgcmVxdWVzdHMKdHJ5OgoJaW1wb3J0IGRucy5yZXNvbHZlcgpleGNlcHQ6CglzdWJwcm9jZXNzLmNoZWNrX2NhbGwoW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAncGlwJywgJ2luc3RhbGwnLCAnZG5zcHl0aG9uJ10pCglpbXBvcnQgZG5zLnJlc29sdmVyCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIElOTElORUQgVVRJTElUSUVTIChmcm9tIEF1ZGl0Q29tbW9uKSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpkZWYgY29udmVydFNpemUoc2l6ZUJ5dGVzKToKCSIiIkNvbnZlcnQgYnl0ZXMgdG8gaHVtYW4tcmVhZGFibGUgZm9ybWF0IiIiCglpZiBzaXplQnl0ZXMgPT0gMDoKCQlyZXR1cm4gIjAgQiIKCXNpemVOYW1lID0gKCJCIiwgIktCIiwgIk1CIiwgIkdCIiwgIlRCIiwgIlBCIiwgIkVCIiwgIlpCIiwgIllCIikKCWkgPSBpbnQobWF0aC5mbG9vcihtYXRoLmxvZyhzaXplQnl0ZXMsIDEwMjQpKSkKCXAgPSBtYXRoLnBvdygxMDI0LCBpKQoJcyA9IHJvdW5kKHNpemVCeXRlcyAvIHAsIDIpCglyZXR1cm4gZid7c30ge3NpemVOYW1lW2ldfScKCmRlZiBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCBlbmRwb2ludCwgaG9zdCwgZGVidWdNb2RlPUZhbHNlKToKCSIiIlNlbmQgSlNPTiBwYXlsb2FkIHRvIEZsYXNrIGVuZHBvaW50IiIiCgl1cmwgPSBmJ2h0dHBzOi8ve2hvc3R9e2VuZHBvaW50fScKCWlmIGRlYnVnTW9kZToKCQlsb2dnZXIuZGVidWcoZidwYXlsb2FkIHRvIHNlbmQ6IHtwYXlsb2FkfScpCgkJbG9nZ2VyLmRlYnVnKGYnQXR0ZW1wdGluZyB0byBjb25uZWN0IHRvIHt1cmx9JykKCWhlYWRlcnMgPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30KCXJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKHBheWxvYWQpKQoJcmV0dXJuIHJlc3BvbnNlCgpkZWYgZ2V0UHVibGljSXBBZGRyKCk6CgkiIiJHZXQgcHVibGljIElQIGFkZHJlc3MiIiIKCW9kRG5zU2VydmVyID0gJzIwOC42Ny4yMjIuMjIyJwoJaHR0cERuc1NlcnZlciA9ICdodHRwczovL2ljYW5oYXppcC5jb20nCglkbnNSZXNvbHZlciA9IGRucy5yZXNvbHZlci5SZXNvbHZlcigpCglkbnNSZXNvbHZlci5uYW1lc2VydmVycyA9IFtvZERuc1NlcnZlcl0KCXB1YmxpY0lwID0gTm9uZQoKCXRyeToKCQlhbnN3ZXJzID0gZG5zUmVzb2x2ZXIucmVzb2x2ZSgnbXlpcC5vcGVuZG5zLmNvbScsICdBJykKCQlmb3IgaXAgaW4gYW5zd2VyczoKCQkJcHVibGljSXAgPSBpcC50b190ZXh0KCkKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHB1YmxpY0lQIGZyb20ge29kRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoKCWlmIG5vdCBwdWJsaWNJcDoKCQl0cnk6CgkJCXIgPSByZXF1ZXN0cy5nZXQoaHR0cERuc1NlcnZlcikKCQkJcHVibGljSXAgPSByLnRleHQuc3RyaXAoKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBwdWJsaWNJUCBmcm9tIHtodHRwRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoKCWlmIG5vdCBwdWJsaWNJcDoKCQlwdWJsaWNJcCA9ICcwLjAuMC4wJwoKCXJldHVybiBwdWJsaWNJcAoKZGVmIGdldFVzZXJIb21lUGF0aCgpOgoJIiIiR2V0IHVzZXIgaG9tZSBkaXJlY3RvcnkgcGF0aCIiIgoJdXNlckhvbWVQYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKCJ+IikKCWxvZ2dlci5pbmZvKGYndXNlckhvbWVQYXRoOiB7dXNlckhvbWVQYXRofScpCglyZXR1cm4gdXNlckhvbWVQYXRoCgpkZWYgZ2V0RGV2aWNlVXVpZChjb25maWdGaWxlKToKCSIiIkdldCBkZXZpY2UgVVVJRCBmcm9tIGNvbmZpZyBmaWxlIiIiCglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gcmVhZCB7Y29uZmlnRmlsZX0nKQoJdHJ5OgoJCXdpdGggb3Blbihjb25maWdGaWxlLCAncicpIGFzIGY6CgkJCWNvbmZpZyA9IGpzb24ubG9hZChmKQoJCQlkZXZpY2VVdWlkID0gY29uZmlnLmdldCgnZGV2aWNlVXVpZCcpCgkJCWhvc3QgPSBjb25maWcuZ2V0KCdob3N0JywgJ2FwcC53ZWd3ZWlzZXIudGVjaCcpCgkJCWxvZ2dlci5pbmZvKGYnZGV2aWNlVXVpZDoge2RldmljZVV1aWR9JykKCQkJcmV0dXJuIGRldmljZVV1aWQsIGhvc3QKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gcmVhZCBjb25maWcgZmlsZToge2V9JykKCQlyZXR1cm4gTm9uZSwgJ2FwcC53ZWd3ZWlzZXIudGVjaCcKCmRlZiBnZXRBcHBEaXJzKCk6CgkiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMiIiIKCXVzZXJIb21lUGF0aCA9IGdldFVzZXJIb21lUGF0aCgpCglhcHBEaXIgPSBvcy5wYXRoLmpvaW4odXNlckhvbWVQYXRoLCAnLndlZ3dlaXNlcicpCglsb2dEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnbG9ncycpCgljb25maWdEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnY29uZmlnJykKCXRlbXBEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAndGVtcCcpCglmaWxlc0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdmaWxlcycpCgoJZm9yIGRpcmVjdG9yeSBpbiBbYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXJdOgoJCW9zLm1ha2VkaXJzKGRpcmVjdG9yeSwgZXhpc3Rfb2s9VHJ1ZSkKCglsb2dnZXIuaW5mbyhmJ2FwcERpcjoge2FwcERpcn0nKQoJcmV0dXJuIGFwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyCgpkZWYgZGVsRmlsZShmaWxlVG9EZWxldGUpOgoJIiIiRGVsZXRlIGEgZmlsZSIiIgoJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4uLicpCgl0cnk6CgkJb3MucmVtb3ZlKGZpbGVUb0RlbGV0ZSkKCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSBkZWxldGVkIHtmaWxlVG9EZWxldGV9LicpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGRlbGV0ZSB7ZmlsZVRvRGVsZXRlfS4gUmVhc29uOiB7ZX0nKQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyBJTkxJTkVEIFBTVVRJTCBNRVRSSUNTIChmcm9tIFBzdXRpbE1ldHJpY3MpICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmRlZiBnZXRDcHVNZXRyaWNzKCk6CgkiIiJHYXRoZXIgY29tcHJlaGVuc2l2ZSBDUFUgbWV0cmljcyB1c2luZyBwc3V0aWwiIiIKCXRyeToKCQljcHVfbWV0cmljcyA9IHt9CgoJCSMgQ29yZSBpbmZvcm1hdGlvbgoJCWNwdV9tZXRyaWNzWydjb3Jlc19sb2dpY2FsJ10gPSBwc3V0aWwuY3B1X2NvdW50KGxvZ2ljYWw9VHJ1ZSkKCQljcHVfbWV0cmljc1snY29yZXNfcGh5c2ljYWwnXSA9IHBzdXRpbC5jcHVfY291bnQobG9naWNhbD1GYWxzZSkKCgkJIyBGcmVxdWVuY3kgaW5mb3JtYXRpb24KCQl0cnk6CgkJCWZyZXEgPSBwc3V0aWwuY3B1X2ZyZXEoKQoJCQlpZiBmcmVxOgoJCQkJY3B1X21ldHJpY3NbJ2ZyZXF1ZW5jeV9jdXJyZW50J10gPSByb3VuZChmcmVxLmN1cnJlbnQsIDIpCgkJCQljcHVfbWV0cmljc1snZnJlcXVlbmN5X21pbiddID0gcm91bmQoZnJlcS5taW4sIDIpCgkJCQljcHVfbWV0cmljc1snZnJlcXVlbmN5X21heCddID0gcm91bmQoZnJlcS5tYXgsIDIpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IENQVSBmcmVxdWVuY3k6IHtlfScpCgoJCSMgUGVyLUNQVSB1c2FnZSBwZXJjZW50YWdlCgkJdHJ5OgoJCQljcHVfcGVyY2VudCA9IHBzdXRpbC5jcHVfcGVyY2VudChpbnRlcnZhbD0xLCBwZXJjcHU9VHJ1ZSkKCQkJY3B1X21ldHJpY3NbJ2NwdV9wZXJjZW50J10gPSBbcm91bmQocCwgMikgZm9yIHAgaW4gY3B1X3BlcmNlbnRdCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IHBlci1DUFUgcGVyY2VudDoge2V9JykKCgkJIyBPdmVyYWxsIENQVSB1c2FnZQoJCXRyeToKCQkJY3B1X21ldHJpY3NbJ2NwdV9wZXJjZW50X292ZXJhbGwnXSA9IHJvdW5kKHBzdXRpbC5jcHVfcGVyY2VudChpbnRlcnZhbD0wLjEpLCAyKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBvdmVyYWxsIENQVSBwZXJjZW50OiB7ZX0nKQoKCQkjIENQVSB0aW1lcyAodXNlciwgc3lzdGVtLCBpZGxlLCBpb3dhaXQsIGlycSwgc29mdGlycSkKCQl0cnk6CgkJCXRpbWVzID0gcHN1dGlsLmNwdV90aW1lcygpCgkJCWNwdV9tZXRyaWNzWydjcHVfdGltZXMnXSA9IHsKCQkJCSd1c2VyJzogcm91bmQodGltZXMudXNlciwgMiksCgkJCQknc3lzdGVtJzogcm91bmQodGltZXMuc3lzdGVtLCAyKSwKCQkJCSdpZGxlJzogcm91bmQodGltZXMuaWRsZSwgMiksCgkJCQknaW93YWl0Jzogcm91bmQodGltZXMuaW93YWl0LCAyKSBpZiBoYXNhdHRyKHRpbWVzLCAnaW93YWl0JykgZWxzZSBOb25lLAoJCQkJJ2lycSc6IHJvdW5kKHRpbWVzLmlycSwgMikgaWYgaGFzYXR0cih0aW1lcywgJ2lycScpIGVsc2UgTm9uZSwKCQkJCSdzb2Z0aXJxJzogcm91bmQodGltZXMuc29mdGlycSwgMikgaWYgaGFzYXR0cih0aW1lcywgJ3NvZnRpcnEnKSBlbHNlIE5vbmUsCgkJCX0KCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCWxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgQ1BVIHRpbWVzOiB7ZX0nKQoKCQkjIENQVSBzdGF0aXN0aWNzIChjb250ZXh0IHN3aXRjaGVzLCBpbnRlcnJ1cHRzKQoJCXRyeToKCQkJc3RhdHMgPSBwc3V0aWwuY3B1X3N0YXRzKCkKCQkJY3B1X21ldHJpY3NbJ2NwdV9zdGF0cyddID0gewoJCQkJJ2N0eF9zd2l0Y2hlcyc6IHN0YXRzLmN0eF9zd2l0Y2hlcywKCQkJCSdpbnRlcnJ1cHRzJzogc3RhdHMuaW50ZXJydXB0cywKCQkJCSdzb2Z0X2ludGVycnVwdHMnOiBzdGF0cy5zb2Z0X2ludGVycnVwdHMsCgkJCQknc3lzY2FsbHMnOiBzdGF0cy5zeXNjYWxscyBpZiBoYXNhdHRyKHN0YXRzLCAnc3lzY2FsbHMnKSBlbHNlIE5vbmUsCgkJCX0KCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCWxvZ2dlci5kZWJ1ZyhmJ0NvdWxkIG5vdCBnZXQgQ1BVIHN0YXRzOiB7ZX0nKQoKCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSBnYXRoZXJlZCBDUFUgbWV0cmljcycpCgkJcmV0dXJuIGNwdV9tZXRyaWNzCgoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0Vycm9yIGdhdGhlcmluZyBDUFUgbWV0cmljczoge2V9JykKCQlyZXR1cm4ge30KCmRlZiBnZXRNZW1vcnlNZXRyaWNzKCk6CgkiIiJHYXRoZXIgY29tcHJlaGVuc2l2ZSBtZW1vcnkgbWV0cmljcyB1c2luZyBwc3V0aWwiIiIKCXRyeToKCQltZW1vcnlfbWV0cmljcyA9IHt9CgoJCSMgVmlydHVhbCBtZW1vcnkgZGV0YWlscwoJCXRyeToKCQkJdm1lbSA9IHBzdXRpbC52aXJ0dWFsX21lbW9yeSgpCgkJCW1lbW9yeV9tZXRyaWNzWydidWZmZXJzJ10gPSB2bWVtLmJ1ZmZlcnMgaWYgaGFzYXR0cih2bWVtLCAnYnVmZmVycycpIGVsc2UgTm9uZQoJCQltZW1vcnlfbWV0cmljc1snY2FjaGVkJ10gPSB2bWVtLmNhY2hlZCBpZiBoYXNhdHRyKHZtZW0sICdjYWNoZWQnKSBlbHNlIE5vbmUKCQkJbWVtb3J5X21ldHJpY3NbJ3NoYXJlZCddID0gdm1lbS5zaGFyZWQgaWYgaGFzYXR0cih2bWVtLCAnc2hhcmVkJykgZWxzZSBOb25lCgkJCW1lbW9yeV9tZXRyaWNzWydwZXJjZW50J10gPSByb3VuZCh2bWVtLnBlcmNlbnQsIDIpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlsb2dnZXIuZGVidWcoZidDb3VsZCBub3QgZ2V0IHZpcnR1YWwgbWVtb3J5IGRldGFpbHM6IHtlfScpCgoJCSMgU3dhcCBtZW1vcnkgZGV0YWlscwoJCXRyeToKCQkJc3dhcCA9IHBzdXRpbC5zd2FwX21lbW9yeSgpCgkJCW1lbW9yeV9tZXRyaWNzWydzd2FwX3RvdGFsJ10gPSBzd2FwLnRvdGFsCgkJCW1lbW9yeV9tZXRyaWNzWydzd2FwX3VzZWQnXSA9IHN3YXAudXNlZAoJCQltZW1vcnlfbWV0cmljc1snc3dhcF9mcmVlJ10gPSBzd2FwLmZyZWUKCQkJbWVtb3J5X21ldHJpY3NbJ3N3YXBfcGVyY2VudCddID0gcm91bmQoc3dhcC5wZXJjZW50LCAyKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJbG9nZ2VyLmRlYnVnKGYnQ291bGQgbm90IGdldCBzd2FwIG1lbW9yeSBkZXRhaWxzOiB7ZX0nKQoKCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSBnYXRoZXJlZCBtZW1vcnkgbWV0cmljcycpCgkJcmV0dXJuIG1lbW9yeV9tZXRyaWNzCgoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0Vycm9yIGdhdGhlcmluZyBtZW1vcnkgbWV0cmljczoge2V9JykKCQlyZXR1cm4ge30KCgoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIEZVTkNUSU9OUyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIGRlZiBwYXJzZUFyZ3MoKToKIyAJcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoKQojIAlwYXJzZXIuYWRkX2FyZ3VtZW50KCItdCIsICItLXRlbXBEaXIiLCAJCWhlbHAgPSAiRW50ZXIgdGVtcCBkaXJlY3RvcnkiLCAJcmVxdWlyZWQ9VHJ1ZSkKIyAJcGFyc2VyLmFkZF9hcmd1bWVudCgiLW0iLCAiLS1tb2RlIiwgCQloZWxwID0gIkVudGVyIG1vZGUgLSBhdWRpdCIsIAlyZXF1aXJlZD1GYWxzZSkJCiMgCXBhcnNlci5hZGRfYXJndW1lbnQoIi1nIiwgIi0tZ3JvdXBVdWlkIiwJaGVscCA9ICJFbnRlciBncm91cFV1aWQiLAkJcmVxdWlyZWQ9RmFsc2UpCQkgCiMgCXBhcnNlci5hZGRfYXJndW1lbnQoIi12IiwgIi0tdmVyc2lvbiIsCQloZWxwID0gIkRpc3BsYXkgdGhlIHZlcnNpb24iLCAJYWN0aW9uPSdzdG9yZV90cnVlJykKIyAJYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkJCiMgCXJldHVybihhcmdzKQoKZGVmIGNvbnZlcnRTaXplKHNpemVCeXRlcyk6CglpZiBzaXplQnl0ZXMgPT0gMDoKCQlyZXR1cm4gIjAgQiIKCXNpemVOYW1lID0gKCJCIiwgIktCIiwgIk1CIiwgIkdCIiwgIlRCIiwgIlBCIiwgIkVCIiwgIlpCIiwgIllCIikKCWkgPSBpbnQobWF0aC5mbG9vcihtYXRoLmxvZyhzaXplQnl0ZXMsIDEwMjQpKSkKCXAgPSBtYXRoLnBvdygxMDI0LCBpKQoJcyA9IHJvdW5kKHNpemVCeXRlcyAvIHAsIDIpCglyZXR1cm4gKGYne3N9IHtzaXplTmFtZVtpXX0nKQoKZGVmIHNlbmRKc29uUGF5bG9hZEZsYXNrKHBheWxvYWQsIGVuZHBvaW50KToKCXVybCAJCT0gZidodHRwczovL3tob3N0fXtlbmRwb2ludH0nCglpZiBkZWJ1Z01vZGUgPT0gVHJ1ZToKCQlsb2dnZXIuZGVidWcoZidwYXlsb2FkIHRvIHNlbmQ6IHtwYXlsb2FkfScpCgkJbG9nZ2VyLmRlYnVnKGYnQXR0ZW1wdGluZyB0byBjb25uZWN0IHRvIHt1cmx9JykKCWhlYWRlcnMgCT0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9CglyZXNwb25zZSAJPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWpzb24uZHVtcHMocGF5bG9hZCkpCglyZXR1cm4ocmVzcG9uc2UpCgpkZWYgZ2V0UHVibGljSXBBZGRyKCk6CglvZERuc1NlcnZlciAJCQk9ICcyMDguNjcuMjIyLjIyMicKCWh0dHBEbnNTZXJ2ZXIJCQk9ICdodHRwczovL2ljYW5oYXppcC5jb20nCglkbnNSZXNvbHZlciAJCQk9IGRucy5yZXNvbHZlci5SZXNvbHZlcigpCglkbnNSZXNvbHZlci5uYW1lc2VydmVycyA9IFtvZERuc1NlcnZlcl0KCXRyeToKCQlhbnN3ZXJzIAkJCT0gZG5zUmVzb2x2ZXIucmVzb2x2ZSgnbXlpcC5vcGVuZG5zLmNvbScsICdBJykKCQlmb3IgcHVibGljSXAgaW4gYW5zd2VyczoKCQkJcHVibGljSXAgPSBwdWJsaWNJcC50b190ZXh0KCkKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHB1YmxpY0lQIGZyb20ge29kRG5zU2VydmVyfS4gUmVhc29uOiB7ZX0nKQoJCXB1YmxpY0lwID0gTm9uZQoJaWYgbm90IHB1YmxpY0lwOgoJCXRyeToKCQkJciAJCQk9IHJlcXVlc3RzLmdldChodHRwRG5zU2VydmVyKQoJCQlsb2dnZXIuaW5mbyhmJ3J0ZXh0OiB7ci50ZXh0fScpCgkJCXB1YmxpY0lwIAk9IHIudGV4dC5zdHJpcCgpCgkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHB1YmxpY0lQIGZyb20ge2h0dHBEbnNTZXJ2ZXJ9LiBSZWFzb246IHtlfScpCgkJCXB1YmxpY0lwID0gTm9uZQoJaWYgbm90IHB1YmxpY0lwOgoJCXB1YmxpY0lwID0gJzAuMC4wLjAnCglyZXR1cm4ocHVibGljSXApCgpkZWYgZ2V0VXNlckhvbWVQYXRoKCk6Cgl1c2VySG9tZVBhdGggCT0gb3MucGF0aC5leHBhbmR1c2VyKCJ+IikKCWxvZ2dlci5pbmZvKGYndXNlckhvbWVQYXRoOiB7dXNlckhvbWVQYXRofScpCglyZXR1cm4odXNlckhvbWVQYXRoKQoKZGVmIGdldERldmljZVV1aWQoY29uZmlnRmlsZSk6Cglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gcmVhZCBjb25maWcgZmlsZToge2NvbmZpZ0ZpbGV9Li4uJykKCWlmIG9zLnBhdGguaXNmaWxlKGNvbmZpZ0ZpbGUpOgoJCXRyeToKCQkJd2l0aCBvcGVuKGNvbmZpZ0ZpbGUsICdyJykgYXMgZjoKCQkJCWNvbmZpZ0RpY3QgPSBqc29uLmxvYWQoZikKCQkJbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgcmVhZCB7Y29uZmlnRmlsZX0nKQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHJlYWQge2NvbmZpZ0ZpbGV9JykKCQkJcXVpdCgnUXVpdHRpbmcuJykKCQlkZXZpY2VVdWlkIAk9IGNvbmZpZ0RpY3RbJ2RldmljZXV1aWQnXQoJCWlmICdzZXJ2ZXJBZGRyJyBpbiBjb25maWdEaWN0OgoJCQlob3N0ID0gY29uZmlnRGljdFsnc2VydmVyQWRkciddCgkJZWxzZToKCQkJaG9zdCA9ICdhcHAud2Vnd2Vpc2VyLnRlY2gnCgllbHNlOgoJCWxvZ2dlci5lcnJvcihmJ3tjb25maWdGaWxlfSBkb2VzIG5vdCBleGlzdC4gUXVpdHRpbmcuJykKCXJldHVybihkZXZpY2VVdWlkLCBob3N0KQoKIyBkZWYgd3JpdGVXZWdDb25maWdGaWxlKGRldmljZXV1aWQsIGdyb3VwdXVpZCk6CiMgCWNvbmZpZ0RpY3QgPSB7J2RldmljZXV1aWQnOmRldmljZXV1aWQsICdncm91cHV1aWQnOmdyb3VwdXVpZH0KIyAJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHdyaXRlIHRvIHt3ZWdDb25maWdGaWxlfScpCiMgCXdpdGggb3Blbih3ZWdDb25maWdGaWxlLCAndycpIGFzIGY6CiMgCQlmLndyaXRlKGpzb24uZHVtcHMoY29uZmlnRGljdCwgaW5kZW50PTQpKQojIAlsb2dnZXIuaW5mbyhmJ3t3ZWdDb25maWdGaWxlfSB3cml0dGVuIHN1Y2Nlc3NmdWxseS4nKQoKIyBkZWYgcmVnaXN0ZXJEZXZpY2UoZ3JvdXB1dWlkKToKIyAJZW5kcG9pbnQgCQk9ICcvZGV2aWNlcy9yZWdpc3RlcicKIyAJZGV2aWNlTmFtZSAJCT0gc29ja2V0LmdldGhvc3RuYW1lKCkKIyAJaGFyZHdhcmVJbmZvIAk9IHBsYXRmb3JtLnN5c3RlbSgpCiMgCXBheWxvYWQgCQk9IHsnZ3JvdXB1dWlkJzogZ3JvdXB1dWlkLCAnZGV2aWNlbmFtZSc6IGRldmljZU5hbWUsICdoYXJkd2FyZWluZm8nOiBoYXJkd2FyZUluZm99CiMgCXJlc3BvbnNlIAkJPSBzZW5kSnNvblBheWxvYWRGbGFzayhwYXlsb2FkLCBlbmRwb2ludCkKIyAJbG9nZ2VyLmRlYnVnKGYncmVzcG9uc2U6IHtyZXNwb25zZS50ZXh0fScpCiMgCWRldmljZVV1aWQgCQk9IGpzb24ubG9hZHMocmVzcG9uc2UudGV4dClbJ2RldmljZXV1aWQnXQojIAlsb2dnZXIuZGVidWcoZidEZXZpY2UgaXNzdWVkIG5ldyBkZXZpY2VVdWlkOiB7ZGV2aWNlVXVpZH0nKQojIAlyZXR1cm4oZGV2aWNlVXVpZCkKCmRlZiBnZXREZXZpY2VEYXRhKGRldmljZURhdGFEaWN0KToKCWRldmljZURhdGFEaWN0WydkZXZpY2UnXSAJCQkJCT0ge30KCWRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnZGV2aWNlVXVpZCddCQk9IGYne2RldmljZVV1aWR9JwojCWRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnZ3JvdXBVdWlkJ10JCT0gZid7Z3JvdXBVdWlkfScKCWRldmljZURhdGFEaWN0WydkZXZpY2UnXVsnc3lzdGVtdGltZSddCQk9IGludCh0aW1lLnRpbWUoKSkKCWlmIGRlYnVnTW9kZSA9PSBUcnVlOgoJCWxvZ2dlci5kZWJ1Zyhqc29uLmR1bXBzKGRldmljZURhdGFEaWN0LCBpbmRlbnQ9NCkpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCk6CglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ10gCQkJCQk9IHt9CglwbGF0ID0gJ21hY09TJyBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnRGFyd2luJyBlbHNlIChwbGF0Zm9ybS5zeXN0ZW0oKSBvciAnVW5rbm93bicpCglyZWwgID0gcGxhdGZvcm0ucmVsZWFzZSgpIG9yICdVbmtub3duJwoJdmVyICA9IHBsYXRmb3JtLnZlcnNpb24oKSBvciAnVW5rbm93bicKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnZGV2aWNlUGxhdGZvcm0nXSAJPSBmIntwbGF0fS17cmVsfS17dmVyfSIKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnc3lzdGVtTmFtZSddCQk9IHNvY2tldC5nZXRob3N0bmFtZSgpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ2N1cnJlbnRVc2VyJ10JCT0gZ2V0cGFzcy5nZXR1c2VyKCkKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnY3B1VXNhZ2UnXQkJPSBwc3V0aWwuY3B1X3BlcmNlbnQoNCkKCWRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnY3B1Q291bnQnXSAJCT0gcHN1dGlsLmNwdV9jb3VudCgpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ3B1YmxpY0lwJ10gCQk9IGdldFB1YmxpY0lwQWRkcigpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0Q29sbGVjdG9yRGF0YShkZXZpY2VEYXRhRGljdCk6CglhZ2VudFZlcnNpb25GaWxlID0gb3MucGF0aC5qb2luKGNvbmZpZ0RpciwgJ2FnZW50VmVyc2lvbi50eHQnKQoJd2l0aCBvcGVuKGFnZW50VmVyc2lvbkZpbGUsICdyJykgYXMgZjoKCQlsb2NhbEFnZW50VmVyc2lvbiA9IGYucmVhZCgpLnN0cmlwKCkKCWxvZ2dlci5pbmZvKGYnbG9jYWxBZ2VudFZlcnNpb246IHtsb2NhbEFnZW50VmVyc2lvbn0nKQoJZGV2aWNlRGF0YURpY3RbJ2NvbGxlY3RvciddIAkJCQkJPSB7fQoJZGV2aWNlRGF0YURpY3RbJ2NvbGxlY3RvciddWydjb2xsdmVyc2lvbiddCQk9IGxvY2FsQWdlbnRWZXJzaW9uCglkZXZpY2VEYXRhRGljdFsnY29sbGVjdG9yJ11bJ2NvbGxpbnN0YWxsZGlyJ10JPSBhcHBEaXIKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRVcHRpbWVEYXRhKGRldmljZURhdGFEaWN0KToKCWlmICdzeXN0ZW0nIG5vdCBpbiBkZXZpY2VEYXRhRGljdDoKCQlkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ10gPSB7fQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydib290VGltZSddCQk9IGludChwc3V0aWwuYm9vdF90aW1lKCkpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpOgoJZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10JCQkJPSBbXQoJcHNOZXREaWN0IAkJCQkJCQkJCT0gcHN1dGlsLm5ldF9pZl9zdGF0cygpCglpZkRpY3QgCQkJCQkJCQkJCT0ge30KCglmb3IgaWZOYW1lLCBkYXRhIGluIHBzTmV0RGljdC5pdGVtcygpOgoJCWlmRGljdFtpZk5hbWVdIAkJCQk9IHt9CgkJaWZEaWN0W2lmTmFtZV1bJ2lmSXNVcCddCT0gZGF0YS5pc3VwCgkJaWZEaWN0W2lmTmFtZV1bJ2lmU3BlZWQnXQk9IGRhdGEuc3BlZWQKCQlpZkRpY3RbaWZOYW1lXVsnaWZNdHUnXQkJPSBkYXRhLm10dQoKCXBzTmV0RGljdCAJCQkJCQkJCQk9IHBzdXRpbC5uZXRfaW9fY291bnRlcnMocGVybmljPVRydWUpCglmb3IgaWZOYW1lLCBkYXRhIGluIHBzTmV0RGljdC5pdGVtcygpOgoJCWlmIGlmTmFtZSBpbiBpZkRpY3Q6ICAjIE9ubHkgcHJvY2VzcyBpbnRlcmZhY2VzIHdlIGZvdW5kIGJlZm9yZQoJCQlpZkRpY3RbaWZOYW1lXVsnYnl0ZXNTZW50J10gCT0gZGF0YS5ieXRlc19yZWN2CgkJCWlmRGljdFtpZk5hbWVdWydieXRlc1JlY3YnXSAJPSBkYXRhLmJ5dGVzX3NlbnQKCQkJaWZEaWN0W2lmTmFtZV1bJ2VyckluJ10gCQk9IGRhdGEuZXJyaW4KCQkJaWZEaWN0W2lmTmFtZV1bJ2Vyck91dCddIAkJPSBkYXRhLmVycm91dAoKCXBzTmV0RGljdCAJCQkJCQkJCQk9IHBzdXRpbC5uZXRfaWZfYWRkcnMoKQoJZm9yIGlmTmFtZSwgYWRkcmVzc2VzIGluIHBzTmV0RGljdC5pdGVtcygpOgoJCWlmIGlmTmFtZSBpbiBpZkRpY3Q6ICAjIE9ubHkgcHJvY2VzcyBpbnRlcmZhY2VzIHdlIGZvdW5kIGJlZm9yZQoJCQlmb3IgYWRkcmVzcyBpbiBhZGRyZXNzZXM6CgkJCQlpZiBhZGRyZXNzLmZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDoKCQkJCQlpZkRpY3RbaWZOYW1lXVsnYWRkcmVzczQnXSAJCT0gYWRkcmVzcy5hZGRyZXNzCgkJCQkJaWZEaWN0W2lmTmFtZV1bJ25ldG1hc2s0J10gCQk9IGFkZHJlc3MubmV0bWFzawoJCQkJCWlmRGljdFtpZk5hbWVdWydicm9hZGNhc3Q0J10gCT0gYWRkcmVzcy5icm9hZGNhc3QKCQkJCWVsaWYgYWRkcmVzcy5mYW1pbHkgPT0gc29ja2V0LkFGX0lORVQ2OgoJCQkJCWlmRGljdFtpZk5hbWVdWydhZGRyZXNzNiddIAkJPSBhZGRyZXNzLmFkZHJlc3MKCQkJCQlpZkRpY3RbaWZOYW1lXVsnbmV0bWFzazYnXSAJCT0gYWRkcmVzcy5uZXRtYXNrCgkJCQkJaWZEaWN0W2lmTmFtZV1bJ2Jyb2FkY2FzdDYnXSAJPSBhZGRyZXNzLmJyb2FkY2FzdAoJZGV2aWNlRGF0YURpY3RbJ25ldHdvcmtMaXN0J10uYXBwZW5kKGlmRGljdCkJCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCQoJCmRlZiBnZXRVc2VyRGF0YShkZXZpY2VEYXRhRGljdCk6Cgl1c2VycyAJCT0gcHN1dGlsLnVzZXJzKCkKCWRldmljZURhdGFEaWN0WydVc2VycyddIAkJCQk9IFtdCgl1c2VyRGljdCAJPSB7fQoJdXNlcklkIAkJPSAwCglmb3IgdXNlciBpbiB1c2VyczoKCQl1c2VyRGljdFt1c2VySWRdIAkJCQk9IHt9CgkJdXNlckRpY3RbdXNlcklkXVsndXNlcm5hbWUnXSAJPSB1c2VyLm5hbWUKCQlpZiBub3QgdXNlci50ZXJtaW5hbDoKCQkJdXNlckRpY3RbdXNlcklkXVsndGVybWluYWwnXSAJPSAnLTEnCgkJZWxzZToKCQkJdXNlckRpY3RbdXNlcklkXVsndGVybWluYWwnXSAJPSB1c2VyLnRlcm1pbmFsCgkJaWYgbm90IHVzZXIuaG9zdDoKCQkJdXNlckRpY3RbdXNlcklkXVsnaG9zdCddIAk9ICdsb2NhbGhvc3QnCgkJZWxzZToKCQkJdXNlckRpY3RbdXNlcklkXVsnaG9zdCddIAkJPSB1c2VyLmhvc3QKCQl1c2VyRGljdFt1c2VySWRdWydsb2dnZWRJbiddIAk9IHVzZXIuc3RhcnRlZAoJCWlmIG5vdCB1c2VyLnBpZDoKCQkJdXNlckRpY3RbdXNlcklkXVsncGlkJ10JCQk9IC0xCgkJZWxzZToKCQkJdXNlckRpY3RbdXNlcklkXVsncGlkJ10gCQk9IHVzZXIucGlkCgkJdXNlcklkICs9IDEKCWRldmljZURhdGFEaWN0WydVc2VycyddLmFwcGVuZCh1c2VyRGljdCkKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCiMgV2luZG93cy1zcGVjaWZpYyBmdW5jdGlvbiByZW1vdmVkIGZvciBtYWNPUy1vbmx5IHNjcmlwdAoKZGVmIGdldERpc2tTdGF0cyhkZXZpY2VEYXRhRGljdCk6CgkiIiJHZXQgZGlzayB1c2FnZSBzdGF0aXN0aWNzIGZvciBtYWNPUyIiIgoJZHJpdmVEYXRhID0ge30KCXN0YXQgPSBzaHV0aWwuZGlza191c2FnZSgnLycpCgl0b3RhbCA9IHN0YXQudG90YWwKCXVzZWQgPSBzdGF0LnVzZWQKCWZyZWUgPSBzdGF0LmZyZWUKCXVzZWRQZXIgPSAodXNlZCAvIHRvdGFsKSAqIDEwMAoJZnJlZVBlciA9IChmcmVlIC8gdG90YWwpICogMTAwCglkZXZpY2VEYXRhRGljdFsnZHJpdmVzJ10gPSBbXQoJZHJpdmVEYXRhWyduYW1lJ10gPSAnLycKCWRyaXZlRGF0YVsndG90YWwnXSA9IHRvdGFsCglkcml2ZURhdGFbJ3VzZWQnXSA9IHVzZWQKCWRyaXZlRGF0YVsnZnJlZSddID0gZnJlZQoJZHJpdmVEYXRhWyd1c2VkUGVyJ10gPSB1c2VkUGVyCglkcml2ZURhdGFbJ2ZyZWVQZXInXSA9IGZyZWVQZXIKCWRldmljZURhdGFEaWN0Wydkcml2ZXMnXS5hcHBlbmQoZHJpdmVEYXRhKQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldEJhdHRlcnlEYXRhKGRldmljZURhdGFEaWN0KToKICAgIGJhdHRlcnkgPSBwc3V0aWwuc2Vuc29yc19iYXR0ZXJ5KCkKICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J10gPSB7fQogICAgaWYgYmF0dGVyeToKICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddWydpbnN0YWxsZWQnXSA9IFRydWUKICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddWydwY0NoYXJnZWQnXSA9IGJhdHRlcnkucGVyY2VudAogICAgICAgICMgRml4IGZvciBtYWNPUyBiYXR0ZXJ5IHNlY29uZHMgbGVmdCBoYW5kbGluZwogICAgICAgIGlmIGJhdHRlcnkuc2Vjc2xlZnQgPT0gLTI6ICAjIFBvd2VyIGNvbm5lY3RlZAogICAgICAgICAgICBkZXZpY2VEYXRhRGljdFsnYmF0dGVyeSddWydzZWNzTGVmdCddID0gLTIKICAgICAgICBlbGlmIGJhdHRlcnkuc2Vjc2xlZnQgPT0gLTE6ICAjIENhbGN1bGF0aW5nLi4uCiAgICAgICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3NlY3NMZWZ0J10gPSAtMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3NlY3NMZWZ0J10gPSBiYXR0ZXJ5LnNlY3NsZWZ0CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsncG93ZXJQbHVnJ10gPSBiYXR0ZXJ5LnBvd2VyX3BsdWdnZWQKICAgIGVsc2U6CiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsnaW5zdGFsbGVkJ10gPSBGYWxzZQogICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3BjQ2hhcmdlZCddID0gMAogICAgICAgIGRldmljZURhdGFEaWN0WydiYXR0ZXJ5J11bJ3NlY3NMZWZ0J10gPSAwCiAgICAgICAgZGV2aWNlRGF0YURpY3RbJ2JhdHRlcnknXVsncG93ZXJQbHVnJ10gPSBGYWxzZQogICAgcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFBhcnRpdGlvbkRhdGEoZGV2aWNlRGF0YURpY3QpOgoJcGFydGl0aW9uRGljdCAJCQkJCT0ge30KCWRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10gCT0gW10KCXBhcnRpdGlvbnNMaXN0CQkJCQk9IHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKQoJZm9yIHBhcnRpdGlvbiBpbiBwYXJ0aXRpb25zTGlzdDoKCQlwYXJ0aXRpb25EaWN0W3BhcnRpdGlvbi5tb3VudHBvaW50XSAJCQk9IHt9CgkJcGFydGl0aW9uRGljdFtwYXJ0aXRpb24ubW91bnRwb2ludF1bJ2RldmljZSddCT0gcGFydGl0aW9uLmRldmljZQoJCXBhcnRpdGlvbkRpY3RbcGFydGl0aW9uLm1vdW50cG9pbnRdWydmc3R5cGUnXQk9IHBhcnRpdGlvbi5mc3R5cGUKCWRldmljZURhdGFEaWN0WydwYXJ0aXRpb25zJ10uYXBwZW5kKHBhcnRpdGlvbkRpY3QpCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0bWVtb3J5RGF0YShkZXZpY2VEYXRhRGljdCk6CgkiIiJHZXQgbWVtb3J5IGluZm9ybWF0aW9uIGluY2x1ZGluZyBjb21wcmVoZW5zaXZlIHBzdXRpbCBtZXRyaWNzIiIiCgl0cnk6CgkJbWVtb3J5ID0gcHN1dGlsLnZpcnR1YWxfbWVtb3J5KCkKCgkJIyBHZXQgY29tcHJlaGVuc2l2ZSBtZW1vcnkgbWV0cmljcwoJCXRyeToKCQkJbWVtb3J5X21ldHJpY3MgPSBnZXRNZW1vcnlNZXRyaWNzKCkKCQlleGNlcHQ6CgkJCW1lbW9yeV9tZXRyaWNzID0ge30KCgkJZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewoJCQkndG90YWwnOiBtZW1vcnkudG90YWwsCgkJCSdhdmFpbGFibGUnOiBtZW1vcnkuYXZhaWxhYmxlLAoJCQkndXNlZCc6IG1lbW9yeS51c2VkLAoJCQknZnJlZSc6IG1lbW9yeS5mcmVlLAoJCQknbWVtb3J5X21ldHJpY3MnOiBtZW1vcnlfbWV0cmljcwoJCX0KCQlsb2dnZXIuaW5mbyhmJ01lbW9yeSBkYXRhIGNvbGxlY3RlZCcpCgkJcmV0dXJuKGRldmljZURhdGFEaWN0KQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0Vycm9yIGdldHRpbmcgbWVtb3J5IGRhdGE6IHtlfScpCgkJZGV2aWNlRGF0YURpY3RbJ21lbW9yeSddID0gewoJCQkndG90YWwnOiAwLAoJCQknYXZhaWxhYmxlJzogMCwKCQkJJ3VzZWQnOiAwLAoJCQknZnJlZSc6IDAsCgkJCSdtZW1vcnlfbWV0cmljcyc6IHt9CgkJfQoJCXJldHVybihkZXZpY2VEYXRhRGljdCkKCgoKZGVmIGNoZWNrTW9kZShtb2RlKToKCXZhbGlkTW9kZXMgPSBbJ0FVRElUJywgJ0VWRU5UTE9HJywgJ1NUQVRVUycsICdXRUdMT0cnLCAnRlVMTEFVRElUJywgCgkJCSAgIAkJJ01TSU5GTycsICdVUERBVEUnLCAnSU5TVEFMTCcsICdSRVNFVEVWRU5UUyddCglpZiBtb2RlLnVwcGVyKCkgaW4gdmFsaWRNb2RlczoKCQlyZXR1cm4obW9kZSkKCWVsc2U6CgkJbG9nZ2VyLmVycm9yKGYnSW52YWxpZCBtb2RlIHNwZWNpZmllZDoge21vZGV9JykKCQlzeXMuZXhpdCgpCgpkZWYgZ2V0V2VnQ29uZmlnRmlsZVgoY29uZmlnRGlyKToKCSIiIkdldCBjb25maWcgZmlsZSBwYXRoIGZvciBtYWNPUyIiIgoJd2VnQ29uZmlnRmlsZSA9IGYne2NvbmZpZ0Rpcn1hZ2VudC5jb25maWcnCglyZXR1cm4od2VnQ29uZmlnRmlsZSkKCmRlZiBnZXRBcHBEaXJzKCk6CgkiIiJHZXQgYXBwbGljYXRpb24gZGlyZWN0b3JpZXMgZm9yIG1hY09TIiIiCglhcHBEaXIgPSAnL29wdC9XZWd3ZWlzZXIvJwoJbG9nRGlyID0gb3MucGF0aC5qb2luKGFwcERpciwgJ0xvZ3MnLCAnJykKCWNvbmZpZ0RpciA9IG9zLnBhdGguam9pbihhcHBEaXIsICdDb25maWcnLCAnJykKCXRlbXBEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnVGVtcCcsICcnKQoJZmlsZXNEaXIgPSBvcy5wYXRoLmpvaW4oYXBwRGlyLCAnRmlsZXMnLCAnJykKCWNoZWNrRGlycyhbYXBwRGlyLCBsb2dEaXIsIGNvbmZpZ0RpciwgdGVtcERpciwgZmlsZXNEaXJdKQoJcmV0dXJuKGFwcERpciwgbG9nRGlyLCBjb25maWdEaXIsIHRlbXBEaXIsIGZpbGVzRGlyKQoKZGVmIGNoZWNrRGlycyhkaXJzVG9DaGVjayk6Cglmb3IgZGlyVG9DaGVjayBpbiBkaXJzVG9DaGVjazoKCQlkaXJUb0NoZWNrID0gb3MucGF0aC5qb2luKGRpclRvQ2hlY2ssICcnKQoJCWlmIG5vdCBvcy5wYXRoLmlzZGlyKGRpclRvQ2hlY2spOgoJCQlsb2dnZXIuaW5mbyhmJ3tkaXJUb0NoZWNrfSBkb2VzIG5vdCBleGlzdC4gQ3JlYXRpbmcuLi4nKQoJCQl0cnk6CgkJCQlvcy5tYWtlZGlycyhkaXJUb0NoZWNrKQoJCQkJbG9nZ2VyLmluZm8oZid7ZGlyVG9DaGVja30gY3JlYXRlZC4nKQoJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gY3JlYXRlIHtkaXJUb0NoZWNrfS4gUmVhc29uOiB7ZX0nKQoJCQkJc3lzLmV4aXQoKQoKZGVmIGRlbEZpbGUoZmlsZVRvRGVsZXRlKToKCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uLi4nKQoJdHJ5OgoJCW9zLnJlbW92ZShmaWxlVG9EZWxldGUpCgkJbG9nZ2VyLmluZm8oZidTdWNjZXNzZnVsbHkgZGVsZXRlZCB7ZmlsZVRvRGVsZXRlfS4nKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkZWxldGUge2ZpbGVUb0RlbGV0ZX0uIFJlYXNvbjoge2V9JykKCiMgV2luZG93cyBNU0luZm8gZnVuY3Rpb25zIHJlbW92ZWQgLSBub3QgYXBwbGljYWJsZSBmb3IgbWFjT1MKIyBNU0luZm8gcHJvY2Vzc2luZyByZW1vdmVkIC0gbm90IGFwcGxpY2FibGUgZm9yIG1hY09TCgpkZWYgZ2V0Q3B1SW5mbyhkZXZpY2VEYXRhRGljdCk6CgkiIiJHZXQgQ1BVIGluZm9ybWF0aW9uIGZvciBtYWNPUyBpbmNsdWRpbmcgY29tcHJlaGVuc2l2ZSBwc3V0aWwgbWV0cmljcyIiIgoJdHJ5OgoJCWNvbW1hbmQgPSBbJ3N5c2N0bCcsICctbicsICdtYWNoZGVwLmNwdS5icmFuZF9zdHJpbmcnXQoJCXJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNvbW1hbmQsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0xMCkKCQljcHVOYW1lID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpIG9yICdVbmtub3duJwoKCQlsb2dnZXIuaW5mbyhmJ2NwdU5hbWU6IHtjcHVOYW1lfScpCgoJCSMgR2V0IGNvbXByZWhlbnNpdmUgQ1BVIG1ldHJpY3MKCQl0cnk6CgkJCWNwdV9tZXRyaWNzID0gZ2V0Q3B1TWV0cmljcygpCgkJZXhjZXB0OgoJCQljcHVfbWV0cmljcyA9IHt9CgoJCWRldmljZURhdGFEaWN0WydjcHUnXSA9IHsKCQkJJ2NwdW5hbWUnOiBjcHVOYW1lLAoJCQknY3B1X21ldHJpY3MnOiBjcHVfbWV0cmljcwoJCX0KCQlyZXR1cm4oZGV2aWNlRGF0YURpY3QpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRXJyb3IgZ2V0dGluZyBDUFUgaW5mbzoge2V9JykKCQlkZXZpY2VEYXRhRGljdFsnY3B1J10gPSB7CgkJCSdjcHVuYW1lJzogJ1Vua25vd24nLAoJCQknY3B1X21ldHJpY3MnOiB7fQoJCX0KCQlyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgY2hlY2tBcHBJbnN0YWxsZWQoYXBwTmFtZSk6Cglsb2dnZXIuaW5mbyhmJ0NoZWNraW5nIGlmIHthcHBOYW1lfSBleGlzdHMuLi4nKQoJY29tbWFuZCAJPSBbIndoaWNoIiwgYXBwTmFtZV0KCXJlc3VsdCAJCT0gc3VicHJvY2Vzcy5Qb3Blbihjb21tYW5kLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFKQoJcmVzdWx0IAkJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKS5kZWNvZGUoInV0Zi04Iikuc3RyaXAoKQoJbG9nZ2VyLmluZm8oZidFOiB7cmVzdWx0fScpCglpZiBsZW4ocmVzdWx0KSA+IDA6CgkJbG9nZ2VyLmluZm8oZid7YXBwTmFtZX0gZXhpc3RzJykKCQlyZXR1cm4oVHJ1ZSkKCWVsc2U6CgkJbG9nZ2VyLmluZm8oZid7YXBwTmFtZX0gZG9lcyBub3QgZXhpc3QnKQoJCXJldHVybihGYWxzZSkKCmRlZiBnZXRHcHVJbmZvKGRldmljZURhdGFEaWN0KToKCSIiIkdldCBHUFUgaW5mb3JtYXRpb24gZm9yIG1hY09TIiIiCgl2ZW5kb3IgPSAnTm8gZGF0YSBmb3VuZCcKCXByb2R1Y3QgPSAnTm8gZGF0YSBmb3VuZCcKCWNvbG91ckRlcHRoID0gLTEKCWhSZXMgPSAtMQoJdlJlcyA9IC0xCgoJY29tbWFuZCA9IFsnc3lzdGVtX3Byb2ZpbGVyJywgJ1NQRGlzcGxheXNEYXRhVHlwZSddCglyZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjb21tYW5kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCglmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKCQlpZiAnQ2hpcHNldCBNb2RlbCcgaW4gbGluZToKCQkJcHJvZHVjdCA9IGxpbmUuc3BsaXQoJzogJylbMV0uc3RyaXAoKQoJCWlmICdWZW5kb3InIGluIGxpbmU6CgkJCXZlbmRvciA9IGxpbmUuc3BsaXQoJzogJylbMV0uc3RyaXAoKQoJCWlmICdSZXNvbHV0aW9uJyBpbiBsaW5lOgoJCQlyZXNvbHV0aW9uID0gbGluZS5zcGxpdCgnOiAnKVsxXS5zdHJpcCgpCgkJCXRyeToKCQkJCWhSZXMsIHZSZXMgPSByZXNvbHV0aW9uLnNwbGl0KCcgeCAnKQoJCQkJaFJlcyA9IGludChoUmVzKQoJCQkJdlJlcyA9ICcnLmpvaW4oZmlsdGVyKHN0ci5pc2RpZ2l0LCB2UmVzKSkKCQkJCXZSZXMgPSBpbnQodlJlcykgaWYgdlJlcy5pc2RpZ2l0KCkgZWxzZSAtMQoJCQlleGNlcHQ6CgkJCQloUmVzID0gLTEKCQkJCXZSZXMgPSAtMQoJCWlmICdGcmFtZWJ1ZmZlciBEZXB0aCcgaW4gbGluZToKCQkJdHJ5OgoJCQkJY29sb3VyRGVwdGggPSBpbnQobGluZS5zcGxpdCgnOiAnKVsxXS5zdHJpcCgpLnNwbGl0KCctJylbMF0pCgkJCWV4Y2VwdDoKCQkJCWNvbG91ckRlcHRoID0gLTEKCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddID0ge30KCWRldmljZURhdGFEaWN0WydncHVpbmZvJ11bJ2dwdXZlbmRvciddID0gdmVuZG9yCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHVwcm9kdWN0J10gPSBwcm9kdWN0CglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHVjb2xvdXInXSA9IGNvbG91ckRlcHRoCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHVocmVzJ10gPSBoUmVzCglkZXZpY2VEYXRhRGljdFsnZ3B1aW5mbyddWydncHV2cmVzJ10gPSB2UmVzCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgemlwRmlsZShmaWxlVG9aaXApOgoJaW1wb3J0IHppcGZpbGUKCWluRmlsZSAJCT0gb3MucGF0aC5qb2luKGZpbGVzRGlyLCBmaWxlVG9aaXApCglvdXRaaXBGaWxlIAk9IG9zLnBhdGguam9pbihmaWxlc0RpciwgZid7ZmlsZVRvWmlwfS56aXAnKQoJbG9nZ2VyLmluZm8oZidaaXBwaW5nIHtpbkZpbGV9IHRvIHtvdXRaaXBGaWxlfScpCgl0cnk6CgkJd2l0aCB6aXBmaWxlLlppcEZpbGUob3V0WmlwRmlsZSwgJ3cnLCBjb21wcmVzc2lvbj16aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKCQkJemlwZi53cml0ZShpbkZpbGUsIG9zLnBhdGguYmFzZW5hbWUoaW5GaWxlKSkKCQlsb2dnZXIuaW5mbyhmJ1N1Y2Nlc3NmdWxseSB6aXBwZWQge2luRmlsZX0gdG8ge291dFppcEZpbGV9JykKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gemlwIHtpbkZpbGV9IHRvIHtvdXRaaXBGaWxlfS4gUmVhc29uOiB7ZX0nKQoJcmV0dXJuKG91dFppcEZpbGUpCgpkZWYgc2VuZFBheWxvYWRGbGFzayhyb3V0ZSwgb3V0WmlwRmlsZSwgZGV2aWNlVXVpZCk6CglwYXlsb2FkTmFtZSAJPSBvcy5wYXRoLmJhc2VuYW1lKG91dFppcEZpbGUpCgl1cmwgCQkJPSBmJ2h0dHBzOi8ve2hvc3R9e3JvdXRlfScKCWxvZ2dlci5pbmZvKGYnUmVxdWVzdCB0byBzZW5kIHtvdXRaaXBGaWxlfSB8IHBheWxvYWROYW1lOiB7cGF5bG9hZE5hbWV9JykKCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBjb25uZWN0IHRvIHt1cmx9JykKCXdpdGggb3BlbihvdXRaaXBGaWxlLCAncmInKSBhcyBmOgoJCWZpbGVzID0geydmaWxlJzogKHBheWxvYWROYW1lLCBmKX0KCQloZWFkZXJzID0geydkZXZpY2V1dWlkJzogZGV2aWNlVXVpZH0KCQlyZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcywgaGVhZGVycz1oZWFkZXJzKQoJCWlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKCQkJbG9nZ2VyLmluZm8oZidzdGF0dXNfY29kZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfScpCgkJCXJldHVybihUcnVlKQoJCWVsc2U6CgkJCWxvZ2dlci5lcnJvcihmJ3N0YXR1c19jb2RlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9LiBSZWFzb246IHtyZXNwb25zZS50ZXh0fScpCgkJCXJldHVybihGYWxzZSkKCmRlZiBnZXRTbUJpb3NJbmZvKGRldmljZURhdGFEaWN0KToKCSIiIkdldCBzeXN0ZW0gaW5mb3JtYXRpb24gZm9yIG1hY09TIHVzaW5nIHN5c3RlbV9wcm9maWxlciIiIgoJdmVuZG9yID0gJ0FwcGxlIEluYy4nCglzZXJpYWxOdW1iZXIgPSAnbi9hJwoJdmVyc2lvbiA9ICduL2EnCgoJdHJ5OgoJCWNvbW1hbmQgPSBbJ3N5c3RlbV9wcm9maWxlcicsICdTUEhhcmR3YXJlRGF0YVR5cGUnXQoJCXJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNvbW1hbmQsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKCQlmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LnNwbGl0bGluZXMoKToKCQkJaWYgJ1NlcmlhbCBOdW1iZXInIGluIGxpbmU6CgkJCQlzZXJpYWxOdW1iZXIgPSBsaW5lLnNwbGl0KCc6ICcpWzFdLnN0cmlwKCkKCQkJaWYgJ0Jvb3QgUk9NIFZlcnNpb24nIGluIGxpbmU6CgkJCQl2ZXJzaW9uID0gbGluZS5zcGxpdCgnOiAnKVsxXS5zdHJpcCgpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBzeXN0ZW0gaW5mbzoge2V9JykKCglsb2dnZXIuaW5mbyhmJ3ZlbmRvcjoge3ZlbmRvcn0nKQoJbG9nZ2VyLmluZm8oZidzZXJpYWxOdW1iZXI6IHtzZXJpYWxOdW1iZXJ9JykKCWxvZ2dlci5pbmZvKGYndmVyc2lvbjoge3ZlcnNpb259JykKCWRldmljZURhdGFEaWN0WydiaW9zJ10gPSB7fQoJZGV2aWNlRGF0YURpY3RbJ2Jpb3MnXVsnYmlvc3ZlbmRvciddID0gdmVuZG9yCglkZXZpY2VEYXRhRGljdFsnYmlvcyddWydzZXJpYWxudW1iZXInXSA9IHNlcmlhbE51bWJlcgoJZGV2aWNlRGF0YURpY3RbJ2Jpb3MnXVsnYmlvc3ZlcnNpb24nXSA9IHZlcnNpb24KCXJldHVybihkZXZpY2VEYXRhRGljdCkKCmRlZiBnZXRTeXN0ZW1Nb2RlbEZyb21Qcm9jKCk6CglzeXN0ZW1Nb2RlbAk9ICduL2EnCgljb21tYW5kCQk9IFsnY2F0JywgJy9wcm9jL2NwdWluZm8nXQoJcmVzdWx0IAkJPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dCA9IHN1YnByb2Nlc3MuUElQRSwgdW5pdmVyc2FsX25ld2xpbmVzID0gVHJ1ZSkKCWxvZ2dlci5kZWJ1ZyhmJ3Jlc3VsdDoge3Jlc3VsdH0nKQoJb3V0dGV4dCAJPSByZXN1bHQuc3Rkb3V0LnJlYWQoKQoJbG9nZ2VyLmluZm8oZidvdXR0ZXh0OiB7b3V0dGV4dH0nKQoJZm9yIGxpbmUgaW4gb3V0dGV4dC5zcGxpdGxpbmVzKCk6CgkJaWYgJ01vZGVsJyBpbiBsaW5lOgoJCQlzeXN0ZW1Nb2RlbCA9IGxpbmUuc3BsaXQoJzonKVsxXS5zdHJpcCgpCglsb2dnZXIuaW5mbyhmJ3N5c3RlbU1vZGVsOiB7c3lzdGVtTW9kZWx9JykJCglyZXR1cm4oc3lzdGVtTW9kZWwpCgpkZWYgZ2V0U3lzdGVtTW9kZWwoZGV2aWNlRGF0YURpY3QpOgoJIiIiR2V0IGRldGFpbGVkIHN5c3RlbSBtb2RlbCBmb3IgbWFjT1MgaW5jbHVkaW5nIHllYXIgYW5kIGdlbmVyYXRpb24iIiIKCXN5c3RlbU1vZGVsID0gJ24vYScKCW1vZGVsSWRlbnRpZmllciA9ICduL2EnCgltb2RlbE5hbWUgPSAnbi9hJwoKCXRyeToKCQljb21tYW5kID0gWydzeXN0ZW1fcHJvZmlsZXInLCAnU1BIYXJkd2FyZURhdGFUeXBlJ10KCQlyZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjb21tYW5kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCgkJZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CgkJCWlmICdNb2RlbCBOYW1lJyBpbiBsaW5lOgoJCQkJbW9kZWxOYW1lID0gbGluZS5zcGxpdCgnOiAnKVsxXS5zdHJpcCgpCgkJCWVsaWYgJ01vZGVsIElkZW50aWZpZXInIGluIGxpbmU6CgkJCQltb2RlbElkZW50aWZpZXIgPSBsaW5lLnNwbGl0KCc6ICcpWzFdLnN0cmlwKCkKCgkJIyBDb21iaW5lIGJvdGggZm9yIGNvbXBsZXRlIG1vZGVsIGluZm8KCQlpZiBtb2RlbE5hbWUgIT0gJ24vYScgYW5kIG1vZGVsSWRlbnRpZmllciAhPSAnbi9hJzoKCQkJc3lzdGVtTW9kZWwgPSBmInttb2RlbE5hbWV9ICh7bW9kZWxJZGVudGlmaWVyfSkiCgkJZWxpZiBtb2RlbE5hbWUgIT0gJ24vYSc6CgkJCXN5c3RlbU1vZGVsID0gbW9kZWxOYW1lCgkJZWxpZiBtb2RlbElkZW50aWZpZXIgIT0gJ24vYSc6CgkJCXN5c3RlbU1vZGVsID0gbW9kZWxJZGVudGlmaWVyCgoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBnZXQgc3lzdGVtIG1vZGVsOiB7ZX0nKQoKCWxvZ2dlci5pbmZvKGYnc3lzdGVtTW9kZWw6IHtzeXN0ZW1Nb2RlbH0nKQoJbG9nZ2VyLmluZm8oZidtb2RlbE5hbWU6IHttb2RlbE5hbWV9JykKCWxvZ2dlci5pbmZvKGYnbW9kZWxJZGVudGlmaWVyOiB7bW9kZWxJZGVudGlmaWVyfScpCglkZXZpY2VEYXRhRGljdFsnc3lzdGVtJ11bJ3N5c3RlbW1vZGVsJ10gPSBzeXN0ZW1Nb2RlbAoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydtb2RlbG5hbWUnXSA9IG1vZGVsTmFtZQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydtb2RlbGlkZW50aWZpZXInXSA9IG1vZGVsSWRlbnRpZmllcgoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFNlcnZpY2VzKCk6CgkiIiJHZXQgcnVubmluZyBzZXJ2aWNlcy9kYWVtb25zIGZvciBtYWNPUyB1c2luZyBsYXVuY2hjdGwiIiIKCWxvZ2dlci5pbmZvKCdBdHRlbXB0aW5nIHRvIGdldCBzZXJ2aWNlcy4uLicpCglzZXJ2aWNlc0RpY3QgPSB7fQoKCXRyeToKCQkjIEdldCBsaXN0IG9mIGxvYWRlZCBzZXJ2aWNlcwoJCWNvbW1hbmQgPSBbJ2xhdW5jaGN0bCcsICdsaXN0J10KCQlyZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjb21tYW5kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCgoJCWZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgoJCQlpZiBsaW5lLnN0YXJ0c3dpdGgoJ1BJRCcpIG9yIGxpbmUuc3RyaXAoKSA9PSAnJzoKCQkJCWNvbnRpbnVlCgkJCXBhcnRzID0gbGluZS5zcGxpdCgnXHQnKQoJCQlpZiBsZW4ocGFydHMpID49IDM6CgkJCQlwaWQgPSBwYXJ0c1swXS5zdHJpcCgpCgkJCQlzdGF0dXMgPSBwYXJ0c1sxXS5zdHJpcCgpCgkJCQlzZXJ2aWNlTmFtZSA9IHBhcnRzWzJdLnN0cmlwKCkKCgkJCQkjIERldGVybWluZSBmcmllbmRseSBzdGF0ZQoJCQkJaWYgcGlkID09ICctJzoKCQkJCQlmcmllbmRseVN0YXRlID0gJ1NUT1BQRUQnCgkJCQllbGlmIHBpZC5pc2RpZ2l0KCk6CgkJCQkJZnJpZW5kbHlTdGF0ZSA9ICdSVU5OSU5HJwoJCQkJZWxzZToKCQkJCQlmcmllbmRseVN0YXRlID0gJ09USEVSJwoKCQkJCXNlcnZpY2VzRGljdFtzZXJ2aWNlTmFtZV0gPSB7CgkJCQkJJ2Rpc3BsYXluYW1lJzogc2VydmljZU5hbWUsCgkJCQkJJ2N1cnJlbnRzdGF0ZSc6IDEgaWYgZnJpZW5kbHlTdGF0ZSA9PSAnU1RPUFBFRCcgZWxzZSA0LAoJCQkJCSdmcmllbmRseXN0YXRlJzogZnJpZW5kbHlTdGF0ZSwKCQkJCQkncGlkJzogcGlkIGlmIHBpZCAhPSAnLScgZWxzZSBOb25lCgkJCQl9CglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBzZXJ2aWNlczoge2V9JykKCglsb2dnZXIuaW5mbygnU3VjY2Vzc2Z1bGx5IGNvbGxlY3RlZCBzZXJ2aWNlcy4nKQoJc2VydmljZXNEaWN0RmlsZSA9IHdyaXRlU2VydmljZXNKc29uKHNlcnZpY2VzRGljdCkKCXJvdXRlID0gJy9wYXlsb2FkL3NlbmRmaWxlJwoJdXBsb2FkU3VjY2VzcyA9IHNlbmRQYXlsb2FkRmxhc2socm91dGUsIHNlcnZpY2VzRGljdEZpbGUsIGRldmljZVV1aWQpCglpZiB1cGxvYWRTdWNjZXNzOgoJCWRlbEZpbGUoc2VydmljZXNEaWN0RmlsZSkKCWVsc2U6CgkJbG9nZ2VyLmVycm9yKGYnVXBsb2FkIGZhaWxlZC4nKQoJcmV0dXJuKHNlcnZpY2VzRGljdCkKCmRlZiB3cml0ZVNlcnZpY2VzSnNvbihzZXJ2aWNlc0RpY3QpOgoJc2VydmljZXNEaWN0RmlsZSA9IGYne2ZpbGVzRGlyfXNlcnZpY2VzLmpzb24nCglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gd3JpdGUgc2VydmljZXMgdG8ge3NlcnZpY2VzRGljdEZpbGV9JykKCXRyeToKCQl3aXRoIG9wZW4oc2VydmljZXNEaWN0RmlsZSwgJ3cnKSBhcyBmOgoJCQlmLndyaXRlKGpzb24uZHVtcHMoc2VydmljZXNEaWN0LCBpbmRlbnQ9NCkpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHdyaXRlIHNlcnZpY2VzRGljdCB0byB7c2VydmljZXNEaWN0RmlsZX0uIFJlYXNvbjoge2V9JykKCXJldHVybihzZXJ2aWNlc0RpY3RGaWxlKQoKZGVmIGdldFByaW50ZXJzKGRldmljZURhdGFEaWN0KToKCSIiIkdldCBwcmludGVyIGluZm9ybWF0aW9uIGZvciBtYWNPUyIiIgoJcHJpbnRlckRpY3QgPSB7fQoJZGV2aWNlRGF0YURpY3RbJ3ByaW50ZXJzJ10gPSBbXQoKCXRyeToKCQkjIFVzZSBscHN0YXQgdG8gZ2V0IHByaW50ZXIgaW5mb3JtYXRpb24KCQljb21tYW5kID0gWydscHN0YXQnLCAnLXAnLCAnLWwnLCAnLXMnXQoJCXJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNvbW1hbmQsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKCgkJZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CgkJCWlmIGxpbmUuc3RyaXAoKS5zdGFydHN3aXRoKCdwcmludGVyJyk6CgkJCQlwcmludGVyTmFtZSA9IGxpbmUuc3BsaXQoJ3ByaW50ZXIgJylbMV0uc3BsaXQoJyAnKVswXS5zdHJpcCgpCgkJCQlpZiBwcmludGVyTmFtZSBub3QgaW4gcHJpbnRlckRpY3Q6CgkJCQkJcHJpbnRlckRpY3RbcHJpbnRlck5hbWVdID0ge30KCQkJZWxpZiBsaW5lLnN0cmlwKCkuc3RhcnRzd2l0aCgnc3lzdGVtIGRlZmF1bHQnKToKCQkJCWRlZmF1bHRQcmludGVyID0gbGluZS5zcGxpdCgnOicpWzFdLnN0cmlwKCkKCQkJCWlmIGRlZmF1bHRQcmludGVyIGluIHByaW50ZXJEaWN0OgoJCQkJCXByaW50ZXJEaWN0W2RlZmF1bHRQcmludGVyXVsnZGVmYXVsdCddID0gVHJ1ZQoJCQllbGlmIGxpbmUuc3RyaXAoKS5zdGFydHN3aXRoKCdkZXZpY2UnKToKCQkJCXByaW50ZXJOYW1lID0gbGluZS5zcGxpdCgnZGV2aWNlIGZvciAnKVsxXS5zcGxpdCgnOicpWzBdCgkJCQlwcmludGVyUG9ydCA9ICc6Jy5qb2luKGxpbmUuc3BsaXQoJzonKVsxOl0pLnN0cmlwKCkKCQkJCWlmIHByaW50ZXJOYW1lIGluIHByaW50ZXJEaWN0OgoJCQkJCXByaW50ZXJEaWN0W3ByaW50ZXJOYW1lXVsncG9ydG5hbWUnXSA9IHByaW50ZXJQb3J0CgoJCWRldmljZURhdGFEaWN0WydwcmludGVycyddID0gcHJpbnRlckRpY3QKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IHByaW50ZXIgaW5mbzoge2V9JykKCQlkZXZpY2VEYXRhRGljdFsncHJpbnRlcnMnXSA9IHt9CgoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldFBjaURldmljZXMoZGV2aWNlRGF0YURpY3QpOgoJIiIiR2V0IFBDSSBkZXZpY2UgaW5mb3JtYXRpb24gZm9yIG1hY09TIHVzaW5nIHN5c3RlbV9wcm9maWxlciIiIgoJcGNpRGV2aWNlRGljdCA9IHt9CgoJdHJ5OgoJCWNvbW1hbmQgPSBbJ3N5c3RlbV9wcm9maWxlcicsICdTUFBDSURhdGFUeXBlJ10KCQlyZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjb21tYW5kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCgoJCWN1cnJlbnRfZGV2aWNlID0gTm9uZQoJCWZvciBsaW5lIGluIHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpOgoJCQlsaW5lID0gbGluZS5zdHJpcCgpCgkJCWlmICc6JyBpbiBsaW5lIGFuZCBub3QgbGluZS5zdGFydHN3aXRoKCcgJyk6CgkJCQkjIFRoaXMgaXMgYSBkZXZpY2UgbmFtZQoJCQkJY3VycmVudF9kZXZpY2UgPSBsaW5lLnJzdHJpcCgnOicpCgkJCQlwY2lEZXZpY2VEaWN0W2N1cnJlbnRfZGV2aWNlXSA9IHt9CgkJCWVsaWYgY3VycmVudF9kZXZpY2UgYW5kICdUeXBlOicgaW4gbGluZToKCQkJCWRldmljZV90eXBlID0gbGluZS5zcGxpdCgnVHlwZTonKVsxXS5zdHJpcCgpCgkJCQlwY2lEZXZpY2VEaWN0W2N1cnJlbnRfZGV2aWNlXVsncG5wY2xhc3MnXSA9IGRldmljZV90eXBlCgoJCWRldmljZURhdGFEaWN0WydwY2lkZXZpY2VzJ10gPSBwY2lEZXZpY2VEaWN0CglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBQQ0kgZGV2aWNlczoge2V9JykKCQlkZXZpY2VEYXRhRGljdFsncGNpZGV2aWNlcyddID0ge30KCglyZXR1cm4oZGV2aWNlRGF0YURpY3QpCgpkZWYgZ2V0VXNiRGV2aWNlcyhkZXZpY2VEYXRhRGljdCk6CgkiIiJHZXQgVVNCIGRldmljZSBpbmZvcm1hdGlvbiBmb3IgbWFjT1MgdXNpbmcgc3lzdGVtX3Byb2ZpbGVyIiIiCgl1c2JEZXZpY2VMaXN0ID0gW10KCgl0cnk6CgkJY29tbWFuZCA9IFsnc3lzdGVtX3Byb2ZpbGVyJywgJ1NQVVNCRGF0YVR5cGUnXQoJCXJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNvbW1hbmQsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKCgkJZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCk6CgkJCWxpbmUgPSBsaW5lLnN0cmlwKCkKCQkJaWYgJzonIGluIGxpbmUgYW5kIG5vdCBsaW5lLnN0YXJ0c3dpdGgoJyAnKToKCQkJCSMgVGhpcyBpcyBhIGRldmljZSBuYW1lCgkJCQlkZXZpY2VfbmFtZSA9IGxpbmUucnN0cmlwKCc6JykKCQkJCWlmIGRldmljZV9uYW1lIG5vdCBpbiB1c2JEZXZpY2VMaXN0IGFuZCBkZXZpY2VfbmFtZSAhPSAnVVNCJzoKCQkJCQl1c2JEZXZpY2VMaXN0LmFwcGVuZChkZXZpY2VfbmFtZSkKCgkJZGV2aWNlRGF0YURpY3RbJ3VzYmRldmljZXMnXSA9IHVzYkRldmljZUxpc3QKCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZ2V0IFVTQiBkZXZpY2VzOiB7ZX0nKQoJCWRldmljZURhdGFEaWN0Wyd1c2JkZXZpY2VzJ10gPSBbXQoKCXJldHVybihkZXZpY2VEYXRhRGljdCkKCiMgV2luZG93cyBFdmVudCBMb2cgZnVuY3Rpb25zIHJlbW92ZWQgLSBub3QgYXBwbGljYWJsZSBmb3IgbWFjT1MKCiMgZGVmIGdldFNlcnZlckNvbGxWZXJzaW9uKGFwcFZlcnNpb24pOgojIAlsb2dnZXIuaW5mbyhmJ0NoZWNraW5nIGNvbGxlY3RvciB2ZXJzaW9uJykKIyAJbG9nZ2VyLmluZm8oZidsb2NhbCBjb2xsZWN0b3JWZXJzaW9uOiB7YXBwVmVyc2lvbn0nKQojIAlyIAkJPSByZXF1ZXN0cy5nZXQoZidodHRwczovL3tob3N0fS9kaWFncy9jb2xsZWN0b3JWZXJzaW9uJykKIyAJZGF0YSAJPSByLmpzb24oKQojIAlzZXJ2ZXJDb2xsZWN0b3JWZXJzaW9uID0gZGF0YVsnc2VydmVyQ29sbGVjdG9yVmVyc2lvbiddCiMgCWNvbGxIYXNoUHkgCT0gZGF0YVsnc2VydmVySGFzaFB5J10KIyAJY29sbEhhc2hXaW4JPSBkYXRhWydzZXJ2ZXJIYXNoV2luJ10KIyAJbG9nZ2VyLmluZm8oZidzZXJ2ZXIgY29sbGVjdG9yVmVyc2lvbjoge3NlcnZlckNvbGxlY3RvclZlcnNpb259JykKIyAJaWYgaW50KGFwcFZlcnNpb24pIDwgaW50KHNlcnZlckNvbGxlY3RvclZlcnNpb24pOgojIAkJbG9nZ2VyLmluZm8oJ0xvY2FsIGNvbGxlY3RvciBuZWVkcyB1cGRhdGluZy4uLicpCiMgCQljb2xsZWN0b3JVcGRhdGVSZXFkID0gVHJ1ZQojIAllbHNlOgojIAkJbG9nZ2VyLmluZm8oJ0xvY2FsIGNvbGxlY3RvciBpcyB1cCB0byBkYXRlLicpCiMgCQljb2xsZWN0b3JVcGRhdGVSZXFkID0gRmFsc2UKIyAJcmV0dXJuKGNvbGxlY3RvclVwZGF0ZVJlcWQsIGNvbGxIYXNoUHksIGNvbGxIYXNoV2luKQoKZGVmIGdldFNoYTI1Nkhhc2goZmlsZVRvSGFzaCk6CglzaGEyNTZIYXNoID0gaGFzaGxpYi5zaGEyNTYoKQoJd2l0aCBvcGVuKGZpbGVUb0hhc2gsICdyYicpIGFzIGY6CgkJZm9yIGJ5dGVCbG9jayBpbiBpdGVyKGxhbWJkYTogZi5yZWFkKDQwOTYpLCBiIiIpOgoJCQlzaGEyNTZIYXNoLnVwZGF0ZShieXRlQmxvY2spCglsb2dnZXIuaW5mbyhmJ3NoYTI1NiBvZiB7ZmlsZVRvSGFzaH06IHtzaGEyNTZIYXNoLmhleGRpZ2VzdCgpfScpCglyZXR1cm4oc2hhMjU2SGFzaC5oZXhkaWdlc3QoKSkKCiMgZGVmIHVwZGF0ZUNvbGxlY3Rvcihjb2xsSGFzaFB5LCBjb2xsSGFzaFdpbik6CiMgCWlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdMaW51eCc6CiMgCQljb2xsZWN0b3JVcmwgPSBmJ2h0dHBzOi8ve2hvc3R9L2Rvd25sb2FkL2NvbGxlY3Rvci5weScKIyAJCWNodW5rU2l6ZSA9IDQwOTYKIyAJCXNhdmVUb0ZpbGUgPSBmJ3tzeXMuYXJndlswXX0ubmV3JwojIAkJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIGRvd25sb2FkIHtjb2xsZWN0b3JVcmx9IHRvIHtzYXZlVG9GaWxlfS4uLicpCiMgCQl0cnk6CiMgCQkJciA9IHJlcXVlc3RzLmdldChjb2xsZWN0b3JVcmwsIHN0cmVhbT1UcnVlKQojIAkJCWlmIHIuc3RhdHVzX2NvZGUgIT0gMjAwOgojIAkJCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gZG93bmxvYWQge2NvbGxlY3RvclVybH0uIFN0YXR1cyBDb2RlOiB7ci5zdGF0dXNfY29kZX0nKQojIAkJCQlyZXR1cm4oRmFsc2UpCiMgCQkJd2l0aCBvcGVuKHNhdmVUb0ZpbGUsICd3YicpIGFzIGY6CiMgCQkJCWZvciBjaHVuayBpbiByLml0ZXJfY29udGVudChjaHVua19zaXplPWNodW5rU2l6ZSk6CiMgCQkJCQlpZiBjaHVuazoKIyAJCQkJCQlmLndyaXRlKGNodW5rKQojIAkJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgojIAkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkb3dubG9hZCB7Y29sbGVjdG9yVXJsfSB0byB7c2F2ZVRvRmlsZX0uIFJlYXNvbjoge2V9JykKIyAJCW5ld0NvbGxIYXNoID0gZ2V0U2hhMjU2SGFzaChzYXZlVG9GaWxlKQojIAkJbG9nZ2VyLmluZm8oZidEb3dubG9hZGVkIEhhc2g6IHtuZXdDb2xsSGFzaH0gfCBTZXJ2ZXIgSGFzaDoge2NvbGxIYXNoUHl9JykKIyAJCWlmIG5ld0NvbGxIYXNoID09IGNvbGxIYXNoUHk6CiMgCQkJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJlbmFtZSB7c2F2ZVRvRmlsZX0gdG8ge3N5cy5hcmd2WzBdfScpCiMgCQkJdHJ5OgojIAkJCQlvcy5yZW5hbWUoc2F2ZVRvRmlsZSwgc3lzLmFyZ3ZbMF0pCiMgCQkJCWxvZ2dlci5pbmZvKGYnU3VjY2Vzc2Z1bGx5IHVwZ3JhZGVkIHtjb2xsZWN0b3JVcmx9IHRvIHtzYXZlVG9GaWxlfScpCiMgCQkJCWxvZ2dlci5pbmZvKCdOZXcgY29sbGVjdG9yIHdpbGwgcnVuIG9uIG5leHQgY3ljbGUnKQojIAkJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToKIyAJCQkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIHJlbmFtZSB7c2F2ZVRvRmlsZX0gdG8ge3N5cy5hcmd2WzBdfS4gUmVhc29uOiB7ZX0nKQojIAkJZWxzZToKIyAJCQlsb2dnZXIuZXJyb3IoJ0hhc2hlcyBkbyBub3QgbWF0Y2guIERlbGV0aW5nIGRvd25sb2FkLicpCiMgCQkJdHJ5OgojIAkJCQlvcy5yZW1vdmUoc2F2ZVRvRmlsZSkKIyAJCQlleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiMgCQkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBkZWxldGUge3NhdmVUb0ZpbGV9LiBSZWFzb246IHtlfScpCgkJCiMgCWVsaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ1dpbmRvd3MnOgojIAkJY29tbWFuZCA9IGYnKE5ldy1PYmplY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkRmlsZSgiaHR0cHM6Ly9hcHAud2Vnd2Vpc2VyLnRlY2gvZG93bmxvYWQvd2Vnd2Vpc2VyLmV4ZSIsIiRlbnY6VEVNUC93ZWd3ZWlzZXIuZXhlIik7IFwKIyBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiJGVudjpURU1QL3dlZ3dlaXNlci5leGUiIC1Bcmd1bWVudExpc3QgIi9ncm91cHV1aWQ9e2dyb3VwVXVpZH0iLCAiL0xPRz0kZW52OlRFTVAvV2Vnd2Vpc2VyU2V0dXAubG9nIiwgIi9TSUxFTlQiJwojIAkJbG9nZ2VyLmluZm8oZidBdHRlbXB0aW5nIHRvIHJ1bjoge2NvbW1hbmR9JykKIyAJCXJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsicG93ZXJzaGVsbCIsICItQ29tbWFuZCIsIGNvbW1hbmRdLCBzdGRvdXQgPSBzdWJwcm9jZXNzLlBJUEUsIHVuaXZlcnNhbF9uZXdsaW5lcyA9IFRydWUpCiMgCQlsb2dnZXIuaW5mbyhmJ3Jlc3VsdDoge3Jlc3VsdC5zdGRvdXR9JykKCmRlZiBwYXJzZVRpbWUodGltZVN0cik6CiAgICByZXR1cm4gKGRhdGV0aW1lLmRhdGV0aW1lLnN0cnB0aW1lKHRpbWVTdHIsICIlWS0lbS0lZC0lSDolTTolUyIpKQoKZGVmIHBhcnNlVGltZTIodGltZVN0cik6CiAgICByZXR1cm4gKGRhdGV0aW1lLmRhdGV0aW1lLnN0cnB0aW1lKHRpbWVTdHIsICIlWS0lbS0lZCAlSDolTTolUyIpKQoKZGVmIHJlYWRFdmVudEpzb24oanNvbkZpbGUpOgogICAgd2l0aCBvcGVuKGpzb25GaWxlLCAncicpIGFzIGY6CiAgICAgICAgZXZlbnRzRGljdCA9IGpzb24ubG9hZChmKQogICAgcmV0dXJuKGV2ZW50c0RpY3QpCgojIFdpbmRvd3MvTGludXggbG9nIGZpbHRlcmluZyBmdW5jdGlvbnMgcmVtb3ZlZCAtIG5vdCBhcHBsaWNhYmxlIGZvciBtYWNPUwoKZGVmIHNlbmRFdmVudE1ldGFkYXRhKGRldmljZVV1aWQpOgoJdXJsID0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCglsb2dOYW1lcyA9IFsnQXBwbGljYXRpb24nLCAnU3lzdGVtJywgJ1NlY3VyaXR5J10KCWZvciBsb2dOYW1lIGluIGxvZ05hbWVzOgoJCXdpdGggb3Blbihvcy5wYXRoLmpvaW4oZmlsZXNEaXIsICdldmVudHNGaWx0ZXJlZC0nICsgbG9nTmFtZSArJy5qc29uJyksICdyJykgYXMgZjoKCQkJZGF0YSA9IGpzb24ubG9hZChmKQoJCWJvZHkgPSB7CgkJCSdkZXZpY2V1dWlkJzpkZXZpY2VVdWlkLAoJCQknbWV0YWxvZ29zX3R5cGUnOmYnZXZlbnRzRmlsdGVyZWQte2xvZ05hbWV9JywKCQkJJ21ldGFsb2dvcyc6ZGF0YQoJCQl9CgkJCgkJaGVhZGVycyAJPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30KCQlsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gUE9TVCB0bzoge3VybH0nKQoJCXJlc3BvbnNlIAk9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhib2R5KSkKCQlsb2dnZXIuaW5mbyhmJ3Jlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9JykKCQlpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDE6CgkJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBQT1NUIGRhdGEuIFJlYXNvbjoge3Jlc3BvbnNlLnRleHR9JykKCmRlZiBzZW5kTGludXhMb2dNZXRhZGF0YShkZXZpY2VVdWlkLCBsb2dUb1NlbmQpOgoJdXJsID0gZidodHRwczovL3tob3N0fS9haS9kZXZpY2UvbWV0YWRhdGEnCgl3aXRoIG9wZW4ob3MucGF0aC5qb2luKGZpbGVzRGlyLCBmJ3tsb2dUb1NlbmR9RmlsdGVyZWQuanNvbicpLCAncicpIGFzIGY6CgkJZGF0YSA9IGpzb24ubG9hZChmKQoJYm9keSA9IHsKCQknZGV2aWNldXVpZCc6ZGV2aWNlVXVpZCwKCQknbWV0YWxvZ29zX3R5cGUnOmYne2xvZ1RvU2VuZH1GaWx0ZXJlZCcsCgkJJ21ldGFsb2dvcyc6ZGF0YQoJCX0KCWhlYWRlcnMgCT0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9Cglsb2dnZXIuaW5mbyhmJ0F0dGVtcHRpbmcgdG8gUE9TVCB0bzoge3VybH0gZm9yIHtsb2dUb1NlbmR9JykKCXJlc3BvbnNlIAk9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhib2R5KSkKCWxvZ2dlci5pbmZvKGYncmVzcG9uc2U6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0nKQoJaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAxOgoJCWxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBQT1NUIGRhdGEuIFJlYXNvbjoge3Jlc3BvbnNlLnRleHR9JykKCmRlZiBnZXREYXRlRm9ybWF0KGRhdGVTdHJpbmcpOgoJaWYgKCctJyBpbiBkYXRlU3RyaW5nKSBhbmQgKCcrJyBpbiBkYXRlU3RyaW5nKToKCQlldmVudFRpbWUgPSBkYXRldGltZS5kYXRldGltZS5mcm9taXNvZm9ybWF0KGRhdGVTdHJpbmcpCgllbHNlOgoJCWV2ZW50VGltZSA9IGRhdGV0aW1lLmRhdGV0aW1lLnN0cnB0aW1lKGRhdGVTdHJpbmcsICIlYiAlZCAlSDolTTolUyIpCgkJZXZlbnRUaW1lID0gZXZlbnRUaW1lLnJlcGxhY2UoeWVhcj1kYXRldGltZS5kYXRldGltZS5ub3coKS55ZWFyKQoJcmV0dXJuKGV2ZW50VGltZSkJCQoJCiMgZGVmIGNoZWNrQXJncyhhcmdzKToKIyAJaWYgYXJncy52ZXJzaW9uOgojIAkJcHJpbnQoZid7YXBwTmFtZX0gVmVyc2lvbjoge2FwcFZlcnNpb259JykKIyAJCXN5cy5leGl0KCkKIyAJaWYgYXJncy5ncm91cFV1aWQ6CiMgCQlncm91cFV1aWQgCQk9IGFyZ3MuZ3JvdXBVdWlkCiMgCWVsc2U6CiMgCQlncm91cFV1aWQJCT0gTm9uZQojIAlpZiBhcmdzLm1vZGU6CiMgCQltb2RlID0gYXJncy5tb2RlCiMgCWVsc2U6CiMgCQltb2RlID0gJ0FVRElUJwojIAlyZXR1cm4oZ3JvdXBVdWlkLCBtb2RlKQoKIyBMaW51eCBsb2cgcHJvY2Vzc2luZyByZW1vdmVkIC0gbm90IGFwcGxpY2FibGUgZm9yIG1hY09TCgpkZWYgZ2V0T3NMYW5nKGRldmljZURhdGFEaWN0KToKCSIiIkdldCBzeXN0ZW0gbG9jYWxlIGZvciBtYWNPUyIiIgoJc3lzdGVtTG9jYWxlID0gJ05vdCBkZXRlY3RlZCcKCgl0cnk6CgkJIyBHZXQgc3lzdGVtIGxvY2FsZSB1c2luZyBkZWZhdWx0cyBjb21tYW5kCgkJY29tbWFuZCA9IFsnZGVmYXVsdHMnLCAncmVhZCcsICctZycsICdBcHBsZUxvY2FsZSddCgkJcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY29tbWFuZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQoJCWlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CgkJCXN5c3RlbUxvY2FsZSA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKQoJCWVsc2U6CgkJCSMgRmFsbGJhY2sgdG8gZW52aXJvbm1lbnQgdmFyaWFibGUKCQkJc3lzdGVtTG9jYWxlID0gb3MuZ2V0ZW52KCdMQU5HJywgJ05vdCBkZXRlY3RlZCcpCglleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgkJbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGdldCBzeXN0ZW0gbG9jYWxlOiB7ZX0nKQoJCXN5c3RlbUxvY2FsZSA9IG9zLmdldGVudignTEFORycsICdOb3QgZGV0ZWN0ZWQnKQoKCWxvZ2dlci5kZWJ1ZyhmJ3N5c3RlbUxvY2FsZToge3N5c3RlbUxvY2FsZX0nKQoJZGV2aWNlRGF0YURpY3RbJ3N5c3RlbSddWydzeXN0ZW1sb2NhbGUnXSA9IHN5c3RlbUxvY2FsZQoJcmV0dXJuKGRldmljZURhdGFEaWN0KQoKZGVmIGdldE1hbnVmYWN0dXJlcihkZXZpY2VEYXRhRGljdCk6CiAgICAiIiJHZXQgc3lzdGVtIG1hbnVmYWN0dXJlciBmb3IgbWFjT1MiIiIKICAgIHN5c3RlbU1hbnVmYWN0dXJlciA9ICdBcHBsZSBJbmMuJyAgIyBtYWNPUyBkZXZpY2VzIGFyZSBhbHdheXMgQXBwbGUKCiAgICBsb2dnZXIuZGVidWcoZidzeXN0ZW1NYW51ZmFjdHVyZXI6IHtzeXN0ZW1NYW51ZmFjdHVyZXJ9JykKICAgIGRldmljZURhdGFEaWN0WydzeXN0ZW0nXVsnc3lzdGVtbWFudWZhY3R1cmVyJ10gPSBzeXN0ZW1NYW51ZmFjdHVyZXIKICAgIHJldHVybihkZXZpY2VEYXRhRGljdCkKCiMgV2luZG93cy1zcGVjaWZpYyBmdW5jdGlvbnMgcmVtb3ZlZCAtIG5vdCBhcHBsaWNhYmxlIGZvciBtYWNPUwoKZGVmIGdldEZpbGVWZXJzaW9uKHBhdGgsIEdldEZpbGVWZXJzaW9uSW5mbywgTE9XT1JELCBISVdPUkQpOgoJdHJ5OgoJCWluZm8gPSBHZXRGaWxlVmVyc2lvbkluZm8gKHBhdGgsICJcXCIpCgkJbXMgPSBpbmZvWydGaWxlVmVyc2lvbk1TJ10KCQlscyA9IGluZm9bJ0ZpbGVWZXJzaW9uTFMnXQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ1ZlcnNpb24gRGF0YSBub3QgZm91bmQuIFJlYXNvbjoge2V9JykKCXRyeToKCQlpbnN0YWxsZWRWZXJzaW9uID0gc3RyKEhJV09SRCAobXMpKSArICcuJyArIFwKCQkJCQkJc3RyKExPV09SRCAobXMpKSArICcuJyArIFwKCQkJCQkJc3RyKEhJV09SRCAobHMpKSArICcuJyArIFwKCQkJCQkJc3RyKExPV09SRCAobHMpKQoJCXJldHVybihpbnN0YWxsZWRWZXJzaW9uKQoJZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgoJCWxvZ2dlci5lcnJvcihmJ2Vycm9yOiB7ZX0nKQoJCXJldHVybignMC4wLjAuMCcpCgpkZWYgZ2V0RmlsZU1vZGlmaWVkRGF0ZShwYXRoKToKCW1vZERhdGUgPSBpbnQob3MucGF0aC5nZXRtdGltZShwYXRoKSkKCXJldHVybihtb2REYXRlKQoKIyBnZXREcml2ZXJzKCkgZnVuY3Rpb24gcmVtb3ZlZCAtIG5vdCBhcHBsaWNhYmxlIGZvciBtYWNPUwoKZGVmIHNlbmRNZXRhTWV0YWRhdGEoZGV2aWNlVXVpZCwgZGF0YSwgbWV0YU5hbWUpOgoJdXJsID0gZidodHRwczovL3tob3N0fS9tZXRhZGF0YScKCWJvZHkgPSB7CgkJJ2RldmljZXV1aWQnOmRldmljZVV1aWQsCgkJJ21ldGFsb2dvc190eXBlJzogbWV0YU5hbWUsCgkJJ21ldGFsb2dvcyc6ZGF0YQoJCX0KCQoJaGVhZGVycyAJPSB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30KCWxvZ2dlci5pbmZvKGYnQXR0ZW1wdGluZyB0byBQT1NUIHRvOiB7dXJsfScpCglyZXNwb25zZSAJPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWpzb24uZHVtcHMoYm9keSkpCglsb2dnZXIuaW5mbyhmJ3Jlc3BvbnNlOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9JykKCWlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMToKCQlsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gUE9TVCBkYXRhLiBSZWFzb246IHtyZXNwb25zZS50ZXh0fScpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIE1BSU4gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGVidWdNb2RlIAkJCT0gVHJ1ZQpob3N0IAkJCQk9ICdhcHAud2Vnd2Vpc2VyLnRlY2gnCnBvcnQgCQkJCT0gNDQzCiNhcmdzCQkJCT0gcGFyc2VBcmdzKCkKCmlmIGRlYnVnTW9kZSA9PSBUcnVlOgoJbG9nZ2VyLmluZm8oJ2Z1bGxBdWRpdCBTdGFydGluZy4uLicpCgphcHBEaXIsIFwKCWxvZ0RpciwgXAoJY29uZmlnRGlyLCBcCgl0ZW1wRGlyLCBcCglmaWxlc0RpcgkJPSBnZXRBcHBEaXJzKCkKI2xvZ0ZpbGUgCQkJPSBmJ3tsb2dEaXJ9LmxvZycKI2xvZ2ZpbGUobG9nRmlsZSkKI2xvZ2dlci5kZWJ1ZyhmJ2xvZ0ZpbGU6IHtsb2dGaWxlfScpCmFnZW50Q29uZmlnRmlsZSAJPSBvcy5wYXRoLmpvaW4oY29uZmlnRGlyLCAnYWdlbnQuY29uZmlnJykKZGV2aWNlVXVpZCwgXAoJaG9zdAkJPSBnZXREZXZpY2VVdWlkKGFnZW50Q29uZmlnRmlsZSkKbXNpbmZvT3V0cHV0IAkJPSBmJ3tmaWxlc0Rpcn1tc2luZm8udHh0JwoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMgTUFDT1MgQVVESVQgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZGV2aWNlRGF0YURpY3QgPSB7fQpkZXZpY2VEYXRhRGljdCA9IGdldERldmljZURhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0U3lzdGVtRGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXREaXNrU3RhdHMoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0TmV0d29ya0RhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0VXNlckRhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0VXB0aW1lRGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRCYXR0ZXJ5RGF0YShkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRtZW1vcnlEYXRhKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCA9IGdldENvbGxlY3RvckRhdGEoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0TWFudWZhY3R1cmVyKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCA9IGdldE9zTGFuZyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRDcHVJbmZvKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCA9IGdldEdwdUluZm8oZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0U21CaW9zSW5mbyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRTeXN0ZW1Nb2RlbChkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRQcmludGVycyhkZXZpY2VEYXRhRGljdCkKZGV2aWNlRGF0YURpY3QgPSBnZXRQY2lEZXZpY2VzKGRldmljZURhdGFEaWN0KQpkZXZpY2VEYXRhRGljdCA9IGdldFVzYkRldmljZXMoZGV2aWNlRGF0YURpY3QpCmRldmljZURhdGFEaWN0ID0gZ2V0UGFydGl0aW9uRGF0YShkZXZpY2VEYXRhRGljdCkKIyBnZXREcml2ZXJzKCkgcmVtb3ZlZCAtIG5vdCBhcHBsaWNhYmxlIGZvciBtYWNPUwpzZXJ2aWNlc0RpY3QgPSBnZXRTZXJ2aWNlcygpCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIFNFTkQgUkVTVUxUUyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpyb3V0ZSA9ICcvcGF5bG9hZC9zZW5kYXVkaXQnCnBheWxvYWQgPSB7CgkiZGF0YSI6IGRldmljZURhdGFEaWN0Cn0KCmlmIGRlYnVnTW9kZSA9PSBUcnVlOgoJcHJpbnQoZidwYXlsb2FkIGR1bXBzOiB7anNvbi5kdW1wcyhwYXlsb2FkLCBpbmRlbnQ9NCl9JykKCXdpdGggb3BlbihmJ3tsb2dEaXJ9ZnVsbEF1ZGl0LmxvZycsICdhJykgYXMgZjoKCQlmLndyaXRlKGpzb24uZHVtcHMoZGV2aWNlRGF0YURpY3QsIGluZGVudD00KSkKcmVzcG9uc2UgCT0gc2VuZEpzb25QYXlsb2FkRmxhc2socGF5bG9hZCwgcm91dGUpCmxvZ2dlci5pbmZvKGYnU2VydmVyIHJlc3BvbnNlOiB7cmVzcG9uc2V9IHwge3Jlc3BvbnNlLnRleHR9JykKCgoKCgoKCgoKCgo="}}