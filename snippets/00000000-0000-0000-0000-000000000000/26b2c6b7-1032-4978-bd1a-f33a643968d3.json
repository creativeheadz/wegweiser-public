{"settings": {"snippetUuid": "26b2c6b7-1032-4978-bd1a-f33a643968d3", "snippetname": "updateNatsAgent", "snippettype": ".py", "created_at": 1761148678}, "payload": {"payloadsig": "YwO9Cn4S4uwHq4EL3gLJK9ebBClMHHzpDLShpONBe1311s2Z+qAfsEVu8vWkNnNSTyByrci7aYam7VlvpnIPAWJsXcZ7rqBOca8y5MJoiLV+ZE1/iYSLwBlWCFBWIZzznMdOjUmAV+N2OQENdEzuV7cfZnbOd+ALYSoKvI4ITcI3T/HT4DfbucFQhn80ierNeTlPeCgR6D7UjcqaaN4xjirs/6RcIiiyJ/amP+ygKEPh4pelC/amxAohhka+oLX8YKLhbM6oxVDLgwkmPodtjiSpa0KDa0M0uDsk4c1EX9RJ6K5hz4gvnIhhDL56fPdEKiG7pAlDEkQ5uFwsi/2y+JnR3ihJKNs6hxPLAuxTOTMDRMbomBtF8ZJiKGyt+nkh6hma3iwAEA8Auv5j7taIP3deEKSdoiXtzte45FEazDcREqwGIjpBxSlbgogC2ryWOaclbeAnBdq0ea0kgqz4tPJfnb0qqvyfYD4XzCnpT2oQFsZXSMNzAZedfODp9Qh2XMeuwUOlguHZYcrODMTkqADEtL9i2sFkKdnDl2JPS18eG0gpVjYQhpsk/KkTguKMo5E5iIqE3BcQwxbCGdrPTn2WQ0F2H2rhelEGqTgawueoii5FogO7FKYjRokoO+CCJiUIHiyPQyGz9WW2Xmlf27qH1D3N+XBaFBiy5Q9kbHA=", "payloadb64": "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKVXBkYXRlIE5BVFMgUGVyc2lzdGVudCBBZ2VudCAtIHYzLjAuMCsKRG93bmxvYWRzIGFuZCB1cGRhdGVzIHRoZSBOQVRTIHBlcnNpc3RlbnQgYWdlbnQgd2l0aCBoZWFydGJlYXQgZnVuY3Rpb25hbGl0eQpTdXBwb3J0cyBXaW5kb3dzLCBMaW51eCwgYW5kIG1hY09TCiIiIgoKaW1wb3J0IGhhc2hsaWIKaW1wb3J0IGpzb24KaW1wb3J0IHBsYXRmb3JtCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgb3MKaW1wb3J0IHN5cwppbXBvcnQgc2h1dGlsCmltcG9ydCB0aW1lCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAoKIyBDb25maWd1cmF0aW9uCmhvc3QgPSBvcy5lbnZpcm9uLmdldCgnV0VHV0VJU0VSX0hPU1QnLCAnYXBwLndlZ3dlaXNlci50ZWNoJykKCiMgRGV0ZXJtaW5lIGFnZW50IGRpcmVjdG9yeSBiYXNlZCBvbiBwbGF0Zm9ybQppZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnV2luZG93cyc6CiAgICAjIFRyeSBQcm9ncmFtIEZpbGVzICh4ODYpIGZpcnN0LCB0aGVuIFByb2dyYW0gRmlsZXMsIHRoZW4gZmFsbGJhY2sKICAgIGFnZW50X2Jhc2VfZGlyID0gb3MuZW52aXJvbi5nZXQoJ1dFR1dFSVNFUl9BR0VOVF9ESVInKQogICAgaWYgbm90IGFnZW50X2Jhc2VfZGlyOgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCdDOlxcUHJvZ3JhbSBGaWxlcyAoeDg2KVxcV2Vnd2Vpc2VyXFxBZ2VudCcpOgogICAgICAgICAgICBhZ2VudF9iYXNlX2RpciA9ICdDOlxcUHJvZ3JhbSBGaWxlcyAoeDg2KVxcV2Vnd2Vpc2VyXFxBZ2VudCcKICAgICAgICBlbGlmIG9zLnBhdGguZXhpc3RzKCdDOlxcUHJvZ3JhbSBGaWxlc1xcV2Vnd2Vpc2VyXFxBZ2VudCcpOgogICAgICAgICAgICBhZ2VudF9iYXNlX2RpciA9ICdDOlxcUHJvZ3JhbSBGaWxlc1xcV2Vnd2Vpc2VyXFxBZ2VudCcKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZ2VudF9iYXNlX2RpciA9ICdDOlxcUHJvZ3JhbSBGaWxlcyAoeDg2KVxcV2Vnd2Vpc2VyXFxBZ2VudCcKZWxzZToKICAgIGFnZW50X2Jhc2VfZGlyID0gb3MuZW52aXJvbi5nZXQoJ1dFR1dFSVNFUl9BR0VOVF9ESVInLCAnL29wdC9XZWd3ZWlzZXIvQWdlbnQnKQoKZGVmIGdldF9sb2dnZXIoKToKICAgICIiIlNpbXBsZSBsb2dnaW5nIHNldHVwIiIiCiAgICBpbXBvcnQgbG9nZ2luZwogICAgbG9nZ2luZy5iYXNpY0NvbmZpZygKICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8sCiAgICAgICAgZm9ybWF0PSclKGFzY3RpbWUpcyAtICUobGV2ZWxuYW1lKXMgLSAlKG1lc3NhZ2UpcycKICAgICkKICAgIHJldHVybiBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCmxvZ2dlciA9IGdldF9sb2dnZXIoKQpsb2dnZXIuaW5mbyhmIltVUERBVEVdIEFnZW50IGRpcmVjdG9yeToge2FnZW50X2Jhc2VfZGlyfSIpCmxvZ2dlci5pbmZvKGYiW1VQREFURV0gQWdlbnQgZGlyZWN0b3J5IGV4aXN0czoge29zLnBhdGguZXhpc3RzKGFnZW50X2Jhc2VfZGlyKX0iKQoKZGVmIGdldF9zZXJ2ZXJfbmF0c19hZ2VudF92ZXJzaW9uKCk6CiAgICAiIiJHZXQgTkFUUyBhZ2VudCB2ZXJzaW9uIGFuZCBoYXNoZXMgZnJvbSBzZXJ2ZXIiIiIKICAgIHRyeToKICAgICAgICBsb2dnZXIuaW5mbygnQ2hlY2tpbmcgTkFUUyBhZ2VudCB2ZXJzaW9uIGZyb20gc2VydmVyJykKICAgICAgICB1cmwgPSBmJ2h0dHBzOi8ve2hvc3R9L2RpYWdzL3BlcnNpc3RlbnRhZ2VudHZlcnNpb24nCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCB0aW1lb3V0PTEwLCB2ZXJpZnk9RmFsc2UpCiAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIAogICAgICAgIGlmIGRhdGEuZ2V0KCdzdGF0dXMnKSAhPSAnc3VjY2Vzcyc6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlNlcnZlciByZXR1cm5lZCBlcnJvcjoge2RhdGF9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAndmVyc2lvbic6IGRhdGEuZ2V0KCdwZXJzaXN0ZW50X2FnZW50X3ZlcnNpb24nKSwKICAgICAgICAgICAgJ2hhc2hfcHknOiBkYXRhLmdldCgncGVyc2lzdGVudF9hZ2VudF9oYXNoX3B5JyksCiAgICAgICAgICAgICdoYXNoX2xpbnV4JzogZGF0YS5nZXQoJ3BlcnNpc3RlbnRfYWdlbnRfaGFzaF9saW51eCcpLAogICAgICAgICAgICAnaGFzaF9tYWNvcyc6IGRhdGEuZ2V0KCdwZXJzaXN0ZW50X2FnZW50X2hhc2hfbWFjb3MnKQogICAgICAgIH0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gZ2V0IHNlcnZlciB2ZXJzaW9uOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X2xvY2FsX25hdHNfYWdlbnRfdmVyc2lvbigpOgogICAgIiIiR2V0IGxvY2FsIE5BVFMgYWdlbnQgdmVyc2lvbiIiIgogICAgdHJ5OgogICAgICAgIHZlcnNpb25fZmlsZSA9IG9zLnBhdGguam9pbihhZ2VudF9iYXNlX2RpciwgJ1ZFUlNJT04nKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHZlcnNpb25fZmlsZSk6CiAgICAgICAgICAgIHdpdGggb3Blbih2ZXJzaW9uX2ZpbGUsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgIHJldHVybiBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgIyBGYWxsYmFjazogY2hlY2sgbmF0c19hZ2VudC5weSBmb3IgVkVSU0lPTiBjb25zdGFudAogICAgICAgIG5hdHNfYWdlbnRfZmlsZSA9IG9zLnBhdGguam9pbihhZ2VudF9iYXNlX2RpciwgJ25hdHNfYWdlbnQucHknKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG5hdHNfYWdlbnRfZmlsZSk6CiAgICAgICAgICAgIHdpdGggb3BlbihuYXRzX2FnZW50X2ZpbGUsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIGY6CiAgICAgICAgICAgICAgICAgICAgaWYgJ1ZFUlNJT04nIGluIGxpbmUgYW5kICc9JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uID0gbGluZS5zcGxpdCgnPScpWzFdLnN0cmlwKCkuc3RyaXAoJyJcJycpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2ZXJzaW9uCiAgICAgICAgcmV0dXJuICcwLjAuMCcKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gZ2V0IGxvY2FsIHZlcnNpb246IHtlfSIpCiAgICAgICAgcmV0dXJuICcwLjAuMCcKCmRlZiBjb21wYXJlX3ZlcnNpb25zKGxvY2FsX3Zlciwgc2VydmVyX3Zlcik6CiAgICAiIiJDb21wYXJlIHNlbWFudGljIHZlcnNpb25zIiIiCiAgICB0cnk6CiAgICAgICAgbG9jYWxfcGFydHMgPSBbaW50KHgpIGZvciB4IGluIGxvY2FsX3Zlci5zcGxpdCgnLicpXQogICAgICAgIHNlcnZlcl9wYXJ0cyA9IFtpbnQoeCkgZm9yIHggaW4gc2VydmVyX3Zlci5zcGxpdCgnLicpXQogICAgICAgIHJldHVybiBzZXJ2ZXJfcGFydHMgPiBsb2NhbF9wYXJ0cwogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGdldF9zaGEyNTZfaGFzaChmaWxlcGF0aCk6CiAgICAiIiJDYWxjdWxhdGUgU0hBMjU2IGhhc2ggb2YgZmlsZSIiIgogICAgc2hhMjU2X2hhc2ggPSBoYXNobGliLnNoYTI1NigpCiAgICB3aXRoIG9wZW4oZmlsZXBhdGgsICdyYicpIGFzIGY6CiAgICAgICAgZm9yIGJ5dGVfYmxvY2sgaW4gaXRlcihsYW1iZGE6IGYucmVhZCg0MDk2KSwgYiIiKToKICAgICAgICAgICAgc2hhMjU2X2hhc2gudXBkYXRlKGJ5dGVfYmxvY2spCiAgICByZXR1cm4gc2hhMjU2X2hhc2guaGV4ZGlnZXN0KCkKCmRlZiBkb3dubG9hZF9maWxlKHVybCwgc2F2ZV9wYXRoKToKICAgICIiIkRvd25sb2FkIGZpbGUgZnJvbSBVUkwiIiIKICAgIHRyeToKICAgICAgICBsb2dnZXIuaW5mbyhmIkRvd25sb2FkaW5nIHt1cmx9IikKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PTMwLCB2ZXJpZnk9RmFsc2UpCiAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHNhdmVfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgZm9yIGNodW5rIGluIHJlc3BvbnNlLml0ZXJfY29udGVudChjaHVua19zaXplPTgxOTIpOgogICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbyhmIkRvd25sb2FkZWQgdG8ge3NhdmVfcGF0aH0iKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIGRvd25sb2FkIHt1cmx9OiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIHVwZGF0ZV9uYXRzX2FnZW50KHNlcnZlcl9pbmZvKToKICAgICIiIlVwZGF0ZSBOQVRTIGFnZW50IGZpbGVzIiIiCiAgICB0cnk6CiAgICAgICAgc3lzdGVtID0gcGxhdGZvcm0uc3lzdGVtKCkKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIFN0YXJ0aW5nIE5BVFMgYWdlbnQgdXBkYXRlIG9uIHtzeXN0ZW19IikKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIEFnZW50IGJhc2UgZGlyZWN0b3J5OiB7YWdlbnRfYmFzZV9kaXJ9IikKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIEFnZW50IGJhc2UgZGlyIGV4aXN0czoge29zLnBhdGguZXhpc3RzKGFnZW50X2Jhc2VfZGlyKX0iKQoKICAgICAgICAjIERldGVybWluZSBwbGF0Zm9ybSBhbmQgaGFzaAogICAgICAgIGlmIHN5c3RlbSA9PSAnV2luZG93cyc6CiAgICAgICAgICAgIHBsYXRmb3JtX25hbWUgPSAnV2luZG93cycKICAgICAgICAgICAgZXhwZWN0ZWRfaGFzaCA9IHNlcnZlcl9pbmZvWydoYXNoX3B5J10KICAgICAgICBlbGlmIHN5c3RlbSA9PSAnTGludXgnOgogICAgICAgICAgICBwbGF0Zm9ybV9uYW1lID0gJ0xpbnV4JwogICAgICAgICAgICBleHBlY3RlZF9oYXNoID0gc2VydmVyX2luZm9bJ2hhc2hfbGludXgnXQogICAgICAgIGVsaWYgc3lzdGVtID09ICdEYXJ3aW4nOgogICAgICAgICAgICBwbGF0Zm9ybV9uYW1lID0gJ01hY09TJwogICAgICAgICAgICBleHBlY3RlZF9oYXNoID0gc2VydmVyX2luZm9bJ2hhc2hfbWFjb3MnXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIltVUERBVEVdIFVuc3VwcG9ydGVkIHBsYXRmb3JtOiB7c3lzdGVtfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIFBsYXRmb3JtOiB7cGxhdGZvcm1fbmFtZX0sIEV4cGVjdGVkIGhhc2g6IHtleHBlY3RlZF9oYXNofSIpCgogICAgICAgICMgQ3JlYXRlIGJhY2t1cCBkaXJlY3RvcnkKICAgICAgICBiYWNrdXBfZGlyID0gb3MucGF0aC5qb2luKGFnZW50X2Jhc2VfZGlyLCAnYmFja3VwJywgc2VydmVyX2luZm9bJ3ZlcnNpb24nXSkKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIENyZWF0aW5nIGJhY2t1cCBkaXJlY3Rvcnk6IHtiYWNrdXBfZGlyfSIpCiAgICAgICAgb3MubWFrZWRpcnMoYmFja3VwX2RpciwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIEJhY2t1cCBkaXJlY3RvcnkgcmVhZHkiKQoKICAgICAgICAjIEZpbGVzIHRvIHVwZGF0ZQogICAgICAgIGZpbGVzX3RvX3VwZGF0ZSA9IFsKICAgICAgICAgICAgJ25hdHNfYWdlbnQucHknLAogICAgICAgICAgICAnY29yZS9uYXRzX3NlcnZpY2UucHknLAogICAgICAgICAgICAnY29yZS9hZ2VudC5weScsCiAgICAgICAgICAgICdjb3JlL2FwaV9jbGllbnQucHknCiAgICAgICAgXQoKICAgICAgICAjIERvd25sb2FkIGFuZCB2ZXJpZnkgZWFjaCBmaWxlCiAgICAgICAgZm9yIGZpbGVuYW1lIGluIGZpbGVzX3RvX3VwZGF0ZToKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbVVBEQVRFXSBQcm9jZXNzaW5nIGZpbGU6IHtmaWxlbmFtZX0iKQogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8ve2hvc3R9L2luc3RhbGxlckZpbGVzL3twbGF0Zm9ybV9uYW1lfS9BZ2VudC97ZmlsZW5hbWV9IgogICAgICAgICAgICB0ZW1wX3BhdGggPSBvcy5wYXRoLmpvaW4oYWdlbnRfYmFzZV9kaXIsIGYie2ZpbGVuYW1lfS5uZXciKQoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbVVBEQVRFXSBEb3dubG9hZCBVUkw6IHt1cmx9IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbVVBEQVRFXSBUZW1wIHBhdGg6IHt0ZW1wX3BhdGh9IikKCiAgICAgICAgICAgICMgQ3JlYXRlIGRpcmVjdG9yeSBpZiBuZWVkZWQKICAgICAgICAgICAgdGVtcF9kaXIgPSBvcy5wYXRoLmRpcm5hbWUodGVtcF9wYXRoKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIENyZWF0aW5nIHRlbXAgZGlyZWN0b3J5OiB7dGVtcF9kaXJ9IikKICAgICAgICAgICAgb3MubWFrZWRpcnModGVtcF9kaXIsIGV4aXN0X29rPVRydWUpCgogICAgICAgICAgICBpZiBub3QgZG93bmxvYWRfZmlsZSh1cmwsIHRlbXBfcGF0aCk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJbVVBEQVRFXSBGYWlsZWQgdG8gZG93bmxvYWQge2ZpbGVuYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiW1VQREFURV0gRG93bmxvYWRlZCB7ZmlsZW5hbWV9LCB2ZXJpZnlpbmcuLi4iKQoKICAgICAgICAgICAgIyBWZXJpZnkgaGFzaCBmb3IgbWFpbiBmaWxlCiAgICAgICAgICAgIGlmIGZpbGVuYW1lID09ICduYXRzX2FnZW50LnB5JzoKICAgICAgICAgICAgICAgIGZpbGVfaGFzaCA9IGdldF9zaGEyNTZfaGFzaCh0ZW1wX3BhdGgpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIltVUERBVEVdIEZpbGUgaGFzaDoge2ZpbGVfaGFzaH0iKQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbVVBEQVRFXSBFeHBlY3RlZCBoYXNoOiB7ZXhwZWN0ZWRfaGFzaH0iKQogICAgICAgICAgICAgICAgaWYgZmlsZV9oYXNoICE9IGV4cGVjdGVkX2hhc2g6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiW1VQREFURV0gSGFzaCBtaXNtYXRjaCBmb3Ige2ZpbGVuYW1lfToge2ZpbGVfaGFzaH0gIT0ge2V4cGVjdGVkX2hhc2h9IikKICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9wYXRoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbVVBEQVRFXSBIYXNoIHZlcmlmaWVkIGZvciB7ZmlsZW5hbWV9IikKICAgICAgICAKICAgICAgICAjIEJhY2t1cCBjdXJyZW50IGZpbGVzCiAgICAgICAgZm9yIGZpbGVuYW1lIGluIGZpbGVzX3RvX3VwZGF0ZToKICAgICAgICAgICAgc3JjID0gb3MucGF0aC5qb2luKGFnZW50X2Jhc2VfZGlyLCBmaWxlbmFtZSkKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc3JjKToKICAgICAgICAgICAgICAgIGRzdCA9IG9zLnBhdGguam9pbihiYWNrdXBfZGlyLCBmaWxlbmFtZSkKICAgICAgICAgICAgICAgIG9zLm1ha2VkaXJzKG9zLnBhdGguZGlybmFtZShkc3QpLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKHNyYywgZHN0KQogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJCYWNrZWQgdXAge2ZpbGVuYW1lfSIpCiAgICAgICAgCiAgICAgICAgIyBSZXBsYWNlIGZpbGVzCiAgICAgICAgZm9yIGZpbGVuYW1lIGluIGZpbGVzX3RvX3VwZGF0ZToKICAgICAgICAgICAgdGVtcF9wYXRoID0gb3MucGF0aC5qb2luKGFnZW50X2Jhc2VfZGlyLCBmIntmaWxlbmFtZX0ubmV3IikKICAgICAgICAgICAgdGFyZ2V0X3BhdGggPSBvcy5wYXRoLmpvaW4oYWdlbnRfYmFzZV9kaXIsIGZpbGVuYW1lKQoKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gUHJvY2Vzc2luZyB7ZmlsZW5hbWV9IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gVGVtcCBwYXRoOiB7dGVtcF9wYXRofSIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiW1JFUExBQ0VdIFRhcmdldCBwYXRoOiB7dGFyZ2V0X3BhdGh9IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gVGVtcCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyh0ZW1wX3BhdGgpfSIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiW1JFUExBQ0VdIFRhcmdldCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyh0YXJnZXRfcGF0aCl9IikKCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHRlbXBfcGF0aCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gQXR0ZW1wdGluZyB0byBtb3ZlIHt0ZW1wX3BhdGh9IHRvIHt0YXJnZXRfcGF0aH0iKQoKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRhcmdldCBleGlzdHMgYW5kIHRyeSB0byByZW1vdmUgaXQgZmlyc3QKICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyh0YXJnZXRfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiW1JFUExBQ0VdIFRhcmdldCBleGlzdHMsIGF0dGVtcHRpbmcgdG8gcmVtb3ZlIGl0IGZpcnN0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHRhcmdldF9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgb2xkIHtmaWxlbmFtZX0iKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJbUkVQTEFDRV0gRmFpbGVkIHRvIHJlbW92ZSBvbGQge2ZpbGVuYW1lfToge2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgICAgICAgICAjIE5vdyBtb3ZlIHRoZSBuZXcgZmlsZQogICAgICAgICAgICAgICAgICAgIHNodXRpbC5tb3ZlKHRlbXBfcGF0aCwgdGFyZ2V0X3BhdGgpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJbUkVQTEFDRV0gU3VjY2Vzc2Z1bGx5IG1vdmVkIHt0ZW1wX3BhdGh9IHRvIHt0YXJnZXRfcGF0aH0iKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiW1JFUExBQ0VdIFZlcmlmeWluZyBmaWxlIGV4aXN0cyBhdCB0YXJnZXQ6IHtvcy5wYXRoLmV4aXN0cyh0YXJnZXRfcGF0aCl9IikKCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiW1JFUExBQ0VdIEZhaWxlZCB0byByZXBsYWNlIHtmaWxlbmFtZX06IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiW1JFUExBQ0VdIEV4Y2VwdGlvbiB0eXBlOiB7dHlwZShlKS5fX25hbWVfX30iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiW1JFUExBQ0VdIFRlbXAgZmlsZSBub3QgZm91bmQ6IHt0ZW1wX3BhdGh9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAjIFdyaXRlIHZlcnNpb24gZmlsZQogICAgICAgIHZlcnNpb25fZmlsZSA9IG9zLnBhdGguam9pbihhZ2VudF9iYXNlX2RpciwgJ1ZFUlNJT04nKQogICAgICAgIHdpdGggb3Blbih2ZXJzaW9uX2ZpbGUsICd3JykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzZXJ2ZXJfaW5mb1sndmVyc2lvbiddKQogICAgICAgIGxvZ2dlci5pbmZvKGYiW1NVQ0NFU1NdIFdyb3RlIFZFUlNJT04gZmlsZToge3ZlcnNpb25fZmlsZX0iKQoKICAgICAgICBsb2dnZXIuaW5mbyhmIltTVUNDRVNTXSBOQVRTIGFnZW50IHVwZGF0ZWQgdG8ge3NlcnZlcl9pbmZvWyd2ZXJzaW9uJ119IikKICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIlVwZGF0ZSBmYWlsZWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgdXBkYXRlX3NlcnZlcl9wdWJsaWNfa2V5KCk6CiAgICAiIiJVcGRhdGUgc2VydmVyIHB1YmxpYyBrZXkgaW4gYWdlbnQgY29uZmlnIiIiCiAgICB0cnk6CiAgICAgICAgbG9nZ2VyLmluZm8oIlVwZGF0aW5nIHNlcnZlciBwdWJsaWMga2V5IGluIGFnZW50IGNvbmZpZyIpCgogICAgICAgICMgR2V0IGNvbmZpZyBmaWxlIHBhdGgKICAgICAgICBzeXN0ZW0gPSBwbGF0Zm9ybS5zeXN0ZW0oKQogICAgICAgIGlmIHN5c3RlbSA9PSAnV2luZG93cyc6CiAgICAgICAgICAgIGNvbmZpZ19kaXIgPSAnQzpcXFdlZ3dlaXNlclxcQ29uZmlnJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbmZpZ19kaXIgPSAnL29wdC9XZWd3ZWlzZXIvQ29uZmlnJwoKICAgICAgICBjb25maWdfZmlsZSA9IG9zLnBhdGguam9pbihjb25maWdfZGlyLCAnYWdlbnQuY29uZmlnJykKCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGNvbmZpZ19maWxlKToKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJDb25maWcgZmlsZSBub3QgZm91bmQ6IHtjb25maWdfZmlsZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgIyBSZWFkIGN1cnJlbnQgY29uZmlnCiAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAncicpIGFzIGY6CiAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQoKICAgICAgICAjIEdldCBuZXcgc2VydmVyIHB1YmxpYyBrZXkgZnJvbSBzZXJ2ZXIKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybCA9IGYnaHR0cHM6Ly97aG9zdH0vZGlhZ3Mvc2VydmVycHVia2V5JwogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHRpbWVvdXQ9MTAsIHZlcmlmeT1GYWxzZSkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgbmV3X3B1YmtleSA9IGRhdGEuZ2V0KCdzZXJ2ZXJwdWJwZW0nKQoKICAgICAgICAgICAgaWYgbmV3X3B1YmtleToKICAgICAgICAgICAgICAgIGNvbmZpZ1snc2VydmVycHVicGVtJ10gPSBuZXdfcHVia2V5CgogICAgICAgICAgICAgICAgIyBXcml0ZSB1cGRhdGVkIGNvbmZpZwogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wKGNvbmZpZywgZiwgaW5kZW50PTIpCgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlNlcnZlciBwdWJsaWMga2V5IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiU2VydmVyIGRpZCBub3QgcmV0dXJuIHB1YmxpYyBrZXkiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkZhaWxlZCB0byBmZXRjaCBuZXcgc2VydmVyIHB1YmxpYyBrZXk6IHtlfSIpCiAgICAgICAgICAgICMgQ29udGludWUgYW55d2F5IC0gb2xkIGtleSBtaWdodCBzdGlsbCB3b3JrCiAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byB1cGRhdGUgc2VydmVyIHB1YmxpYyBrZXk6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgcmVzdGFydF9uYXRzX2FnZW50KCk6CiAgICAiIiJSZXN0YXJ0IE5BVFMgYWdlbnQgc2VydmljZSIiIgogICAgdHJ5OgogICAgICAgIHN5c3RlbSA9IHBsYXRmb3JtLnN5c3RlbSgpCgogICAgICAgIGlmIHN5c3RlbSA9PSAnV2luZG93cyc6CiAgICAgICAgICAgICMgUmVzdGFydCBXaW5kb3dzIHNlcnZpY2UKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyduZXQnLCAnc3RvcCcsICdXZWd3ZWlzZXJTZXJ2aWNlSG9zdCddLCBjaGVjaz1GYWxzZSkKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ25ldCcsICdzdGFydCcsICdXZWd3ZWlzZXJTZXJ2aWNlSG9zdCddLCBjaGVjaz1GYWxzZSkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlJlc3RhcnRlZCBXZWd3ZWlzZXJTZXJ2aWNlSG9zdCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBSZXN0YXJ0IHN5c3RlbWQgc2VydmljZQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ3N1ZG8nLCAnc3lzdGVtY3RsJywgJ3Jlc3RhcnQnLCAnd2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQnXSwgY2hlY2s9RmFsc2UpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJSZXN0YXJ0ZWQgd2Vnd2Vpc2VyLXBlcnNpc3RlbnQtYWdlbnQiKQoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmIkZhaWxlZCB0byByZXN0YXJ0IGFnZW50OiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIG1haW4oKToKICAgICIiIk1haW4gdXBkYXRlIGxvZ2ljIiIiCiAgICBsb2dnZXIuaW5mbygiU3RhcnRpbmcgTkFUUyBhZ2VudCB1cGRhdGUgY2hlY2siKQoKICAgICMgVXBkYXRlIHNlcnZlciBwdWJsaWMga2V5IGZpcnN0IChmb3Igc2lnbmF0dXJlIHZlcmlmaWNhdGlvbikKICAgIHVwZGF0ZV9zZXJ2ZXJfcHVibGljX2tleSgpCgogICAgIyBHZXQgdmVyc2lvbnMKICAgIGxvY2FsX3ZlcnNpb24gPSBnZXRfbG9jYWxfbmF0c19hZ2VudF92ZXJzaW9uKCkKICAgIHNlcnZlcl9pbmZvID0gZ2V0X3NlcnZlcl9uYXRzX2FnZW50X3ZlcnNpb24oKQoKICAgIGlmIG5vdCBzZXJ2ZXJfaW5mbzoKICAgICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byBnZXQgc2VydmVyIHZlcnNpb24gaW5mbyIpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBsb2dnZXIuaW5mbyhmIkxvY2FsIHZlcnNpb246IHtsb2NhbF92ZXJzaW9ufSIpCiAgICBsb2dnZXIuaW5mbyhmIlNlcnZlciB2ZXJzaW9uOiB7c2VydmVyX2luZm9bJ3ZlcnNpb24nXX0iKQoKICAgICMgQ2hlY2sgaWYgdXBkYXRlIG5lZWRlZAogICAgaWYgbm90IGNvbXBhcmVfdmVyc2lvbnMobG9jYWxfdmVyc2lvbiwgc2VydmVyX2luZm9bJ3ZlcnNpb24nXSk6CiAgICAgICAgbG9nZ2VyLmluZm8oIk5BVFMgYWdlbnQgaXMgdXAgdG8gZGF0ZSIpCiAgICAgICAgc3lzLmV4aXQoMCkKCiAgICBsb2dnZXIuaW5mbygiTkFUUyBhZ2VudCB1cGRhdGUgcmVxdWlyZWQiKQoKICAgICMgUGVyZm9ybSB1cGRhdGUKICAgIGlmIG5vdCB1cGRhdGVfbmF0c19hZ2VudChzZXJ2ZXJfaW5mbyk6CiAgICAgICAgbG9nZ2VyLmVycm9yKCJVcGRhdGUgZmFpbGVkIikKICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgV3JpdGUgVkVSU0lPTiBmaWxlIHRvIG1hcmsgc3VjY2Vzc2Z1bCB1cGRhdGUKICAgIHRyeToKICAgICAgICB2ZXJzaW9uX2ZpbGUgPSBvcy5wYXRoLmpvaW4oYWdlbnRfYmFzZV9kaXIsICdWRVJTSU9OJykKICAgICAgICB3aXRoIG9wZW4odmVyc2lvbl9maWxlLCAndycpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoc2VydmVyX2luZm9bJ3ZlcnNpb24nXSkKICAgICAgICBsb2dnZXIuaW5mbyhmIldyb3RlIFZFUlNJT04gZmlsZToge3ZlcnNpb25fZmlsZX0iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci53YXJuaW5nKGYiRmFpbGVkIHRvIHdyaXRlIFZFUlNJT04gZmlsZToge2V9IikKCiAgICAjIFJlc3RhcnQgYWdlbnQKICAgIGlmIG5vdCByZXN0YXJ0X25hdHNfYWdlbnQoKToKICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIHJlc3RhcnQgYWdlbnQgKG1heSByZXN0YXJ0IG9uIG5leHQgY3ljbGUpIikKCiAgICBsb2dnZXIuaW5mbygiTkFUUyBhZ2VudCB1cGRhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSIpCiAgICBzeXMuZXhpdCgwKQoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIG1haW4oKQoK"}, "resigned_at": 1761308227}