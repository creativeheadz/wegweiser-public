{% extends "base.html" %}

{% block title %}{{ message.title }} - Wegweiser{% endblock %}

{% block content %}
<div class="main-content p-4">
    <!-- Breadcrumb Navigation -->
    {% call breadcrumb(title='Communication', items=[
        {'text': 'Message Centre', 'icon': 'fas fa-envelope', 'url': url_for('messagecentre_bp.messagecentre')},
        {'text': message.title, 'icon': 'fas fa-envelope-open'}
    ]) %}
    {% endcall %}

    <!-- Message Header -->
    <div class="card mb-3">
        <div class="card-body py-3">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-3">
                    <div class="message-type-icon">
                        <i class="fas fa-broadcast-tower text-warning fa-2x"></i>
                    </div>
                    <div>
                        <h5 class="mb-0">{{ message.title }}</h5>
                        <p class="mb-0 text-muted small">System Message</p>
                    </div>
                </div>
                <a href="{{ url_for('messagecentre_bp.messagecentre') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Back to Messages
                </a>
            </div>
        </div>
    </div>

    <!-- Message Content -->
    <div class="card">
        <div class="card-body">
            <!-- Message Meta Information -->
            <div class="message-meta-info mb-4 p-3 rounded" style="background: var(--glass-bg); border: 1px solid var(--glass-border);">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-user text-muted"></i>
                            <div>
                                <small class="text-muted d-block">From</small>
                                <strong>{{ message.sender }}</strong>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-clock text-muted"></i>
                            <div>
                                <small class="text-muted d-block">Received</small>
                                <strong>{{ message.timestamp }}</strong>
                            </div>
                        </div>
                    </div>
                    {% if message.entity_info %}
                    <div class="col-12">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-info-circle text-muted"></i>
                            <div>
                                <small class="text-muted d-block">Related to</small>
                                <strong>{{ message.entity_info }}</strong>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Message Content -->
            <div class="message-content-body">
                <div class="content-wrapper p-4 rounded" style="background: var(--glass-bg); border: 1px solid var(--glass-border); min-height: 200px;">
                    {{ message.content|safe }}
                </div>
            </div>

            <!-- Message Actions -->
            <div class="message-actions mt-4 pt-3 border-top">
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="markAsRead()">
                        <i class="fas fa-check me-1"></i> Mark as Read
                    </button>
                    <button class="btn btn-outline-secondary" onclick="window.print()">
                        <i class="fas fa-print me-1"></i> Print
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Message View Specific Styles */
.message-type-icon {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--glass-bg);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--glass-border);
}

.message-meta-info {
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
}

.content-wrapper {
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    line-height: 1.6;
}

.content-wrapper p:last-child {
    margin-bottom: 0;
}

.message-actions {
    border-top: 1px solid var(--glass-border) !important;
}

/* Print styles */
@media print {
    .page-breadcrumb,
    .message-actions,
    .btn {
        display: none !important;
    }

    .card {
        border: none !important;
        box-shadow: none !important;
    }
}
</style>

<script>
function markAsRead() {
    // This could be enhanced to make an AJAX call to mark the message as read
    const btn = event.target.closest('button');
    btn.innerHTML = '<i class="fas fa-check me-1"></i> Marked as Read';
    btn.disabled = true;
    btn.classList.remove('btn-outline-primary');
    btn.classList.add('btn-success');
}
</script>
{% endblock %}